(self.webpackChunkscada=self.webpackChunkscada||[]).push([[269],{269:(kt,Et,b)=>{"use strict";b.r(Et),b.d(Et,{EditorModule:()=>Ri});var E=b(6895),at=b(4575),e=b(4650),lt=b(1481),Mt=b(1445),dt=b(9651),pt=b(9985),L=b(1102),$=b(6616),st=b(7044),ut=b(1664),tt=b(5635);const Xt=[[["","more",""]],"*"],qt=function(s){return{close:s}},$t=["[more]","*"];let vt=(()=>{class s{constructor(){this.open=!0,this.title="\u6807\u9898"}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-collapse"]],inputs:{open:"open",title:"title"},ngContentSelectors:$t,decls:9,vars:5,consts:[[1,"header",3,"click"],["nz-icon","","nzType","caret-right","nzTheme","outline",3,"nzRotate"],[1,"title"],[1,"content",3,"ngClass"],[1,"inner"]],template:function(t,i){1&t&&(e.F$t(Xt),e.TgZ(0,"div",0),e.NdJ("click",function(){return i.open=!i.open}),e._UZ(1,"span",1),e.TgZ(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"span"),e.Hsn(5),e.qZA()(),e.TgZ(6,"div",3)(7,"div",4),e.Hsn(8,1),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("nzRotate",i.open?90:0),e.xp6(2),e.Oqu(i.title),e.xp6(3),e.Q6J("ngClass",e.VKq(3,qt,!i.open)))},dependencies:[E.mk,L.Ls,st.w],styles:[".header[_ngcontent-%COMP%]{border-top:1px solid #a8a8a8;border-bottom:1px solid #a8a8a8;padding:4px;background-color:#f0f0f0;cursor:pointer;font-weight:700;font-size:1.1em;-webkit-user-select:none;user-select:none;align-items:center;display:flex}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1}.content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{padding:4px}.content.close[_ngcontent-%COMP%]{height:0;max-height:0;overflow:hidden}"]}),s})();var Kt=b(6273);function te(s,n){1&s&&e._UZ(0,"span",7)}function ee(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.more())}),e._uU(1,"\u66f4\u591a"),e.qZA()}}function Zt(s,n){if(1&s&&e._UZ(0,"img",14),2&s){const t=e.oxw().$implicit;e.Q6J("src",t.icon,e.LSH)("alt",t.name)}}function Jt(s,n){if(1&s&&(e._UZ(0,"div",15),e.ALo(1,"html")),2&s){const t=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,t.svg),e.oJD)}}function U(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",11),e.NdJ("dragstart",function(o){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onDragStart(o,a))}),e.YNc(1,Zt,1,2,"img",12),e.YNc(2,Jt,2,3,"div",13),e.qZA()}if(2&s){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",t.svg)}}function d(s,n){if(1&s&&(e.TgZ(0,"app-collapse",9),e.YNc(1,U,3,3,"div",10),e.qZA()),2&s){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngForOf",t.components)}}let f=(()=>{class s{constructor(t){this.cs=t,this.onDrag=new e.vpe}onDragStart(t,i){console.log("drag",i.id),this.onDrag.emit({event:t,component:i})}handleClick(){}more(){}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(pt.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-library"]],outputs:{onDrag:"onDrag"},decls:9,vars:3,consts:[[1,"header"],["nzSearch","",3,"nzSuffix","nzAddOnAfter"],["type","text","nz-input","","placeholder","\u63a7\u4ef6\u540d\u79f0"],["suffixIconSearch",""],["suffixIconButton",""],[1,"collections"],[3,"title",4,"ngFor","ngForOf"],["nz-icon","","nzType","search"],["nz-button","",3,"click"],[3,"title"],["class","item","draggable","true",3,"title","dragstart",4,"ngFor","ngForOf"],["draggable","true",1,"item",3,"title","dragstart"],[3,"src","alt",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[3,"src","alt"],[3,"innerHTML"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"nz-input-group",1),e._UZ(2,"input",2),e.qZA(),e.YNc(3,te,1,0,"ng-template",null,3,e.W1O),e.YNc(5,ee,2,0,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(7,"div",5),e.YNc(8,d,2,2,"app-collapse",6),e.qZA()),2&t){const o=e.MAs(4),r=e.MAs(6);e.xp6(1),e.Q6J("nzSuffix",o)("nzAddOnAfter",r),e.xp6(7),e.Q6J("ngForOf",i.cs.collections)}},dependencies:[E.sg,E.O5,L.Ls,$.ix,st.w,ut.dQ,tt.Zp,tt.gB,tt.ke,vt,Kt.$],styles:["[_nghost-%COMP%]{height:100%;overflow:hidden;-webkit-user-select:none;user-select:none;border-right:1px solid #a8a8a8;position:relative;display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:5px}.collections[_ngcontent-%COMP%]{flex:1;overflow:auto}.more-btn[_ngcontent-%COMP%]{width:100%;text-align:center;position:absolute;bottom:0}.item[_ngcontent-%COMP%]{display:inline-block;text-align:center;padding:4px;cursor:pointer}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:30px;height:30px}.item[_ngcontent-%COMP%]     svg{width:30px;height:30px}"]}),s})();var I,s,A,l=b(760);class ot extends l.G7{get model(){return this.graph.model}get view(){return this.graph.renderer.findViewByCell(this.node)}get containerClassName(){return this.prefixClassName("widget-transform")}get resizeClassName(){return`${this.containerClassName}-resize`}get rotateClassName(){return`${this.containerClassName}-rotate`}constructor(n,t,i){super(),this.node=t,this.graph=i,this.options=Object.assign(Object.assign({},I.defaultOptions),n),this.render(),this.startListening()}startListening(){this.delegateEvents({[`mousedown .${this.resizeClassName}`]:"startResizing",[`touchstart .${this.resizeClassName}`]:"startResizing",[`mousedown .${this.rotateClassName}`]:"startRotating",[`touchstart .${this.rotateClassName}`]:"startRotating"}),this.model.on("*",this.update,this),this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this),this.node.on("removed",this.remove,this),this.model.on("reseted",this.remove,this),this.view.on("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.on("cell:knob:mouseup",this.onKnobMouseUp,this)}stopListening(){this.undelegateEvents(),this.model.off("*",this.update,this),this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this),this.node.off("removed",this.remove,this),this.model.off("reseted",this.remove,this),this.view.off("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.off("cell:knob:mouseup",this.onKnobMouseUp,this)}renderHandles(){this.container=document.createElement("div");const n=document.createElement("div");l.is.attr(n,"draggable","false");const t=n.cloneNode(!0);l.is.addClass(t,this.rotateClassName);const i=I.POSITIONS.map(o=>{const r=n.cloneNode(!0);return l.is.addClass(r,this.resizeClassName),l.is.attr(r,"data-position",o),r});this.empty(),l.is.append(this.container,[...i,t])}render(){return this.renderHandles(),this.view&&this.view.addClass(I.NODE_CLS),l.is.addClass(this.container,this.containerClassName),l.is.toggleClass(this.container,"no-orth-resize",this.options.preserveAspectRatio||!this.options.orthogonalResizing),l.is.toggleClass(this.container,"no-resize",!this.options.resizable),l.is.toggleClass(this.container,"no-rotate",!this.options.rotatable),this.options.className&&l.is.addClass(this.container,this.options.className),this.graph.container.appendChild(this.container),this.update()}update(){const n=this.graph.matrix(),t=this.node.getBBox();t.x*=n.a,t.x+=n.e,t.y*=n.d,t.y+=n.f,t.width*=n.a,t.height*=n.d;const i=l.RZ.normalize(this.node.getAngle());return l.is.css(this.container,{transform:0!==i?`rotate(${i}deg)`:"",width:t.width,height:t.height,left:t.x,top:t.y}),this.updateResizerDirections(),this}remove(){return this.view&&this.view.removeClass(I.NODE_CLS),super.remove()}onKnobMouseDown(){this.startHandle()}onKnobMouseUp(){this.stopHandle()}updateResizerDirections(){const n=l.RZ.normalize(this.node.getAngle()),t=Math.floor(n*(I.DIRECTIONS.length/360));if(t!==this.prevShift){const i=I.DIRECTIONS.slice(t).concat(I.DIRECTIONS.slice(0,t)),o=a=>`${this.containerClassName}-cursor-${a}`;this.container.querySelectorAll(`.${this.resizeClassName}`).forEach((a,c)=>{l.is.removeClass(a,I.DIRECTIONS.map(h=>o(h)).join(" ")),l.is.addClass(a,o(i[c]))}),this.prevShift=t}}getTrueDirection(n){const t=l.RZ.normalize(this.node.getAngle());let i=I.POSITIONS.indexOf(n);return i+=Math.floor(t*(I.POSITIONS.length/360)),i%=I.POSITIONS.length,I.POSITIONS[i]}toValidResizeDirection(n){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[n]||n}startResizing(n){n.stopPropagation(),this.model.startBatch("resize",{cid:this.cid});const t=l.is.attr(n.target,"data-position");this.prepareResizing(n,t),this.startAction(n)}prepareResizing(n,t){const i=this.getTrueDirection(t);let o=0,r=0;t.split("-").forEach(u=>{o={left:-1,right:1}[u]||o,r={top:-1,bottom:1}[u]||r});const a=this.toValidResizeDirection(t),c={"top-right":"bottomLeft","top-left":"bottomRight","bottom-left":"topRight","bottom-right":"topLeft"}[a],h=l.RZ.normalize(this.node.getAngle());this.setEventData(n,{selector:c,direction:a,trueDirection:i,relativeDirection:t,angle:h,resizeX:o,resizeY:r,action:"resizing"})}startRotating(n){n.stopPropagation(),this.model.startBatch("rotate",{cid:this.cid});const t=this.node.getBBox().getCenter(),i=this.normalizeEvent(n),o=this.graph.snapToGrid(i.clientX,i.clientY);this.setEventData(n,{center:t,action:"rotating",angle:l.RZ.normalize(this.node.getAngle()),start:l.E9.create(o).theta(t)}),this.startAction(n)}onMouseMove(n){const t=this.graph.findViewByCell(this.node);let i=this.getEventData(n);if(i.action){const o=this.normalizeEvent(n);let r=o.clientX,a=o.clientY;const c=this.graph.getPlugin("scroller"),h=this.options.restrictedResizing;if(!0===h||"number"==typeof h){const C=!0===h?0:h,w=c?Math.max(C,8):C,z=this.graph.container.getBoundingClientRect();r=l.GH.clamp(r,z.left+w,z.right-w),a=l.GH.clamp(a,z.top+w,z.bottom-w)}else this.options.autoScrollOnResizing&&c&&c.autoScroll(r,a);const u=this.graph.snapToGrid(r,a),p=this.graph.getGridSize(),g=this.node,m=this.options;if("resizing"===i.action){i.resized||(t&&(t.addClass("node-resizing"),this.notify("node:resize",n,t)),i.resized=!0);const C=g.getBBox(),w=l.E9.create(u).rotate(i.angle,C.getCenter()).diff(C[i.selector]);let z=i.resizeX?w.x*i.resizeX:C.width,v=i.resizeY?w.y*i.resizeY:C.height;const k=z,y=v;if(z=l.Z4.snapToGrid(z,p),v=l.Z4.snapToGrid(v,p),z=Math.max(z,m.minWidth||p),v=Math.max(v,m.minHeight||p),z=Math.min(z,m.maxWidth||1/0),v=Math.min(v,m.maxHeight||1/0),m.preserveAspectRatio){const x=C.width*v/C.height;z<x?v=C.height*z/C.width:z=x}const S=i.relativeDirection;if(m.allowReverse&&(k<=-z||y<=-v)){let x;"left"===S?k<=-z&&(x="right"):"right"===S?k<=-z&&(x="left"):"top"===S?y<=-v&&(x="bottom"):"bottom"===S?y<=-v&&(x="top"):"top-left"===S?k<=-z&&y<=-v?x="bottom-right":k<=-z?x="top-right":y<=-v&&(x="bottom-left"):"top-right"===S?k<=-z&&y<=-v?x="bottom-left":k<=-z?x="top-left":y<=-v&&(x="bottom-right"):"bottom-left"===S?k<=-z&&y<=-v?x="top-right":k<=-z?x="bottom-right":y<=-v&&(x="top-left"):"bottom-right"===S&&(k<=-z&&y<=-v?x="top-left":k<=-z?x="bottom-left":y<=-v&&(x="top-right"));const O=x;this.stopHandle();const J=this.container.querySelector(`.${this.resizeClassName}[data-position="${O}"]`);this.startHandle(J),this.prepareResizing(n,O),this.onMouseMove(n)}C.width===z&&C.height===v||(g.resize(z,v,{ui:!0,direction:i.direction,relativeDirection:i.relativeDirection,trueDirection:i.trueDirection,minWidth:m.minWidth,minHeight:m.minHeight,maxWidth:m.maxWidth,maxHeight:m.maxHeight,preserveAspectRatio:!0===m.preserveAspectRatio}),this.notify("node:resizing",n,t))}else if("rotating"===i.action){i.rotated||(t&&(t.addClass("node-rotating"),this.notify("node:rotate",n,t)),i.rotated=!0);const C=g.getAngle(),w=i.start-l.E9.create(u).theta(i.center);let z=i.angle+w;m.rotateGrid&&(z=l.Z4.snapToGrid(z,m.rotateGrid)),z=l.RZ.normalize(z),C!==z&&(g.rotate(z,{absolute:!0}),this.notify("node:rotating",n,t))}}}onMouseUp(n){const t=this.getEventData(n);t.action&&(this.stopAction(n),this.model.stopBatch("resizing"===t.action?"resize":"rotate",{cid:this.cid}))}startHandle(n){if(this.handle=n||null,l.is.addClass(this.container,`${this.containerClassName}-active`),n){l.is.addClass(n,`${this.containerClassName}-active-handle`);const t=n.getAttribute("data-position");if(t){const i=I.DIRECTIONS[I.POSITIONS.indexOf(t)];l.is.addClass(this.container,`${this.containerClassName}-cursor-${i}`)}}}stopHandle(){if(l.is.removeClass(this.container,`${this.containerClassName}-active`),this.handle){l.is.removeClass(this.handle,`${this.containerClassName}-active-handle`);const n=this.handle.getAttribute("data-position");if(n){const t=I.DIRECTIONS[I.POSITIONS.indexOf(n)];l.is.removeClass(this.container,`${this.containerClassName}-cursor-${t}`)}this.handle=null}}startAction(n){this.startHandle(n.target),this.graph.view.undelegateEvents(),this.delegateDocumentEvents(I.documentEvents,n.data)}stopAction(n){this.stopHandle(),this.undelegateDocumentEvents(),this.graph.view.delegateEvents();const t=this.graph.findViewByCell(this.node),i=this.getEventData(n);t&&(t.removeClass(`node-${i.action}`),"resizing"===i.action&&i.resized?this.notify("node:resized",n,t):"rotating"===i.action&&i.rotated&&this.notify("node:rotated",n,t))}notify(n,t,i,o={}){if(i){const r=i.graph,a=r.view.normalizeEvent(t),c=r.snapToGrid(a.clientX,a.clientY);this.trigger(n,Object.assign({e:a,view:i,node:i.cell,cell:i.cell,x:c.x,y:c.y},o))}}dispose(){this.remove(),this.off()}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],ot.prototype,"dispose",null),(s=I||(I={})).NODE_CLS="has-widget-transform",s.DIRECTIONS=["nw","n","ne","e","se","s","sw","w"],s.POSITIONS=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],s.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp"},s.defaultOptions={minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,rotateGrid:15,rotatable:!0,preserveAspectRatio:!1,orthogonalResizing:!0,restrictedResizing:!1,autoScrollOnResizing:!0,allowReverse:!0},l.kJ.prototype.createTransformWidget=function(s){const n=this.getPlugin("transform");return n&&n.createWidget(s),this},l.kJ.prototype.clearTransformWidgets=function(){const s=this.getPlugin("transform");return s&&s.clearWidgets(),this};class ct extends l.ew{constructor(n={}){super(),this.name="transform",this.widgets=new Map,this.disabled=!1,this.options=n,l.mf.ensure(this.name,".x6-widget-transform {\n  position: absolute;\n  box-sizing: content-box !important;\n  margin: -5px 0 0 -5px;\n  padding: 4px;\n  border: 1px dashed #000;\n  border-radius: 5px;\n  user-select: none;\n  pointer-events: none;\n}\n.x6-widget-transform > div {\n  position: absolute;\n  box-sizing: border-box;\n  background-color: #fff;\n  border: 1px solid #000;\n  transition: background-color 0.2s;\n  pointer-events: auto;\n  -webkit-user-drag: none;\n  user-drag: none;\n  /* stylelint-disable-line */\n}\n.x6-widget-transform > div:hover {\n  background-color: #d3d3d3;\n}\n.x6-widget-transform-cursor-n {\n  cursor: n-resize;\n}\n.x6-widget-transform-cursor-s {\n  cursor: s-resize;\n}\n.x6-widget-transform-cursor-e {\n  cursor: e-resize;\n}\n.x6-widget-transform-cursor-w {\n  cursor: w-resize;\n}\n.x6-widget-transform-cursor-ne {\n  cursor: ne-resize;\n}\n.x6-widget-transform-cursor-nw {\n  cursor: nw-resize;\n}\n.x6-widget-transform-cursor-se {\n  cursor: se-resize;\n}\n.x6-widget-transform-cursor-sw {\n  cursor: sw-resize;\n}\n.x6-widget-transform-resize {\n  width: 10px;\n  height: 10px;\n  border-radius: 6px;\n}\n.x6-widget-transform-resize[data-position='top-left'] {\n  top: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='top-right'] {\n  top: -5px;\n  right: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-left'] {\n  bottom: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-right'] {\n  right: -5px;\n  bottom: -5px;\n}\n.x6-widget-transform-resize[data-position='top'] {\n  top: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom'] {\n  bottom: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='left'] {\n  top: 50%;\n  left: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform-resize[data-position='right'] {\n  top: 50%;\n  right: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='top'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='right'] {\n  display: none;\n}\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='right'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='top'] {\n  display: none;\n}\n.x6-widget-transform.no-resize .x6-widget-transform-resize {\n  display: none;\n}\n.x6-widget-transform-rotate {\n  top: -20px;\n  left: -20px;\n  width: 12px;\n  height: 12px;\n  border-radius: 6px;\n  cursor: crosshair;\n}\n.x6-widget-transform.no-rotate .x6-widget-transform-rotate {\n  display: none;\n}\n.x6-widget-transform-active {\n  border-color: transparent;\n  pointer-events: all;\n}\n.x6-widget-transform-active > div {\n  display: none;\n}\n.x6-widget-transform-active > .x6-widget-transform-active-handle {\n  display: block;\n  background-color: #808080;\n}\n")}init(n){this.graph=n,!this.disabled&&this.startListening()}startListening(){this.graph.on("node:click",this.onNodeClick,this),this.graph.on("blank:mousedown",this.onBlankMouseDown,this)}stopListening(){this.graph.off("node:click",this.onNodeClick,this),this.graph.off("blank:mousedown",this.onBlankMouseDown,this)}enable(){this.disabled&&(this.disabled=!1,this.startListening())}disable(){this.disabled||(this.disabled=!0,this.stopListening())}isEnabled(){return!this.disabled}createWidget(n){this.clearWidgets();const t=this.createTransform(n);t&&(this.widgets.set(n,t),t.on("*",(i,o)=>{this.trigger(i,o),this.graph.trigger(i,o)}))}onNodeClick({node:n}){this.createWidget(n)}onBlankMouseDown(){this.clearWidgets()}createTransform(n){const t=this.getTransformOptions(n);return t.resizable||t.rotatable?new ot(t,n,this.graph):null}getTransformOptions(n){this.options.resizing||(this.options.resizing={enabled:!1}),this.options.rotating||(this.options.rotating={enabled:!1}),"boolean"==typeof this.options.resizing&&(this.options.resizing={enabled:this.options.resizing}),"boolean"==typeof this.options.rotating&&(this.options.rotating={enabled:this.options.rotating});const t=ct.parseOptionGroup(this.graph,n,this.options.resizing),i=ct.parseOptionGroup(this.graph,n,this.options.rotating);return{resizable:!!t.enabled,minWidth:t.minWidth||0,maxWidth:t.maxWidth||Number.MAX_SAFE_INTEGER,minHeight:t.minHeight||0,maxHeight:t.maxHeight||Number.MAX_SAFE_INTEGER,orthogonalResizing:"boolean"!=typeof t.orthogonal||t.orthogonal,restrictedResizing:!!t.restrict,autoScrollOnResizing:"boolean"!=typeof t.autoScroll||t.autoScroll,preserveAspectRatio:!!t.preserveAspectRatio,allowReverse:"boolean"!=typeof t.allowReverse||t.allowReverse,rotatable:!!i.enabled,rotateGrid:i.grid||15}}clearWidgets(){this.widgets.forEach((n,t)=>{this.graph.getCellById(t.id)&&n.dispose()}),this.widgets.clear()}dispose(){this.clearWidgets(),this.stopListening(),this.off(),l.mf.clean(this.name)}}(function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)})([l.ew.dispose()],ct.prototype,"dispose",null),function(s){s.parseOptionGroup=function n(t,i,o){const r={};return Object.keys(o||{}).forEach(a=>{const c=o[a];r[a]="function"==typeof c?c.call(t,i):c}),r}}(ct||(ct={}));class Lt extends l.G7{get model(){return this.graph.model}get containerClassName(){return this.prefixClassName("widget-snapline")}get verticalClassName(){return`${this.containerClassName}-vertical`}get horizontalClassName(){return`${this.containerClassName}-horizontal`}constructor(n){super();const{graph:t}=n,i=function(s,n){var t={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.indexOf(i)<0&&(t[i]=s[i]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(s);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(t[i[o]]=s[i[o]])}return t}(n,["graph"]);this.graph=t,this.options=Object.assign({},i),this.offset={x:0,y:0},this.render(),this.disabled||this.startListening()}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.startListening())}disable(){this.disabled||(this.options.enabled=!1,this.stopListening())}setFilter(n){this.options.filter=n}render(){const n=this.containerWrapper=new l.OW("svg"),t=this.horizontal=new l.OW("line"),i=this.vertical=new l.OW("line");n.addClass(this.containerClassName),t.addClass(this.horizontalClassName),i.addClass(this.verticalClassName),n.setAttribute("width","100%"),n.setAttribute("height","100%"),t.setAttribute("display","none"),i.setAttribute("display","none"),n.append([t,i]),this.options.className&&n.addClass(this.options.className),this.container=this.containerWrapper.node}startListening(){this.stopListening(),this.graph.on("node:mousedown",this.captureCursorOffset,this),this.graph.on("node:mousemove",this.snapOnMoving,this),this.model.on("batch:stop",this.onBatchStop,this),this.delegateDocumentEvents({mouseup:"hide",touchend:"hide"})}stopListening(){this.graph.off("node:mousedown",this.captureCursorOffset,this),this.graph.off("node:mousemove",this.snapOnMoving,this),this.model.off("batch:stop",this.onBatchStop,this),this.undelegateDocumentEvents()}onBatchStop({name:n,data:t}){"resize"===n&&this.snapOnResizing(t.cell,t)}captureCursorOffset({view:n,x:t,y:i}){const o=n.getDelegatedView();if(o&&this.isNodeMovable(o)){const r=n.cell.getPosition();this.offset={x:t-r.x,y:i-r.y}}}isNodeMovable(n){return n&&n.cell.isNode()&&n.can("nodeMovable")}getRestrictArea(n){const t=this.graph.options.translating.restrict,i="function"==typeof t?l.Iw.call(t,this.graph,n):t;return"number"==typeof i?this.graph.transform.getGraphArea().inflate(i):!0===i?this.graph.transform.getGraphArea():i||null}snapOnResizing(n,t){if(this.options.resizing&&!t.snapped&&t.ui&&t.direction&&t.trueDirection){const i=this.graph.renderer.findViewByCell(n);if(i&&i.cell.isNode()){const o=n.getBBox(),r=o.bbox(n.getAngle()),a=r.getTopLeft(),c=r.getBottomRight(),h=l.RZ.normalize(n.getAngle()),u=this.options.tolerance||0;let p,g,m,C,w,z;const v={vertical:0,horizontal:0},k=t.direction,y=t.trueDirection,S=t.relativeDirection;v.vertical=-1!==y.indexOf("right")?c.x:a.x,v.horizontal=-1!==y.indexOf("bottom")?c.y:a.y,this.model.getNodes().some(Z=>{if(this.isIgnored(n,Z))return!1;const H=Z.getBBox().bbox(Z.getAngle()),zt=H.getTopLeft(),Wt=H.getBottomRight(),Oe={vertical:[zt.x,Wt.x],horizontal:[zt.y,Wt.y]},Rt={};return Object.keys(Oe).forEach(Zi=>{const de=Zi,Ji=Oe[de].map(wt=>({position:wt,distance:Math.abs(wt-v[de])})).filter(wt=>wt.distance<=u);Rt[de]=l.RO.sortBy(Ji,wt=>wt.distance)}),null==p&&Rt.vertical.length>0&&(p=Rt.vertical[0].position,g=Math.min(r.y,H.y),m=Math.max(c.y,Wt.y)-g),null==C&&Rt.horizontal.length>0&&(C=Rt.horizontal[0].position,w=Math.min(r.x,H.x),z=Math.max(c.x,Wt.x)-w),null!=p&&null!=C}),this.hide();let x=0,O=0;(null!=C||null!=p)&&(null!=p&&(x=-1!==y.indexOf("right")?p-c.x:a.x-p),null!=C&&(O=-1!==y.indexOf("bottom")?C-c.y:a.y-C));let J=0,Q=0;if(h%90==0)90===h||270===h?(J=O,Q=x):(J=x,Q=O);else{const Z=h>=0&&h<90?1:h>=90&&h<180?4:h>=180&&h<270?3:2;null!=C&&null!=p&&(x<O?(O=0,C=void 0):(x=0,p=void 0));const H=l.RZ.toRad(h%90);x&&(J=3===Z?x/Math.cos(H):x/Math.sin(H)),O&&(Q=3===Z?O/Math.cos(H):O/Math.sin(H));const zt=1===Z||3===Z;switch(S){case"top":case"bottom":Q=O?O/(zt?Math.cos(H):Math.sin(H)):x/(zt?Math.sin(H):Math.cos(H));break;case"left":case"right":J=x?x/(zt?Math.cos(H):Math.sin(H)):O/(zt?Math.sin(H):Math.cos(H))}}switch(S){case"top":case"bottom":J=0;break;case"left":case"right":Q=0}const rt=this.graph.getGridSize();let j=Math.max(o.width+J,rt),W=Math.max(o.height+Q,rt);t.minWidth&&t.minWidth>rt&&(j=Math.max(j,t.minWidth)),t.minHeight&&t.minHeight>rt&&(W=Math.max(W,t.minHeight)),t.maxWidth&&(j=Math.min(j,t.maxWidth)),t.maxHeight&&(W=Math.min(W,t.maxHeight)),t.preserveAspectRatio&&(Q<J?W=j*(o.height/o.width):j=W*(o.width/o.height)),(j!==o.width||W!==o.height)&&(n.resize(j,W,{direction:k,relativeDirection:S,trueDirection:y,snapped:!0,snaplines:this.cid,restrict:this.getRestrictArea(i)}),m&&(m+=W-o.height),z&&(z+=j-o.width));const G=n.getBBox().bbox(h);p&&Math.abs(G.x-p)>1&&Math.abs(G.width+G.x-p)>1&&(p=void 0),C&&Math.abs(G.y-C)>1&&Math.abs(G.height+G.y-C)>1&&(C=void 0),this.update({verticalLeft:p,verticalTop:g,verticalHeight:m,horizontalTop:C,horizontalLeft:w,horizontalWidth:z})}}}snapOnMoving({view:n,e:t,x:i,y:o}){const r=n.getEventData(t).delegatedView||n;if(!this.isNodeMovable(r))return;const a=r.cell,c=a.getSize(),h=a.getPosition(),u=new l.Ae(i-this.offset.x,o-this.offset.y,c.width,c.height),p=a.getAngle(),g=u.getCenter(),m=u.bbox(p),C=m.getTopLeft(),w=m.getBottomRight(),z=this.options.tolerance||0;let v,k,y,S,x,O,J=0,Q=0;if(this.model.getNodes().some(rt=>{if(this.isIgnored(a,rt))return!1;const j=rt.getBBox().bbox(rt.getAngle()),W=j.getCenter(),G=j.getTopLeft(),Z=j.getBottomRight();return null==v&&(Math.abs(W.x-g.x)<z?(v=W.x,J=.5):Math.abs(G.x-C.x)<z?(v=G.x,J=0):Math.abs(G.x-w.x)<z?(v=G.x,J=1):Math.abs(Z.x-w.x)<z?(v=Z.x,J=1):Math.abs(Z.x-C.x)<z&&(v=Z.x),null!=v&&(k=Math.min(m.y,j.y),y=Math.max(w.y,Z.y)-k)),null==S&&(Math.abs(W.y-g.y)<z?(S=W.y,Q=.5):Math.abs(G.y-C.y)<z?S=G.y:Math.abs(G.y-w.y)<z?(S=G.y,Q=1):Math.abs(Z.y-w.y)<z?(S=Z.y,Q=1):Math.abs(Z.y-C.y)<z&&(S=Z.y),null!=S&&(x=Math.min(m.x,j.x),O=Math.max(w.x,Z.x)-x)),null!=v&&null!=S}),this.hide(),null!=S||null!=v){null!=S&&(m.y=S-Q*m.height),null!=v&&(m.x=v-J*m.width);const rt=m.getCenter(),G=rt.x-u.width/2-h.x,Z=rt.y-u.height/2-h.y;(0!==G||0!==Z)&&(a.translate(G,Z,{snapped:!0,restrict:this.getRestrictArea(r)}),O&&(O+=G),y&&(y+=Z)),this.update({verticalLeft:v,verticalTop:k,verticalHeight:y,horizontalTop:S,horizontalLeft:x,horizontalWidth:O})}}isIgnored(n,t){return t.id===n.id||t.isDescendantOf(n)||!this.filter(t)}filter(n){const t=this.options.filter;return Array.isArray(t)?t.some(i=>"string"==typeof i?n.shape===i:n.id===i.id):"function"!=typeof t||l.Iw.call(t,this.graph,n)}update(n){if(n.horizontalTop){const t=this.graph.localToGraph(new l.E9(n.horizontalLeft,n.horizontalTop)),i=this.graph.localToGraph(new l.E9(n.horizontalLeft+n.horizontalWidth,n.horizontalTop));this.horizontal.setAttributes({x1:this.options.sharp?`${t.x}`:"0",y1:`${t.y}`,x2:this.options.sharp?`${i.x}`:"100%",y2:`${i.y}`,display:"inherit"})}else this.horizontal.setAttribute("display","none");if(n.verticalLeft){const t=this.graph.localToGraph(new l.E9(n.verticalLeft,n.verticalTop)),i=this.graph.localToGraph(new l.E9(n.verticalLeft,n.verticalTop+n.verticalHeight));this.vertical.setAttributes({x1:`${t.x}`,y1:this.options.sharp?`${t.y}`:"0",x2:`${i.x}`,y2:this.options.sharp?`${i.y}`:"100%",display:"inherit"})}else this.vertical.setAttribute("display","none");this.show()}resetTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}show(){return this.resetTimer(),null==this.container.parentNode&&this.graph.container.appendChild(this.container),this}hide(){this.resetTimer(),this.vertical.setAttribute("display","none"),this.horizontal.setAttribute("display","none");const n=this.options.clean,t="number"==typeof n?n:!1!==n?3e3:0;return t>0&&(this.timer=window.setTimeout(()=>{null!==this.container.parentNode&&this.unmount()},t)),this}onRemove(){this.stopListening(),this.hide()}dispose(){this.remove()}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],Lt.prototype,"dispose",null),l.kJ.prototype.isSnaplineEnabled=function(){const s=this.getPlugin("snapline");return!!s&&s.isEnabled()},l.kJ.prototype.enableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enable(),this},l.kJ.prototype.disableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disable(),this},l.kJ.prototype.toggleSnapline=function(){const s=this.getPlugin("snapline");return s&&s.toggleEnabled(),this},l.kJ.prototype.hideSnapline=function(){const s=this.getPlugin("snapline");return s&&s.hide(),this},l.kJ.prototype.setSnaplineFilter=function(s){const n=this.getPlugin("snapline");return n&&n.setFilter(s),this},l.kJ.prototype.isSnaplineOnResizingEnabled=function(){const s=this.getPlugin("snapline");return!!s&&s.isOnResizingEnabled()},l.kJ.prototype.enableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.enableOnResizing(),this},l.kJ.prototype.disableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.disableOnResizing(),this},l.kJ.prototype.toggleSnaplineOnResizing=function(s){const n=this.getPlugin("snapline");return n&&n.toggleOnResizing(s),this},l.kJ.prototype.isSharpSnapline=function(){const s=this.getPlugin("snapline");return!!s&&s.isSharp()},l.kJ.prototype.enableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enableSharp(),this},l.kJ.prototype.disableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disableSharp(),this},l.kJ.prototype.toggleSharpSnapline=function(s){const n=this.getPlugin("snapline");return n&&n.toggleSharp(s),this},l.kJ.prototype.getSnaplineTolerance=function(){const s=this.getPlugin("snapline");if(s)return s.getTolerance()},l.kJ.prototype.setSnaplineTolerance=function(s){const n=this.getPlugin("snapline");return n&&n.setTolerance(s),this};class T extends l.JT{constructor(n={}){super(),this.name="snapline",this.options=Object.assign({enabled:!0,tolerance:10},n),l.mf.ensure(this.name,".x6-widget-snapline {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  pointer-events: none;\n}\n.x6-widget-snapline-vertical,\n.x6-widget-snapline-horizontal {\n  stroke: #2ecc71;\n  stroke-width: 1px;\n}\n")}init(n){this.snaplineImpl=new Lt(Object.assign(Object.assign({},this.options),{graph:n}))}isEnabled(){return!this.snaplineImpl.disabled}enable(){this.snaplineImpl.enable()}disable(){this.snaplineImpl.disable()}toggleEnabled(n){if(null==n)return this.isEnabled()?this.disable():this.enable(),this;n!==this.isEnabled()&&(n?this.enable():this.disable())}hide(){return this.snaplineImpl.hide(),this}setFilter(n){return this.snaplineImpl.setFilter(n),this}isOnResizingEnabled(){return!0===this.snaplineImpl.options.resizing}enableOnResizing(){return this.snaplineImpl.options.resizing=!0,this}disableOnResizing(){return this.snaplineImpl.options.resizing=!1,this}toggleOnResizing(n){return null!=n?n!==this.isOnResizingEnabled()&&(n?this.enableOnResizing():this.disableOnResizing()):this.isOnResizingEnabled()?this.disableOnResizing():this.enableOnResizing(),this}isSharp(){return!0===this.snaplineImpl.options.sharp}enableSharp(){return this.snaplineImpl.options.sharp=!0,this}disableSharp(){return this.snaplineImpl.options.sharp=!1,this}toggleSharp(n){return null!=n?n!==this.isSharp()&&(n?this.enableSharp():this.disableSharp()):this.isSharp()?this.disableSharp():this.enableSharp(),this}getTolerance(){return this.snaplineImpl.options.tolerance}setTolerance(n){return this.snaplineImpl.options.tolerance=n,this}captureCursorOffset(n){this.snaplineImpl.captureCursorOffset(n)}snapOnMoving(n){this.snaplineImpl.snapOnMoving(n)}dispose(){this.snaplineImpl.dispose(),l.mf.clean(this.name)}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.JT.dispose()],T.prototype,"dispose",null);class M{constructor(){this.cells=[]}copy(n,t,i={}){this.options=Object.assign({},i);const r=(l.Hn.isModel(t)?t:t.model).cloneSubGraph(n,i);this.cells=l.RO.sortBy(Object.keys(r).map(a=>r[a]),a=>a.isEdge()?2:1),this.serialize(i)}cut(n,t,i={}){this.copy(n,t,i),(l.kJ.isGraph(t)?t.model:t).batchUpdate("cut",()=>{n.forEach(r=>r.remove())})}paste(n,t={}){const i=Object.assign(Object.assign({},this.options),t),{offset:o,edgeProps:r,nodeProps:a}=i;let c=20,h=20;o&&(c="number"==typeof o?o:o.dx,h="number"==typeof o?o:o.dy),this.deserialize(i);const u=this.cells;u.forEach(g=>{g.model=null,g.removeProp("zIndex"),(c||h)&&g.translate(c,h),a&&g.isNode()&&g.prop(a),r&&g.isEdge()&&g.prop(r)});const p=l.kJ.isGraph(n)?n.model:n;return p.batchUpdate("paste",()=>{p.addCells(this.cells)}),this.copy(u,n,t),u}serialize(n){!1!==n.useLocalStorage&&A.save(this.cells)}deserialize(n){if(n.useLocalStorage){const t=A.fetch();t&&(this.cells=t)}}isEmpty(n={}){return n.useLocalStorage&&this.deserialize(n),this.cells.length<=0}clean(){this.options={},this.cells=[],A.clean()}}(function(s){const n=`${l.De.prefixCls}.clipboard.cells`;s.save=function t(r){if(window.localStorage){const a=r.map(c=>c.toJSON());localStorage.setItem(n,JSON.stringify(a))}},s.fetch=function i(){if(window.localStorage){const r=localStorage.getItem(n),a=r?JSON.parse(r):[];if(a)return l.Hn.fromJSON(a)}},s.clean=function o(){window.localStorage&&localStorage.removeItem(n)}})(A||(A={})),l.kJ.prototype.isClipboardEnabled=function(){const s=this.getPlugin("clipboard");return!!s&&s.isEnabled()},l.kJ.prototype.enableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.enable(),this},l.kJ.prototype.disableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.disable(),this},l.kJ.prototype.toggleClipboard=function(s){const n=this.getPlugin("clipboard");return n&&n.toggleEnabled(s),this},l.kJ.prototype.isClipboardEmpty=function(s){const n=this.getPlugin("clipboard");return!n||n.isEmpty(s)},l.kJ.prototype.getCellsInClipboard=function(){const s=this.getPlugin("clipboard");return s?s.getCellsInClipboard():[]},l.kJ.prototype.cleanClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.clean(),this},l.kJ.prototype.copy=function(s,n){const t=this.getPlugin("clipboard");return t&&t.copy(s,n),this},l.kJ.prototype.cut=function(s,n){const t=this.getPlugin("clipboard");return t&&t.cut(s,n),this},l.kJ.prototype.paste=function(s,n){const t=this.getPlugin("clipboard");return t?t.paste(s,n):[]};class nt extends l.ew{get disabled(){return!0!==this.options.enabled}get cells(){return this.clipboardImpl.cells}constructor(n={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},n)}init(n){this.graph=n,this.clipboardImpl=new M,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(n={}){return this.clipboardImpl.isEmpty(n)}getCellsInClipboard(){return this.cells}clean(n){return(!this.disabled||n)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(n,t={}){return this.disabled||(this.clipboardImpl.copy(n,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:n})),this}cut(n,t={}){return this.disabled||(this.clipboardImpl.cut(n,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:n})),this}paste(n={},t=this.graph){return this.disabled?[]:this.clipboardImpl.paste(t,Object.assign(Object.assign({},this.commonOptions),n))}get commonOptions(){return function(s,n){var t={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.indexOf(i)<0&&(t[i]=s[i]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(s);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(t[i[o]]=s[i[o]])}return t}(this.options,["enabled"])}notify(n,t){this.trigger(n,t),this.graph.trigger(n,t)}dispose(){this.clean(!0),this.off()}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.ew.dispose()],nt.prototype,"dispose",null);var P=b(7521),Y=b.n(P);class X extends l.JT{get graph(){return this.options.graph}constructor(n){super(),this.options=n;const t=this.graph.getPlugin("scroller");this.container=t?t.container:this.graph.container,n.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=X.createMousetrap(this)}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(n,t,i){this.mousetrap.bind(this.getKeys(n),t,i)}off(n,t){this.mousetrap.unbind(this.getKeys(n),t)}clear(){this.mousetrap.reset()}trigger(n,t){this.mousetrap.trigger(n,t)}focus(n){this.isInputEvent(n.e)||this.target.focus({preventScroll:!0})}getKeys(n){return(Array.isArray(n)?n:[n]).map(t=>this.formatkey(t))}formatkey(n){const t=n.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command"),i=this.options.format;return i?l.Iw.call(i,this.graph,t):t}isGraphEvent(n){const t=n.target;return!!t&&(t===this.target||n.currentTarget===this.target||t===document.body||l.is.contains(this.container,t))}isInputEvent(n){var t;const i=n.target,o=null===(t=i?.tagName)||void 0===t?void 0:t.toLowerCase();let r=["input","textarea"].includes(o);return"true"===l.is.attr(i,"contenteditable")&&(r=!0),r}isEnabledForEvent(n){const t=!this.disabled&&this.isGraphEvent(n),i=this.isInputEvent(n);if(t){if(i&&("Backspace"===n.key||"Delete"===n.key))return!1;if(this.options.guard)return l.Iw.call(this.options.guard,this.graph,n)}return t}dispose(){this.mousetrap.reset()}}(function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)})([l.JT.dispose()],X.prototype,"dispose",null),function(s){s.createMousetrap=function n(t){const i=new(Y())(t.target),o=i.stopCallback;return i.stopCallback=(r,a,c)=>!t.isEnabledForEvent(r)||!!o&&o.call(i,r,a,c),i}}(X||(X={})),l.kJ.prototype.isKeyboardEnabled=function(){const s=this.getPlugin("keyboard");return!!s&&s.isEnabled()},l.kJ.prototype.enableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.enable(),this},l.kJ.prototype.disableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.disable(),this},l.kJ.prototype.toggleKeyboard=function(s){const n=this.getPlugin("keyboard");return n&&n.toggleEnabled(s),this},l.kJ.prototype.bindKey=function(s,n,t){const i=this.getPlugin("keyboard");return i&&i.bindKey(s,n,t),this},l.kJ.prototype.unbindKey=function(s,n){const t=this.getPlugin("keyboard");return t&&t.unbindKey(s,n),this},l.kJ.prototype.clearKeys=function(){const s=this.getPlugin("keyboard");return s&&s.clear(),this},l.kJ.prototype.triggerKey=function(s,n){const t=this.getPlugin("keyboard");return t&&t.trigger(s,n),this};class Gt extends l.JT{constructor(n={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},n)}init(n){this.keyboardImpl=new X(Object.assign(Object.assign({},this.options),{graph:n}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(n,t,i){return this.keyboardImpl.on(n,t,i),this}trigger(n,t){return this.keyboardImpl.trigger(n,t),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(n,t){return this.keyboardImpl.off(n,t),this}dispose(){this.keyboardImpl.dispose()}}(function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)})([l.JT.dispose()],Gt.prototype,"dispose",null),l.kJ.prototype.isHistoryEnabled=function(){const s=this.getPlugin("history");return!!s&&s.isEnabled()},l.kJ.prototype.enableHistory=function(){const s=this.getPlugin("history");return s&&s.enable(),this},l.kJ.prototype.disableHistory=function(){const s=this.getPlugin("history");return s&&s.disable(),this},l.kJ.prototype.toggleHistory=function(s){const n=this.getPlugin("history");return n&&n.toggleEnabled(s),this},l.kJ.prototype.undo=function(s){const n=this.getPlugin("history");return n&&n.undo(s),this},l.kJ.prototype.redo=function(s){const n=this.getPlugin("history");return n&&n.redo(s),this},l.kJ.prototype.undoAndCancel=function(s){const n=this.getPlugin("history");return n&&n.cancel(s),this},l.kJ.prototype.canUndo=function(){const s=this.getPlugin("history");return!!s&&s.canUndo()},l.kJ.prototype.canRedo=function(){const s=this.getPlugin("history");return!!s&&s.canRedo()},l.kJ.prototype.cleanHistory=function(s){const n=this.getPlugin("history");return n&&n.clean(s),this},l.kJ.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()},l.kJ.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()},l.kJ.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()},l.kJ.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var R,K,pe=function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);return o>3&&r&&Object.defineProperty(n,t,r),r};class yt extends l.ew{constructor(n={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:t=0}=n;this.stackSize=t,this.options=R.getOptions(n),this.validator=new yt.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(n){this.graph=n,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(n={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,n),this.redoStack.push(t),this.notify("undo",t,n))}return this}redo(n={}){if(!this.disabled){const t=this.redoStack.pop();t&&(this.applyCommand(t,n),this.undoStackPush(t),this.notify("redo",t,n))}return this}cancel(n={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,n),this.redoStack=[],this.notify("cancel",t,n))}return this}getSize(){return this.stackSize}getUndoRemainSize(){return this.stackSize-this.undoStack.length}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(n={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,n),this}get disabled(){return!0!==this.options.enabled}validate(n,...t){return this.validator.validate(n,...t),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((n,t)=>{this.handlers[t]=this.addCommand.bind(this,n),this.model.on(n,this.handlers[t])}),this.validator.on("invalid",n=>this.trigger("invalid",n))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((n,t)=>{this.model.off(n,this.handlers[t])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(n){return{batch:!!n&&n.batch,data:{}}}revertCommand(n,t){this.freezed=!0;const i=Array.isArray(n)?R.sortBatchCommands(n):[n];for(let o=i.length-1;o>=0;o-=1){const r=i[o],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.revertOptionsList||[]));this.executeCommand(r,!0,a)}this.freezed=!1}applyCommand(n,t){this.freezed=!0;const i=Array.isArray(n)?R.sortBatchCommands(n):[n];for(let o=0;o<i.length;o+=1){const r=i[o],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.applyOptionsList||[]));this.executeCommand(r,!1,a)}this.freezed=!1}executeCommand(n,t,i){const o=this.model,r=o.getCell(n.data.id),a=n.event;if(R.isAddEvent(a)&&t||R.isRemoveEvent(a)&&!t)r&&r.remove(i);else if(R.isAddEvent(a)&&!t||R.isRemoveEvent(a)&&t){const c=n.data;c.node?o.addNode(c.props,i):c.edge&&o.addEdge(c.props,i)}else if(R.isChangeEvent(a)){const c=n.data,h=c.key;if(h&&r){const u=t?c.prev[h]:c.next[h];"attrs"===c.key&&this.ensureUndefinedAttrs(u,t?c.next[h]:c.prev[h]),r.prop(h,u,i)}}else{const c=this.options.executeCommand;c&&l.Iw.call(c,this,n,t,i)}}addCommand(n,t){if(this.freezed||this.disabled)return;const i=t,o=i.options||{};if(o.dryrun||R.isAddEvent(n)&&this.options.ignoreAdd||R.isRemoveEvent(n)&&this.options.ignoreRemove||R.isChangeEvent(n)&&this.options.ignoreChange)return;const r=this.options.beforeAddCommand;if(null!=r&&!1===l.Iw.call(r,this,n,t))return;"cell:change:*"===n&&(n=`cell:change:${i.key}`);const a=i.cell,c=l.Hn.isModel(a);let h;if(this.batchCommands){if(h=this.batchCommands[Math.max(this.lastBatchIndex,0)],this.lastBatchIndex>=0&&(c&&!h.modelChange||h.data.id!==a.id||h.event!==n)){const m=this.batchCommands.findIndex(C=>(c&&C.modelChange||C.data.id===a.id)&&C.event===n);m<0||R.isAddEvent(n)||R.isRemoveEvent(n)?h=this.createCommand({batch:!0}):(h=this.batchCommands[m],this.batchCommands.splice(m,1)),this.batchCommands.push(h),this.lastBatchIndex=this.batchCommands.length-1}}else h=this.createCommand({batch:!1});if(R.isAddEvent(n)||R.isRemoveEvent(n)){const p=h.data;return h.event=n,h.options=o,p.id=a.id,p.props=l.QK.cloneDeep(a.toJSON()),a.isEdge()?p.edge=!0:a.isNode()&&(p.node=!0),this.push(h,o)}if(R.isChangeEvent(n)){const p=t.key,g=h.data;return(!h.batch||!h.event)&&(h.event=n,h.options=o,g.key=p,null==g.prev&&(g.prev={}),g.prev[p]=l.QK.cloneDeep(a.previous(p)),c?h.modelChange=!0:g.id=a.id),null==g.next&&(g.next={}),g.next[p]=l.QK.cloneDeep(a.prop(p)),this.push(h,o)}const u=this.options.afterAddCommand;u&&l.Iw.call(u,this,n,t,h),this.push(h,o)}initBatchCommand(n){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(n){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const t=this.filterBatchCommand(this.batchCommands);t.length>0&&(this.redoStack=[],this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,n)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(n){let t=n.slice();const i=[];for(;t.length>0;){const o=t.shift(),r=o.event,a=o.data.id;if(null!=r&&(null!=a||o.modelChange)){if(R.isAddEvent(r)){const c=t.findIndex(h=>R.isRemoveEvent(h.event)&&h.data.id===a);if(c>=0){t=t.filter((h,u)=>c<u||h.data.id!==a);continue}}else if(R.isRemoveEvent(r)){const c=t.findIndex(h=>R.isAddEvent(h.event)&&h.data.id===a);if(c>=0){t.splice(c,1);continue}}else if(R.isChangeEvent(r)){const c=o.data;if(l.QK.isEqual(c.prev,c.next))continue}i.push(o)}}return i}notify(n,t,i){const o=null==t?null:Array.isArray(t)?t:[t];this.emit(n,{cmds:o,options:i}),this.graph.trigger(`history:${n}`,{cmds:o,options:i}),this.emit("change",{cmds:o,options:i}),this.graph.trigger("history:change",{cmds:o,options:i})}push(n,t){this.redoStack=[],n.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:n,options:t})):(this.undoStackPush(n),this.consolidateCommands(),this.notify("add",n,t))}consolidateCommands(){var n;const t=this.undoStack[this.undoStack.length-1],i=this.undoStack[this.undoStack.length-2];if(!Array.isArray(t))return;const o=new Set(t.map(a=>a.event));if(!(2===o.size&&o.has("cell:change:parent")&&o.has("cell:change:children")&&t.every(a=>{var c;return a.batch&&(null===(c=a.options)||void 0===c?void 0:c.ui)})&&Array.isArray(i)&&1===i.length))return;const r=i[0];"cell:change:position"!==r.event||null===(n=r.options)||void 0===n||!n.ui||(i.push(...t),this.undoStack.pop())}undoStackPush(n){0!==this.stackSize?(this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(n)):this.undoStack.push(n)}ensureUndefinedAttrs(n,t){null!==n&&null!==t&&"object"==typeof n&&"object"==typeof t&&Object.keys(t).forEach(i=>{n.hasOwnProperty(i)?"object"==typeof n[i]&&"object"==typeof t[i]&&this.ensureUndefinedAttrs(n[i],t[i]):n[i]=void 0})}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}pe([l.ew.dispose()],yt.prototype,"dispose",null),function(s){class n extends l.ew{constructor(i){super(),this.map={},this.command=i.history,this.cancelInvalid=!1!==i.cancelInvalid,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:i}){return Array.isArray(i)?i.every(o=>this.isValidCommand(o)):this.isValidCommand(i)}isValidCommand(i){if(i.options&&!1===i.options.validation)return!0;let r=null;return(i.event&&this.map[i.event]||[]).forEach(a=>{let c=0;const h=u=>{const p=a[c];c+=1;try{if(!p)return void(r=u);p(u,i,h)}catch(g){h(g)}};h(r)}),!r||(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:r}),!1)}validate(i,...o){const r=Array.isArray(i)?i:i.split(/\s+/);return o.forEach(a=>{if("function"!=typeof a)throw new Error(`${r.join(" ")} requires callback functions.`)}),r.forEach(a=>{null==this.map[a]&&(this.map[a]=[]),this.map[a].push(o)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}pe([l.ew.dispose()],n.prototype,"dispose",null),s.Validator=n}(yt||(yt={})),function(s){s.isAddEvent=function n(a){return"cell:added"===a},s.isRemoveEvent=function t(a){return"cell:removed"===a},s.isChangeEvent=function i(a){return null!=a&&a.startsWith("cell:change:")},s.getOptions=function o(a){const c=["cell:added","cell:removed","cell:change:*"],h=["batch:start","batch:stop"],u=a.eventNames?a.eventNames.filter(p=>!(s.isChangeEvent(p)||c.includes(p)||h.includes(p))):c;return Object.assign(Object.assign({enabled:!0},a),{eventNames:u,applyOptionsList:a.applyOptionsList||["propertyPath"],revertOptionsList:a.revertOptionsList||["propertyPath"]})},s.sortBatchCommands=function r(a){const c=[];for(let h=0,u=a.length;h<u;h+=1){const p=a[h];let g=null;if(s.isAddEvent(p.event)){const m=p.data.id;for(let C=0;C<h;C+=1)if(a[C].data.id===m){g=C;break}}null!==g?c.splice(g,0,p):c.push(p)}return c}}(R||(R={}));class ue extends l.G7{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(K.classNames.box)}get $boxes(){return l.is.children(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(n){super(),this.options=n,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new l.FE([],{comparator:K.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const n=this.graph,t=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),n.on("scale",this.onGraphTransformed,this),n.on("translate",this.onGraphTransformed,this),n.model.on("updated",this.onModelUpdated,this),t.on("added",this.onCellAdded,this),t.on("removed",this.onCellRemoved,this),t.on("reseted",this.onReseted,this),t.on("updated",this.onCollectionUpdated,this),t.on("node:change:position",this.onNodePositionChanged,this),t.on("cell:changed",this.onCellChanged,this)}stopListening(){const n=this.graph,t=this.collection;this.undelegateEvents(),n.off("scale",this.onGraphTransformed,this),n.off("translate",this.onGraphTransformed,this),n.model.off("updated",this.onModelUpdated,this),t.off("added",this.onCellAdded,this),t.off("removed",this.onCellRemoved,this),t.off("reseted",this.onReseted,this),t.off("updated",this.onCollectionUpdated,this),t.off("node:change:position",this.onNodePositionChanged,this),t.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:n,options:t}){const{showNodeSelectionBox:i,pointerEvents:o}=this.options,{ui:r,selection:a,translateBy:c,snapped:h}=t;if(!(!0===i&&"none"!==o||this.translating||a)&&(r&&c&&n.id===c||h)){this.translating=!0;const g=n.position(),m=n.previous("position"),C=g.x-m.x,w=g.y-m.y;(0!==C||0!==w)&&this.translateSelectedNodes(C,w,n,t),this.translating=!1}}onModelUpdated({removed:n}){n&&n.length&&this.unselect(n)}isEmpty(){return this.length<=0}isSelected(n){return this.collection.has(n)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(n,t={}){t.dryrun=!0;const i=this.filter(Array.isArray(n)?n:[n]);return this.collection.add(i,t),this}unselect(n,t={}){return t.dryrun=!0,this.collection.remove(Array.isArray(n)?n:[n],t),this}reset(n,t={}){if(n){if(t.batch){const u=this.filter(Array.isArray(n)?n:[n]);return this.collection.reset(u,Object.assign(Object.assign({},t),{ui:!0})),this}const i=this.cells,o=this.filter(Array.isArray(n)?n:[n]),r={},a={};i.forEach(u=>r[u.id]=u),o.forEach(u=>a[u.id]=u);const c=[],h=[];return o.forEach(u=>{r[u.id]||c.push(u)}),i.forEach(u=>{a[u.id]||h.push(u)}),h.length&&this.unselect(h,Object.assign(Object.assign({},t),{ui:!0})),c.length&&this.select(c,Object.assign(Object.assign({},t),{ui:!0})),0===h.length&&0===c.length&&this.updateContainer(),this}return this.clean(t)}clean(n={}){return this.length&&(!1===n.batch?this.unselect(this.cells,n):this.collection.reset([],Object.assign(Object.assign({},n),{ui:!0}))),this}setFilter(n){this.options.filter=n}setContent(n){this.options.content=n}startSelecting(n){let t,i;n=this.normalizeEvent(n),this.clean();const o=this.graph.container;if(null!=n.offsetX&&null!=n.offsetY&&o.contains(n.target))t=n.offsetX,i=n.offsetY;else{const r=l.is.offset(o);t=n.clientX-r.left+window.pageXOffset+o.scrollLeft,i=n.clientY-r.top+window.pageYOffset+o.scrollTop}l.is.css(this.container,{top:i,left:t,width:1,height:1}),this.setEventData(n,{action:"selecting",clientX:n.clientX,clientY:n.clientY,offsetX:t,offsetY:i,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(K.documentEvents,n.data)}filter(n){const t=this.options.filter;return n.filter(i=>Array.isArray(t)?t.some(o=>"string"==typeof o?i.shape===o:i.id===o.id):"function"!=typeof t||l.Iw.call(t,this.graph,i))}stopSelecting(n){const t=this.graph,i=this.getEventData(n);switch(i.action){case"selecting":{let r=l.is.width(this.container),a=l.is.height(this.container);const c=l.is.offset(this.container),h=t.pageToLocal(c.left,c.top),u=t.transform.getScale();r/=u.sx,a/=u.sy;const p=new l.Ae(h.x,h.y,r,a),g=this.getCellViewsInArea(p).map(m=>m.cell);this.reset(g,{batch:!0}),this.hideRubberband();break}case"translating":{const r=t.snapToGrid(n.clientX,n.clientY);this.options.following||this.updateSelectedNodesPosition({dx:i.clientX-i.originX,dy:i.clientY-i.originY}),this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",n,r.x,r.y);break}default:this.clean()}}onMouseUp(n){this.getEventData(n).action&&(this.stopSelecting(n),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(n){this.options.following||n.stopPropagation();const t=this.normalizeEvent(n);this.options.movable&&this.startTranslating(t);const i=this.getCellViewFromElem(t.target);this.setEventData(t,{activeView:i});const o=this.graph.snapToGrid(t.clientX,t.clientY);this.notifyBoxEvent("box:mousedown",t,o.x,o.y),this.delegateDocumentEvents(K.documentEvents,t.data)}startTranslating(n){this.graph.model.startBatch("move-selection");const t=this.graph.snapToGrid(n.clientX,n.clientY);this.setEventData(n,{action:"translating",clientX:t.x,clientY:t.y,originX:t.x,originY:t.y})}getRestrictArea(){const n=this.graph.options.translating.restrict,t="function"==typeof n?l.Iw.call(n,this.graph,null):n;return"number"==typeof t?this.graph.transform.getGraphArea().inflate(t):!0===t?this.graph.transform.getGraphArea():t||null}getSelectionOffset(n,t){let i=n.x-t.clientX,o=n.y-t.clientY;const r=this.getRestrictArea();if(r){const a=this.collection.toArray(),c=l.bL.getCellsBBox(a,{deep:!0})||l.Ae.create(),h=r.x-c.x,u=r.y-c.y,p=r.x+r.width-(c.x+c.width),g=r.y+r.height-(c.y+c.height);if(i<h&&(i=h),o<u&&(o=u),p<i&&(i=p),g<o&&(o=g),!this.options.following){const m=n.x-t.originX,C=n.y-t.originY;i=m<=h||m>=p?0:i,o=C<=u||C>=g?0:o}}return{dx:i,dy:o}}updateElementPosition(n,t,i){const o=l.is.css(n,"left"),r=l.is.css(n,"top"),a=o?parseFloat(o):0,c=r?parseFloat(r):0;l.is.css(n,"left",a+t),l.is.css(n,"top",c+i)}updateSelectedNodesPosition(n){const{dx:t,dy:i}=n;if(t||i)if(this.translateSelectedNodes(t,i),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const o=this.graph.transform.getScale();for(let r=0,a=this.$boxes.length;r<a;r+=1)this.updateElementPosition(this.$boxes[r],t*o.sx,i*o.sy);this.updateElementPosition(this.selectionContainer,t*o.sx,i*o.sy)}}autoScrollGraph(n,t){const i=this.graph.getPlugin("scroller");return i?i.autoScroll(n,t):{scrollerX:0,scrollerY:0}}adjustSelection(n){const t=this.normalizeEvent(n),i=this.getEventData(t);switch(i.action){case"selecting":{const r=i;!0!==r.moving&&(l.is.appendTo(this.container,this.graph.container),this.showRubberband(),r.moving=!0);const{scrollerX:a,scrollerY:c}=this.autoScrollGraph(t.clientX,t.clientY);r.scrollerX+=a,r.scrollerY+=c;const h=t.clientX-r.clientX+r.scrollerX,u=t.clientY-r.clientY+r.scrollerY,p=parseInt(l.is.css(this.container,"left")||"0",10),g=parseInt(l.is.css(this.container,"top")||"0",10);l.is.css(this.container,{left:h<0?r.offsetX+h:p,top:u<0?r.offsetY+u:g,width:Math.abs(h),height:Math.abs(u)});break}case"translating":{const r=this.graph.snapToGrid(t.clientX,t.clientY),a=i,c=this.getSelectionOffset(r,a);this.options.following?this.updateSelectedNodesPosition(c):this.updateContainerPosition(c),c.dx&&(a.clientX=r.x),c.dy&&(a.clientY=r.y),this.notifyBoxEvent("box:mousemove",n,r.x,r.y);break}}this.boxesUpdated=!1}translateSelectedNodes(n,t,i,o){const r={},a=[];if(i&&(r[i.id]=!0),this.collection.toArray().forEach(c=>{c.getDescendants({deep:!0}).forEach(h=>{r[h.id]=!0})}),o&&o.translateBy){const c=this.graph.getCellById(o.translateBy);c&&(r[c.id]=!0,c.getDescendants({deep:!0}).forEach(h=>{r[h.id]=!0}),a.push(c))}this.collection.toArray().forEach(c=>{if(!r[c.id]){const h=Object.assign(Object.assign({},o),{selection:this.cid,exclude:a});c.translate(n,t,h),this.graph.model.getConnectedEdges(c).forEach(u=>{r[u.id]||(u.translate(n,t,h),r[u.id]=!0)})}})}getCellViewsInArea(n){const t=this.graph,i={strict:this.options.strict};let o=[];return this.options.rubberNode&&(o=o.concat(t.model.getNodesInArea(n,i).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),this.options.rubberEdge&&(o=o.concat(t.model.getEdgesInArea(n,i).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),o}notifyBoxEvent(n,t,i,o){const a=this.getEventData(t).activeView;this.trigger(n,{e:t,view:a,x:i,y:o,cell:a.cell})}getSelectedClassName(n){return this.prefixClassName((n.isNode()?"node":"edge")+"-selected")}addCellSelectedClassName(n){const t=this.graph.renderer.findViewByCell(n);t&&t.addClass(this.getSelectedClassName(n))}removeCellUnSelectedClassName(n){const t=this.graph.renderer.findViewByCell(n);t&&t.removeClass(this.getSelectedClassName(n))}destroySelectionBox(n){this.removeCellUnSelectedClassName(n),this.canShowSelectionBox(n)&&(l.is.remove(this.container.querySelector(`[data-cell-id="${n.id}"]`)),0===this.$boxes.length&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(n){n.forEach(t=>this.removeCellUnSelectedClassName(t)),this.hide(),l.is.remove(this.$boxes),this.boxCount=0}hide(){l.is.removeClass(this.container,this.prefixClassName(K.classNames.rubberband)),l.is.removeClass(this.container,this.prefixClassName(K.classNames.selected))}showRubberband(){l.is.addClass(this.container,this.prefixClassName(K.classNames.rubberband))}hideRubberband(){l.is.removeClass(this.container,this.prefixClassName(K.classNames.rubberband))}showSelected(){l.is.removeAttribute(this.container,"style"),l.is.addClass(this.container,this.prefixClassName(K.classNames.selected))}createContainer(){this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName(K.classNames.root)),this.options.className&&l.is.addClass(this.container,this.options.className),this.selectionContainer=document.createElement("div"),l.is.addClass(this.selectionContainer,this.prefixClassName(K.classNames.inner)),this.selectionContent=document.createElement("div"),l.is.addClass(this.selectionContent,this.prefixClassName(K.classNames.content)),l.is.append(this.selectionContainer,this.selectionContent),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length),l.is.prepend(this.container,this.selectionContainer)}updateContainerPosition(n){(n.dx||n.dy)&&this.updateElementPosition(this.selectionContainer,n.dx,n.dy)}updateContainer(){const n={x:1/0,y:1/0},t={x:0,y:0};this.collection.toArray().filter(r=>this.canShowSelectionBox(r)).forEach(r=>{const a=this.graph.renderer.findViewByCell(r);if(a){const c=a.getBBox({useCellGeometry:!0});n.x=Math.min(n.x,c.x),n.y=Math.min(n.y,c.y),t.x=Math.max(t.x,c.x+c.width),t.y=Math.max(t.y,c.y+c.height)}}),l.is.css(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:n.x,top:n.y,width:t.x-n.x,height:t.y-n.y}),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length);const o=this.options.content;if(o)if("function"==typeof o){const r=l.Iw.call(o,this.graph,this,this.selectionContent);r&&(this.selectionContent.innerHTML=r)}else this.selectionContent.innerHTML=o;this.collection.length>0&&!this.container.parentNode?l.is.appendTo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(n){return n.isNode()&&!0===this.options.showNodeSelectionBox||n.isEdge()&&!0===this.options.showEdgeSelectionBox}createSelectionBox(n){if(this.addCellSelectedClassName(n),this.canShowSelectionBox(n)){const t=this.graph.renderer.findViewByCell(n);if(t){const i=t.getBBox({useCellGeometry:!0}),o=this.boxClassName,r=document.createElement("div");l.is.addClass(r,o),l.is.addClass(r,`${o}-${n.isNode()?"node":"edge"}`),l.is.attr(r,"data-cell-id",n.id),l.is.css(r,{position:"absolute",left:i.x,top:i.y,width:i.width,height:i.height,pointerEvents:this.options.pointerEvents||"auto"}),l.is.appendTo(r,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let n=0,t=this.$boxes.length;n<t;n+=1){const i=this.$boxes[n],o=l.is.attr(i,"data-cell-id");l.is.remove(i);const r=this.collection.get(o);r&&this.createSelectionBox(r)}this.updateContainer()}return 0}getCellViewFromElem(n){const t=n.getAttribute("data-cell-id");if(t){const i=this.collection.get(t);if(i)return this.graph.renderer.findViewByCell(i)}return null}onCellRemoved({cell:n}){this.destroySelectionBox(n),this.updateContainer()}onReseted({previous:n,current:t}){this.destroyAllSelectionBoxes(n),t.forEach(i=>{this.listenCellRemoveEvent(i),this.createSelectionBox(i)}),this.updateContainer()}onCellAdded({cell:n}){this.listenCellRemoveEvent(n),this.createSelectionBox(n),this.updateContainer()}listenCellRemoveEvent(n){n.off("removed",this.onCellRemoved,this),n.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:n,removed:t,options:i}){n.forEach(r=>{this.trigger("cell:selected",{cell:r,options:i}),r.isNode()?this.trigger("node:selected",{cell:r,options:i,node:r}):r.isEdge()&&this.trigger("edge:selected",{cell:r,options:i,edge:r})}),t.forEach(r=>{this.trigger("cell:unselected",{cell:r,options:i}),r.isNode()?this.trigger("node:unselected",{cell:r,options:i,node:r}):r.isEdge()&&this.trigger("edge:unselected",{cell:r,options:i,edge:r})});const o={added:n,removed:t,options:i,selected:this.cells.filter(r=>!!this.graph.getCellById(r.id))};this.trigger("selection:changed",o)}dispose(){this.clean(),this.remove(),this.off()}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],ue.prototype,"dispose",null),function(s){const n="widget-selection";s.classNames={root:n,inner:`${n}-inner`,box:`${n}-box`,content:`${n}-content`,rubberband:`${n}-rubberband`,selected:`${n}-selected`},s.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},s.depthComparator=function t(i){return i.getAncestors().length}}(K||(K={})),l.kJ.prototype.isSelectionEnabled=function(){const s=this.getPlugin("selection");return!!s&&s.isEnabled()},l.kJ.prototype.enableSelection=function(){const s=this.getPlugin("selection");return s&&s.enable(),this},l.kJ.prototype.disableSelection=function(){const s=this.getPlugin("selection");return s&&s.disable(),this},l.kJ.prototype.toggleSelection=function(s){const n=this.getPlugin("selection");return n&&n.toggleEnabled(s),this},l.kJ.prototype.isMultipleSelection=function(){const s=this.getPlugin("selection");return!!s&&s.isMultipleSelection()},l.kJ.prototype.enableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.enableMultipleSelection(),this},l.kJ.prototype.disableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.disableMultipleSelection(),this},l.kJ.prototype.toggleMultipleSelection=function(s){const n=this.getPlugin("selection");return n&&n.toggleMultipleSelection(s),this},l.kJ.prototype.isSelectionMovable=function(){const s=this.getPlugin("selection");return!!s&&s.isSelectionMovable()},l.kJ.prototype.enableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.enableSelectionMovable(),this},l.kJ.prototype.disableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.disableSelectionMovable(),this},l.kJ.prototype.toggleSelectionMovable=function(s){const n=this.getPlugin("selection");return n&&n.toggleSelectionMovable(s),this},l.kJ.prototype.isRubberbandEnabled=function(){const s=this.getPlugin("selection");return!!s&&s.isRubberbandEnabled()},l.kJ.prototype.enableRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableRubberband(),this},l.kJ.prototype.disableRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableRubberband(),this},l.kJ.prototype.toggleRubberband=function(s){const n=this.getPlugin("selection");return n&&n.toggleRubberband(s),this},l.kJ.prototype.isStrictRubberband=function(){const s=this.getPlugin("selection");return!!s&&s.isStrictRubberband()},l.kJ.prototype.enableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableStrictRubberband(),this},l.kJ.prototype.disableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableStrictRubberband(),this},l.kJ.prototype.toggleStrictRubberband=function(s){const n=this.getPlugin("selection");return n&&n.toggleStrictRubberband(s),this},l.kJ.prototype.setRubberbandModifiers=function(s){const n=this.getPlugin("selection");return n&&n.setRubberbandModifiers(s),this},l.kJ.prototype.setSelectionFilter=function(s){const n=this.getPlugin("selection");return n&&n.setSelectionFilter(s),this},l.kJ.prototype.setSelectionDisplayContent=function(s){const n=this.getPlugin("selection");return n&&n.setSelectionDisplayContent(s),this},l.kJ.prototype.isSelectionEmpty=function(){const s=this.getPlugin("selection");return!s||s.isEmpty()},l.kJ.prototype.cleanSelection=function(s){const n=this.getPlugin("selection");return n&&n.clean(s),this},l.kJ.prototype.resetSelection=function(s,n){const t=this.getPlugin("selection");return t&&t.reset(s,n),this},l.kJ.prototype.getSelectedCells=function(){const s=this.getPlugin("selection");return s?s.getSelectedCells():[]},l.kJ.prototype.getSelectedCellCount=function(){const s=this.getPlugin("selection");return s?s.getSelectedCellCount():0},l.kJ.prototype.isSelected=function(s){const n=this.getPlugin("selection");return!!n&&n.isSelected(s)},l.kJ.prototype.select=function(s,n){const t=this.getPlugin("selection");return t&&t.select(s,n),this},l.kJ.prototype.unselect=function(s,n){const t=this.getPlugin("selection");return t?t.unselect(s,n):this};class xt extends l.ew{get rubberbandDisabled(){return!0!==this.options.enabled||!0!==this.options.rubberband}get disabled(){return!0!==this.options.enabled}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(n={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=l.QK.merge({enabled:!0},xt.defaultOptions,n),l.mf.ensure(this.name,".x6-widget-selection {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: none;\n  width: 0;\n  height: 0;\n  touch-action: none;\n}\n.x6-widget-selection-rubberband {\n  display: block;\n  overflow: visible;\n  opacity: 0.3;\n}\n.x6-widget-selection-selected {\n  display: block;\n}\n.x6-widget-selection-box {\n  cursor: move;\n}\n.x6-widget-selection-inner[data-selection-length='0'],\n.x6-widget-selection-inner[data-selection-length='1'] {\n  display: none;\n}\n.x6-widget-selection-content {\n  position: absolute;\n  top: 100%;\n  right: -20px;\n  left: -20px;\n  margin-top: 30px;\n  padding: 6px;\n  line-height: 14px;\n  text-align: center;\n  border-radius: 6px;\n}\n.x6-widget-selection-content:empty {\n  display: none;\n}\n.x6-widget-selection-rubberband {\n  background-color: #3498db;\n  border: 2px solid #2980b9;\n}\n.x6-widget-selection-box {\n  box-sizing: content-box !important;\n  margin-top: -4px;\n  margin-left: -4px;\n  padding-right: 4px;\n  padding-bottom: 4px;\n  border: 2px dashed #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-inner {\n  box-sizing: content-box !important;\n  margin-top: -8px;\n  margin-left: -8px;\n  padding-right: 12px;\n  padding-bottom: 12px;\n  border: 2px solid #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-content {\n  color: #fff;\n  font-size: 10px;\n  background-color: #6a6b8a;\n}\n")}init(n){this.graph=n,this.selectionImpl=new ue(Object.assign(Object.assign({},this.options),{graph:n})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(n){return null!=n?n!==this.isMultipleSelection()&&(n?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return!1!==this.options.movable}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(n){return null!=n?n!==this.isSelectionMovable()&&(n?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(n){return null!=n?n!==this.isRubberbandEnabled()&&(n?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return!0===this.selectionImpl.options.strict}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(n){return null!=n?n!==this.isStrictRubberband()&&(n?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(n){this.setModifiers(n)}setSelectionFilter(n){return this.setFilter(n),this}setSelectionDisplayContent(n){return this.setContent(n),this}isEmpty(){return this.length<=0}clean(n={}){return this.selectionImpl.clean(n),this}reset(n,t={}){return this.selectionImpl.reset(n?this.getCells(n):[],t),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(n){return this.selectionImpl.isSelected(n)}select(n,t={}){const i=this.getCells(n);return i.length&&(this.isMultiple()?this.selectionImpl.select(i,t):this.reset(i.slice(0,1),t)),this}unselect(n,t={}){return this.selectionImpl.unselect(this.getCells(n),t),this}setup(){this.selectionImpl.on("*",(n,t)=>{this.trigger(n,t),this.graph.trigger(n,t)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:n}){const t=this.graph.panning.allowPanning(n,!0),i=this.graph.getPlugin("scroller"),o=i&&i.allowPanning(n,!0);(this.allowRubberband(n,!0)||this.allowRubberband(n)&&!o&&!t)&&this.startRubberband(n)}onBlankClick(){this.clean()}allowRubberband(n,t){return!this.rubberbandDisabled&&l.tx.isMatch(n,this.options.modifiers,t)}allowMultipleSelection(n){return this.isMultiple()&&l.tx.isMatch(n,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:n}){this.movedMap.set(n,!0)}onCellMouseUp({e:n,cell:t}){const i=this.options;let o=this.disabled;!o&&this.movedMap.has(t)&&(o=!1===i.selectCellOnMoved,o||(o=!1===i.selectNodeOnMoved&&t.isNode()),o||(o=!1===i.selectEdgeOnMoved&&t.isEdge())),o||(this.allowMultipleSelection(n)?this.unselectMap.has(t)?this.unselectMap.delete(t):this.isSelected(t)?this.unselect(t):this.select(t):this.reset(t)),this.movedMap.delete(t)}onBoxMouseDown({e:n,cell:t}){this.disabled||this.allowMultipleSelection(n)&&(this.unselect(t),this.unselectMap.set(t,!0))}getCells(n){return(Array.isArray(n)?n:[n]).map(t=>"string"==typeof t?this.graph.getCellById(t):t).filter(t=>null!=t)}startRubberband(n){return this.rubberbandDisabled||this.selectionImpl.startSelecting(n),this}isMultiple(){return!1!==this.options.multiple}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(n){return this.options.modifiers=n,this}setContent(n){return this.selectionImpl.setContent(n),this}setFilter(n){return this.selectionImpl.setFilter(n),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),l.mf.clean(this.name)}}(function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)})([l.ew.dispose()],xt.prototype,"dispose",null),function(s){s.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null}}(xt||(xt={})),l.kJ.prototype.toSVG=function(s,n){const t=this.getPlugin("export");t&&t.toSVG(s,n)},l.kJ.prototype.toPNG=function(s,n){const t=this.getPlugin("export");t&&t.toPNG(s,n)},l.kJ.prototype.toJPEG=function(s,n){const t=this.getPlugin("export");t&&t.toJPEG(s,n)},l.kJ.prototype.exportPNG=function(s,n){const t=this.getPlugin("export");t&&t.exportPNG(s,n)},l.kJ.prototype.exportJPEG=function(s,n){const t=this.getPlugin("export");t&&t.exportJPEG(s,n)},l.kJ.prototype.exportSVG=function(s,n){const t=this.getPlugin("export");t&&t.exportSVG(s,n)};class ge extends l.ew{constructor(){super(),this.name="export"}get view(){return this.graph.view}init(n){this.graph=n}exportPNG(n="chart",t={}){this.toPNG(i=>{l.Vb.downloadDataUri(i,n)},t)}exportJPEG(n="chart",t={}){this.toPNG(i=>{l.Vb.downloadDataUri(i,n)},t)}exportSVG(n="chart",t={}){this.toSVG(i=>{l.Vb.downloadDataUri(l.Vb.svgToDataUrl(i),n)},t)}toSVG(n,t={}){this.notify("before:export",t);const i=this.view.svg,o=l.OW.create(i).clone();let r=o.node;const a=o.findOne(`.${this.view.prefixClassName("graph-svg-stage")}`),c=t.viewBox||this.graph.graphToLocal(this.graph.getContentBBox()),h=t.preserveDimensions;if(h){const g="boolean"==typeof h?c:h;o.attr({width:g.width,height:g.height})}if(o.removeAttribute("style").attr("viewBox",[c.x,c.y,c.width,c.height].join(" ")),a.removeAttribute("transform"),!1!==t.copyStyles){const g=i.ownerDocument,m=Array.from(i.querySelectorAll("*")),C=Array.from(r.querySelectorAll("*")),w=g.styleSheets.length,z=[];for(let y=w-1;y>=0;y-=1)z[y]=g.styleSheets[y],g.styleSheets[y].disabled=!0;const v={};m.forEach((y,S)=>{const x=window.getComputedStyle(y,null),O={};Object.keys(x).forEach(J=>{O[J]=x.getPropertyValue(J)}),v[S]=O}),w!==g.styleSheets.length&&z.forEach((y,S)=>{g.styleSheets[S]=y});for(let y=0;y<w;y+=1)g.styleSheets[y].disabled=!1;const k={};m.forEach((y,S)=>{const x=window.getComputedStyle(y,null),O=v[S],J={};Object.keys(x).forEach(Q=>{!l.GH.isNumber(Q)&&x.getPropertyValue(Q)!==O[Q]&&(J[Q]=x.getPropertyValue(Q))}),k[S]=J}),C.forEach((y,S)=>{l.is.css(y,k[S])})}const u=t.stylesheet;if("string"==typeof u){const g=i.ownerDocument.implementation.createDocument(null,"xml",null).createCDATASection(u);o.prepend(l.OW.create("style",{type:"text/css"},[g]))}const p=()=>{const g=t.beforeSerialize;if("function"==typeof g){const C=l.Iw.call(g,this.graph,r);C instanceof SVGSVGElement&&(r=C)}const m=(new XMLSerializer).serializeToString(r).replace(/&nbsp;/g,"\xa0");this.notify("after:export",t),n(m)};if(t.serializeImages){const g=o.find("image").map(m=>new Promise(C=>{const w=m.attr("xlink:href")||m.attr("href");l.Vb.imageToDataUri(w,(z,v)=>{!z&&v&&m.attr("xlink:href",v),C()})}));Promise.all(g).then(p)}else p()}toDataURL(n,t){let i=t.viewBox||this.graph.getContentBBox();const o=l.GH.normalizeSides(t.padding);t.width&&t.height&&(o.left+o.right>=t.width&&(o.left=o.right=0),o.top+o.bottom>=t.height&&(o.top=o.bottom=0));const r=new l.Ae(-o.left,-o.top,o.left+o.right,o.top+o.bottom);t.width&&t.height&&r.scale((i.width+o.left+o.right)/t.width,(i.height+o.top+o.bottom)/t.height),i=l.Ae.create(i).moveAndExpand(r);const a="number"==typeof t.width&&"number"==typeof t.height?{width:t.width,height:t.height}:i;let c=t.ratio?parseFloat(t.ratio):1;(!Number.isFinite(c)||0===c)&&(c=1);const h={width:Math.max(Math.round(a.width*c),1),height:Math.max(Math.round(a.height*c),1)};{const p=document.createElement("canvas"),g=p.getContext("2d");p.width=h.width,p.height=h.height;const m=h.width-1,C=h.height-1;g.fillStyle="rgb(1,1,1)",g.fillRect(m,C,1,1);const w=g.getImageData(m,C,1,1).data;if(1!==w[0]||1!==w[1]||1!==w[2])throw new Error("size exceeded")}const u=new Image;u.onload=()=>{const p=document.createElement("canvas");p.width=h.width,p.height=h.height;const g=p.getContext("2d");g.fillStyle=t.backgroundColor||"white",g.fillRect(0,0,h.width,h.height);try{g.drawImage(u,0,0,h.width,h.height);const m=p.toDataURL(t.type,t.quality);n(m)}catch{}},this.toSVG(p=>{u.src=`data:image/svg+xml,${encodeURIComponent(p)}`},Object.assign(Object.assign({},t),{viewBox:i,serializeImages:!0,preserveDimensions:Object.assign({},h)}))}toPNG(n,t={}){this.toDataURL(n,Object.assign(Object.assign({},t),{type:"image/png"}))}toJPEG(n,t={}){this.toDataURL(n,Object.assign(Object.assign({},t),{type:"image/jpeg"}))}notify(n,t){this.trigger(n,t),this.graph.trigger(n,t)}dispose(){this.off()}}!function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)}([l.ew.dispose()],ge.prototype,"dispose",null);class ft extends l.G7{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){return this.options.target.getPlugin("snapline")}constructor(n){super(),this.name="dnd",this.options=Object.assign(Object.assign({},ft.defaults),n),this.init()}init(){l.mf.ensure(this.name,".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n"),this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new l.kJ(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),l.is.append(this.container,this.draggingGraph.container)}start(n,t){const i=t;i.preventDefault(),this.targetModel.startBatch("dnd"),l.is.addClass(this.container,"dragging"),l.is.appendTo(this.container,this.options.draggingContainer||document.body),this.sourceNode=n,this.prepareDragging(n,i.clientX,i.clientY);const o=this.updateNodePosition(i.clientX,i.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:i,node:n,cell:n,view:this.draggingView,x:o.x,y:o.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(ft.documentEvents,i.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(n,t,i){const o=this.draggingGraph,r=o.model,a=this.options.getDragNode(n,{sourceNode:n,draggingGraph:o,targetGraph:this.targetGraph});a.position(0,0);let c=5;if(this.isSnaplineEnabled()&&(c+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const p=this.targetGraph.transform.getScale();o.scale(p.sx,p.sy),c*=Math.max(p.sx,p.sy)}else o.scale(1,1);this.clearDragging(),r.resetCells([a]);const h=o.findViewByCell(a);h.undelegateEvents(),h.cell.off("changed"),o.fitToContent({padding:c,allowNewOrigin:"any"});const u=h.getBBox();this.geometryBBox=h.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(u.getTopLeft()),this.draggingNode=a,this.draggingView=h,this.draggingBBox=a.getBBox(),this.padding=c,this.originOffset=this.updateGraphPosition(t,i)}updateGraphPosition(n,t){const i=document.body.scrollTop||document.documentElement.scrollTop,o=this.delta,r=this.geometryBBox,a=this.padding||5,c={left:n-o.x-r.width/2-a,top:t-o.y-r.height/2-a+i};return this.draggingGraph&&l.is.css(this.container,{left:`${c.left}px`,top:`${c.top}px`}),c}updateNodePosition(n,t){const i=this.targetGraph.clientToLocal(n,t),o=this.draggingBBox;return i.x-=o.width/2,i.y-=o.height/2,this.draggingNode.position(i.x,i.y),i}snap({cell:n,current:t,options:i}){const o=n;if(i.snapped){const r=this.draggingBBox;o.position(r.x+i.tx,r.y+i.ty,{silent:!0}),this.draggingView.translate(),o.position(t.x,t.y,{silent:!0}),this.snapOffset={x:i.tx,y:i.ty}}else this.snapOffset=null}onDragging(n){const t=this.draggingView;if(t){n.preventDefault();const i=this.normalizeEvent(n),o=i.clientX,r=i.clientY;this.updateGraphPosition(o,r);const a=this.updateNodePosition(o,r),c=this.targetGraph.options.embedding.enabled,h=(c||this.isSnaplineEnabled())&&this.isInsideValidArea({x:o,y:r});if(c){t.setEventData(i,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const u=t.getEventData(i);h?t.processEmbedding(i,u):t.clearEmbedding(u),this.candidateEmbedView=u.candidateEmbedView}this.isSnaplineEnabled()&&(h?this.snapline.snapOnMoving({e:i,view:t,x:a.x,y:a.y}):this.snapline.hide())}}onDragEnd(n){const t=this.draggingNode;if(t){const i=this.normalizeEvent(n),o=this.draggingView,r=this.draggingBBox,a=this.snapOffset;let c=r.x,h=r.y;a&&(c+=a.x,h+=a.y),t.position(c,h,{silent:!0});const u=this.drop(t,{x:i.clientX,y:i.clientY}),p=g=>{g?(this.onDropped(t),this.targetGraph.options.embedding.enabled&&o&&(o.setEventData(i,{cell:g,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),o.finalizeEmbedding(i,o.getEventData(i)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};l.Iw.isAsync(u)?(this.undelegateDocumentEvents(),u.then(p)):p(u)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(n){this.draggingNode===n&&(this.clearDragging(),l.is.removeClass(this.container,"dragging"),l.is.remove(this.container))}onDropInvalid(){const n=this.draggingNode;n&&this.onDropped(n)}isInsideValidArea(n){let t,i=null;const o=this.targetGraph,r=this.targetScroller;this.options.dndContainer&&(i=this.getDropArea(this.options.dndContainer));const a=i&&i.containsPoint(n);if(r)if(r.options.autoResize)t=this.getDropArea(r.container);else{const c=this.getDropArea(r.container);t=this.getDropArea(o.container).intersectsWithRect(c)}else t=this.getDropArea(o.container);return!a&&t&&t.containsPoint(n)}getDropArea(n){const t=l.is.offset(n),i=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft;return l.Ae.create({x:t.left+parseInt(l.is.css(n,"border-left-width"),10)-o,y:t.top+parseInt(l.is.css(n,"border-top-width"),10)-i,width:n.clientWidth,height:n.clientHeight})}drop(n,t){if(this.isInsideValidArea(t)){const i=this.targetGraph,o=i.model,r=i.clientToLocal(t),a=this.sourceNode,c=this.options.getDropNode(n,{sourceNode:a,draggingNode:n,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),h=c.getBBox();r.x+=h.x-h.width/2,r.y+=h.y-h.height/2;const u=this.snapOffset?1:i.getGridSize();c.position(l.Z4.snapToGrid(r.x,u),l.Z4.snapToGrid(r.y,u)),c.removeZIndex();const p=this.options.validateNode,g=!p||p(c,{sourceNode:a,draggingNode:n,droppingNode:c,targetGraph:i,draggingGraph:this.draggingGraph});return"boolean"==typeof g?g?(o.addCell(c,{stencil:this.cid}),c):null:l.Iw.toDeferredBoolean(g).then(m=>m?(o.addCell(c,{stencil:this.cid}),c):null)}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),l.mf.clean(this.name)}}(function(s,n,t,i){var a,o=arguments.length,r=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,n,t,i);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(n,t,r):a(n,t))||r);o>3&&r&&Object.defineProperty(n,t,r)})([l.G7.dispose()],ft.prototype,"dispose",null),function(s){s.defaults={getDragNode:n=>n.clone(),getDropNode:n=>n.clone()},s.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}}(ft||(ft={}));let Fe=(()=>{class s{constructor(t,i,o,r){this.cs=t,this.element=i,this.injector=o,this.viewContainerRef=r,this.graph=new l.kJ({container:i.nativeElement,background:{},grid:{size:10,visible:JSON.parse(localStorage.getItem("show_grid")||"true"),type:"mesh"},connecting:{snap:!1,connector:"normal",createEdge:()=>new l.bn.kS({shape:"line",attrs:{line:{stroke:"#333",strokeWidth:1,targetMarker:null,strokeDasharray:0,style:{animation:"ant-line 30s infinite linear"}}},label:{text:""},router:{name:"normal"}})},highlighting:{magnetAvailable:{name:"stroke",args:{padding:4,attrs:{strokeWidth:2,stroke:"rgba(223,234,255)"}}}}}),this.graph.use(new Gt({enabled:!0})),this.graph.use(new ct({resizing:{enabled:!0},rotating:{enabled:!0}})),this.graph.use(new T({enabled:!0})),this.graph.use(new nt({enabled:!0})),this.graph.use(new yt({enabled:!0})),this.graph.use(new xt({enabled:!0,multiple:!0,rubberband:!0,rubberEdge:!0,movable:!0,strict:!0,showNodeSelectionBox:!0})),this.graph.use(new ge),this.dnd=new ft({target:this.graph}),this.graph.bindKey("ctrl+s",a=>{this.graph.exportPNG(),a.preventDefault()}),this.graph.bindKey("ctrl+z",()=>this.graph.undo()),this.graph.bindKey("ctrl+y",()=>this.graph.redo()),this.graph.bindKey("ctrl+x",()=>this.graph.cut(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+c",()=>this.graph.copy(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+v",()=>this.graph.resetSelection(this.graph.paste())),this.graph.bindKey("backspace",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.bindKey("delete",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.container.onmousemove=a=>{this.line&&(this.graph.addEdge({shape:this.line.id,source:[a.offsetX,a.offsetY],target:[a.offsetX-120,a.offsetY+80],...this.line.meta}),this.line=void 0)},this.graph.on("edge:selected",l.Iw.debounce(({edge:a})=>{a.addTools([{name:"source-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"target-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"vertices",args:{attrs:{fill:"#3c9566",cursor:"crosshair"},stopPropagation:!1}}])})),this.graph.on("edge:unselected",({cell:a})=>{a.removeTools()}),this.graph.on("node:mouseenter",l.Iw.debounce(({})=>{}),500),this.graph.on("node:mouseleave",({})=>{}),this.graph.on("blank:click",()=>{}),this.graph.on("node:click",({})=>{}),this.graph.on("cell:selected",()=>{}),this.graph.on("cell:click",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.click?.call(this,a,c)}),this.graph.on("cell:mouseenter",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseenter?.call(this,a,c)}),this.graph.on("cell:mouseleave",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseleave?.call(this,a,c)})}Render(t){t.content?.cells?.forEach(i=>{this.cs.Get(i.shape)}),this.graph.drawBackground({color:t.background_color,image:t.background_image}),this.graph.fromJSON(t.content)}Draw(t){let i,{component:o}=t;switch(this.cs.CheckRegister(o),o.type){case"line":return void(this.line=o);case"shape":case"svg":let r={};o.bindings?.forEach(a=>r[a.name]=a.default),i=this.graph.createNode({shape:o.id,...o.meta,data:r});break;case"chart":console.log(1111111)}console.log(i),i&&t.event&&this.dnd.start(i,t.event)}showPorts(t,i){for(let o=0,r=t.length;o<r;o+=1)t[o].style.visibility=i?"visible":"hidden"}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(pt.m),e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-canvas"]],decls:0,vars:0,template:function(t,i){},styles:["[_nghost-%COMP%]{display:block;position:relative;box-shadow:#a8a8a8 2px 2px 10px;background-color:#fff}"]}),s})();var _=b(433);let Ge=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-attach-select"]],decls:1,vars:0,consts:[["src","/app/attachment/list","frameborder","0"]],template:function(t,i){1&t&&e._UZ(0,"iframe",0)}}),s})();var mt=b(5156),se=b(2851),oe=b(7096),V=b(7582),q=b(9521),Ut=b(7579),Tt=b(4968),ht=b(2722),bt=b(2536),it=b(3187),Yt=b(2687),Bt=b(445),Ct=b(6287);const Ue=["switchElement"];function Ye(s,n){1&s&&e._UZ(0,"span",8)}function Qe(s,n){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzCheckedChildren)}}function je(s,n){if(1&s&&(e.ynx(0),e.YNc(1,Qe,2,1,"ng-container",9),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("nzStringTemplateOutlet",t.nzCheckedChildren)}}function He(s,n){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzUnCheckedChildren)}}function Ve(s,n){if(1&s&&e.YNc(0,He,2,1,"ng-container",9),2&s){const t=e.oxw();e.Q6J("nzStringTemplateOutlet",t.nzUnCheckedChildren)}}let Xe=(()=>{class s{constructor(t,i,o,r,a,c){this.nzConfigService=t,this.host=i,this.ngZone=o,this.cdr=r,this.focusMonitor=a,this.directionality=c,this._nzModuleName="switch",this.isChecked=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzLoading=!1,this.nzDisabled=!1,this.nzControl=!1,this.nzCheckedChildren=null,this.nzUnCheckedChildren=null,this.nzSize="default",this.nzId=null,this.dir="ltr",this.destroy$=new Ut.x,this.isNzDisableFirstChange=!0}updateValue(t){this.isChecked!==t&&(this.isChecked=t,this.onChange(this.isChecked))}focus(){this.focusMonitor.focusVia(this.switchElement.nativeElement,"keyboard")}blur(){this.switchElement.nativeElement.blur()}ngOnInit(){this.directionality.change.pipe((0,ht.R)(this.destroy$)).subscribe(t=>{this.dir=t,this.cdr.detectChanges()}),this.dir=this.directionality.value,this.ngZone.runOutsideAngular(()=>{(0,Tt.R)(this.host.nativeElement,"click").pipe((0,ht.R)(this.destroy$)).subscribe(t=>{t.preventDefault(),!(this.nzControl||this.nzDisabled||this.nzLoading)&&this.ngZone.run(()=>{this.updateValue(!this.isChecked),this.cdr.markForCheck()})}),(0,Tt.R)(this.switchElement.nativeElement,"keydown").pipe((0,ht.R)(this.destroy$)).subscribe(t=>{if(this.nzControl||this.nzDisabled||this.nzLoading)return;const{keyCode:i}=t;i!==q.oh&&i!==q.SV&&i!==q.L_&&i!==q.K5||(t.preventDefault(),this.ngZone.run(()=>{i===q.oh?this.updateValue(!1):i===q.SV?this.updateValue(!0):(i===q.L_||i===q.K5)&&this.updateValue(!this.isChecked),this.cdr.markForCheck()}))})})}ngAfterViewInit(){this.focusMonitor.monitor(this.switchElement.nativeElement,!0).pipe((0,ht.R)(this.destroy$)).subscribe(t=>{t||Promise.resolve().then(()=>this.onTouched())})}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.switchElement.nativeElement),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.isChecked=t,this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.cdr.markForCheck()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(bt.jY),e.Y36(e.SBq),e.Y36(e.R0b),e.Y36(e.sBO),e.Y36(Yt.tE),e.Y36(Bt.Is,8))},s.\u0275cmp=e.Xpm({type:s,selectors:[["nz-switch"]],viewQuery:function(t,i){if(1&t&&e.Gf(Ue,7),2&t){let o;e.iGM(o=e.CRH())&&(i.switchElement=o.first)}},inputs:{nzLoading:"nzLoading",nzDisabled:"nzDisabled",nzControl:"nzControl",nzCheckedChildren:"nzCheckedChildren",nzUnCheckedChildren:"nzUnCheckedChildren",nzSize:"nzSize",nzId:"nzId"},exportAs:["nzSwitch"],features:[e._Bn([{provide:_.JU,useExisting:(0,e.Gpc)(()=>s),multi:!0}])],decls:9,vars:16,consts:[["nz-wave","","type","button",1,"ant-switch",3,"disabled","nzWaveExtraNode"],["switchElement",""],[1,"ant-switch-handle"],["nz-icon","","nzType","loading","class","ant-switch-loading-icon",4,"ngIf"],[1,"ant-switch-inner"],[4,"ngIf","ngIfElse"],["uncheckTemplate",""],[1,"ant-click-animating-node"],["nz-icon","","nzType","loading",1,"ant-switch-loading-icon"],[4,"nzStringTemplateOutlet"]],template:function(t,i){if(1&t&&(e.TgZ(0,"button",0,1)(2,"span",2),e.YNc(3,Ye,1,0,"span",3),e.qZA(),e.TgZ(4,"span",4),e.YNc(5,je,2,1,"ng-container",5),e.YNc(6,Ve,1,1,"ng-template",null,6,e.W1O),e.qZA(),e._UZ(8,"div",7),e.qZA()),2&t){const o=e.MAs(7);e.ekj("ant-switch-checked",i.isChecked)("ant-switch-loading",i.nzLoading)("ant-switch-disabled",i.nzDisabled)("ant-switch-small","small"===i.nzSize)("ant-switch-rtl","rtl"===i.dir),e.Q6J("disabled",i.nzDisabled)("nzWaveExtraNode",!0),e.uIk("id",i.nzId),e.xp6(3),e.Q6J("ngIf",i.nzLoading),e.xp6(2),e.Q6J("ngIf",i.isChecked)("ngIfElse",o)}},dependencies:[E.O5,ut.dQ,L.Ls,Ct.f],encapsulation:2,changeDetection:0}),(0,V.gn)([(0,it.yF)()],s.prototype,"nzLoading",void 0),(0,V.gn)([(0,it.yF)()],s.prototype,"nzDisabled",void 0),(0,V.gn)([(0,it.yF)()],s.prototype,"nzControl",void 0),(0,V.gn)([(0,bt.oS)()],s.prototype,"nzSize",void 0),s})(),qe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[Bt.vT,E.ez,ut.vG,L.PV,Ct.T]}),s})();function $e(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"input",8),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)||"")}}function Ke(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-number",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function tn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-number",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function en(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"nz-switch",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function nn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-group",10)(1,"input",11),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.qZA()()}if(2&s){const t=e.oxw(),i=e.MAs(7);e.Q6J("nzSuffix",i),e.xp6(1),e.Q6J("value",t.cell.getPropByPath(t.property.path)||"")}}function sn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"button",12)(1,"span",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.handleSelectImage())}),e.qZA()()}}function on(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"input",14),e.NdJ("colorPickerChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))})("cpPresetColorsChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.setPresentColors(o))}),e.qZA()}if(2&s){const t=e.oxw(),i=e.MAs(10);e.Udp("color",t.cell.getPropByPath(t.property.path)),e.Q6J("value",t.cell.getPropByPath(t.property.path)||"none")("colorPicker",t.cell.getPropByPath(t.property.path))("cpEyeDropper",!0)("cpUseRootViewContainer",!0)("cpPresetColors",t.getPresentColors())("cpExtraTemplate",i)}}function rn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}function an(s,n){if(1&s&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&s){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.name)}}function ln(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"select",16),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.YNc(1,an,2,2,"option",17),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)),e.xp6(1),e.Q6J("ngForOf",t.property.options)}}let cn=(()=>{class s{constructor(t,i){this.ms=t,this.msg=i;const o=this;window.onload=()=>{window.top.onmessage=function({data:r}){o.msg.success("\u9009\u62e9\u6210\u529f!"),o.cell.setPropByPath("attrs/image/xlink:href",r)}}}inputChange(t){this.cell.setPropByPath(this.property.path,t.target.value)}change(t){this.cell.setPropByPath(this.property.path,t);let i=this.getPresentColors(),o=i.indexOf(t);o>-1&&i.splice(o,1),i.unshift(t),i.length>12&&(i.length=12),this.setPresentColors(i)}getPresentColors(){let t=localStorage.getItem("present-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("present-colors",JSON.stringify(t))}clearColor(){this.cell.setPropByPath(this.property.path,"none")}handleSelectImage(){this.ms.create({nzTitle:"\u9009\u62e9\u56fe\u7247",nzContent:Ge,nzComponentParams:{},nzFooter:null})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(mt.Sf),e.Y36(dt.dD))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-property-input"]],inputs:{property:"property",cell:"cell"},decls:12,vars:8,consts:[[3,"ngSwitch"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change",4,"ngSwitchCase"],["nzSize","small",3,"ngModel","ngModelChange",4,"ngSwitchCase"],["nzSize","small","style","padding-right: 0;",3,"nzSuffix",4,"ngSwitchCase"],["suffixIconSearch",""],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","color","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange",4,"ngSwitchCase"],["suffixIconClear",""],[3,"value","change",4,"ngSwitchCase"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change"],["nzSize","small",3,"ngModel","ngModelChange"],["nzSize","small",2,"padding-right","0",3,"nzSuffix"],["type","text","nz-input","","placeholder","\u7a7a",3,"value","change"],["nz-button","","nzSize","small","nzType","primary","nzSearch",""],["nz-icon","","nzType","search",3,"click"],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange"],[3,"click"],[3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,i){1&t&&(e.ynx(0,0),e.YNc(1,$e,1,1,"input",1),e.YNc(2,Ke,1,1,"nz-input-number",2),e.YNc(3,tn,1,1,"nz-input-number",2),e.YNc(4,en,1,1,"nz-switch",2),e.YNc(5,nn,2,2,"nz-input-group",3),e.YNc(6,sn,2,0,"ng-template",null,4,e.W1O),e.YNc(8,on,1,8,"input",5),e.YNc(9,rn,2,0,"ng-template",null,6,e.W1O),e.YNc(11,ln,2,2,"select",7),e.BQk()),2&t&&(e.Q6J("ngSwitch",i.property.type),e.xp6(1),e.Q6J("ngSwitchCase","text"),e.xp6(1),e.Q6J("ngSwitchCase","number"),e.xp6(1),e.Q6J("ngSwitchCase","stroke"),e.xp6(1),e.Q6J("ngSwitchCase","boolean"),e.xp6(1),e.Q6J("ngSwitchCase","image"),e.xp6(3),e.Q6J("ngSwitchCase","color"),e.xp6(3),e.Q6J("ngSwitchCase","select"))},dependencies:[E.sg,E.RF,E.n9,_.YN,_.Kr,_.JJ,_.On,L.Ls,$.ix,st.w,ut.dQ,se.Kk,tt.Zp,tt.gB,tt.ke,oe._V,Xe]}),s})();var St=b(3679),et=b(6704);function hn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"a",2),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}let dn=(()=>{class s{constructor(){this.onChanged=()=>{},this.onTouched=()=>{},this.colorChange=new e.vpe}ngOnInit(){}writeValue(t){this.color=t||""}registerOnChange(t){this.onChanged=t}registerOnTouched(t){this.onTouched=t}colorPickerChange(t){console.log("property change",t),this.color=t,this.onChanged(t);let i=this.getPresentColors(),o=i.indexOf(t);o>-1&&i.splice(o,1),i.unshift(t),i.length>12&&(i.length=12),this.setPresentColors(i)}getPresentColors(){let t=localStorage.getItem("bgc-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("bgc-colors",JSON.stringify(t))}clearColor(){this.color="",this.onChanged(this.color)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-color-input"]],outputs:{colorChange:"colorChange"},features:[e._Bn([{provide:_.JU,useExisting:(0,e.Gpc)(()=>s),multi:!0}])],decls:3,vars:7,consts:[["cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpPresetColors","cpExtraTemplate","valueChange","colorPickerChange","cpPresetColorsChange"],["suffixIconClear",""],[3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"input",0),e.NdJ("valueChange",function(r){return i.color=r})("colorPickerChange",function(r){return i.colorPickerChange(r)})("cpPresetColorsChange",function(r){return i.setPresentColors(r)}),e.qZA(),e.YNc(1,hn,2,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Udp("color",i.color),e.Q6J("value",i.color)("colorPicker",i.color)("cpEyeDropper",!0)("cpPresetColors",i.getPresentColors())("cpExtraTemplate",o)}},dependencies:[se.Kk]}),s})(),pn=(()=>{class s{set row(t){t&&this.group.patchValue(t)}constructor(t){this.fb=t,this.build()}build(t){this.group=this.fb.group({name:[(t=t||{}).name||"",[_.kI.required]],background_color:[t.background_color],background_image:[t.background_image]})}submit(){return new Promise((t,i)=>{this.group.valid?t(this.group.value):Object.values(this.group.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),i())})})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_.qu))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-page-setting"]],inputs:{row:"row"},decls:16,vars:13,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","\u8bf7\u8f93\u5165\u540d\u79f0!",3,"nzSm","nzXs"],["nz-input","","formControlName","name"],["nzFor","background_color",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["formControlName","background_color"],["nzFor","background_image",3,"nzSm","nzXs"],["nz-input","","formControlName","background_image","placeholder","\u8f93\u5165\u56fe\u7247\u5730\u5740"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u540d\u79f0"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.qZA()(),e.TgZ(6,"nz-form-item")(7,"nz-form-label",4),e._uU(8,"\u80cc\u666f\u989c\u8272"),e.qZA(),e.TgZ(9,"nz-form-control",5),e._UZ(10,"app-color-input",6),e.qZA()(),e.TgZ(11,"nz-form-item")(12,"nz-form-label",7),e._uU(13,"\u80cc\u666f\u56fe\u7247"),e.qZA(),e.TgZ(14,"nz-form-control",5),e._UZ(15,"input",8),e.qZA()()()),2&t&&(e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24))},dependencies:[_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,St.t3,St.SK,et.Lr,et.Nx,et.iK,et.Fd,tt.Zp,dn]}),s})();const un=function(s){return{selected:s}};function gn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.open(r))}),e._uU(1),e.TgZ(2,"div",2),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(3,"span",3),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleCopy(r))}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleEdit(r))}),e.qZA(),e.TgZ(5,"span",5),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleDel(r))}),e.qZA()()()}if(2&s){const t=n.$implicit,i=n.index,o=e.oxw();e.Q6J("ngClass",e.VKq(2,un,i==o.index)),e.xp6(1),e.hij(" ",t.name," ")}}let fn=(()=>{class s{constructor(t,i,o){this.modal=t,this.ms=i,this.viewContainerRef=o,this.onPageChange=new e.vpe,this.index=0}handleEdit(t){const i=void 0===t,o=this.modal.create({nzTitle:i?"\u65b0\u589e\u9875\u9762":"\u7f16\u8f91\u9875\u9762",nzContent:pn,nzComponentParams:{row:i?{name:"",content:{}}:this.project.pages[t]},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>o.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:r=>r?.submit().then(a=>{i?this.project.pages.push(a):this.project.pages[t]=a,this.onPageChange.emit(0),o.destroy()}).catch(a=>!1)}]})}handleDel(t){1!=this.project.pages.length?(this.project.pages.splice(t,1),this.index==t&&(t>=this.project.pages.length&&(this.index=t-1),this.onPageChange.emit(this.index))):this.ms.error("\u518d\u5220\u5c31\u6ca1\u6709\u4e86")}open(t){this.index=t,this.onPageChange.emit(t)}handleCopy(t){}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(mt.Sf),e.Y36(dt.dD),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-pages"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:1,vars:1,consts:[["class","page",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"page",3,"ngClass","click"],[1,"tools",3,"click"],["nz-icon","","nzType","copy","title","\u590d\u5236",3,"click"],["nz-icon","","nzType","edit","title","\u7f16\u8f91",3,"click"],["nz-icon","","nzType","delete","title","\u5220\u9664",3,"click"]],template:function(t,i){1&t&&e.YNc(0,gn,6,4,"div",0),2&t&&e.Q6J("ngForOf",i.project.pages)},dependencies:[E.mk,E.sg,L.Ls,st.w],styles:[".page[_ngcontent-%COMP%]{position:relative;padding:3px 5px}.page[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{position:absolute;right:5px;top:3px;display:none}.page.selected[_ngcontent-%COMP%]{background-color:#e1e1e1}.page[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.page[_ngcontent-%COMP%]:hover > .tools[_ngcontent-%COMP%]{display:block}"]}),s})();var Dt=b(8e3);function mn(s,n){if(1&s&&e._UZ(0,"nz-option",12),2&s){const t=e.oxw().$implicit;e.Q6J("nzValue",t.id)("nzLabel",t.name+"-"+t.id)}}function bn(s,n){if(1&s&&(e.ynx(0),e.YNc(1,mn,1,2,"nz-option",11),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function Cn(s,n){1&s&&(e.TgZ(0,"nz-option",13),e._UZ(1,"span",14),e._uU(2," Loading Data... "),e.qZA())}function _n(s,n){if(1&s&&e._UZ(0,"nz-option",15),2&s){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.name)}}let zn=(()=>{class s{set content(t){const{product:i,device:o}=t;o?(this.onSearch(o),this.getVariableList(i)):this.onSearch(""),this.group.patchValue(t)}constructor(t,i){this.fb=t,this.rs=i,this.isLoading=!1,this.optionList=[],this.variableList=[],this.build()}build(t){this.group=this.fb.group({product:[(t=t||{}).product||"",[_.kI.required]],device:[t.device||"",[_.kI.required]],variable:[t.variable||"",[_.kI.required]]})}onSearch(t){this.isLoading=!0,this.rs.post("/api/device/search",{keyword:{name:t,id:t},limit:20,skip:0}).subscribe(i=>{this.optionList=i.data||[]}).add(()=>{this.isLoading=!1})}handleChange(t){this.variableList=[];const i=this.optionList.find(o=>o.id===t)||{product_id:""};this.group.patchValue({product:i.product_id,variable:""}),this.getVariableList(i.product_id)}getVariableList(t){t&&this.rs.get(`/api/product/${t}`).subscribe(i=>{this.variableList=i&&i.data&&i.data.properties||[]})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_.qu),e.Y36(Mt.s))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-binding-setting"]],inputs:{content:"content"},decls:19,vars:16,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","device",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nzAllowClear","","nzShowSearch","","nzServerSearch","","formControlName","device","nzPlaceHolder","\u8f93\u5165\u8bbe\u5907\u540d\u79f0/id\u53ef\u641c\u7d22",3,"nzOnSearch","ngModelChange"],[4,"ngFor","ngForOf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],["nzRequired","","nzFor","product",3,"nzSm","nzXs"],["nz-input","","formControlName","product","readonly",""],["nzRequired","","nzFor","variable",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","variable"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel",4,"ngIf"],[3,"nzValue","nzLabel"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"],[3,"nzLabel","nzValue"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u8bbe\u5907ID"),e.qZA(),e.TgZ(4,"nz-form-control",2)(5,"nz-select",3),e.NdJ("nzOnSearch",function(r){return i.onSearch(r)})("ngModelChange",function(r){return i.handleChange(r)}),e.YNc(6,bn,2,1,"ng-container",4),e.YNc(7,Cn,3,0,"nz-option",5),e.qZA()()(),e.TgZ(8,"nz-form-item")(9,"nz-form-label",6),e._uU(10,"\u4ea7\u54c1ID"),e.qZA(),e.TgZ(11,"nz-form-control",2),e._UZ(12,"input",7),e.qZA()(),e.TgZ(13,"nz-form-item")(14,"nz-form-label",8),e._uU(15,"\u53d8\u91cf"),e.qZA(),e.TgZ(16,"nz-form-control",2)(17,"nz-select",9),e.YNc(18,_n,1,2,"nz-option",10),e.qZA()()()()),2&t&&(e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",i.optionList),e.xp6(1),e.Q6J("ngIf",i.isLoading),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",i.variableList))},dependencies:[E.sg,E.O5,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,L.Ls,st.w,St.t3,St.SK,et.Lr,et.Nx,et.iK,et.Fd,tt.Zp,Dt.Ip,Dt.Vq]}),s})();function vn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.ALo(2,"json"),e.qZA()}if(2&s){const t=n.$implicit,i=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",e.lcZ(2,2,null==i.cell.data||null==i.cell.data.bindings?null:i.cell.data.bindings[t.name]),"\n")}}let yn=(()=>{class s{constructor(t){this.ms=t}edit(t){this.cell.data.bindings||={},this.ms.create({nzTitle:`\u7f16\u8f91 ${t.label} \u6570\u636e\u7ed1\u5b9a`,nzContent:zn,nzComponentParams:{content:this.cell.data.bindings[t.name]||{}},nzOnOk:({group:i})=>{this.cell.data.bindings[t.name]=i.value}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(mt.Sf))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-binding"]],inputs:{cell:"cell",component:"component"},decls:1,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,i){1&t&&e.YNc(0,vn,3,4,"div",0),2&t&&e.Q6J("ngForOf",null==i.component?null:i.component.bindings)},dependencies:[E.sg,E.Ts]}),s})();var fe=b(1103);let xn=(()=>{class s{constructor(){this.content="",this.codeMirrorOptions={theme:"material",mode:"javascript",lineWrapping:!0,foldGutter:!0,autoCloseBrackets:!0,autoFocus:!0,matchBrackets:!0,lint:!0}}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-listener-setting"]],inputs:{content:"content"},decls:1,vars:2,consts:[[3,"ngModel","options","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"ngx-codemirror",0),e.NdJ("ngModelChange",function(r){return i.content=r}),e.qZA()),2&t&&e.Q6J("ngModel",i.content)("options",i.codeMirrorOptions)},dependencies:[_.JJ,_.On,fe.C],styles:[".CodeMirror-sizer{margin-left:0}  .CodeMirror-sizer .CodeMirror-gutters{visibility:hidden}"]}),s})();function Tn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",0),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.qZA()}if(2&s){const t=n.$implicit,i=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",null==i.cell.data||null==i.cell.data.listeners?null:i.cell.data.listeners[t.name],"\n")}}let Sn=(()=>{class s{constructor(t){this.ms=t,this.click={label:"\u70b9\u51fb",name:"click"}}edit(t){this.cell.data.listeners||={},this.ms.create({nzTitle:`\u7f16\u8f91${t.label}\u4e8b\u4ef6\u811a\u672c`,nzContent:xn,nzComponentParams:{content:this.cell.data.listeners[t.name]||""},nzOnOk:({content:i})=>{this.cell.data.listeners=Object.assign(this.cell.data.listeners||{},{[t.name]:i})}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(mt.Sf))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-listener"]],inputs:{cell:"cell",component:"component"},decls:3,vars:2,consts:[[3,"click"],[3,"click",4,"ngFor","ngForOf"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.NdJ("click",function(){return i.edit(i.click)}),e._uU(1),e.qZA(),e.YNc(2,Tn,2,2,"div",1)),2&t&&(e.xp6(1),e.hij(" \u70b9\u51fb : ",null==i.cell.data||null==i.cell.data.listeners?null:i.cell.data.listeners.click,"\n"),e.xp6(1),e.Q6J("ngForOf",null==i.component?null:i.component.events))},dependencies:[E.sg]}),s})();function wn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onPositionChange(o))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"X"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",11),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"Y"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",12),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formPosition)}}function kn(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSizeChange(o))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",13),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",14),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formSize)}}function En(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onLinePositionChange(o))}),e.TgZ(1,"table")(2,"tr",15)(3,"td"),e._uU(4,"\u8d77\u70b9"),e.qZA(),e.TgZ(5,"td"),e._uU(6,"X:"),e._UZ(7,"input",16),e.qZA(),e.TgZ(8,"td"),e._uU(9,"Y:"),e._UZ(10,"input",17),e.qZA()(),e.TgZ(11,"tr",18)(12,"td"),e._uU(13,"\u7ec8\u70b9"),e.qZA(),e.TgZ(14,"td"),e._uU(15,"X:"),e._UZ(16,"input",16),e.qZA(),e.TgZ(17,"td"),e._uU(18,"Y:"),e._UZ(19,"input",17),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formLinePosition)}}function Nn(s,n){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"app-property-input",19),e.qZA()()),2&s){const t=n.$implicit,i=e.oxw(2);e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("property",t)("cell",i.cell)}}function Mn(s,n){if(1&s&&(e.TgZ(0,"app-collapse",7),e.YNc(1,wn,12,1,"form",8),e.YNc(2,kn,12,1,"form",8),e.YNc(3,En,20,1,"form",8),e.TgZ(4,"table"),e.YNc(5,Nn,5,3,"tr",9),e.qZA()()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isEdge()),e.xp6(2),e.Q6J("ngForOf",t.cmp.properties)}}function An(s,n){if(1&s&&(e.TgZ(0,"app-collapse",20),e._UZ(1,"app-binding",21),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}function Pn(s,n){if(1&s&&(e.TgZ(0,"app-collapse",22),e._UZ(1,"app-listener",21),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}let In=(()=>{class s{get graph(){return this.g}set graph(t){this.g=t,t.on("cell:change:size",i=>{i.cell==this.cell&&this.formSize.patchValue(i.current)}),t.on("cell:change:position",i=>{i.cell==this.cell&&this.formPosition.patchValue(i.current)}),t.on("cell:unselected",({cell:i})=>{i==this.cell&&(this.cmp=void 0)}),t.on("selection:changed",({selected:i})=>{if(this.selected=i,1===t.getSelectedCellCount()){if(this.cell=t.getSelectedCells()[0],this.cell.isNode()){const o=this.cell.getPosition();this.formPosition.patchValue(o);const r=this.cell.getSize();this.formSize.patchValue(r)}else if(this.cell.isEdge()){const o=this.cell.getProp("source"),r=this.cell.getProp("target");this.formLinePosition.patchValue({source:o,target:r})}this.cmp=this.cs.Get(this.cell.shape)}})}constructor(t,i){this.fb=t,this.cs=i,this.onPageChange=new e.vpe,this.selected=[],this.formPosition=t.group({x:[0,[_.kI.required]],y:[0,[_.kI.required]]}),this.formSize=t.group({width:[0,[_.kI.required]],height:[0,[_.kI.required]]}),this.formLinePosition=t.group({source:t.group({x:[0,[_.kI.required]],y:[0,[_.kI.required]]}),target:t.group({x:[0,[_.kI.required]],y:[0,[_.kI.required]]})})}onPositionChange(t){this.cell.isNode()&&this.cell.setPosition(this.formPosition.value)}onSizeChange(t){this.cell.isNode()&&this.cell.setSize(this.formSize.value)}onLinePositionChange(t){this.cell.setProp(this.formLinePosition.value)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_.qu),e.Y36(pt.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-property"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:7,vars:5,consts:[["title","\u9875\u9762\u7ba1\u7406"],["more","","nz-icon","","nzType","plus","nzTheme","outline","title","\u6dfb\u52a0\u9875\u9762",3,"click"],[3,"graph","project","onPageChange"],["pages",""],["title","\u63a7\u4ef6\u5c5e\u6027",4,"ngIf"],["title","\u6570\u636e\u7ed1\u5b9a",4,"ngIf"],["title","\u4e8b\u4ef6\u54cd\u5e94",4,"ngIf"],["title","\u63a7\u4ef6\u5c5e\u6027"],[3,"formGroup","change",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"formGroup","change"],["nz-input","","nzSize","small","type","number","formControlName","x"],["nz-input","","nzSize","small","type","number","formControlName","y"],["nz-input","","nzSize","small","type","number","formControlName","width"],["nz-input","","nzSize","small","type","number","formControlName","height"],["formGroupName","source"],["nz-input","","nzSize","small","type","number","formControlName","x",2,"width","60px"],["nz-input","","nzSize","small","type","number","formControlName","y",2,"width","60px"],["formGroupName","target"],[3,"property","cell"],["title","\u6570\u636e\u7ed1\u5b9a"],[3,"cell","component"],["title","\u4e8b\u4ef6\u54cd\u5e94"]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"app-collapse",0)(1,"span",1),e.NdJ("click",function(a){return e.CHM(o),e.MAs(3).handleEdit(),e.KtG(a.stopPropagation())}),e.qZA(),e.TgZ(2,"app-pages",2,3),e.NdJ("onPageChange",function(a){return i.onPageChange.emit(a)}),e.qZA()(),e.YNc(4,Mn,6,4,"app-collapse",4),e.YNc(5,An,2,2,"app-collapse",5),e.YNc(6,Pn,2,2,"app-collapse",6)}2&t&&(e.xp6(2),e.Q6J("graph",i.graph)("project",i.project),e.xp6(2),e.Q6J("ngIf",i.selected.length&&i.cmp),e.xp6(1),e.Q6J("ngIf",1==i.selected.length&&(null==i.cmp||null==i.cmp.bindings?null:i.cmp.bindings.length)),e.xp6(1),e.Q6J("ngIf",1==i.selected.length&&i.cmp))},dependencies:[E.sg,E.O5,_._Y,_.Fj,_.wV,_.JJ,_.JL,_.sg,_.u,_.x0,L.Ls,st.w,tt.Zp,cn,vt,fn,yn,Sn],styles:["[_nghost-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden;border-left:1px solid #a8a8a8;-webkit-user-select:none;user-select:none}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{min-width:80px}"]}),s})(),On=(()=>{class s{set project(t){t&&this.group.patchValue(t)}constructor(t){this.fb=t,this.build()}build(t){this.group=this.fb.group({id:[(t=t||{}).id||"",[_.kI.required]],name:[t.name||"",[_.kI.required]],desc:[t.desc||"",[]],width:[t.width||400,[_.kI.required]],height:[t.height||400,[_.kI.required]]})}setData(t){const i=this.group.value;for(const o in i)i[o]=t[o];this.group.setValue(i)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_.qu))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-project-setting"]],inputs:{project:"project"},decls:26,vars:11,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","id",3,"nzSpan"],["nzErrorTip","ID\u4e0d\u53ef\u4e3a\u7a7a!",3,"nzSpan"],["nz-input","","name","id","formControlName","id"],["nzRequired","","nzFor","name",3,"nzSpan"],["nzErrorTip","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a!",3,"nzSpan"],["nz-input","","name","name","formControlName","name"],["nzFor","width",3,"nzSpan"],[3,"nzSpan"],["formControlName","width"],["nzFor","height",3,"nzSpan"],["formControlName","height"],["nzFor","desc",3,"nzSpan"],["nz-input","","name","desc","formControlName","desc"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"ID"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.qZA()(),e.TgZ(6,"nz-form-item")(7,"nz-form-label",4),e._uU(8,"\u540d\u79f0"),e.qZA(),e.TgZ(9,"nz-form-control",5),e._UZ(10,"input",6),e.qZA()(),e.TgZ(11,"nz-form-item")(12,"nz-form-label",7),e._uU(13,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(14,"nz-form-control",8),e._UZ(15,"nz-input-number",9),e.qZA()(),e.TgZ(16,"nz-form-item")(17,"nz-form-label",10),e._uU(18,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(19,"nz-form-control",8),e._UZ(20,"nz-input-number",11),e.qZA()(),e.TgZ(21,"nz-form-item")(22,"nz-form-label",12),e._uU(23,"\u8bf4\u660e"),e.qZA(),e.TgZ(24,"nz-form-control",8),e._UZ(25,"input",13),e.qZA()()()),2&t&&(e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16))},dependencies:[_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,St.t3,St.SK,et.Lr,et.Nx,et.iK,et.Fd,tt.Zp,oe._V]}),s})();function Bn(s,n){if(1&s&&(e.TgZ(0,"p")(1,"a",1),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&s){const t=n.$implicit;e.xp6(1),e.Q6J("href",t.url,e.LSH),e.xp6(1),e.Oqu(t.name),e.xp6(1),e.hij(" ",t.email,"\n")}}let Dn=(()=>{class s{constructor(){this.contributors=[{name:"\u6770\u795e",url:"https://github.com/zgwit",email:"jason@zgwit.com"},{name:"EnTrouble",url:"https://github.com/EnTrouble",email:"hutianqi@zgwit.cn"}]}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-about"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],["target","_blank",3,"href"]],template:function(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"\u7269\u8054\u5927\u5e08 Web SCADA \u63d2\u4ef6\uff0c\u8d21\u732e\u8005\uff1a"),e.qZA(),e.YNc(2,Bn,4,3,"p",0)),2&t&&(e.xp6(2),e.Q6J("ngForOf",i.contributors))},dependencies:[E.sg]}),s})();var me=b(2577),Qt=b(3325),_t=b(9562);const Rn=function(){return{standalone:!0}};let Zn=(()=>{class s{constructor(t,i,o,r){this.cs=t,this.modal=i,this.msg=o,this.viewContainerRef=r,this.onSave=new e.vpe,this.scale=1,this.scaleChange=new e.vpe,this.showGrid=JSON.parse(localStorage.getItem("show_grid")||"true")}handleSave(){this.onSave.emit()}handleExport(t){switch(console.log(this.graph),t){case"SVG":this.graph.exportSVG();break;case"PNG":this.graph.exportPNG();break;case"JPEG":this.graph.exportJPEG();break;case"file":this.savefiles(this.graph.toJSON(),Date.now()+"")}}handleUndo(){this.graph.undo()}handleRedo(){this.graph.redo()}handleCut(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.cut(this.graph.getSelectedCells(),{deep:!0})}handleCopy(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.copy(this.graph.getSelectedCells(),{deep:!0})}handlePaste(){this.graph.paste()}handleDelete(){this.graph.getSelectedCells().forEach(t=>t.remove())}handleAlignLeft(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position();void 0===t?t=r.x:(r.x=t,o.setPosition(r))})}handleAlignCenter(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position(),a=o.size();void 0===t?t=r.x+.5*a.width:(r.x=t-.5*a.width,o.setPosition(r))})}handleAlignRight(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position(),a=o.size();void 0===t?t=r.x+a.width:(r.x=t-a.width,o.setPosition(r))})}handleValignTop(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position();void 0===t?t=r.y:(r.y=t,o.setPosition(r))})}handleValignMiddle(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position(),a=o.size();void 0===t?t=r.y+.5*a.height:(r.y=t-.5*a.height,o.setPosition(r))})}handleValignBottom(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let o=i,r=o.position(),a=o.size();void 0===t?t=r.y+a.height:(r.y=t-a.height,o.setPosition(r))})}handleMoveTop(){this.graph.getSelectedCells().forEach(t=>{t.toFront()})}handleMoveUp(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)+1)}handleMoveDown(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)-1)}handleMoveBottom(){this.graph.getSelectedCells().forEach(t=>{t.toBack()})}handleGroup(){let t=this.graph.getSelectedCells().map(r=>r.getBBox()),i={x:t.reduce((r,a)=>r.x<a.x?r:a).x-10,y:t.reduce((r,a)=>r.y<a.y?r:a).y-10,right:t.reduce((r,a)=>r.right>a.right?r:a).right+10,bottom:t.reduce((r,a)=>r.bottom>a.bottom?r:a).bottom+10};console.log("group",i),this.cs.Get("group");let o=this.graph.addNode({shape:"group",x:i.x,y:i.y,width:i.right-i.x,height:i.bottom-i.y});this.graph.getSelectedCells().forEach(r=>{r.setZIndex(o.zIndex+r.zIndex),o.addChild(r)})}handleUngroup(){this.graph.getSelectedCells().forEach(t=>{"group"==t.shape&&(t.getChildren()?.forEach(i=>{i.setParent(null)}),t.setChildren(null),t.remove())})}isGroup(){return 1===this.graph.getSelectedCellCount()&&this.graph.getSelectedCells()[0].getChildCount()>0}handleGrid(){this.showGrid?this.graph.hideGrid():this.graph.showGrid(),this.showGrid=!this.showGrid,localStorage.setItem("show_grid",JSON.stringify(this.showGrid))}settingProject(){const t=this.modal.create({nzTitle:"\u7f16\u8f91\u5de5\u7a0b\u4fe1\u606f",nzContent:On,nzComponentParams:{project:this.project},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>t.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:i=>{const o=i.group.value;Object.assign(this.project,o),console.log("project setting",o),t.destroy()}}]})}savefiles(t,i){const o=window.URL||window.webkitURL||window,r=new Blob([JSON.stringify(t)]),a=document.createElement("a");a.href=o.createObjectURL(r),a.download=i,a.click()}handleScale(t){this.scaleChange.emit(t),this.graph.zoomTo(t)}about(){this.modal.create({nzTitle:"\u5173\u4e8e",nzContent:Dn,nzFooter:null})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(pt.m),e.Y36(mt.Sf),e.Y36(dt.dD),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-toolbar"]],inputs:{project:"project",graph:"graph",scale:"scale"},outputs:{onSave:"onSave",scaleChange:"scaleChange"},features:[e._Bn([dt.dD,mt.Sf])],decls:74,vars:30,consts:[["nz-button","",3,"click"],["nz-icon","","nzType","save","title","\u4fdd\u5b58"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["exportDropDownMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],["nzType","vertical"],["nz-button","","title","\u64a4\u9500(ctrl+z)",3,"disabled","click"],["nz-icon","","nzType","undo"],["nz-button","","title","\u91cd\u505a(ctrl+y)",3,"disabled","click"],["nz-icon","","nzType","redo"],["nz-button","","title","\u526a\u5207(ctrl+x)",3,"disabled","click"],["nz-icon","","nzType","scissor"],["nz-button","","title","\u590d\u5236(ctrl+c)",3,"disabled","click"],["nz-icon","","nzType","copy"],["nz-button","","title","\u7c98\u8d34(ctrl+v)",3,"disabled","click"],["nz-icon","","nzType","snippets"],["nz-button","","title","\u5220\u9664",3,"disabled","click"],["nz-icon","","nzType","delete"],["nz-button","",3,"disabled","click"],["nz-icon","","nzType","align-left","title","\u5de6\u5bf9\u9f50"],["nz-icon","","nzType","align-center","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","align-right","title","\u53f3\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-top","title","\u4e0a\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-middle","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-bottom","title","\u4e0b\u5bf9\u9f50"],["nz-icon","","nzType","vertical-right","title","\u7f6e\u9876",3,"nzRotate"],["nz-icon","","nzType","up","title","\u4e0a\u79fb\u4e00\u5c42"],["nz-icon","","nzType","down","title","\u4e0b\u79fb\u4e00\u5c42"],["nz-icon","","nzType","vertical-left","title","\u7f6e\u5e95",3,"nzRotate"],["nz-icon","","nzType","group","title","\u7ec4\u5408"],["nz-icon","","nzType","ungroup","title","\u89e3\u9664\u7ec4\u5408"],["nz-icon","","nzType","table","title","\u663e\u793a\u7f51\u683c"],["nz-icon","","nzType","setting","title","\u5de5\u7a0b\u8bbe\u7f6e"],[3,"ngModel","ngModelOptions","ngModelChange"],["nzLabel","25%",3,"nzValue"],["nzLabel","50%",3,"nzValue"],["nzLabel","75%",3,"nzValue"],["nzLabel","100%",3,"nzValue"],["nzLabel","200%",3,"nzValue"],["nzLabel","500%",3,"nzValue"],["nz-icon","","nzType","question-circle","title","\u5173\u4e8e"]],template:function(t,i){if(1&t&&(e.TgZ(0,"a",0),e.NdJ("click",function(){return i.handleSave()}),e._UZ(1,"i",1),e._uU(2," \u4fdd\u5b58\n"),e.qZA(),e.TgZ(3,"button",2),e._UZ(4,"i",3),e._uU(5,"\u4e0b\u8f7d"),e.qZA(),e.TgZ(6,"nz-dropdown-menu",null,4)(8,"ul",5)(9,"li",6),e.NdJ("click",function(){return i.handleExport("SVG")}),e._uU(10,"\u5bfc\u51faSVG"),e.qZA(),e.TgZ(11,"li",6),e.NdJ("click",function(){return i.handleExport("PNG")}),e._uU(12,"\u5bfc\u51faPNG"),e.qZA(),e.TgZ(13,"li",6),e.NdJ("click",function(){return i.handleExport("JPEG")}),e._uU(14,"\u5bfc\u51faJPEG"),e.qZA(),e.TgZ(15,"li",6),e.NdJ("click",function(){return i.handleExport("file")}),e._uU(16,"\u5bfc\u51fa\u6587\u4ef6"),e.qZA()()(),e._UZ(17,"nz-divider",7),e.TgZ(18,"a",8),e.NdJ("click",function(){return i.handleUndo()}),e._UZ(19,"i",9),e.qZA(),e.TgZ(20,"a",10),e.NdJ("click",function(){return i.handleRedo()}),e._UZ(21,"i",11),e.qZA(),e._UZ(22,"nz-divider",7),e.TgZ(23,"a",12),e.NdJ("click",function(){return i.handleCut()}),e._UZ(24,"i",13),e.qZA(),e.TgZ(25,"a",14),e.NdJ("click",function(){return i.handleCopy()}),e._UZ(26,"i",15),e.qZA(),e.TgZ(27,"a",16),e.NdJ("click",function(){return i.handlePaste()}),e._UZ(28,"i",17),e.qZA(),e.TgZ(29,"a",18),e.NdJ("click",function(){return i.handleDelete()}),e._UZ(30,"i",19),e.qZA(),e._UZ(31,"nz-divider",7),e.TgZ(32,"a",20),e.NdJ("click",function(){return i.handleAlignLeft()}),e._UZ(33,"i",21),e.qZA(),e.TgZ(34,"a",20),e.NdJ("click",function(){return i.handleAlignCenter()}),e._UZ(35,"i",22),e.qZA(),e.TgZ(36,"a",20),e.NdJ("click",function(){return i.handleAlignRight()}),e._UZ(37,"i",23),e.qZA(),e._UZ(38,"nz-divider",7),e.TgZ(39,"a",20),e.NdJ("click",function(){return i.handleValignTop()}),e._UZ(40,"i",24),e.qZA(),e.TgZ(41,"a",20),e.NdJ("click",function(){return i.handleValignMiddle()}),e._UZ(42,"i",25),e.qZA(),e.TgZ(43,"a",20),e.NdJ("click",function(){return i.handleValignBottom()}),e._UZ(44,"i",26),e.qZA(),e._UZ(45,"nz-divider",7),e.TgZ(46,"a",20),e.NdJ("click",function(){return i.handleMoveTop()}),e._UZ(47,"i",27),e.qZA(),e.TgZ(48,"a",20),e.NdJ("click",function(){return i.handleMoveUp()}),e._UZ(49,"i",28),e.qZA(),e.TgZ(50,"a",20),e.NdJ("click",function(){return i.handleMoveDown()}),e._UZ(51,"i",29),e.qZA(),e.TgZ(52,"a",20),e.NdJ("click",function(){return i.handleMoveBottom()}),e._UZ(53,"i",30),e.qZA(),e._UZ(54,"nz-divider",7),e.TgZ(55,"a",20),e.NdJ("click",function(){return i.handleGroup()}),e._UZ(56,"i",31),e.qZA(),e.TgZ(57,"a",20),e.NdJ("click",function(){return i.handleUngroup()}),e._UZ(58,"i",32),e.qZA(),e._UZ(59,"nz-divider",7),e.TgZ(60,"a",0),e.NdJ("click",function(){return i.handleGrid()}),e._UZ(61,"i",33),e.qZA(),e.TgZ(62,"a",0),e.NdJ("click",function(){return i.settingProject()}),e._UZ(63,"i",34),e.qZA(),e.TgZ(64,"nz-select",35),e.NdJ("ngModelChange",function(r){return i.handleScale(r)}),e._UZ(65,"nz-option",36)(66,"nz-option",37)(67,"nz-option",38)(68,"nz-option",39)(69,"nz-option",40)(70,"nz-option",41),e.qZA(),e._UZ(71,"nz-divider",7),e.TgZ(72,"a",0),e.NdJ("click",function(){return i.about()}),e._UZ(73,"i",42),e.qZA()),2&t){const o=e.MAs(7);e.xp6(3),e.Q6J("nzDropdownMenu",o),e.xp6(15),e.Q6J("disabled",!i.graph.canUndo()),e.xp6(2),e.Q6J("disabled",!i.graph.canRedo()),e.xp6(3),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!i.graph.getCellsInClipboard().length),e.xp6(2),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(3),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(3),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(3),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(1),e.Q6J("nzRotate",90),e.xp6(1),e.Q6J("disabled",1!=i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",1!=i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(1),e.Q6J("nzRotate",90),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",!i.isGroup()),e.xp6(7),e.Q6J("ngModel",i.scale)("ngModelOptions",e.DdM(29,Rn)),e.xp6(1),e.Q6J("nzValue",.25),e.xp6(1),e.Q6J("nzValue",.5),e.xp6(1),e.Q6J("nzValue",.75),e.xp6(1),e.Q6J("nzValue",1),e.xp6(1),e.Q6J("nzValue",2),e.xp6(1),e.Q6J("nzValue",5)}},dependencies:[_.JJ,_.On,L.Ls,me.g,$.ix,st.w,ut.dQ,Dt.Ip,Dt.Vq,Qt.wO,Qt.r9,_t.cm,_t.RR,_t.wA],styles:["[_nghost-%COMP%]{height:50px;display:flex;align-items:center;vertical-align:middle;padding:0 20px;font-size:20px;font-weight:700;overflow:hidden;border-bottom:1px solid #a8a8a8;background-color:#f0f0f0}a[_ngcontent-%COMP%]{padding:5px;margin:1px;cursor:pointer;text-decoration:none}a.disabled[_ngcontent-%COMP%]{color:gray;cursor:default}"]}),s})();const Jn=["canvas"];let be=(()=>{class s{constructor(t,i,o,r,a,c){this.title=t,this.rs=i,this.msg=o,this.router=r,this.route=a,this.cs=c,this.id="",this.project=function Nt(){return{id:"",name:"\u7ec4\u6001\u5de5\u7a0b",desc:"",width:window.screen.width,height:window.screen.height,pages:[{name:"\u9996\u9875",content:{}}]}}(),this.index=0,this.scale=1,this.leftWidth=200,this.leftWidthMin=200,this.rightWidth=250,this.rightWidthMin=250,this.leftOn=!1,this.rightOn=!1,this.lastX=0,t.setTitle(this.project.name)}ngOnInit(){this.route.snapshot.paramMap.has("id")&&(this.id=this.route.snapshot.paramMap.get("id"),this.rs.get(`api/project/${this.id}`).subscribe(t=>{this.project=t.data,this.title.setTitle(this.project.name),this.canvas.Render(this.project.pages[0])}))}onDrag(t){this.canvas.Draw(t)}handleSave(){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.rs.post(this.id?`api/project/${this.id}`:"api/project/create",this.project).subscribe(i=>{this.router.navigateByUrl("/admin/project")})}handlePageChange(t){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.index=t,this.canvas.Render(this.project.pages[this.index])}onLeftDown(t){this.leftOn=!0,this.lastX=t.screenX}onRightDown(t){this.rightOn=!0,this.lastX=t.screenX}onMoseMove(t){let i=t.screenX-this.lastX;if(this.leftOn){if(i<0&&this.leftWidth<=this.leftWidthMin)return;this.leftWidth+=t.screenX-this.lastX}if(this.rightOn){if(i>0&&this.rightWidth<=this.rightWidthMin)return;this.rightWidth-=t.screenX-this.lastX}this.lastX=t.screenX}onMouseUp(t){this.leftOn=!1,this.rightOn=!1}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(lt.Dx),e.Y36(Mt.s),e.Y36(dt.dD),e.Y36(at.F0),e.Y36(at.gz),e.Y36(pt.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-editor"]],viewQuery:function(t,i){if(1&t&&e.Gf(Jn,5),2&t){let o;e.iGM(o=e.CRH())&&(i.canvas=o.first)}},decls:9,vars:13,consts:[[3,"graph","project","scale","onSave","scaleChange"],[1,"body",3,"mousemove","mouseup"],[3,"onDrag"],[1,"splitter",3,"mousedown"],[1,"content"],["canvas",""],[3,"graph","project","onPageChange"]],template:function(t,i){if(1&t&&(e.TgZ(0,"app-toolbar",0),e.NdJ("onSave",function(){return i.handleSave()})("scaleChange",function(r){return i.scale=r}),e.qZA(),e.TgZ(1,"div",1),e.NdJ("mousemove",function(r){return i.onMoseMove(r)})("mouseup",function(r){return i.onMouseUp(r)}),e.TgZ(2,"app-library",2),e.NdJ("onDrag",function(r){return i.onDrag(r)}),e.qZA(),e.TgZ(3,"div",3),e.NdJ("mousedown",function(r){return i.onLeftDown(r)}),e.qZA(),e.TgZ(4,"div",4),e._UZ(5,"app-canvas",null,5),e.qZA(),e.TgZ(7,"div",3),e.NdJ("mousedown",function(r){return i.onRightDown(r)}),e.qZA(),e.TgZ(8,"app-property",6),e.NdJ("onPageChange",function(r){return i.handlePageChange(r)}),e.qZA()()),2&t){const o=e.MAs(6);e.Q6J("graph",o.graph)("project",i.project)("scale",i.scale),e.xp6(2),e.Udp("width",i.leftWidth+"px"),e.xp6(3),e.Udp("width",i.project.width*i.scale+"px")("height",i.project.height*i.scale+"px"),e.xp6(3),e.Udp("width",i.rightWidth+"px"),e.Q6J("graph",o.graph)("project",i.project)}},dependencies:[f,Fe,In,Zn],styles:["[_nghost-%COMP%]{height:100%;min-width:600px;overflow:hidden;display:flex;flex-direction:column;letter-spacing:.1em;font-size:12px}.body[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}.body[_ngcontent-%COMP%]   .splitter[_ngcontent-%COMP%]{width:8px;background-color:#c9c9c9;cursor:col-resize}.body[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;height:100%;position:relative;padding:10px;background-color:#f0f0f0;overflow:auto}"]}),s})();const Ln=[{path:"",component:be},{path:":id",component:be}];let Fn=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[at.Bz.forChild(Ln),at.Bz]}),s})();var F=b(1218),Gn=b(8284),Un=b(6903),ye=(b(5469),b(1281),b(727),b(6406),b(3101),b(9646),b(6451),b(3601),b(8675),b(590),b(9300),b(1005),b(2540)),qn=(b(1519),b(9643)),$n=b(3353);b(8932),new e.OlP("NZ_TAB_SET");let Ii=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[Bt.vT,E.ez,qn.Q8,L.PV,Ct.T,$n.ud,Yt.rt,ye.ZD,_t.b1]}),s})();var Oi=b(8213),Bi=b(1625),Di=b(6672);let Ri=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[{provide:dt.dD},pt.m],imports:[E.ez,_.u5,_.UX,Fn,L.PV.forChild([F.qgH,F.n0m,F.CnB,F.ctN,F.KrS,F.x0x,F.BXO,F.vkb,F.MjI,F.NvA,F.J1v,F.TSL,F.HIu,F.lKn,F.Xwh,F.fhO,F.FsU,F.vEg,F.zuz,F.DxT]),me.S,$.sL,se.e4,et.U5,tt.o7,mt.Qp,Gn.wm,Un.zf,Ii,Oi.Wr,Bi.Y,Dt.LV,oe.Zf,fe.k,Di.X,qe,_t.b1]}),s})()},7521:(kt,Et,b)=>{var E;!function(at,Nt,e){if(at){for(var L,lt={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},Mt={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},dt={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},pt={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},$=1;$<20;++$)lt[111+$]="f"+$;for($=0;$<=9;++$)lt[$+96]=$.toString();U.prototype.bind=function(d,f,l){var D=this;return D._bindMultiple.call(D,d=d instanceof Array?d:[d],f,l),D},U.prototype.unbind=function(d,f){return this.bind.call(this,d,function(){},f)},U.prototype.trigger=function(d,f){var l=this;return l._directMap[d+":"+f]&&l._directMap[d+":"+f]({},d),l},U.prototype.reset=function(){var d=this;return d._callbacks={},d._directMap={},d},U.prototype.stopCallback=function(d,f){if((" "+f.className+" ").indexOf(" mousetrap ")>-1||Jt(f,this.target))return!1;if("composedPath"in d&&"function"==typeof d.composedPath){var D=d.composedPath()[0];D!==d.target&&(f=D)}return"INPUT"==f.tagName||"SELECT"==f.tagName||"TEXTAREA"==f.tagName||f.isContentEditable},U.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},U.addKeycodes=function(d){for(var f in d)d.hasOwnProperty(f)&&(lt[f]=d[f]);L=null},U.init=function(){var d=U(Nt);for(var f in d)"_"!==f.charAt(0)&&(U[f]=function(l){return function(){return d[l].apply(d,arguments)}}(f))},U.init(),at.Mousetrap=U,kt.exports&&(kt.exports=U),void 0!==(E=function(){return U}.call(Et,b,Et,kt))&&(kt.exports=E)}function st(d,f,l){d.addEventListener?d.addEventListener(f,l,!1):d.attachEvent("on"+f,l)}function ut(d){if("keypress"==d.type){var f=String.fromCharCode(d.which);return d.shiftKey||(f=f.toLowerCase()),f}return lt[d.which]?lt[d.which]:Mt[d.which]?Mt[d.which]:String.fromCharCode(d.which).toLowerCase()}function tt(d,f){return d.sort().join(",")===f.sort().join(",")}function vt(d){return"shift"==d||"ctrl"==d||"alt"==d||"meta"==d}function te(d,f,l){return l||(l=function Kt(){if(!L)for(var d in L={},lt)d>95&&d<112||lt.hasOwnProperty(d)&&(L[lt[d]]=d);return L}()[d]?"keydown":"keypress"),"keypress"==l&&f.length&&(l="keydown"),l}function Zt(d,f){var l,D,ot,I=[];for(l=function ee(d){return"+"===d?["+"]:(d=d.replace(/\+{2}/g,"+plus")).split("+")}(d),ot=0;ot<l.length;++ot)pt[D=l[ot]]&&(D=pt[D]),f&&"keypress"!=f&&dt[D]&&(D=dt[D],I.push("shift")),vt(D)&&I.push(D);return{key:D,modifiers:I,action:f=te(D,I,f)}}function Jt(d,f){return null!==d&&d!==Nt&&(d===f||Jt(d.parentNode,f))}function U(d){var f=this;if(d=d||Nt,!(f instanceof U))return new U(d);f.target=d,f._callbacks={},f._directMap={};var D,l={},ot=!1,I=!1,At=!1;function Pt(T){T=T||{};var A,M=!1;for(A in l)T[A]?M=!0:l[A]=0;M||(At=!1)}function ct(T,M,A,N,B,nt){var P,Y,gt=[],X=A.type;if(!f._callbacks[T])return[];for("keyup"==X&&vt(T)&&(M=[T]),P=0;P<f._callbacks[T].length;++P)Y=f._callbacks[T][P],!N&&Y.seq&&l[Y.seq]!=Y.level||X!=Y.action||("keypress"!=X||A.metaKey||A.ctrlKey)&&!tt(M,Y.modifiers)||((!N&&Y.combo==B||N&&Y.seq==N&&Y.level==nt)&&f._callbacks[T].splice(P,1),gt.push(Y));return gt}function It(T,M,A,N){f.stopCallback(M,M.target||M.srcElement,A,N)||!1===T(M,A)&&(function qt(d){d.preventDefault?d.preventDefault():d.returnValue=!1}(M),function $t(d){d.stopPropagation?d.stopPropagation():d.cancelBubble=!0}(M))}function Ot(T){"number"!=typeof T.which&&(T.which=T.keyCode);var M=ut(T);if(M){if("keyup"==T.type&&ot===M)return void(ot=!1);f.handleKey(M,function Xt(d){var f=[];return d.shiftKey&&f.push("shift"),d.altKey&&f.push("alt"),d.ctrlKey&&f.push("ctrl"),d.metaKey&&f.push("meta"),f}(T),T)}}function Ft(T,M,A,N,B){f._directMap[T+":"+A]=M;var P,nt=(T=T.replace(/\s+/g," ")).split(" ");nt.length>1?function ne(T,M,A,N){function B(X){return function(){At=X,++l[T],function Lt(){clearTimeout(D),D=setTimeout(Pt,1e3)}()}}function nt(X){It(A,X,T),"keyup"!==N&&(ot=ut(X)),setTimeout(Pt,10)}l[T]=0;for(var P=0;P<M.length;++P){var gt=P+1===M.length?nt:B(N||Zt(M[P+1]).action);Ft(M[P],gt,N,T,P)}}(T,nt,M,A):(P=Zt(T,A),f._callbacks[P.key]=f._callbacks[P.key]||[],ct(P.key,P.modifiers,{type:P.action},N,T,B),f._callbacks[P.key][N?"unshift":"push"]({callback:M,modifiers:P.modifiers,action:P.action,seq:N,level:B,combo:T}))}f._handleKey=function(T,M,A){var B,N=ct(T,M,A),nt={},P=0,Y=!1;for(B=0;B<N.length;++B)N[B].seq&&(P=Math.max(P,N[B].level));for(B=0;B<N.length;++B)if(N[B].seq){if(N[B].level!=P)continue;Y=!0,nt[N[B].seq]=1,It(N[B].callback,A,N[B].combo,N[B].seq)}else Y||It(N[B].callback,A,N[B].combo);var gt="keypress"==A.type&&I;A.type==At&&!vt(T)&&!gt&&Pt(nt),I=Y&&"keydown"==A.type},f._bindMultiple=function(T,M,A){for(var N=0;N<T.length;++N)Ft(T[N],M,A)},st(d,"keypress",Ot),st(d,"keydown",Ot),st(d,"keyup",Ot)}}(typeof window<"u"?window:null,typeof window<"u"?document:null)}}]);