(self.webpackChunkscada=self.webpackChunkscada||[]).push([[935],{9935:(It,kt,b)=>{"use strict";b.r(kt),b.d(kt,{EditorModule:()=>is});var N=b(6895),ct=b(4575),e=b(4650),ht=b(1481),At=b(1445),dt=b(9651),ut=b(6850),Z=b(1102),tt=b(6616),rt=b(7044),ft=b(1664),nt=b(5635);const qt=[[["","more",""]],"*"],Kt=function(s){return{close:s}},te=["[more]","*"];let vt=(()=>{class s{constructor(){this.open=!0,this.title="\u6807\u9898"}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-collapse"]],inputs:{open:"open",title:"title"},ngContentSelectors:te,decls:9,vars:5,consts:[[1,"header",3,"click"],["nz-icon","","nzType","caret-right","nzTheme","outline",3,"nzRotate"],[1,"title"],[1,"content",3,"ngClass"],[1,"inner"]],template:function(t,n){1&t&&(e.F$t(qt),e.TgZ(0,"div",0),e.NdJ("click",function(){return n.open=!n.open}),e._UZ(1,"span",1),e.TgZ(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"span"),e.Hsn(5),e.qZA()(),e.TgZ(6,"div",3)(7,"div",4),e.Hsn(8,1),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("nzRotate",n.open?90:0),e.xp6(2),e.Oqu(n.title),e.xp6(3),e.Q6J("ngClass",e.VKq(3,Kt,!n.open)))},dependencies:[N.mk,Z.Ls,rt.w],styles:[".header[_ngcontent-%COMP%]{border-top:1px solid #a8a8a8;border-bottom:1px solid #a8a8a8;padding:4px;background-color:#f0f0f0;cursor:pointer;font-weight:700;font-size:1.1em;-webkit-user-select:none;user-select:none;align-items:center;display:flex}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1}.content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{padding:4px}.content.close[_ngcontent-%COMP%]{height:0;max-height:0;overflow:hidden}"]}),s})();var ee=b(6273);function ne(s,i){1&s&&e._UZ(0,"span",7)}function ie(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.more())}),e._uU(1,"\u66f4\u591a"),e.qZA()}}function Jt(s,i){if(1&s&&e._UZ(0,"img",14),2&s){const t=e.oxw().$implicit;e.Q6J("src",t.icon,e.LSH)("alt",t.name)}}function Lt(s,i){if(1&s&&(e._UZ(0,"div",15),e.ALo(1,"html")),2&s){const t=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,t.svg),e.oJD)}}function j(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",11),e.NdJ("dragstart",function(o){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onDragStart(o,a))}),e.YNc(1,Jt,1,2,"img",12),e.YNc(2,Lt,2,3,"div",13),e.qZA()}if(2&s){const t=i.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",t.svg)}}function f(s,i){if(1&s&&(e.TgZ(0,"app-collapse",9),e.YNc(1,j,3,3,"div",10),e.qZA()),2&s){const t=i.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngForOf",t.components)}}let m=(()=>{class s{constructor(t){this.cs=t,this.onDrag=new e.vpe}onDragStart(t,n){console.log("drag",n.id),this.onDrag.emit({event:t,component:n})}handleClick(){}more(){}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(ut.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-library"]],outputs:{onDrag:"onDrag"},decls:9,vars:3,consts:[[1,"header"],["nzSearch","",3,"nzSuffix","nzAddOnAfter"],["type","text","nz-input","","placeholder","\u63a7\u4ef6\u540d\u79f0"],["suffixIconSearch",""],["suffixIconButton",""],[1,"collections"],[3,"title",4,"ngFor","ngForOf"],["nz-icon","","nzType","search"],["nz-button","",3,"click"],[3,"title"],["class","item","draggable","true",3,"title","dragstart",4,"ngFor","ngForOf"],["draggable","true",1,"item",3,"title","dragstart"],[3,"src","alt",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[3,"src","alt"],[3,"innerHTML"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"nz-input-group",1),e._UZ(2,"input",2),e.qZA(),e.YNc(3,ne,1,0,"ng-template",null,3,e.W1O),e.YNc(5,ie,2,0,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(7,"div",5),e.YNc(8,f,2,2,"app-collapse",6),e.qZA()),2&t){const o=e.MAs(4),r=e.MAs(6);e.xp6(1),e.Q6J("nzSuffix",o)("nzAddOnAfter",r),e.xp6(7),e.Q6J("ngForOf",n.cs.collections)}},dependencies:[N.sg,N.O5,Z.Ls,tt.ix,rt.w,ft.dQ,nt.Zp,nt.gB,nt.ke,vt,ee.$],styles:["[_nghost-%COMP%]{height:100%;overflow:hidden;-webkit-user-select:none;user-select:none;border-right:1px solid #a8a8a8;position:relative;display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:5px}.collections[_ngcontent-%COMP%]{flex:1;overflow:auto}.more-btn[_ngcontent-%COMP%]{width:100%;text-align:center;position:absolute;bottom:0}.item[_ngcontent-%COMP%]{display:inline-block;text-align:center;padding:4px;cursor:pointer}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:30px;height:30px}.item[_ngcontent-%COMP%]     svg{width:30px;height:30px}"]}),s})();var O,s,A,l=b(760);class at extends l.G7{get model(){return this.graph.model}get view(){return this.graph.renderer.findViewByCell(this.node)}get containerClassName(){return this.prefixClassName("widget-transform")}get resizeClassName(){return`${this.containerClassName}-resize`}get rotateClassName(){return`${this.containerClassName}-rotate`}constructor(i,t,n){super(),this.node=t,this.graph=n,this.options=Object.assign(Object.assign({},O.defaultOptions),i),this.render(),this.startListening()}startListening(){this.delegateEvents({[`mousedown .${this.resizeClassName}`]:"startResizing",[`touchstart .${this.resizeClassName}`]:"startResizing",[`mousedown .${this.rotateClassName}`]:"startRotating",[`touchstart .${this.rotateClassName}`]:"startRotating"}),this.model.on("*",this.update,this),this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this),this.node.on("removed",this.remove,this),this.model.on("reseted",this.remove,this),this.view.on("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.on("cell:knob:mouseup",this.onKnobMouseUp,this)}stopListening(){this.undelegateEvents(),this.model.off("*",this.update,this),this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this),this.node.off("removed",this.remove,this),this.model.off("reseted",this.remove,this),this.view.off("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.off("cell:knob:mouseup",this.onKnobMouseUp,this)}renderHandles(){this.container=document.createElement("div");const i=document.createElement("div");l.is.attr(i,"draggable","false");const t=i.cloneNode(!0);l.is.addClass(t,this.rotateClassName);const n=O.POSITIONS.map(o=>{const r=i.cloneNode(!0);return l.is.addClass(r,this.resizeClassName),l.is.attr(r,"data-position",o),r});this.empty(),l.is.append(this.container,[...n,t])}render(){return this.renderHandles(),this.view&&this.view.addClass(O.NODE_CLS),l.is.addClass(this.container,this.containerClassName),l.is.toggleClass(this.container,"no-orth-resize",this.options.preserveAspectRatio||!this.options.orthogonalResizing),l.is.toggleClass(this.container,"no-resize",!this.options.resizable),l.is.toggleClass(this.container,"no-rotate",!this.options.rotatable),this.options.className&&l.is.addClass(this.container,this.options.className),this.graph.container.appendChild(this.container),this.update()}update(){const i=this.graph.matrix(),t=this.node.getBBox();t.x*=i.a,t.x+=i.e,t.y*=i.d,t.y+=i.f,t.width*=i.a,t.height*=i.d;const n=l.RZ.normalize(this.node.getAngle());return l.is.css(this.container,{transform:0!==n?`rotate(${n}deg)`:"",width:t.width,height:t.height,left:t.x,top:t.y}),this.updateResizerDirections(),this}remove(){return this.view&&this.view.removeClass(O.NODE_CLS),super.remove()}onKnobMouseDown(){this.startHandle()}onKnobMouseUp(){this.stopHandle()}updateResizerDirections(){const i=l.RZ.normalize(this.node.getAngle()),t=Math.floor(i*(O.DIRECTIONS.length/360));if(t!==this.prevShift){const n=O.DIRECTIONS.slice(t).concat(O.DIRECTIONS.slice(0,t)),o=a=>`${this.containerClassName}-cursor-${a}`;this.container.querySelectorAll(`.${this.resizeClassName}`).forEach((a,c)=>{l.is.removeClass(a,O.DIRECTIONS.map(h=>o(h)).join(" ")),l.is.addClass(a,o(n[c]))}),this.prevShift=t}}getTrueDirection(i){const t=l.RZ.normalize(this.node.getAngle());let n=O.POSITIONS.indexOf(i);return n+=Math.floor(t*(O.POSITIONS.length/360)),n%=O.POSITIONS.length,O.POSITIONS[n]}toValidResizeDirection(i){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[i]||i}startResizing(i){i.stopPropagation(),this.model.startBatch("resize",{cid:this.cid});const t=l.is.attr(i.target,"data-position");this.prepareResizing(i,t),this.startAction(i)}prepareResizing(i,t){const n=this.getTrueDirection(t);let o=0,r=0;t.split("-").forEach(d=>{o={left:-1,right:1}[d]||o,r={top:-1,bottom:1}[d]||r});const a=this.toValidResizeDirection(t),c={"top-right":"bottomLeft","top-left":"bottomRight","bottom-left":"topRight","bottom-right":"topLeft"}[a],h=l.RZ.normalize(this.node.getAngle());this.setEventData(i,{selector:c,direction:a,trueDirection:n,relativeDirection:t,angle:h,resizeX:o,resizeY:r,action:"resizing"})}startRotating(i){i.stopPropagation(),this.model.startBatch("rotate",{cid:this.cid});const t=this.node.getBBox().getCenter(),n=this.normalizeEvent(i),o=this.graph.snapToGrid(n.clientX,n.clientY);this.setEventData(i,{center:t,action:"rotating",angle:l.RZ.normalize(this.node.getAngle()),start:l.E9.create(o).theta(t)}),this.startAction(i)}onMouseMove(i){const t=this.graph.findViewByCell(this.node);let n=this.getEventData(i);if(n.action){const o=this.normalizeEvent(i);let r=o.clientX,a=o.clientY;const c=this.graph.getPlugin("scroller"),h=this.options.restrictedResizing;if(!0===h||"number"==typeof h){const _=!0===h?0:h,w=c?Math.max(_,8):_,C=this.graph.container.getBoundingClientRect();r=l.GH.clamp(r,C.left+w,C.right-w),a=l.GH.clamp(a,C.top+w,C.bottom-w)}else this.options.autoScrollOnResizing&&c&&c.autoScroll(r,a);const d=this.graph.snapToGrid(r,a),p=this.graph.getGridSize(),u=this.node,g=this.options;if("resizing"===n.action){n.resized||(t&&(t.addClass("node-resizing"),this.notify("node:resize",i,t)),n.resized=!0);const _=u.getBBox(),w=l.E9.create(d).rotate(n.angle,_.getCenter()).diff(_[n.selector]);let C=n.resizeX?w.x*n.resizeX:_.width,y=n.resizeY?w.y*n.resizeY:_.height;const I=C,x=y;if(C=l.Z4.snapToGrid(C,p),y=l.Z4.snapToGrid(y,p),C=Math.max(C,g.minWidth||p),y=Math.max(y,g.minHeight||p),C=Math.min(C,g.maxWidth||1/0),y=Math.min(y,g.maxHeight||1/0),g.preserveAspectRatio){const v=_.width*y/_.height;C<v?y=_.height*C/_.width:C=v}const T=n.relativeDirection;if(g.allowReverse&&(I<=-C||x<=-y)){let v;"left"===T?I<=-C&&(v="right"):"right"===T?I<=-C&&(v="left"):"top"===T?x<=-y&&(v="bottom"):"bottom"===T?x<=-y&&(v="top"):"top-left"===T?I<=-C&&x<=-y?v="bottom-right":I<=-C?v="top-right":x<=-y&&(v="bottom-left"):"top-right"===T?I<=-C&&x<=-y?v="bottom-left":I<=-C?v="top-left":x<=-y&&(v="bottom-right"):"bottom-left"===T?I<=-C&&x<=-y?v="top-right":I<=-C?v="bottom-right":x<=-y&&(v="top-left"):"bottom-right"===T&&(I<=-C&&x<=-y?v="top-left":I<=-C?v="bottom-left":x<=-y&&(v="top-right"));const P=v;this.stopHandle();const J=this.container.querySelector(`.${this.resizeClassName}[data-position="${P}"]`);this.startHandle(J),this.prepareResizing(i,P),this.onMouseMove(i)}_.width===C&&_.height===y||(u.resize(C,y,{ui:!0,direction:n.direction,relativeDirection:n.relativeDirection,trueDirection:n.trueDirection,minWidth:g.minWidth,minHeight:g.minHeight,maxWidth:g.maxWidth,maxHeight:g.maxHeight,preserveAspectRatio:!0===g.preserveAspectRatio}),this.notify("node:resizing",i,t))}else if("rotating"===n.action){n.rotated||(t&&(t.addClass("node-rotating"),this.notify("node:rotate",i,t)),n.rotated=!0);const _=u.getAngle(),w=n.start-l.E9.create(d).theta(n.center);let C=n.angle+w;g.rotateGrid&&(C=l.Z4.snapToGrid(C,g.rotateGrid)),C=l.RZ.normalize(C),_!==C&&(u.rotate(C,{absolute:!0}),this.notify("node:rotating",i,t))}}}onMouseUp(i){const t=this.getEventData(i);t.action&&(this.stopAction(i),this.model.stopBatch("resizing"===t.action?"resize":"rotate",{cid:this.cid}))}startHandle(i){if(this.handle=i||null,l.is.addClass(this.container,`${this.containerClassName}-active`),i){l.is.addClass(i,`${this.containerClassName}-active-handle`);const t=i.getAttribute("data-position");if(t){const n=O.DIRECTIONS[O.POSITIONS.indexOf(t)];l.is.addClass(this.container,`${this.containerClassName}-cursor-${n}`)}}}stopHandle(){if(l.is.removeClass(this.container,`${this.containerClassName}-active`),this.handle){l.is.removeClass(this.handle,`${this.containerClassName}-active-handle`);const i=this.handle.getAttribute("data-position");if(i){const t=O.DIRECTIONS[O.POSITIONS.indexOf(i)];l.is.removeClass(this.container,`${this.containerClassName}-cursor-${t}`)}this.handle=null}}startAction(i){this.startHandle(i.target),this.graph.view.undelegateEvents(),this.delegateDocumentEvents(O.documentEvents,i.data)}stopAction(i){this.stopHandle(),this.undelegateDocumentEvents(),this.graph.view.delegateEvents();const t=this.graph.findViewByCell(this.node),n=this.getEventData(i);t&&(t.removeClass(`node-${n.action}`),"resizing"===n.action&&n.resized?this.notify("node:resized",i,t):"rotating"===n.action&&n.rotated&&this.notify("node:rotated",i,t))}notify(i,t,n,o={}){if(n){const r=n.graph,a=r.view.normalizeEvent(t),c=r.snapToGrid(a.clientX,a.clientY);this.trigger(i,Object.assign({e:a,view:n,node:n.cell,cell:n.cell,x:c.x,y:c.y},o))}}dispose(){this.remove(),this.off()}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.G7.dispose()],at.prototype,"dispose",null),(s=O||(O={})).NODE_CLS="has-widget-transform",s.DIRECTIONS=["nw","n","ne","e","se","s","sw","w"],s.POSITIONS=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],s.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp"},s.defaultOptions={minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,rotateGrid:15,rotatable:!0,preserveAspectRatio:!1,orthogonalResizing:!0,restrictedResizing:!1,autoScrollOnResizing:!0,allowReverse:!0},l.kJ.prototype.createTransformWidget=function(s){const i=this.getPlugin("transform");return i&&i.createWidget(s),this},l.kJ.prototype.clearTransformWidgets=function(){const s=this.getPlugin("transform");return s&&s.clearWidgets(),this};class pt extends l.ew{constructor(i={}){super(),this.name="transform",this.widgets=new Map,this.disabled=!1,this.options=i,l.mf.ensure(this.name,".x6-widget-transform {\n  position: absolute;\n  box-sizing: content-box !important;\n  margin: -5px 0 0 -5px;\n  padding: 4px;\n  border: 1px dashed #000;\n  border-radius: 5px;\n  user-select: none;\n  pointer-events: none;\n}\n.x6-widget-transform > div {\n  position: absolute;\n  box-sizing: border-box;\n  background-color: #fff;\n  border: 1px solid #000;\n  transition: background-color 0.2s;\n  pointer-events: auto;\n  -webkit-user-drag: none;\n  user-drag: none;\n  /* stylelint-disable-line */\n}\n.x6-widget-transform > div:hover {\n  background-color: #d3d3d3;\n}\n.x6-widget-transform-cursor-n {\n  cursor: n-resize;\n}\n.x6-widget-transform-cursor-s {\n  cursor: s-resize;\n}\n.x6-widget-transform-cursor-e {\n  cursor: e-resize;\n}\n.x6-widget-transform-cursor-w {\n  cursor: w-resize;\n}\n.x6-widget-transform-cursor-ne {\n  cursor: ne-resize;\n}\n.x6-widget-transform-cursor-nw {\n  cursor: nw-resize;\n}\n.x6-widget-transform-cursor-se {\n  cursor: se-resize;\n}\n.x6-widget-transform-cursor-sw {\n  cursor: sw-resize;\n}\n.x6-widget-transform-resize {\n  width: 10px;\n  height: 10px;\n  border-radius: 6px;\n}\n.x6-widget-transform-resize[data-position='top-left'] {\n  top: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='top-right'] {\n  top: -5px;\n  right: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-left'] {\n  bottom: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-right'] {\n  right: -5px;\n  bottom: -5px;\n}\n.x6-widget-transform-resize[data-position='top'] {\n  top: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom'] {\n  bottom: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='left'] {\n  top: 50%;\n  left: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform-resize[data-position='right'] {\n  top: 50%;\n  right: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='top'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='right'] {\n  display: none;\n}\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='right'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='top'] {\n  display: none;\n}\n.x6-widget-transform.no-resize .x6-widget-transform-resize {\n  display: none;\n}\n.x6-widget-transform-rotate {\n  top: -20px;\n  left: -20px;\n  width: 12px;\n  height: 12px;\n  border-radius: 6px;\n  cursor: crosshair;\n}\n.x6-widget-transform.no-rotate .x6-widget-transform-rotate {\n  display: none;\n}\n.x6-widget-transform-active {\n  border-color: transparent;\n  pointer-events: all;\n}\n.x6-widget-transform-active > div {\n  display: none;\n}\n.x6-widget-transform-active > .x6-widget-transform-active-handle {\n  display: block;\n  background-color: #808080;\n}\n")}init(i){this.graph=i,!this.disabled&&this.startListening()}startListening(){this.graph.on("node:click",this.onNodeClick,this),this.graph.on("blank:mousedown",this.onBlankMouseDown,this)}stopListening(){this.graph.off("node:click",this.onNodeClick,this),this.graph.off("blank:mousedown",this.onBlankMouseDown,this)}enable(){this.disabled&&(this.disabled=!1,this.startListening())}disable(){this.disabled||(this.disabled=!0,this.stopListening())}isEnabled(){return!this.disabled}createWidget(i){this.clearWidgets();const t=this.createTransform(i);t&&(this.widgets.set(i,t),t.on("*",(n,o)=>{this.trigger(n,o),this.graph.trigger(n,o)}))}onNodeClick({node:i}){this.createWidget(i)}onBlankMouseDown(){this.clearWidgets()}createTransform(i){const t=this.getTransformOptions(i);return t.resizable||t.rotatable?new at(t,i,this.graph):null}getTransformOptions(i){this.options.resizing||(this.options.resizing={enabled:!1}),this.options.rotating||(this.options.rotating={enabled:!1}),"boolean"==typeof this.options.resizing&&(this.options.resizing={enabled:this.options.resizing}),"boolean"==typeof this.options.rotating&&(this.options.rotating={enabled:this.options.rotating});const t=pt.parseOptionGroup(this.graph,i,this.options.resizing),n=pt.parseOptionGroup(this.graph,i,this.options.rotating);return{resizable:!!t.enabled,minWidth:t.minWidth||0,maxWidth:t.maxWidth||Number.MAX_SAFE_INTEGER,minHeight:t.minHeight||0,maxHeight:t.maxHeight||Number.MAX_SAFE_INTEGER,orthogonalResizing:"boolean"!=typeof t.orthogonal||t.orthogonal,restrictedResizing:!!t.restrict,autoScrollOnResizing:"boolean"!=typeof t.autoScroll||t.autoScroll,preserveAspectRatio:!!t.preserveAspectRatio,allowReverse:"boolean"!=typeof t.allowReverse||t.allowReverse,rotatable:!!n.enabled,rotateGrid:n.grid||15}}clearWidgets(){this.widgets.forEach((i,t)=>{this.graph.getCellById(t.id)&&i.dispose()}),this.widgets.clear()}dispose(){this.clearWidgets(),this.stopListening(),this.off(),l.mf.clean(this.name)}}(function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)})([l.ew.dispose()],pt.prototype,"dispose",null),function(s){s.parseOptionGroup=function i(t,n,o){const r={};return Object.keys(o||{}).forEach(a=>{const c=o[a];r[a]="function"==typeof c?c.call(t,n):c}),r}}(pt||(pt={}));class Gt extends l.G7{get model(){return this.graph.model}get containerClassName(){return this.prefixClassName("widget-snapline")}get verticalClassName(){return`${this.containerClassName}-vertical`}get horizontalClassName(){return`${this.containerClassName}-horizontal`}constructor(i){super();const{graph:t}=i,n=function(s,i){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&i.indexOf(n)<0&&(t[n]=s[n]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(s);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(t[n[o]]=s[n[o]])}return t}(i,["graph"]);this.graph=t,this.options=Object.assign({},n),this.offset={x:0,y:0},this.render(),this.disabled||this.startListening()}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.startListening())}disable(){this.disabled||(this.options.enabled=!1,this.stopListening())}setFilter(i){this.options.filter=i}render(){const i=this.containerWrapper=new l.OW("svg"),t=this.horizontal=new l.OW("line"),n=this.vertical=new l.OW("line");i.addClass(this.containerClassName),t.addClass(this.horizontalClassName),n.addClass(this.verticalClassName),i.setAttribute("width","100%"),i.setAttribute("height","100%"),t.setAttribute("display","none"),n.setAttribute("display","none"),i.append([t,n]),this.options.className&&i.addClass(this.options.className),this.container=this.containerWrapper.node}startListening(){this.stopListening(),this.graph.on("node:mousedown",this.captureCursorOffset,this),this.graph.on("node:mousemove",this.snapOnMoving,this),this.model.on("batch:stop",this.onBatchStop,this),this.delegateDocumentEvents({mouseup:"hide",touchend:"hide"})}stopListening(){this.graph.off("node:mousedown",this.captureCursorOffset,this),this.graph.off("node:mousemove",this.snapOnMoving,this),this.model.off("batch:stop",this.onBatchStop,this),this.undelegateDocumentEvents()}onBatchStop({name:i,data:t}){"resize"===i&&this.snapOnResizing(t.cell,t)}captureCursorOffset({view:i,x:t,y:n}){const o=i.getDelegatedView();if(o&&this.isNodeMovable(o)){const r=i.cell.getPosition();this.offset={x:t-r.x,y:n-r.y}}}isNodeMovable(i){return i&&i.cell.isNode()&&i.can("nodeMovable")}getRestrictArea(i){const t=this.graph.options.translating.restrict,n="function"==typeof t?l.Iw.call(t,this.graph,i):t;return"number"==typeof n?this.graph.transform.getGraphArea().inflate(n):!0===n?this.graph.transform.getGraphArea():n||null}snapOnResizing(i,t){if(this.options.resizing&&!t.snapped&&t.ui&&t.direction&&t.trueDirection){const n=this.graph.renderer.findViewByCell(i);if(n&&n.cell.isNode()){const o=i.getBBox(),r=o.bbox(i.getAngle()),a=r.getTopLeft(),c=r.getBottomRight(),h=l.RZ.normalize(i.getAngle()),d=this.options.tolerance||0;let p,u,g,_,w,C;const y={vertical:0,horizontal:0},I=t.direction,x=t.trueDirection,T=t.relativeDirection;y.vertical=-1!==x.indexOf("right")?c.x:a.x,y.horizontal=-1!==x.indexOf("bottom")?c.y:a.y,this.model.getNodes().some(F=>{if(this.isIgnored(i,F))return!1;const $=F.getBBox().bbox(F.getAngle()),xt=$.getTopLeft(),Xt=$.getBottomRight(),Be={vertical:[xt.x,Xt.x],horizontal:[xt.y,Xt.y]},Zt={};return Object.keys(Be).forEach(ss=>{const pe=ss,os=Be[pe].map(Nt=>({position:Nt,distance:Math.abs(Nt-y[pe])})).filter(Nt=>Nt.distance<=d);Zt[pe]=l.RO.sortBy(os,Nt=>Nt.distance)}),null==p&&Zt.vertical.length>0&&(p=Zt.vertical[0].position,u=Math.min(r.y,$.y),g=Math.max(c.y,Xt.y)-u),null==_&&Zt.horizontal.length>0&&(_=Zt.horizontal[0].position,w=Math.min(r.x,$.x),C=Math.max(c.x,Xt.x)-w),null!=p&&null!=_}),this.hide();let v=0,P=0;(null!=_||null!=p)&&(null!=p&&(v=-1!==x.indexOf("right")?p-c.x:a.x-p),null!=_&&(P=-1!==x.indexOf("bottom")?_-c.y:a.y-_));let J=0,Q=0;if(h%90==0)90===h||270===h?(J=P,Q=v):(J=v,Q=P);else{const F=h>=0&&h<90?1:h>=90&&h<180?4:h>=180&&h<270?3:2;null!=_&&null!=p&&(v<P?(P=0,_=void 0):(v=0,p=void 0));const $=l.RZ.toRad(h%90);v&&(J=3===F?v/Math.cos($):v/Math.sin($)),P&&(Q=3===F?P/Math.cos($):P/Math.sin($));const xt=1===F||3===F;switch(T){case"top":case"bottom":Q=P?P/(xt?Math.cos($):Math.sin($)):v/(xt?Math.sin($):Math.cos($));break;case"left":case"right":J=v?v/(xt?Math.cos($):Math.sin($)):P/(xt?Math.sin($):Math.cos($))}}switch(T){case"top":case"bottom":J=0;break;case"left":case"right":Q=0}const lt=this.graph.getGridSize();let W=Math.max(o.width+J,lt),q=Math.max(o.height+Q,lt);t.minWidth&&t.minWidth>lt&&(W=Math.max(W,t.minWidth)),t.minHeight&&t.minHeight>lt&&(q=Math.max(q,t.minHeight)),t.maxWidth&&(W=Math.min(W,t.maxWidth)),t.maxHeight&&(q=Math.min(q,t.maxHeight)),t.preserveAspectRatio&&(Q<J?q=W*(o.height/o.width):W=q*(o.width/o.height)),(W!==o.width||q!==o.height)&&(i.resize(W,q,{direction:I,relativeDirection:T,trueDirection:x,snapped:!0,snaplines:this.cid,restrict:this.getRestrictArea(n)}),g&&(g+=q-o.height),C&&(C+=W-o.width));const V=i.getBBox().bbox(h);p&&Math.abs(V.x-p)>1&&Math.abs(V.width+V.x-p)>1&&(p=void 0),_&&Math.abs(V.y-_)>1&&Math.abs(V.height+V.y-_)>1&&(_=void 0),this.update({verticalLeft:p,verticalTop:u,verticalHeight:g,horizontalTop:_,horizontalLeft:w,horizontalWidth:C})}}}snapOnMoving({view:i,e:t,x:n,y:o}){const r=i.getEventData(t).delegatedView||i;if(!this.isNodeMovable(r))return;const a=r.cell,c=a.getSize(),h=a.getPosition(),d=new l.Ae(n-this.offset.x,o-this.offset.y,c.width,c.height),p=a.getAngle(),u=d.getCenter(),g=d.bbox(p),_=g.getTopLeft(),w=g.getBottomRight(),C=this.options.tolerance||0;let y,I,x,T,v,P,J=0,Q=0;if(this.model.getNodes().some(lt=>{if(this.isIgnored(a,lt))return!1;const W=lt.getBBox().bbox(lt.getAngle()),q=W.getCenter(),V=W.getTopLeft(),F=W.getBottomRight();return null==y&&(Math.abs(q.x-u.x)<C?(y=q.x,J=.5):Math.abs(V.x-_.x)<C?(y=V.x,J=0):Math.abs(V.x-w.x)<C?(y=V.x,J=1):Math.abs(F.x-w.x)<C?(y=F.x,J=1):Math.abs(F.x-_.x)<C&&(y=F.x),null!=y&&(I=Math.min(g.y,W.y),x=Math.max(w.y,F.y)-I)),null==T&&(Math.abs(q.y-u.y)<C?(T=q.y,Q=.5):Math.abs(V.y-_.y)<C?T=V.y:Math.abs(V.y-w.y)<C?(T=V.y,Q=1):Math.abs(F.y-w.y)<C?(T=F.y,Q=1):Math.abs(F.y-_.y)<C&&(T=F.y),null!=T&&(v=Math.min(g.x,W.x),P=Math.max(w.x,F.x)-v)),null!=y&&null!=T}),this.hide(),null!=T||null!=y){null!=T&&(g.y=T-Q*g.height),null!=y&&(g.x=y-J*g.width);const lt=g.getCenter(),V=lt.x-d.width/2-h.x,F=lt.y-d.height/2-h.y;(0!==V||0!==F)&&(a.translate(V,F,{snapped:!0,restrict:this.getRestrictArea(r)}),P&&(P+=V),x&&(x+=F)),this.update({verticalLeft:y,verticalTop:I,verticalHeight:x,horizontalTop:T,horizontalLeft:v,horizontalWidth:P})}}isIgnored(i,t){return t.id===i.id||t.isDescendantOf(i)||!this.filter(t)}filter(i){const t=this.options.filter;return Array.isArray(t)?t.some(n=>"string"==typeof n?i.shape===n:i.id===n.id):"function"!=typeof t||l.Iw.call(t,this.graph,i)}update(i){if(i.horizontalTop){const t=this.graph.localToGraph(new l.E9(i.horizontalLeft,i.horizontalTop)),n=this.graph.localToGraph(new l.E9(i.horizontalLeft+i.horizontalWidth,i.horizontalTop));this.horizontal.setAttributes({x1:this.options.sharp?`${t.x}`:"0",y1:`${t.y}`,x2:this.options.sharp?`${n.x}`:"100%",y2:`${n.y}`,display:"inherit"})}else this.horizontal.setAttribute("display","none");if(i.verticalLeft){const t=this.graph.localToGraph(new l.E9(i.verticalLeft,i.verticalTop)),n=this.graph.localToGraph(new l.E9(i.verticalLeft,i.verticalTop+i.verticalHeight));this.vertical.setAttributes({x1:`${t.x}`,y1:this.options.sharp?`${t.y}`:"0",x2:`${n.x}`,y2:this.options.sharp?`${n.y}`:"100%",display:"inherit"})}else this.vertical.setAttribute("display","none");this.show()}resetTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}show(){return this.resetTimer(),null==this.container.parentNode&&this.graph.container.appendChild(this.container),this}hide(){this.resetTimer(),this.vertical.setAttribute("display","none"),this.horizontal.setAttribute("display","none");const i=this.options.clean,t="number"==typeof i?i:!1!==i?3e3:0;return t>0&&(this.timer=window.setTimeout(()=>{null!==this.container.parentNode&&this.unmount()},t)),this}onRemove(){this.stopListening(),this.hide()}dispose(){this.remove()}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.G7.dispose()],Gt.prototype,"dispose",null),l.kJ.prototype.isSnaplineEnabled=function(){const s=this.getPlugin("snapline");return!!s&&s.isEnabled()},l.kJ.prototype.enableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enable(),this},l.kJ.prototype.disableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disable(),this},l.kJ.prototype.toggleSnapline=function(){const s=this.getPlugin("snapline");return s&&s.toggleEnabled(),this},l.kJ.prototype.hideSnapline=function(){const s=this.getPlugin("snapline");return s&&s.hide(),this},l.kJ.prototype.setSnaplineFilter=function(s){const i=this.getPlugin("snapline");return i&&i.setFilter(s),this},l.kJ.prototype.isSnaplineOnResizingEnabled=function(){const s=this.getPlugin("snapline");return!!s&&s.isOnResizingEnabled()},l.kJ.prototype.enableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.enableOnResizing(),this},l.kJ.prototype.disableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.disableOnResizing(),this},l.kJ.prototype.toggleSnaplineOnResizing=function(s){const i=this.getPlugin("snapline");return i&&i.toggleOnResizing(s),this},l.kJ.prototype.isSharpSnapline=function(){const s=this.getPlugin("snapline");return!!s&&s.isSharp()},l.kJ.prototype.enableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enableSharp(),this},l.kJ.prototype.disableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disableSharp(),this},l.kJ.prototype.toggleSharpSnapline=function(s){const i=this.getPlugin("snapline");return i&&i.toggleSharp(s),this},l.kJ.prototype.getSnaplineTolerance=function(){const s=this.getPlugin("snapline");if(s)return s.getTolerance()},l.kJ.prototype.setSnaplineTolerance=function(s){const i=this.getPlugin("snapline");return i&&i.setTolerance(s),this};class S extends l.JT{constructor(i={}){super(),this.name="snapline",this.options=Object.assign({enabled:!0,tolerance:10},i),l.mf.ensure(this.name,".x6-widget-snapline {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  pointer-events: none;\n}\n.x6-widget-snapline-vertical,\n.x6-widget-snapline-horizontal {\n  stroke: #2ecc71;\n  stroke-width: 1px;\n}\n")}init(i){this.snaplineImpl=new Gt(Object.assign(Object.assign({},this.options),{graph:i}))}isEnabled(){return!this.snaplineImpl.disabled}enable(){this.snaplineImpl.enable()}disable(){this.snaplineImpl.disable()}toggleEnabled(i){if(null==i)return this.isEnabled()?this.disable():this.enable(),this;i!==this.isEnabled()&&(i?this.enable():this.disable())}hide(){return this.snaplineImpl.hide(),this}setFilter(i){return this.snaplineImpl.setFilter(i),this}isOnResizingEnabled(){return!0===this.snaplineImpl.options.resizing}enableOnResizing(){return this.snaplineImpl.options.resizing=!0,this}disableOnResizing(){return this.snaplineImpl.options.resizing=!1,this}toggleOnResizing(i){return null!=i?i!==this.isOnResizingEnabled()&&(i?this.enableOnResizing():this.disableOnResizing()):this.isOnResizingEnabled()?this.disableOnResizing():this.enableOnResizing(),this}isSharp(){return!0===this.snaplineImpl.options.sharp}enableSharp(){return this.snaplineImpl.options.sharp=!0,this}disableSharp(){return this.snaplineImpl.options.sharp=!1,this}toggleSharp(i){return null!=i?i!==this.isSharp()&&(i?this.enableSharp():this.disableSharp()):this.isSharp()?this.disableSharp():this.enableSharp(),this}getTolerance(){return this.snaplineImpl.options.tolerance}setTolerance(i){return this.snaplineImpl.options.tolerance=i,this}captureCursorOffset(i){this.snaplineImpl.captureCursorOffset(i)}snapOnMoving(i){this.snaplineImpl.snapOnMoving(i)}dispose(){this.snaplineImpl.dispose(),l.mf.clean(this.name)}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.JT.dispose()],S.prototype,"dispose",null);class E{constructor(){this.cells=[]}copy(i,t,n={}){this.options=Object.assign({},n);const r=(l.Hn.isModel(t)?t:t.model).cloneSubGraph(i,n);this.cells=l.RO.sortBy(Object.keys(r).map(a=>r[a]),a=>a.isEdge()?2:1),this.serialize(n)}cut(i,t,n={}){this.copy(i,t,n),(l.kJ.isGraph(t)?t.model:t).batchUpdate("cut",()=>{i.forEach(r=>r.remove())})}paste(i,t={}){const n=Object.assign(Object.assign({},this.options),t),{offset:o,edgeProps:r,nodeProps:a}=n;let c=20,h=20;o&&(c="number"==typeof o?o:o.dx,h="number"==typeof o?o:o.dy),this.deserialize(n);const d=this.cells;d.forEach(u=>{u.model=null,u.removeProp("zIndex"),(c||h)&&u.translate(c,h),a&&u.isNode()&&u.prop(a),r&&u.isEdge()&&u.prop(r)});const p=l.kJ.isGraph(i)?i.model:i;return p.batchUpdate("paste",()=>{p.addCells(this.cells)}),this.copy(d,i,t),d}serialize(i){!1!==i.useLocalStorage&&A.save(this.cells)}deserialize(i){if(i.useLocalStorage){const t=A.fetch();t&&(this.cells=t)}}isEmpty(i={}){return i.useLocalStorage&&this.deserialize(i),this.cells.length<=0}clean(){this.options={},this.cells=[],A.clean()}}(function(s){const i=`${l.De.prefixCls}.clipboard.cells`;s.save=function t(r){if(window.localStorage){const a=r.map(c=>c.toJSON());localStorage.setItem(i,JSON.stringify(a))}},s.fetch=function n(){if(window.localStorage){const r=localStorage.getItem(i),a=r?JSON.parse(r):[];if(a)return l.Hn.fromJSON(a)}},s.clean=function o(){window.localStorage&&localStorage.removeItem(i)}})(A||(A={})),l.kJ.prototype.isClipboardEnabled=function(){const s=this.getPlugin("clipboard");return!!s&&s.isEnabled()},l.kJ.prototype.enableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.enable(),this},l.kJ.prototype.disableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.disable(),this},l.kJ.prototype.toggleClipboard=function(s){const i=this.getPlugin("clipboard");return i&&i.toggleEnabled(s),this},l.kJ.prototype.isClipboardEmpty=function(s){const i=this.getPlugin("clipboard");return!i||i.isEmpty(s)},l.kJ.prototype.getCellsInClipboard=function(){const s=this.getPlugin("clipboard");return s?s.getCellsInClipboard():[]},l.kJ.prototype.cleanClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.clean(),this},l.kJ.prototype.copy=function(s,i){const t=this.getPlugin("clipboard");return t&&t.copy(s,i),this},l.kJ.prototype.cut=function(s,i){const t=this.getPlugin("clipboard");return t&&t.cut(s,i),this},l.kJ.prototype.paste=function(s,i){const t=this.getPlugin("clipboard");return t?t.paste(s,i):[]};class st extends l.ew{get disabled(){return!0!==this.options.enabled}get cells(){return this.clipboardImpl.cells}constructor(i={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},i)}init(i){this.graph=i,this.clipboardImpl=new E,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(i){return null!=i?i!==this.isEnabled()&&(i?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(i={}){return this.clipboardImpl.isEmpty(i)}getCellsInClipboard(){return this.cells}clean(i){return(!this.disabled||i)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(i,t={}){return this.disabled||(this.clipboardImpl.copy(i,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:i})),this}cut(i,t={}){return this.disabled||(this.clipboardImpl.cut(i,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:i})),this}paste(i={},t=this.graph){return this.disabled?[]:this.clipboardImpl.paste(t,Object.assign(Object.assign({},this.commonOptions),i))}get commonOptions(){return function(s,i){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&i.indexOf(n)<0&&(t[n]=s[n]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(s);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(t[n[o]]=s[n[o]])}return t}(this.options,["enabled"])}notify(i,t){this.trigger(i,t),this.graph.trigger(i,t)}dispose(){this.clean(!0),this.off()}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.ew.dispose()],st.prototype,"dispose",null);var M=b(7521),H=b.n(M);class K extends l.JT{get graph(){return this.options.graph}constructor(i){super(),this.options=i;const t=this.graph.getPlugin("scroller");this.container=t?t.container:this.graph.container,i.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=K.createMousetrap(this)}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(i,t,n){this.mousetrap.bind(this.getKeys(i),t,n)}off(i,t){this.mousetrap.unbind(this.getKeys(i),t)}clear(){this.mousetrap.reset()}trigger(i,t){this.mousetrap.trigger(i,t)}focus(i){this.isInputEvent(i.e)||this.target.focus({preventScroll:!0})}getKeys(i){return(Array.isArray(i)?i:[i]).map(t=>this.formatkey(t))}formatkey(i){const t=i.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command"),n=this.options.format;return n?l.Iw.call(n,this.graph,t):t}isGraphEvent(i){const t=i.target;return!!t&&(t===this.target||i.currentTarget===this.target||t===document.body||l.is.contains(this.container,t))}isInputEvent(i){var t;const n=i.target,o=null===(t=n?.tagName)||void 0===t?void 0:t.toLowerCase();let r=["input","textarea"].includes(o);return"true"===l.is.attr(n,"contenteditable")&&(r=!0),r}isEnabledForEvent(i){const t=!this.disabled&&this.isGraphEvent(i),n=this.isInputEvent(i);if(t){if(n&&("Backspace"===i.key||"Delete"===i.key))return!1;if(this.options.guard)return l.Iw.call(this.options.guard,this.graph,i)}return t}dispose(){this.mousetrap.reset()}}(function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)})([l.JT.dispose()],K.prototype,"dispose",null),function(s){s.createMousetrap=function i(t){const n=new(H())(t.target),o=n.stopCallback;return n.stopCallback=(r,a,c)=>!t.isEnabledForEvent(r)||!!o&&o.call(n,r,a,c),n}}(K||(K={})),l.kJ.prototype.isKeyboardEnabled=function(){const s=this.getPlugin("keyboard");return!!s&&s.isEnabled()},l.kJ.prototype.enableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.enable(),this},l.kJ.prototype.disableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.disable(),this},l.kJ.prototype.toggleKeyboard=function(s){const i=this.getPlugin("keyboard");return i&&i.toggleEnabled(s),this},l.kJ.prototype.bindKey=function(s,i,t){const n=this.getPlugin("keyboard");return n&&n.bindKey(s,i,t),this},l.kJ.prototype.unbindKey=function(s,i){const t=this.getPlugin("keyboard");return t&&t.unbindKey(s,i),this},l.kJ.prototype.clearKeys=function(){const s=this.getPlugin("keyboard");return s&&s.clear(),this},l.kJ.prototype.triggerKey=function(s,i){const t=this.getPlugin("keyboard");return t&&t.trigger(s,i),this};class Yt extends l.JT{constructor(i={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},i)}init(i){this.keyboardImpl=new K(Object.assign(Object.assign({},this.options),{graph:i}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(i){return null!=i?i!==this.isEnabled()&&(i?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(i,t,n){return this.keyboardImpl.on(i,t,n),this}trigger(i,t){return this.keyboardImpl.trigger(i,t),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(i,t){return this.keyboardImpl.off(i,t),this}dispose(){this.keyboardImpl.dispose()}}(function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)})([l.JT.dispose()],Yt.prototype,"dispose",null),l.kJ.prototype.isHistoryEnabled=function(){const s=this.getPlugin("history");return!!s&&s.isEnabled()},l.kJ.prototype.enableHistory=function(){const s=this.getPlugin("history");return s&&s.enable(),this},l.kJ.prototype.disableHistory=function(){const s=this.getPlugin("history");return s&&s.disable(),this},l.kJ.prototype.toggleHistory=function(s){const i=this.getPlugin("history");return i&&i.toggleEnabled(s),this},l.kJ.prototype.undo=function(s){const i=this.getPlugin("history");return i&&i.undo(s),this},l.kJ.prototype.redo=function(s){const i=this.getPlugin("history");return i&&i.redo(s),this},l.kJ.prototype.undoAndCancel=function(s){const i=this.getPlugin("history");return i&&i.cancel(s),this},l.kJ.prototype.canUndo=function(){const s=this.getPlugin("history");return!!s&&s.canUndo()},l.kJ.prototype.canRedo=function(){const s=this.getPlugin("history");return!!s&&s.canRedo()},l.kJ.prototype.cleanHistory=function(s){const i=this.getPlugin("history");return i&&i.clean(s),this},l.kJ.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()},l.kJ.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()},l.kJ.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()},l.kJ.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var R,et,de=function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);return o>3&&r&&Object.defineProperty(i,t,r),r};class St extends l.ew{constructor(i={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:t=0}=i;this.stackSize=t,this.options=R.getOptions(i),this.validator=new St.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(i){this.graph=i,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(i){return null!=i?i!==this.isEnabled()&&(i?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(i={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,i),this.redoStack.push(t),this.notify("undo",t,i))}return this}redo(i={}){if(!this.disabled){const t=this.redoStack.pop();t&&(this.applyCommand(t,i),this.undoStackPush(t),this.notify("redo",t,i))}return this}cancel(i={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,i),this.redoStack=[],this.notify("cancel",t,i))}return this}getSize(){return this.stackSize}getUndoRemainSize(){return this.stackSize-this.undoStack.length}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(i={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,i),this}get disabled(){return!0!==this.options.enabled}validate(i,...t){return this.validator.validate(i,...t),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((i,t)=>{this.handlers[t]=this.addCommand.bind(this,i),this.model.on(i,this.handlers[t])}),this.validator.on("invalid",i=>this.trigger("invalid",i))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((i,t)=>{this.model.off(i,this.handlers[t])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(i){return{batch:!!i&&i.batch,data:{}}}revertCommand(i,t){this.freezed=!0;const n=Array.isArray(i)?R.sortBatchCommands(i):[i];for(let o=n.length-1;o>=0;o-=1){const r=n[o],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.revertOptionsList||[]));this.executeCommand(r,!0,a)}this.freezed=!1}applyCommand(i,t){this.freezed=!0;const n=Array.isArray(i)?R.sortBatchCommands(i):[i];for(let o=0;o<n.length;o+=1){const r=n[o],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.applyOptionsList||[]));this.executeCommand(r,!1,a)}this.freezed=!1}executeCommand(i,t,n){const o=this.model,r=o.getCell(i.data.id),a=i.event;if(R.isAddEvent(a)&&t||R.isRemoveEvent(a)&&!t)r&&r.remove(n);else if(R.isAddEvent(a)&&!t||R.isRemoveEvent(a)&&t){const c=i.data;c.node?o.addNode(c.props,n):c.edge&&o.addEdge(c.props,n)}else if(R.isChangeEvent(a)){const c=i.data,h=c.key;if(h&&r){const d=t?c.prev[h]:c.next[h];"attrs"===c.key&&this.ensureUndefinedAttrs(d,t?c.next[h]:c.prev[h]),r.prop(h,d,n)}}else{const c=this.options.executeCommand;c&&l.Iw.call(c,this,i,t,n)}}addCommand(i,t){if(this.freezed||this.disabled)return;const n=t,o=n.options||{};if(o.dryrun||R.isAddEvent(i)&&this.options.ignoreAdd||R.isRemoveEvent(i)&&this.options.ignoreRemove||R.isChangeEvent(i)&&this.options.ignoreChange)return;const r=this.options.beforeAddCommand;if(null!=r&&!1===l.Iw.call(r,this,i,t))return;"cell:change:*"===i&&(i=`cell:change:${n.key}`);const a=n.cell,c=l.Hn.isModel(a);let h;if(this.batchCommands){if(h=this.batchCommands[Math.max(this.lastBatchIndex,0)],this.lastBatchIndex>=0&&(c&&!h.modelChange||h.data.id!==a.id||h.event!==i)){const g=this.batchCommands.findIndex(_=>(c&&_.modelChange||_.data.id===a.id)&&_.event===i);g<0||R.isAddEvent(i)||R.isRemoveEvent(i)?h=this.createCommand({batch:!0}):(h=this.batchCommands[g],this.batchCommands.splice(g,1)),this.batchCommands.push(h),this.lastBatchIndex=this.batchCommands.length-1}}else h=this.createCommand({batch:!1});if(R.isAddEvent(i)||R.isRemoveEvent(i)){const p=h.data;return h.event=i,h.options=o,p.id=a.id,p.props=l.QK.cloneDeep(a.toJSON()),a.isEdge()?p.edge=!0:a.isNode()&&(p.node=!0),this.push(h,o)}if(R.isChangeEvent(i)){const p=t.key,u=h.data;return(!h.batch||!h.event)&&(h.event=i,h.options=o,u.key=p,null==u.prev&&(u.prev={}),u.prev[p]=l.QK.cloneDeep(a.previous(p)),c?h.modelChange=!0:u.id=a.id),null==u.next&&(u.next={}),u.next[p]=l.QK.cloneDeep(a.prop(p)),this.push(h,o)}const d=this.options.afterAddCommand;d&&l.Iw.call(d,this,i,t,h),this.push(h,o)}initBatchCommand(i){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(i){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const t=this.filterBatchCommand(this.batchCommands);t.length>0&&(this.redoStack=[],this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,i)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(i){let t=i.slice();const n=[];for(;t.length>0;){const o=t.shift(),r=o.event,a=o.data.id;if(null!=r&&(null!=a||o.modelChange)){if(R.isAddEvent(r)){const c=t.findIndex(h=>R.isRemoveEvent(h.event)&&h.data.id===a);if(c>=0){t=t.filter((h,d)=>c<d||h.data.id!==a);continue}}else if(R.isRemoveEvent(r)){const c=t.findIndex(h=>R.isAddEvent(h.event)&&h.data.id===a);if(c>=0){t.splice(c,1);continue}}else if(R.isChangeEvent(r)){const c=o.data;if(l.QK.isEqual(c.prev,c.next))continue}n.push(o)}}return n}notify(i,t,n){const o=null==t?null:Array.isArray(t)?t:[t];this.emit(i,{cmds:o,options:n}),this.graph.trigger(`history:${i}`,{cmds:o,options:n}),this.emit("change",{cmds:o,options:n}),this.graph.trigger("history:change",{cmds:o,options:n})}push(i,t){this.redoStack=[],i.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:i,options:t})):(this.undoStackPush(i),this.consolidateCommands(),this.notify("add",i,t))}consolidateCommands(){var i;const t=this.undoStack[this.undoStack.length-1],n=this.undoStack[this.undoStack.length-2];if(!Array.isArray(t))return;const o=new Set(t.map(a=>a.event));if(!(2===o.size&&o.has("cell:change:parent")&&o.has("cell:change:children")&&t.every(a=>{var c;return a.batch&&(null===(c=a.options)||void 0===c?void 0:c.ui)})&&Array.isArray(n)&&1===n.length))return;const r=n[0];"cell:change:position"!==r.event||null===(i=r.options)||void 0===i||!i.ui||(n.push(...t),this.undoStack.pop())}undoStackPush(i){0!==this.stackSize?(this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(i)):this.undoStack.push(i)}ensureUndefinedAttrs(i,t){null!==i&&null!==t&&"object"==typeof i&&"object"==typeof t&&Object.keys(t).forEach(n=>{i.hasOwnProperty(n)?"object"==typeof i[n]&&"object"==typeof t[n]&&this.ensureUndefinedAttrs(i[n],t[n]):i[n]=void 0})}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}de([l.ew.dispose()],St.prototype,"dispose",null),function(s){class i extends l.ew{constructor(n){super(),this.map={},this.command=n.history,this.cancelInvalid=!1!==n.cancelInvalid,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:n}){return Array.isArray(n)?n.every(o=>this.isValidCommand(o)):this.isValidCommand(n)}isValidCommand(n){if(n.options&&!1===n.options.validation)return!0;let r=null;return(n.event&&this.map[n.event]||[]).forEach(a=>{let c=0;const h=d=>{const p=a[c];c+=1;try{if(!p)return void(r=d);p(d,n,h)}catch(u){h(u)}};h(r)}),!r||(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:r}),!1)}validate(n,...o){const r=Array.isArray(n)?n:n.split(/\s+/);return o.forEach(a=>{if("function"!=typeof a)throw new Error(`${r.join(" ")} requires callback functions.`)}),r.forEach(a=>{null==this.map[a]&&(this.map[a]=[]),this.map[a].push(o)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}de([l.ew.dispose()],i.prototype,"dispose",null),s.Validator=i}(St||(St={})),function(s){s.isAddEvent=function i(a){return"cell:added"===a},s.isRemoveEvent=function t(a){return"cell:removed"===a},s.isChangeEvent=function n(a){return null!=a&&a.startsWith("cell:change:")},s.getOptions=function o(a){const c=["cell:added","cell:removed","cell:change:*"],h=["batch:start","batch:stop"],d=a.eventNames?a.eventNames.filter(p=>!(s.isChangeEvent(p)||c.includes(p)||h.includes(p))):c;return Object.assign(Object.assign({enabled:!0},a),{eventNames:d,applyOptionsList:a.applyOptionsList||["propertyPath"],revertOptionsList:a.revertOptionsList||["propertyPath"]})},s.sortBatchCommands=function r(a){const c=[];for(let h=0,d=a.length;h<d;h+=1){const p=a[h];let u=null;if(s.isAddEvent(p.event)){const g=p.data.id;for(let _=0;_<h;_+=1)if(a[_].data.id===g){u=_;break}}null!==u?c.splice(u,0,p):c.push(p)}return c}}(R||(R={}));class ue extends l.G7{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(et.classNames.box)}get $boxes(){return l.is.children(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(i){super(),this.options=i,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new l.FE([],{comparator:et.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const i=this.graph,t=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),i.on("scale",this.onGraphTransformed,this),i.on("translate",this.onGraphTransformed,this),i.model.on("updated",this.onModelUpdated,this),t.on("added",this.onCellAdded,this),t.on("removed",this.onCellRemoved,this),t.on("reseted",this.onReseted,this),t.on("updated",this.onCollectionUpdated,this),t.on("node:change:position",this.onNodePositionChanged,this),t.on("cell:changed",this.onCellChanged,this)}stopListening(){const i=this.graph,t=this.collection;this.undelegateEvents(),i.off("scale",this.onGraphTransformed,this),i.off("translate",this.onGraphTransformed,this),i.model.off("updated",this.onModelUpdated,this),t.off("added",this.onCellAdded,this),t.off("removed",this.onCellRemoved,this),t.off("reseted",this.onReseted,this),t.off("updated",this.onCollectionUpdated,this),t.off("node:change:position",this.onNodePositionChanged,this),t.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:i,options:t}){const{showNodeSelectionBox:n,pointerEvents:o}=this.options,{ui:r,selection:a,translateBy:c,snapped:h}=t;if(!(!0===n&&"none"!==o||this.translating||a)&&(r&&c&&i.id===c||h)){this.translating=!0;const u=i.position(),g=i.previous("position"),_=u.x-g.x,w=u.y-g.y;(0!==_||0!==w)&&this.translateSelectedNodes(_,w,i,t),this.translating=!1}}onModelUpdated({removed:i}){i&&i.length&&this.unselect(i)}isEmpty(){return this.length<=0}isSelected(i){return this.collection.has(i)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(i,t={}){t.dryrun=!0;const n=this.filter(Array.isArray(i)?i:[i]);return this.collection.add(n,t),this}unselect(i,t={}){return t.dryrun=!0,this.collection.remove(Array.isArray(i)?i:[i],t),this}reset(i,t={}){if(i){if(t.batch){const d=this.filter(Array.isArray(i)?i:[i]);return this.collection.reset(d,Object.assign(Object.assign({},t),{ui:!0})),this}const n=this.cells,o=this.filter(Array.isArray(i)?i:[i]),r={},a={};n.forEach(d=>r[d.id]=d),o.forEach(d=>a[d.id]=d);const c=[],h=[];return o.forEach(d=>{r[d.id]||c.push(d)}),n.forEach(d=>{a[d.id]||h.push(d)}),h.length&&this.unselect(h,Object.assign(Object.assign({},t),{ui:!0})),c.length&&this.select(c,Object.assign(Object.assign({},t),{ui:!0})),0===h.length&&0===c.length&&this.updateContainer(),this}return this.clean(t)}clean(i={}){return this.length&&(!1===i.batch?this.unselect(this.cells,i):this.collection.reset([],Object.assign(Object.assign({},i),{ui:!0}))),this}setFilter(i){this.options.filter=i}setContent(i){this.options.content=i}startSelecting(i){let t,n;i=this.normalizeEvent(i),this.clean();const o=this.graph.container;if(null!=i.offsetX&&null!=i.offsetY&&o.contains(i.target))t=i.offsetX,n=i.offsetY;else{const r=l.is.offset(o);t=i.clientX-r.left+window.pageXOffset+o.scrollLeft,n=i.clientY-r.top+window.pageYOffset+o.scrollTop}l.is.css(this.container,{top:n,left:t,width:1,height:1}),this.setEventData(i,{action:"selecting",clientX:i.clientX,clientY:i.clientY,offsetX:t,offsetY:n,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(et.documentEvents,i.data)}filter(i){const t=this.options.filter;return i.filter(n=>Array.isArray(t)?t.some(o=>"string"==typeof o?n.shape===o:n.id===o.id):"function"!=typeof t||l.Iw.call(t,this.graph,n))}stopSelecting(i){const t=this.graph,n=this.getEventData(i);switch(n.action){case"selecting":{let r=l.is.width(this.container),a=l.is.height(this.container);const c=l.is.offset(this.container),h=t.pageToLocal(c.left,c.top),d=t.transform.getScale();r/=d.sx,a/=d.sy;const p=new l.Ae(h.x,h.y,r,a),u=this.getCellViewsInArea(p).map(g=>g.cell);this.reset(u,{batch:!0}),this.hideRubberband();break}case"translating":{const r=t.snapToGrid(i.clientX,i.clientY);this.options.following||this.updateSelectedNodesPosition({dx:n.clientX-n.originX,dy:n.clientY-n.originY}),this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",i,r.x,r.y);break}default:this.clean()}}onMouseUp(i){this.getEventData(i).action&&(this.stopSelecting(i),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(i){this.options.following||i.stopPropagation();const t=this.normalizeEvent(i);this.options.movable&&this.startTranslating(t);const n=this.getCellViewFromElem(t.target);this.setEventData(t,{activeView:n});const o=this.graph.snapToGrid(t.clientX,t.clientY);this.notifyBoxEvent("box:mousedown",t,o.x,o.y),this.delegateDocumentEvents(et.documentEvents,t.data)}startTranslating(i){this.graph.model.startBatch("move-selection");const t=this.graph.snapToGrid(i.clientX,i.clientY);this.setEventData(i,{action:"translating",clientX:t.x,clientY:t.y,originX:t.x,originY:t.y})}getRestrictArea(){const i=this.graph.options.translating.restrict,t="function"==typeof i?l.Iw.call(i,this.graph,null):i;return"number"==typeof t?this.graph.transform.getGraphArea().inflate(t):!0===t?this.graph.transform.getGraphArea():t||null}getSelectionOffset(i,t){let n=i.x-t.clientX,o=i.y-t.clientY;const r=this.getRestrictArea();if(r){const a=this.collection.toArray(),c=l.bL.getCellsBBox(a,{deep:!0})||l.Ae.create(),h=r.x-c.x,d=r.y-c.y,p=r.x+r.width-(c.x+c.width),u=r.y+r.height-(c.y+c.height);if(n<h&&(n=h),o<d&&(o=d),p<n&&(n=p),u<o&&(o=u),!this.options.following){const g=i.x-t.originX,_=i.y-t.originY;n=g<=h||g>=p?0:n,o=_<=d||_>=u?0:o}}return{dx:n,dy:o}}updateElementPosition(i,t,n){const o=l.is.css(i,"left"),r=l.is.css(i,"top"),a=o?parseFloat(o):0,c=r?parseFloat(r):0;l.is.css(i,"left",a+t),l.is.css(i,"top",c+n)}updateSelectedNodesPosition(i){const{dx:t,dy:n}=i;if(t||n)if(this.translateSelectedNodes(t,n),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const o=this.graph.transform.getScale();for(let r=0,a=this.$boxes.length;r<a;r+=1)this.updateElementPosition(this.$boxes[r],t*o.sx,n*o.sy);this.updateElementPosition(this.selectionContainer,t*o.sx,n*o.sy)}}autoScrollGraph(i,t){const n=this.graph.getPlugin("scroller");return n?n.autoScroll(i,t):{scrollerX:0,scrollerY:0}}adjustSelection(i){const t=this.normalizeEvent(i),n=this.getEventData(t);switch(n.action){case"selecting":{const r=n;!0!==r.moving&&(l.is.appendTo(this.container,this.graph.container),this.showRubberband(),r.moving=!0);const{scrollerX:a,scrollerY:c}=this.autoScrollGraph(t.clientX,t.clientY);r.scrollerX+=a,r.scrollerY+=c;const h=t.clientX-r.clientX+r.scrollerX,d=t.clientY-r.clientY+r.scrollerY,p=parseInt(l.is.css(this.container,"left")||"0",10),u=parseInt(l.is.css(this.container,"top")||"0",10);l.is.css(this.container,{left:h<0?r.offsetX+h:p,top:d<0?r.offsetY+d:u,width:Math.abs(h),height:Math.abs(d)});break}case"translating":{const r=this.graph.snapToGrid(t.clientX,t.clientY),a=n,c=this.getSelectionOffset(r,a);this.options.following?this.updateSelectedNodesPosition(c):this.updateContainerPosition(c),c.dx&&(a.clientX=r.x),c.dy&&(a.clientY=r.y),this.notifyBoxEvent("box:mousemove",i,r.x,r.y);break}}this.boxesUpdated=!1}translateSelectedNodes(i,t,n,o){const r={},a=[];if(n&&(r[n.id]=!0),this.collection.toArray().forEach(c=>{c.getDescendants({deep:!0}).forEach(h=>{r[h.id]=!0})}),o&&o.translateBy){const c=this.graph.getCellById(o.translateBy);c&&(r[c.id]=!0,c.getDescendants({deep:!0}).forEach(h=>{r[h.id]=!0}),a.push(c))}this.collection.toArray().forEach(c=>{if(!r[c.id]){const h=Object.assign(Object.assign({},o),{selection:this.cid,exclude:a});c.translate(i,t,h),this.graph.model.getConnectedEdges(c).forEach(d=>{r[d.id]||(d.translate(i,t,h),r[d.id]=!0)})}})}getCellViewsInArea(i){const t=this.graph,n={strict:this.options.strict};let o=[];return this.options.rubberNode&&(o=o.concat(t.model.getNodesInArea(i,n).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),this.options.rubberEdge&&(o=o.concat(t.model.getEdgesInArea(i,n).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),o}notifyBoxEvent(i,t,n,o){const a=this.getEventData(t).activeView;this.trigger(i,{e:t,view:a,x:n,y:o,cell:a.cell})}getSelectedClassName(i){return this.prefixClassName((i.isNode()?"node":"edge")+"-selected")}addCellSelectedClassName(i){const t=this.graph.renderer.findViewByCell(i);t&&t.addClass(this.getSelectedClassName(i))}removeCellUnSelectedClassName(i){const t=this.graph.renderer.findViewByCell(i);t&&t.removeClass(this.getSelectedClassName(i))}destroySelectionBox(i){this.removeCellUnSelectedClassName(i),this.canShowSelectionBox(i)&&(l.is.remove(this.container.querySelector(`[data-cell-id="${i.id}"]`)),0===this.$boxes.length&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(i){i.forEach(t=>this.removeCellUnSelectedClassName(t)),this.hide(),l.is.remove(this.$boxes),this.boxCount=0}hide(){l.is.removeClass(this.container,this.prefixClassName(et.classNames.rubberband)),l.is.removeClass(this.container,this.prefixClassName(et.classNames.selected))}showRubberband(){l.is.addClass(this.container,this.prefixClassName(et.classNames.rubberband))}hideRubberband(){l.is.removeClass(this.container,this.prefixClassName(et.classNames.rubberband))}showSelected(){l.is.removeAttribute(this.container,"style"),l.is.addClass(this.container,this.prefixClassName(et.classNames.selected))}createContainer(){this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName(et.classNames.root)),this.options.className&&l.is.addClass(this.container,this.options.className),this.selectionContainer=document.createElement("div"),l.is.addClass(this.selectionContainer,this.prefixClassName(et.classNames.inner)),this.selectionContent=document.createElement("div"),l.is.addClass(this.selectionContent,this.prefixClassName(et.classNames.content)),l.is.append(this.selectionContainer,this.selectionContent),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length),l.is.prepend(this.container,this.selectionContainer)}updateContainerPosition(i){(i.dx||i.dy)&&this.updateElementPosition(this.selectionContainer,i.dx,i.dy)}updateContainer(){const i={x:1/0,y:1/0},t={x:0,y:0};this.collection.toArray().filter(r=>this.canShowSelectionBox(r)).forEach(r=>{const a=this.graph.renderer.findViewByCell(r);if(a){const c=a.getBBox({useCellGeometry:!0});i.x=Math.min(i.x,c.x),i.y=Math.min(i.y,c.y),t.x=Math.max(t.x,c.x+c.width),t.y=Math.max(t.y,c.y+c.height)}}),l.is.css(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:i.x,top:i.y,width:t.x-i.x,height:t.y-i.y}),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length);const o=this.options.content;if(o)if("function"==typeof o){const r=l.Iw.call(o,this.graph,this,this.selectionContent);r&&(this.selectionContent.innerHTML=r)}else this.selectionContent.innerHTML=o;this.collection.length>0&&!this.container.parentNode?l.is.appendTo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(i){return i.isNode()&&!0===this.options.showNodeSelectionBox||i.isEdge()&&!0===this.options.showEdgeSelectionBox}createSelectionBox(i){if(this.addCellSelectedClassName(i),this.canShowSelectionBox(i)){const t=this.graph.renderer.findViewByCell(i);if(t){const n=t.getBBox({useCellGeometry:!0}),o=this.boxClassName,r=document.createElement("div");l.is.addClass(r,o),l.is.addClass(r,`${o}-${i.isNode()?"node":"edge"}`),l.is.attr(r,"data-cell-id",i.id),l.is.css(r,{position:"absolute",left:n.x,top:n.y,width:n.width,height:n.height,pointerEvents:this.options.pointerEvents||"auto"}),l.is.appendTo(r,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let i=0,t=this.$boxes.length;i<t;i+=1){const n=this.$boxes[i],o=l.is.attr(n,"data-cell-id");l.is.remove(n);const r=this.collection.get(o);r&&this.createSelectionBox(r)}this.updateContainer()}return 0}getCellViewFromElem(i){const t=i.getAttribute("data-cell-id");if(t){const n=this.collection.get(t);if(n)return this.graph.renderer.findViewByCell(n)}return null}onCellRemoved({cell:i}){this.destroySelectionBox(i),this.updateContainer()}onReseted({previous:i,current:t}){this.destroyAllSelectionBoxes(i),t.forEach(n=>{this.listenCellRemoveEvent(n),this.createSelectionBox(n)}),this.updateContainer()}onCellAdded({cell:i}){this.listenCellRemoveEvent(i),this.createSelectionBox(i),this.updateContainer()}listenCellRemoveEvent(i){i.off("removed",this.onCellRemoved,this),i.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:i,removed:t,options:n}){i.forEach(r=>{this.trigger("cell:selected",{cell:r,options:n}),r.isNode()?this.trigger("node:selected",{cell:r,options:n,node:r}):r.isEdge()&&this.trigger("edge:selected",{cell:r,options:n,edge:r})}),t.forEach(r=>{this.trigger("cell:unselected",{cell:r,options:n}),r.isNode()?this.trigger("node:unselected",{cell:r,options:n,node:r}):r.isEdge()&&this.trigger("edge:unselected",{cell:r,options:n,edge:r})});const o={added:i,removed:t,options:n,selected:this.cells.filter(r=>!!this.graph.getCellById(r.id))};this.trigger("selection:changed",o)}dispose(){this.clean(),this.remove(),this.off()}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.G7.dispose()],ue.prototype,"dispose",null),function(s){const i="widget-selection";s.classNames={root:i,inner:`${i}-inner`,box:`${i}-box`,content:`${i}-content`,rubberband:`${i}-rubberband`,selected:`${i}-selected`},s.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},s.depthComparator=function t(n){return n.getAncestors().length}}(et||(et={})),l.kJ.prototype.isSelectionEnabled=function(){const s=this.getPlugin("selection");return!!s&&s.isEnabled()},l.kJ.prototype.enableSelection=function(){const s=this.getPlugin("selection");return s&&s.enable(),this},l.kJ.prototype.disableSelection=function(){const s=this.getPlugin("selection");return s&&s.disable(),this},l.kJ.prototype.toggleSelection=function(s){const i=this.getPlugin("selection");return i&&i.toggleEnabled(s),this},l.kJ.prototype.isMultipleSelection=function(){const s=this.getPlugin("selection");return!!s&&s.isMultipleSelection()},l.kJ.prototype.enableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.enableMultipleSelection(),this},l.kJ.prototype.disableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.disableMultipleSelection(),this},l.kJ.prototype.toggleMultipleSelection=function(s){const i=this.getPlugin("selection");return i&&i.toggleMultipleSelection(s),this},l.kJ.prototype.isSelectionMovable=function(){const s=this.getPlugin("selection");return!!s&&s.isSelectionMovable()},l.kJ.prototype.enableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.enableSelectionMovable(),this},l.kJ.prototype.disableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.disableSelectionMovable(),this},l.kJ.prototype.toggleSelectionMovable=function(s){const i=this.getPlugin("selection");return i&&i.toggleSelectionMovable(s),this},l.kJ.prototype.isRubberbandEnabled=function(){const s=this.getPlugin("selection");return!!s&&s.isRubberbandEnabled()},l.kJ.prototype.enableRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableRubberband(),this},l.kJ.prototype.disableRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableRubberband(),this},l.kJ.prototype.toggleRubberband=function(s){const i=this.getPlugin("selection");return i&&i.toggleRubberband(s),this},l.kJ.prototype.isStrictRubberband=function(){const s=this.getPlugin("selection");return!!s&&s.isStrictRubberband()},l.kJ.prototype.enableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableStrictRubberband(),this},l.kJ.prototype.disableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableStrictRubberband(),this},l.kJ.prototype.toggleStrictRubberband=function(s){const i=this.getPlugin("selection");return i&&i.toggleStrictRubberband(s),this},l.kJ.prototype.setRubberbandModifiers=function(s){const i=this.getPlugin("selection");return i&&i.setRubberbandModifiers(s),this},l.kJ.prototype.setSelectionFilter=function(s){const i=this.getPlugin("selection");return i&&i.setSelectionFilter(s),this},l.kJ.prototype.setSelectionDisplayContent=function(s){const i=this.getPlugin("selection");return i&&i.setSelectionDisplayContent(s),this},l.kJ.prototype.isSelectionEmpty=function(){const s=this.getPlugin("selection");return!s||s.isEmpty()},l.kJ.prototype.cleanSelection=function(s){const i=this.getPlugin("selection");return i&&i.clean(s),this},l.kJ.prototype.resetSelection=function(s,i){const t=this.getPlugin("selection");return t&&t.reset(s,i),this},l.kJ.prototype.getSelectedCells=function(){const s=this.getPlugin("selection");return s?s.getSelectedCells():[]},l.kJ.prototype.getSelectedCellCount=function(){const s=this.getPlugin("selection");return s?s.getSelectedCellCount():0},l.kJ.prototype.isSelected=function(s){const i=this.getPlugin("selection");return!!i&&i.isSelected(s)},l.kJ.prototype.select=function(s,i){const t=this.getPlugin("selection");return t&&t.select(s,i),this},l.kJ.prototype.unselect=function(s,i){const t=this.getPlugin("selection");return t?t.unselect(s,i):this};class Tt extends l.ew{get rubberbandDisabled(){return!0!==this.options.enabled||!0!==this.options.rubberband}get disabled(){return!0!==this.options.enabled}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(i={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=l.QK.merge({enabled:!0},Tt.defaultOptions,i),l.mf.ensure(this.name,".x6-widget-selection {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: none;\n  width: 0;\n  height: 0;\n  touch-action: none;\n}\n.x6-widget-selection-rubberband {\n  display: block;\n  overflow: visible;\n  opacity: 0.3;\n}\n.x6-widget-selection-selected {\n  display: block;\n}\n.x6-widget-selection-box {\n  cursor: move;\n}\n.x6-widget-selection-inner[data-selection-length='0'],\n.x6-widget-selection-inner[data-selection-length='1'] {\n  display: none;\n}\n.x6-widget-selection-content {\n  position: absolute;\n  top: 100%;\n  right: -20px;\n  left: -20px;\n  margin-top: 30px;\n  padding: 6px;\n  line-height: 14px;\n  text-align: center;\n  border-radius: 6px;\n}\n.x6-widget-selection-content:empty {\n  display: none;\n}\n.x6-widget-selection-rubberband {\n  background-color: #3498db;\n  border: 2px solid #2980b9;\n}\n.x6-widget-selection-box {\n  box-sizing: content-box !important;\n  margin-top: -4px;\n  margin-left: -4px;\n  padding-right: 4px;\n  padding-bottom: 4px;\n  border: 2px dashed #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-inner {\n  box-sizing: content-box !important;\n  margin-top: -8px;\n  margin-left: -8px;\n  padding-right: 12px;\n  padding-bottom: 12px;\n  border: 2px solid #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-content {\n  color: #fff;\n  font-size: 10px;\n  background-color: #6a6b8a;\n}\n")}init(i){this.graph=i,this.selectionImpl=new ue(Object.assign(Object.assign({},this.options),{graph:i})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(i){return null!=i?i!==this.isEnabled()&&(i?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(i){return null!=i?i!==this.isMultipleSelection()&&(i?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return!1!==this.options.movable}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(i){return null!=i?i!==this.isSelectionMovable()&&(i?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(i){return null!=i?i!==this.isRubberbandEnabled()&&(i?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return!0===this.selectionImpl.options.strict}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(i){return null!=i?i!==this.isStrictRubberband()&&(i?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(i){this.setModifiers(i)}setSelectionFilter(i){return this.setFilter(i),this}setSelectionDisplayContent(i){return this.setContent(i),this}isEmpty(){return this.length<=0}clean(i={}){return this.selectionImpl.clean(i),this}reset(i,t={}){return this.selectionImpl.reset(i?this.getCells(i):[],t),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(i){return this.selectionImpl.isSelected(i)}select(i,t={}){const n=this.getCells(i);return n.length&&(this.isMultiple()?this.selectionImpl.select(n,t):this.reset(n.slice(0,1),t)),this}unselect(i,t={}){return this.selectionImpl.unselect(this.getCells(i),t),this}setup(){this.selectionImpl.on("*",(i,t)=>{this.trigger(i,t),this.graph.trigger(i,t)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:i}){const t=this.graph.panning.allowPanning(i,!0),n=this.graph.getPlugin("scroller"),o=n&&n.allowPanning(i,!0);(this.allowRubberband(i,!0)||this.allowRubberband(i)&&!o&&!t)&&this.startRubberband(i)}onBlankClick(){this.clean()}allowRubberband(i,t){return!this.rubberbandDisabled&&l.tx.isMatch(i,this.options.modifiers,t)}allowMultipleSelection(i){return this.isMultiple()&&l.tx.isMatch(i,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:i}){this.movedMap.set(i,!0)}onCellMouseUp({e:i,cell:t}){const n=this.options;let o=this.disabled;!o&&this.movedMap.has(t)&&(o=!1===n.selectCellOnMoved,o||(o=!1===n.selectNodeOnMoved&&t.isNode()),o||(o=!1===n.selectEdgeOnMoved&&t.isEdge())),o||(this.allowMultipleSelection(i)?this.unselectMap.has(t)?this.unselectMap.delete(t):this.isSelected(t)?this.unselect(t):this.select(t):this.reset(t)),this.movedMap.delete(t)}onBoxMouseDown({e:i,cell:t}){this.disabled||this.allowMultipleSelection(i)&&(this.unselect(t),this.unselectMap.set(t,!0))}getCells(i){return(Array.isArray(i)?i:[i]).map(t=>"string"==typeof t?this.graph.getCellById(t):t).filter(t=>null!=t)}startRubberband(i){return this.rubberbandDisabled||this.selectionImpl.startSelecting(i),this}isMultiple(){return!1!==this.options.multiple}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(i){return this.options.modifiers=i,this}setContent(i){return this.selectionImpl.setContent(i),this}setFilter(i){return this.selectionImpl.setFilter(i),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),l.mf.clean(this.name)}}(function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)})([l.ew.dispose()],Tt.prototype,"dispose",null),function(s){s.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null}}(Tt||(Tt={})),l.kJ.prototype.toSVG=function(s,i){const t=this.getPlugin("export");t&&t.toSVG(s,i)},l.kJ.prototype.toPNG=function(s,i){const t=this.getPlugin("export");t&&t.toPNG(s,i)},l.kJ.prototype.toJPEG=function(s,i){const t=this.getPlugin("export");t&&t.toJPEG(s,i)},l.kJ.prototype.exportPNG=function(s,i){const t=this.getPlugin("export");t&&t.exportPNG(s,i)},l.kJ.prototype.exportJPEG=function(s,i){const t=this.getPlugin("export");t&&t.exportJPEG(s,i)},l.kJ.prototype.exportSVG=function(s,i){const t=this.getPlugin("export");t&&t.exportSVG(s,i)};class fe extends l.ew{constructor(){super(),this.name="export"}get view(){return this.graph.view}init(i){this.graph=i}exportPNG(i="chart",t={}){this.toPNG(n=>{l.Vb.downloadDataUri(n,i)},t)}exportJPEG(i="chart",t={}){this.toPNG(n=>{l.Vb.downloadDataUri(n,i)},t)}exportSVG(i="chart",t={}){this.toSVG(n=>{l.Vb.downloadDataUri(l.Vb.svgToDataUrl(n),i)},t)}toSVG(i,t={}){this.notify("before:export",t);const n=this.view.svg,o=l.OW.create(n).clone();let r=o.node;const a=o.findOne(`.${this.view.prefixClassName("graph-svg-stage")}`),c=t.viewBox||this.graph.graphToLocal(this.graph.getContentBBox()),h=t.preserveDimensions;if(h){const u="boolean"==typeof h?c:h;o.attr({width:u.width,height:u.height})}if(o.removeAttribute("style").attr("viewBox",[c.x,c.y,c.width,c.height].join(" ")),a.removeAttribute("transform"),!1!==t.copyStyles){const u=n.ownerDocument,g=Array.from(n.querySelectorAll("*")),_=Array.from(r.querySelectorAll("*")),w=u.styleSheets.length,C=[];for(let x=w-1;x>=0;x-=1)C[x]=u.styleSheets[x],u.styleSheets[x].disabled=!0;const y={};g.forEach((x,T)=>{const v=window.getComputedStyle(x,null),P={};Object.keys(v).forEach(J=>{P[J]=v.getPropertyValue(J)}),y[T]=P}),w!==u.styleSheets.length&&C.forEach((x,T)=>{u.styleSheets[T]=x});for(let x=0;x<w;x+=1)u.styleSheets[x].disabled=!1;const I={};g.forEach((x,T)=>{const v=window.getComputedStyle(x,null),P=y[T],J={};Object.keys(v).forEach(Q=>{!l.GH.isNumber(Q)&&v.getPropertyValue(Q)!==P[Q]&&(J[Q]=v.getPropertyValue(Q))}),I[T]=J}),_.forEach((x,T)=>{l.is.css(x,I[T])})}const d=t.stylesheet;if("string"==typeof d){const u=n.ownerDocument.implementation.createDocument(null,"xml",null).createCDATASection(d);o.prepend(l.OW.create("style",{type:"text/css"},[u]))}const p=()=>{const u=t.beforeSerialize;if("function"==typeof u){const _=l.Iw.call(u,this.graph,r);_ instanceof SVGSVGElement&&(r=_)}const g=(new XMLSerializer).serializeToString(r).replace(/&nbsp;/g,"\xa0");this.notify("after:export",t),i(g)};if(t.serializeImages){const u=o.find("image").map(g=>new Promise(_=>{const w=g.attr("xlink:href")||g.attr("href");l.Vb.imageToDataUri(w,(C,y)=>{!C&&y&&g.attr("xlink:href",y),_()})}));Promise.all(u).then(p)}else p()}toDataURL(i,t){let n=t.viewBox||this.graph.getContentBBox();const o=l.GH.normalizeSides(t.padding);t.width&&t.height&&(o.left+o.right>=t.width&&(o.left=o.right=0),o.top+o.bottom>=t.height&&(o.top=o.bottom=0));const r=new l.Ae(-o.left,-o.top,o.left+o.right,o.top+o.bottom);t.width&&t.height&&r.scale((n.width+o.left+o.right)/t.width,(n.height+o.top+o.bottom)/t.height),n=l.Ae.create(n).moveAndExpand(r);const a="number"==typeof t.width&&"number"==typeof t.height?{width:t.width,height:t.height}:n;let c=t.ratio?parseFloat(t.ratio):1;(!Number.isFinite(c)||0===c)&&(c=1);const h={width:Math.max(Math.round(a.width*c),1),height:Math.max(Math.round(a.height*c),1)};{const p=document.createElement("canvas"),u=p.getContext("2d");p.width=h.width,p.height=h.height;const g=h.width-1,_=h.height-1;u.fillStyle="rgb(1,1,1)",u.fillRect(g,_,1,1);const w=u.getImageData(g,_,1,1).data;if(1!==w[0]||1!==w[1]||1!==w[2])throw new Error("size exceeded")}const d=new Image;d.onload=()=>{const p=document.createElement("canvas");p.width=h.width,p.height=h.height;const u=p.getContext("2d");u.fillStyle=t.backgroundColor||"white",u.fillRect(0,0,h.width,h.height);try{u.drawImage(d,0,0,h.width,h.height);const g=p.toDataURL(t.type,t.quality);i(g)}catch{}},this.toSVG(p=>{d.src=`data:image/svg+xml,${encodeURIComponent(p)}`},Object.assign(Object.assign({},t),{viewBox:n,serializeImages:!0,preserveDimensions:Object.assign({},h)}))}toPNG(i,t={}){this.toDataURL(i,Object.assign(Object.assign({},t),{type:"image/png"}))}toJPEG(i,t={}){this.toDataURL(i,Object.assign(Object.assign({},t),{type:"image/jpeg"}))}notify(i,t){this.trigger(i,t),this.graph.trigger(i,t)}dispose(){this.off()}}!function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)}([l.ew.dispose()],fe.prototype,"dispose",null);class bt extends l.G7{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){return this.options.target.getPlugin("snapline")}constructor(i){super(),this.name="dnd",this.options=Object.assign(Object.assign({},bt.defaults),i),this.init()}init(){l.mf.ensure(this.name,".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n"),this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new l.kJ(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),l.is.append(this.container,this.draggingGraph.container)}start(i,t){const n=t;n.preventDefault(),this.targetModel.startBatch("dnd"),l.is.addClass(this.container,"dragging"),l.is.appendTo(this.container,this.options.draggingContainer||document.body),this.sourceNode=i,this.prepareDragging(i,n.clientX,n.clientY);const o=this.updateNodePosition(n.clientX,n.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:n,node:i,cell:i,view:this.draggingView,x:o.x,y:o.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(bt.documentEvents,n.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(i,t,n){const o=this.draggingGraph,r=o.model,a=this.options.getDragNode(i,{sourceNode:i,draggingGraph:o,targetGraph:this.targetGraph});a.position(0,0);let c=5;if(this.isSnaplineEnabled()&&(c+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const p=this.targetGraph.transform.getScale();o.scale(p.sx,p.sy),c*=Math.max(p.sx,p.sy)}else o.scale(1,1);this.clearDragging(),r.resetCells([a]);const h=o.findViewByCell(a);h.undelegateEvents(),h.cell.off("changed"),o.fitToContent({padding:c,allowNewOrigin:"any"});const d=h.getBBox();this.geometryBBox=h.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(d.getTopLeft()),this.draggingNode=a,this.draggingView=h,this.draggingBBox=a.getBBox(),this.padding=c,this.originOffset=this.updateGraphPosition(t,n)}updateGraphPosition(i,t){const n=document.body.scrollTop||document.documentElement.scrollTop,o=this.delta,r=this.geometryBBox,a=this.padding||5,c={left:i-o.x-r.width/2-a,top:t-o.y-r.height/2-a+n};return this.draggingGraph&&l.is.css(this.container,{left:`${c.left}px`,top:`${c.top}px`}),c}updateNodePosition(i,t){const n=this.targetGraph.clientToLocal(i,t),o=this.draggingBBox;return n.x-=o.width/2,n.y-=o.height/2,this.draggingNode.position(n.x,n.y),n}snap({cell:i,current:t,options:n}){const o=i;if(n.snapped){const r=this.draggingBBox;o.position(r.x+n.tx,r.y+n.ty,{silent:!0}),this.draggingView.translate(),o.position(t.x,t.y,{silent:!0}),this.snapOffset={x:n.tx,y:n.ty}}else this.snapOffset=null}onDragging(i){const t=this.draggingView;if(t){i.preventDefault();const n=this.normalizeEvent(i),o=n.clientX,r=n.clientY;this.updateGraphPosition(o,r);const a=this.updateNodePosition(o,r),c=this.targetGraph.options.embedding.enabled,h=(c||this.isSnaplineEnabled())&&this.isInsideValidArea({x:o,y:r});if(c){t.setEventData(n,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const d=t.getEventData(n);h?t.processEmbedding(n,d):t.clearEmbedding(d),this.candidateEmbedView=d.candidateEmbedView}this.isSnaplineEnabled()&&(h?this.snapline.snapOnMoving({e:n,view:t,x:a.x,y:a.y}):this.snapline.hide())}}onDragEnd(i){const t=this.draggingNode;if(t){const n=this.normalizeEvent(i),o=this.draggingView,r=this.draggingBBox,a=this.snapOffset;let c=r.x,h=r.y;a&&(c+=a.x,h+=a.y),t.position(c,h,{silent:!0});const d=this.drop(t,{x:n.clientX,y:n.clientY}),p=u=>{u?(this.onDropped(t),this.targetGraph.options.embedding.enabled&&o&&(o.setEventData(n,{cell:u,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),o.finalizeEmbedding(n,o.getEventData(n)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};l.Iw.isAsync(d)?(this.undelegateDocumentEvents(),d.then(p)):p(d)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(i){this.draggingNode===i&&(this.clearDragging(),l.is.removeClass(this.container,"dragging"),l.is.remove(this.container))}onDropInvalid(){const i=this.draggingNode;i&&this.onDropped(i)}isInsideValidArea(i){let t,n=null;const o=this.targetGraph,r=this.targetScroller;this.options.dndContainer&&(n=this.getDropArea(this.options.dndContainer));const a=n&&n.containsPoint(i);if(r)if(r.options.autoResize)t=this.getDropArea(r.container);else{const c=this.getDropArea(r.container);t=this.getDropArea(o.container).intersectsWithRect(c)}else t=this.getDropArea(o.container);return!a&&t&&t.containsPoint(i)}getDropArea(i){const t=l.is.offset(i),n=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft;return l.Ae.create({x:t.left+parseInt(l.is.css(i,"border-left-width"),10)-o,y:t.top+parseInt(l.is.css(i,"border-top-width"),10)-n,width:i.clientWidth,height:i.clientHeight})}drop(i,t){if(this.isInsideValidArea(t)){const n=this.targetGraph,o=n.model,r=n.clientToLocal(t),a=this.sourceNode,c=this.options.getDropNode(i,{sourceNode:a,draggingNode:i,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),h=c.getBBox();r.x+=h.x-h.width/2,r.y+=h.y-h.height/2;const d=this.snapOffset?1:n.getGridSize();c.position(l.Z4.snapToGrid(r.x,d),l.Z4.snapToGrid(r.y,d)),c.removeZIndex();const p=this.options.validateNode,u=!p||p(c,{sourceNode:a,draggingNode:i,droppingNode:c,targetGraph:n,draggingGraph:this.draggingGraph});return"boolean"==typeof u?u?(o.addCell(c,{stencil:this.cid}),c):null:l.Iw.toDeferredBoolean(u).then(g=>g?(o.addCell(c,{stencil:this.cid}),c):null)}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),l.mf.clean(this.name)}}(function(s,i,t,n){var a,o=arguments.length,r=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,i,t,n);else for(var c=s.length-1;c>=0;c--)(a=s[c])&&(r=(o<3?a(r):o>3?a(i,t,r):a(i,t))||r);o>3&&r&&Object.defineProperty(i,t,r)})([l.G7.dispose()],bt.prototype,"dispose",null),function(s){s.defaults={getDragNode:i=>i.clone(),getDropNode:i=>i.clone()},s.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}}(bt||(bt={}));let Ue=(()=>{class s{constructor(t,n,o,r){this.cs=t,this.element=n,this.injector=o,this.viewContainerRef=r,this.graph=new l.kJ({container:n.nativeElement,background:{},grid:{size:10,visible:JSON.parse(localStorage.getItem("show_grid")||"true"),type:"mesh"},connecting:{snap:!1,connector:"normal",createEdge:()=>new l.bn.kS({shape:"line",attrs:{line:{stroke:"#333",strokeWidth:1,targetMarker:null,strokeDasharray:0,style:{animation:"ant-line 30s infinite linear"}}},label:{text:""},router:{name:"normal"}})},highlighting:{magnetAvailable:{name:"stroke",args:{padding:4,attrs:{strokeWidth:2,stroke:"rgba(223,234,255)"}}}}}),this.graph.use(new Yt({enabled:!0})),this.graph.use(new pt({resizing:{enabled:!0},rotating:{enabled:!0}})),this.graph.use(new S({enabled:!0})),this.graph.use(new st({enabled:!0})),this.graph.use(new St({enabled:!0})),this.graph.use(new Tt({enabled:!0,multiple:!0,rubberband:!0,rubberEdge:!0,movable:!0,strict:!0,showNodeSelectionBox:!0})),this.graph.use(new fe),this.dnd=new bt({target:this.graph}),this.graph.bindKey("ctrl+s",a=>{this.graph.exportPNG(),a.preventDefault()}),this.graph.bindKey("ctrl+z",()=>this.graph.undo()),this.graph.bindKey("ctrl+y",()=>this.graph.redo()),this.graph.bindKey("ctrl+x",()=>this.graph.cut(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+c",()=>this.graph.copy(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+v",()=>this.graph.resetSelection(this.graph.paste())),this.graph.bindKey("backspace",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.bindKey("delete",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.container.onmousemove=a=>{this.line&&(this.graph.addEdge({shape:this.line.id,source:[a.offsetX,a.offsetY],target:[a.offsetX-120,a.offsetY+80],...this.line.meta}),this.line=void 0)},this.graph.on("edge:selected",l.Iw.debounce(({edge:a})=>{a.addTools([{name:"source-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"target-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"vertices",args:{attrs:{fill:"#3c9566",cursor:"crosshair"},stopPropagation:!1}}])})),this.graph.on("edge:unselected",({cell:a})=>{a.removeTools()}),this.graph.on("node:mouseenter",l.Iw.debounce(({})=>{}),500),this.graph.on("node:mouseleave",({})=>{}),this.graph.on("blank:click",()=>{}),this.graph.on("node:click",({})=>{}),this.graph.on("cell:selected",()=>{}),this.graph.on("cell:click",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.click?.call(this,a,c)}),this.graph.on("cell:mouseenter",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseenter?.call(this,a,c)}),this.graph.on("cell:mouseleave",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseleave?.call(this,a,c)})}Render(t){t.content?.cells?.forEach(n=>{this.cs.Get(n.shape)}),this.graph.drawBackground({color:t.background_color,image:t.background_image}),this.graph.fromJSON(t.content)}Draw(t){let n,{component:o}=t;switch(this.cs.CheckRegister(o),o.type){case"line":return void(this.line=o);case"shape":case"svg":let r={};o.bindings?.forEach(a=>r[a.name]=a.default),n=this.graph.createNode({shape:o.id,...o.meta,data:r})}console.log(n),n&&t.event&&this.dnd.start(n,t.event)}showPorts(t,n){for(let o=0,r=t.length;o<r;o+=1)t[o].style.visibility=n?"visible":"hidden"}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(ut.m),e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-canvas"]],decls:0,vars:0,template:function(t,n){},styles:["[_nghost-%COMP%]{display:block;position:relative;box-shadow:#a8a8a8 2px 2px 10px;background-color:#fff}"]}),s})();var z=b(433);let Ye=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-attach-select"]],decls:1,vars:0,consts:[["src","/app/attachment/list","frameborder","0"]],template:function(t,n){1&t&&e._UZ(0,"iframe",0)}}),s})();var zt=b(5156),re=b(2851),L=b(7582),G=b(9521),Bt=b(7579),ot=b(4968),Vt=b(6451),Ve=b(1884),X=b(2722),ge=b(3303),U=b(3187),Rt=b(2687),_t=b(445),jt=b(9570),mt=b(6287);const je=["upHandler"],He=["downHandler"],Qe=["inputElement"];function We(s,i){if(1&s&&e._UZ(0,"nz-form-item-feedback-icon",11),2&s){const t=e.oxw();e.Q6J("status",t.status)}}let me=(()=>{class s{constructor(t,n,o,r,a,c,h,d,p){this.ngZone=t,this.elementRef=n,this.cdr=o,this.focusMonitor=r,this.renderer=a,this.directionality=c,this.destroy$=h,this.nzFormStatusService=d,this.nzFormNoStatusService=p,this.isNzDisableFirstChange=!0,this.isFocused=!1,this.disabled$=new Bt.x,this.disabledUp=!1,this.disabledDown=!1,this.dir="ltr",this.prefixCls="ant-input-number",this.status="",this.statusCls={},this.hasFeedback=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzBlur=new e.vpe,this.nzFocus=new e.vpe,this.nzSize="default",this.nzMin=-1/0,this.nzMax=1/0,this.nzParser=u=>u.trim().replace(/\u3002/g,".").replace(/[^\w\.-]+/g,""),this.nzPrecisionMode="toFixed",this.nzPlaceHolder="",this.nzStatus="",this.nzStep=1,this.nzInputMode="decimal",this.nzId=null,this.nzDisabled=!1,this.nzReadOnly=!1,this.nzAutoFocus=!1,this.nzBorderless=!1,this.nzFormatter=u=>u}onModelChange(t){this.parsedValue=this.nzParser(t),this.inputElement.nativeElement.value=`${this.parsedValue}`;const n=this.getCurrentValidValue(this.parsedValue);this.setValue(n)}getCurrentValidValue(t){let n=t;return n=""===n?"":this.isNotCompleteNumber(n)?this.value:`${this.getValidValue(n)}`,this.toNumber(n)}isNotCompleteNumber(t){return isNaN(t)||""===t||null===t||!(!t||t.toString().indexOf(".")!==t.toString().length-1)}getValidValue(t){let n=parseFloat(t);return isNaN(n)?t:(n<this.nzMin&&(n=this.nzMin),n>this.nzMax&&(n=this.nzMax),n)}toNumber(t){if(this.isNotCompleteNumber(t))return t;const n=String(t);if(n.indexOf(".")>=0&&(0,U.DX)(this.nzPrecision)){if("function"==typeof this.nzPrecisionMode)return this.nzPrecisionMode(t,this.nzPrecision);if("cut"===this.nzPrecisionMode){const o=n.split(".");return o[1]=o[1].slice(0,this.nzPrecision),Number(o.join("."))}return Number(Number(t).toFixed(this.nzPrecision))}return Number(t)}getRatio(t){let n=1;return t.metaKey||t.ctrlKey?n=.1:t.shiftKey&&(n=10),n}down(t,n){this.isFocused||this.focus(),this.step("down",t,n)}up(t,n){this.isFocused||this.focus(),this.step("up",t,n)}getPrecision(t){const n=t.toString();if(n.indexOf("e-")>=0)return parseInt(n.slice(n.indexOf("e-")+2),10);let o=0;return n.indexOf(".")>=0&&(o=n.length-n.indexOf(".")-1),o}getMaxPrecision(t,n){if((0,U.DX)(this.nzPrecision))return this.nzPrecision;const o=this.getPrecision(n),r=this.getPrecision(this.nzStep),a=this.getPrecision(t);return t?Math.max(a,o+r):o+r}getPrecisionFactor(t,n){const o=this.getMaxPrecision(t,n);return Math.pow(10,o)}upStep(t,n){const o=this.getPrecisionFactor(t,n),r=Math.abs(this.getMaxPrecision(t,n));let a;return a="number"==typeof t?((o*t+o*this.nzStep*n)/o).toFixed(r):this.nzMin===-1/0?this.nzStep:this.nzMin,this.toNumber(a)}downStep(t,n){const o=this.getPrecisionFactor(t,n),r=Math.abs(this.getMaxPrecision(t,n));let a;return a="number"==typeof t?((o*t-o*this.nzStep*n)/o).toFixed(r):this.nzMin===-1/0?-this.nzStep:this.nzMin,this.toNumber(a)}step(t,n,o=1){if(this.stop(),n.preventDefault(),this.nzDisabled)return;const r=this.getCurrentValidValue(this.parsedValue)||0;let a=0;"up"===t?a=this.upStep(r,o):"down"===t&&(a=this.downStep(r,o));const c=a>this.nzMax||a<this.nzMin;a>this.nzMax?a=this.nzMax:a<this.nzMin&&(a=this.nzMin),this.setValue(a),this.updateDisplayValue(a),this.isFocused=!0,!c&&(this.autoStepTimer=setTimeout(()=>{this[t](n,o)},300))}stop(){this.autoStepTimer&&clearTimeout(this.autoStepTimer)}setValue(t){if(`${this.value}`!=`${t}`&&this.onChange(t),this.value=t,this.parsedValue=t,this.disabledUp=this.disabledDown=!1,t||0===t){const n=Number(t);n>=this.nzMax&&(this.disabledUp=!0),n<=this.nzMin&&(this.disabledDown=!0)}}updateDisplayValue(t){const n=(0,U.DX)(this.nzFormatter(t))?this.nzFormatter(t):"";this.displayValue=n,this.inputElement.nativeElement.value=`${n}`}writeValue(t){this.value=t,this.setValue(t),this.updateDisplayValue(t),this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.disabled$.next(this.nzDisabled),this.cdr.markForCheck()}focus(){this.focusMonitor.focusVia(this.inputElement,"keyboard")}blur(){this.inputElement.nativeElement.blur()}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe((0,Ve.x)((t,n)=>t.status===n.status&&t.hasFeedback===n.hasFeedback),(0,X.R)(this.destroy$)).subscribe(({status:t,hasFeedback:n})=>{this.setStatusStyles(t,n)}),this.focusMonitor.monitor(this.elementRef,!0).pipe((0,X.R)(this.destroy$)).subscribe(t=>{t?(this.isFocused=!0,this.nzFocus.emit()):(this.isFocused=!1,this.updateDisplayValue(this.value),this.nzBlur.emit(),Promise.resolve().then(()=>this.onTouched()))}),this.dir=this.directionality.value,this.directionality.change.pipe((0,X.R)(this.destroy$)).subscribe(t=>{this.dir=t}),this.setupHandlersListeners(),this.ngZone.runOutsideAngular(()=>{(0,ot.R)(this.inputElement.nativeElement,"keyup").pipe((0,X.R)(this.destroy$)).subscribe(()=>this.stop()),(0,ot.R)(this.inputElement.nativeElement,"keydown").pipe((0,X.R)(this.destroy$)).subscribe(t=>{const{keyCode:n}=t;n!==G.LH&&n!==G.JH&&n!==G.K5||this.ngZone.run(()=>{if(n===G.LH){const o=this.getRatio(t);this.up(t,o),this.stop()}else if(n===G.JH){const o=this.getRatio(t);this.down(t,o),this.stop()}else this.updateDisplayValue(this.value);this.cdr.markForCheck()})})})}ngOnChanges(t){const{nzStatus:n,nzDisabled:o}=t;if(t.nzFormatter&&!t.nzFormatter.isFirstChange()){const r=this.getCurrentValidValue(this.parsedValue);this.setValue(r),this.updateDisplayValue(r)}o&&this.disabled$.next(this.nzDisabled),n&&this.setStatusStyles(this.nzStatus,this.hasFeedback)}ngAfterViewInit(){this.nzAutoFocus&&this.focus()}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.elementRef)}setupHandlersListeners(){this.ngZone.runOutsideAngular(()=>{(0,Vt.T)((0,ot.R)(this.upHandler.nativeElement,"mouseup"),(0,ot.R)(this.upHandler.nativeElement,"mouseleave"),(0,ot.R)(this.downHandler.nativeElement,"mouseup"),(0,ot.R)(this.downHandler.nativeElement,"mouseleave")).pipe((0,X.R)(this.destroy$)).subscribe(()=>this.stop())})}setStatusStyles(t,n){this.status=t,this.hasFeedback=n,this.cdr.markForCheck(),this.statusCls=(0,U.Zu)(this.prefixCls,t,n),Object.keys(this.statusCls).forEach(o=>{this.statusCls[o]?this.renderer.addClass(this.elementRef.nativeElement,o):this.renderer.removeClass(this.elementRef.nativeElement,o)})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(e.R0b),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(Rt.tE),e.Y36(e.Qsj),e.Y36(_t.Is,8),e.Y36(ge.kn),e.Y36(jt.kH,8),e.Y36(jt.yW,8))},s.\u0275cmp=e.Xpm({type:s,selectors:[["nz-input-number"]],viewQuery:function(t,n){if(1&t&&(e.Gf(je,7),e.Gf(He,7),e.Gf(Qe,7)),2&t){let o;e.iGM(o=e.CRH())&&(n.upHandler=o.first),e.iGM(o=e.CRH())&&(n.downHandler=o.first),e.iGM(o=e.CRH())&&(n.inputElement=o.first)}},hostAttrs:[1,"ant-input-number"],hostVars:16,hostBindings:function(t,n){2&t&&e.ekj("ant-input-number-in-form-item",!!n.nzFormStatusService)("ant-input-number-focused",n.isFocused)("ant-input-number-lg","large"===n.nzSize)("ant-input-number-sm","small"===n.nzSize)("ant-input-number-disabled",n.nzDisabled)("ant-input-number-readonly",n.nzReadOnly)("ant-input-number-rtl","rtl"===n.dir)("ant-input-number-borderless",n.nzBorderless)},inputs:{nzSize:"nzSize",nzMin:"nzMin",nzMax:"nzMax",nzParser:"nzParser",nzPrecision:"nzPrecision",nzPrecisionMode:"nzPrecisionMode",nzPlaceHolder:"nzPlaceHolder",nzStatus:"nzStatus",nzStep:"nzStep",nzInputMode:"nzInputMode",nzId:"nzId",nzDisabled:"nzDisabled",nzReadOnly:"nzReadOnly",nzAutoFocus:"nzAutoFocus",nzBorderless:"nzBorderless",nzFormatter:"nzFormatter"},outputs:{nzBlur:"nzBlur",nzFocus:"nzFocus"},exportAs:["nzInputNumber"],features:[e._Bn([{provide:z.JU,useExisting:(0,e.Gpc)(()=>s),multi:!0},ge.kn]),e.TTD],decls:11,vars:15,consts:[[1,"ant-input-number-handler-wrap"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-up",3,"mousedown"],["upHandler",""],["nz-icon","","nzType","up",1,"ant-input-number-handler-up-inner"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-down",3,"mousedown"],["downHandler",""],["nz-icon","","nzType","down",1,"ant-input-number-handler-down-inner"],[1,"ant-input-number-input-wrap"],["autocomplete","off",1,"ant-input-number-input",3,"disabled","placeholder","readOnly","ngModel","ngModelChange"],["inputElement",""],["class","ant-input-number-suffix",3,"status",4,"ngIf"],[1,"ant-input-number-suffix",3,"status"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"span",1,2),e.NdJ("mousedown",function(r){return n.up(r)}),e._UZ(3,"span",3),e.qZA(),e.TgZ(4,"span",4,5),e.NdJ("mousedown",function(r){return n.down(r)}),e._UZ(6,"span",6),e.qZA()(),e.TgZ(7,"div",7)(8,"input",8,9),e.NdJ("ngModelChange",function(r){return n.onModelChange(r)}),e.qZA()(),e.YNc(10,We,1,1,"nz-form-item-feedback-icon",10)),2&t&&(e.xp6(1),e.ekj("ant-input-number-handler-up-disabled",n.disabledUp),e.xp6(3),e.ekj("ant-input-number-handler-down-disabled",n.disabledDown),e.xp6(4),e.Q6J("disabled",n.nzDisabled)("placeholder",n.nzPlaceHolder)("readOnly",n.nzReadOnly)("ngModel",n.displayValue),e.uIk("id",n.nzId)("autofocus",n.nzAutoFocus?"autofocus":null)("min",n.nzMin)("max",n.nzMax)("step",n.nzStep)("inputmode",n.nzInputMode),e.xp6(2),e.Q6J("ngIf",n.hasFeedback&&!!n.status&&!n.nzFormNoStatusService))},dependencies:[N.O5,z.Fj,z.JJ,z.On,Z.Ls,jt.w_],encapsulation:2,changeDetection:0}),(0,L.gn)([(0,U.yF)()],s.prototype,"nzDisabled",void 0),(0,L.gn)([(0,U.yF)()],s.prototype,"nzReadOnly",void 0),(0,L.gn)([(0,U.yF)()],s.prototype,"nzAutoFocus",void 0),(0,L.gn)([(0,U.yF)()],s.prototype,"nzBorderless",void 0),s})(),cn=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[_t.vT,N.ez,z.u5,mt.T,Z.PV,jt.mJ]}),s})();var Ct=b(2536);const hn=["switchElement"];function pn(s,i){1&s&&e._UZ(0,"span",8)}function dn(s,i){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzCheckedChildren)}}function un(s,i){if(1&s&&(e.ynx(0),e.YNc(1,dn,2,1,"ng-container",9),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("nzStringTemplateOutlet",t.nzCheckedChildren)}}function fn(s,i){if(1&s&&(e.ynx(0),e._uU(1),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzUnCheckedChildren)}}function gn(s,i){if(1&s&&e.YNc(0,fn,2,1,"ng-container",9),2&s){const t=e.oxw();e.Q6J("nzStringTemplateOutlet",t.nzUnCheckedChildren)}}let bn=(()=>{class s{constructor(t,n,o,r,a,c){this.nzConfigService=t,this.host=n,this.ngZone=o,this.cdr=r,this.focusMonitor=a,this.directionality=c,this._nzModuleName="switch",this.isChecked=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzLoading=!1,this.nzDisabled=!1,this.nzControl=!1,this.nzCheckedChildren=null,this.nzUnCheckedChildren=null,this.nzSize="default",this.nzId=null,this.dir="ltr",this.destroy$=new Bt.x,this.isNzDisableFirstChange=!0}updateValue(t){this.isChecked!==t&&(this.isChecked=t,this.onChange(this.isChecked))}focus(){this.focusMonitor.focusVia(this.switchElement.nativeElement,"keyboard")}blur(){this.switchElement.nativeElement.blur()}ngOnInit(){this.directionality.change.pipe((0,X.R)(this.destroy$)).subscribe(t=>{this.dir=t,this.cdr.detectChanges()}),this.dir=this.directionality.value,this.ngZone.runOutsideAngular(()=>{(0,ot.R)(this.host.nativeElement,"click").pipe((0,X.R)(this.destroy$)).subscribe(t=>{t.preventDefault(),!(this.nzControl||this.nzDisabled||this.nzLoading)&&this.ngZone.run(()=>{this.updateValue(!this.isChecked),this.cdr.markForCheck()})}),(0,ot.R)(this.switchElement.nativeElement,"keydown").pipe((0,X.R)(this.destroy$)).subscribe(t=>{if(this.nzControl||this.nzDisabled||this.nzLoading)return;const{keyCode:n}=t;n!==G.oh&&n!==G.SV&&n!==G.L_&&n!==G.K5||(t.preventDefault(),this.ngZone.run(()=>{n===G.oh?this.updateValue(!1):n===G.SV?this.updateValue(!0):(n===G.L_||n===G.K5)&&this.updateValue(!this.isChecked),this.cdr.markForCheck()}))})})}ngAfterViewInit(){this.focusMonitor.monitor(this.switchElement.nativeElement,!0).pipe((0,X.R)(this.destroy$)).subscribe(t=>{t||Promise.resolve().then(()=>this.onTouched())})}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.switchElement.nativeElement),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.isChecked=t,this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.cdr.markForCheck()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(Ct.jY),e.Y36(e.SBq),e.Y36(e.R0b),e.Y36(e.sBO),e.Y36(Rt.tE),e.Y36(_t.Is,8))},s.\u0275cmp=e.Xpm({type:s,selectors:[["nz-switch"]],viewQuery:function(t,n){if(1&t&&e.Gf(hn,7),2&t){let o;e.iGM(o=e.CRH())&&(n.switchElement=o.first)}},inputs:{nzLoading:"nzLoading",nzDisabled:"nzDisabled",nzControl:"nzControl",nzCheckedChildren:"nzCheckedChildren",nzUnCheckedChildren:"nzUnCheckedChildren",nzSize:"nzSize",nzId:"nzId"},exportAs:["nzSwitch"],features:[e._Bn([{provide:z.JU,useExisting:(0,e.Gpc)(()=>s),multi:!0}])],decls:9,vars:16,consts:[["nz-wave","","type","button",1,"ant-switch",3,"disabled","nzWaveExtraNode"],["switchElement",""],[1,"ant-switch-handle"],["nz-icon","","nzType","loading","class","ant-switch-loading-icon",4,"ngIf"],[1,"ant-switch-inner"],[4,"ngIf","ngIfElse"],["uncheckTemplate",""],[1,"ant-click-animating-node"],["nz-icon","","nzType","loading",1,"ant-switch-loading-icon"],[4,"nzStringTemplateOutlet"]],template:function(t,n){if(1&t&&(e.TgZ(0,"button",0,1)(2,"span",2),e.YNc(3,pn,1,0,"span",3),e.qZA(),e.TgZ(4,"span",4),e.YNc(5,un,2,1,"ng-container",5),e.YNc(6,gn,1,1,"ng-template",null,6,e.W1O),e.qZA(),e._UZ(8,"div",7),e.qZA()),2&t){const o=e.MAs(7);e.ekj("ant-switch-checked",n.isChecked)("ant-switch-loading",n.nzLoading)("ant-switch-disabled",n.nzDisabled)("ant-switch-small","small"===n.nzSize)("ant-switch-rtl","rtl"===n.dir),e.Q6J("disabled",n.nzDisabled)("nzWaveExtraNode",!0),e.uIk("id",n.nzId),e.xp6(3),e.Q6J("ngIf",n.nzLoading),e.xp6(2),e.Q6J("ngIf",n.isChecked)("ngIfElse",o)}},dependencies:[N.O5,ft.dQ,Z.Ls,mt.f],encapsulation:2,changeDetection:0}),(0,L.gn)([(0,U.yF)()],s.prototype,"nzLoading",void 0),(0,L.gn)([(0,U.yF)()],s.prototype,"nzDisabled",void 0),(0,L.gn)([(0,U.yF)()],s.prototype,"nzControl",void 0),(0,L.gn)([(0,Ct.oS)()],s.prototype,"nzSize",void 0),s})(),zn=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[_t.vT,N.ez,ft.vG,Z.PV,mt.T]}),s})();function _n(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"input",8),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)||"")}}function Cn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-number",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function yn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-number",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function xn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"nz-switch",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))}),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function vn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"nz-input-group",10)(1,"input",11),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.qZA()()}if(2&s){const t=e.oxw(),n=e.MAs(7);e.Q6J("nzSuffix",n),e.xp6(1),e.Q6J("value",t.cell.getPropByPath(t.property.path)||"")}}function Sn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"button",12)(1,"span",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.handleSelectImage())}),e.qZA()()}}function Tn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"input",14),e.NdJ("colorPickerChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.change(o))})("cpPresetColorsChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.setPresentColors(o))}),e.qZA()}if(2&s){const t=e.oxw(),n=e.MAs(10);e.Udp("color",t.cell.getPropByPath(t.property.path)),e.Q6J("value",t.cell.getPropByPath(t.property.path)||"none")("colorPicker",t.cell.getPropByPath(t.property.path))("cpEyeDropper",!0)("cpUseRootViewContainer",!0)("cpPresetColors",t.getPresentColors())("cpExtraTemplate",n)}}function wn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}function Nn(s,i){if(1&s&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&s){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.name)}}function In(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"select",16),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(o))}),e.YNc(1,Nn,2,2,"option",17),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)),e.xp6(1),e.Q6J("ngForOf",t.property.options)}}let kn=(()=>{class s{constructor(t,n){this.ms=t,this.msg=n;const o=this;window.onload=()=>{window.top.onmessage=function({data:r}){o.msg.success("\u9009\u62e9\u6210\u529f!"),o.cell.setPropByPath("attrs/image/xlink:href",r)}}}inputChange(t){this.cell.setPropByPath(this.property.path,t.target.value)}change(t){this.cell.setPropByPath(this.property.path,t);let n=this.getPresentColors(),o=n.indexOf(t);o>-1&&n.splice(o,1),n.unshift(t),n.length>12&&(n.length=12),this.setPresentColors(n)}getPresentColors(){let t=localStorage.getItem("present-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("present-colors",JSON.stringify(t))}clearColor(){this.cell.setPropByPath(this.property.path,"none")}handleSelectImage(){this.ms.create({nzTitle:"\u9009\u62e9\u56fe\u7247",nzContent:Ye,nzComponentParams:{},nzFooter:null})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(zt.Sf),e.Y36(dt.dD))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-property-input"]],inputs:{property:"property",cell:"cell"},decls:12,vars:8,consts:[[3,"ngSwitch"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change",4,"ngSwitchCase"],["nzSize","small",3,"ngModel","ngModelChange",4,"ngSwitchCase"],["nzSize","small","style","padding-right: 0;",3,"nzSuffix",4,"ngSwitchCase"],["suffixIconSearch",""],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","color","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange",4,"ngSwitchCase"],["suffixIconClear",""],[3,"value","change",4,"ngSwitchCase"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change"],["nzSize","small",3,"ngModel","ngModelChange"],["nzSize","small",2,"padding-right","0",3,"nzSuffix"],["type","text","nz-input","","placeholder","\u7a7a",3,"value","change"],["nz-button","","nzSize","small","nzType","primary","nzSearch",""],["nz-icon","","nzType","search",3,"click"],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange"],[3,"click"],[3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){1&t&&(e.ynx(0,0),e.YNc(1,_n,1,1,"input",1),e.YNc(2,Cn,1,1,"nz-input-number",2),e.YNc(3,yn,1,1,"nz-input-number",2),e.YNc(4,xn,1,1,"nz-switch",2),e.YNc(5,vn,2,2,"nz-input-group",3),e.YNc(6,Sn,2,0,"ng-template",null,4,e.W1O),e.YNc(8,Tn,1,8,"input",5),e.YNc(9,wn,2,0,"ng-template",null,6,e.W1O),e.YNc(11,In,2,2,"select",7),e.BQk()),2&t&&(e.Q6J("ngSwitch",n.property.type),e.xp6(1),e.Q6J("ngSwitchCase","text"),e.xp6(1),e.Q6J("ngSwitchCase","number"),e.xp6(1),e.Q6J("ngSwitchCase","stroke"),e.xp6(1),e.Q6J("ngSwitchCase","boolean"),e.xp6(1),e.Q6J("ngSwitchCase","image"),e.xp6(3),e.Q6J("ngSwitchCase","color"),e.xp6(3),e.Q6J("ngSwitchCase","select"))},dependencies:[N.sg,N.RF,N.n9,z.YN,z.Kr,z.JJ,z.On,Z.Ls,tt.ix,rt.w,ft.dQ,re.Kk,nt.Zp,nt.gB,nt.ke,me,bn]}),s})();var wt=b(3679),it=b(6704);function En(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"a",2),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}let An=(()=>{class s{constructor(){this.onChanged=()=>{},this.onTouched=()=>{},this.colorChange=new e.vpe}ngOnInit(){}writeValue(t){this.color=t||""}registerOnChange(t){this.onChanged=t}registerOnTouched(t){this.onTouched=t}colorPickerChange(t){console.log("property change",t),this.color=t,this.onChanged(t);let n=this.getPresentColors(),o=n.indexOf(t);o>-1&&n.splice(o,1),n.unshift(t),n.length>12&&(n.length=12),this.setPresentColors(n)}getPresentColors(){let t=localStorage.getItem("bgc-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("bgc-colors",JSON.stringify(t))}clearColor(){this.color="",this.onChanged(this.color)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-color-input"]],outputs:{colorChange:"colorChange"},features:[e._Bn([{provide:z.JU,useExisting:(0,e.Gpc)(()=>s),multi:!0}])],decls:3,vars:7,consts:[["cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpPresetColors","cpExtraTemplate","valueChange","colorPickerChange","cpPresetColorsChange"],["suffixIconClear",""],[3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"input",0),e.NdJ("valueChange",function(r){return n.color=r})("colorPickerChange",function(r){return n.colorPickerChange(r)})("cpPresetColorsChange",function(r){return n.setPresentColors(r)}),e.qZA(),e.YNc(1,En,2,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Udp("color",n.color),e.Q6J("value",n.color)("colorPicker",n.color)("cpEyeDropper",!0)("cpPresetColors",n.getPresentColors())("cpExtraTemplate",o)}},dependencies:[re.Kk]}),s})(),Mn=(()=>{class s{set row(t){t&&this.group.patchValue(t)}constructor(t){this.fb=t,this.build()}build(t){this.group=this.fb.group({name:[(t=t||{}).name||"",[z.kI.required]],background_color:[t.background_color],background_image:[t.background_image]})}submit(){return new Promise((t,n)=>{this.group.valid?t(this.group.value):Object.values(this.group.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),n())})})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.qu))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-page-setting"]],inputs:{row:"row"},decls:16,vars:13,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","\u8bf7\u8f93\u5165\u540d\u79f0!",3,"nzSm","nzXs"],["nz-input","","formControlName","name"],["nzFor","background_color",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["formControlName","background_color"],["nzFor","background_image",3,"nzSm","nzXs"],["nz-input","","formControlName","background_image","placeholder","\u8f93\u5165\u56fe\u7247\u5730\u5740"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u540d\u79f0"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.qZA()(),e.TgZ(6,"nz-form-item")(7,"nz-form-label",4),e._uU(8,"\u80cc\u666f\u989c\u8272"),e.qZA(),e.TgZ(9,"nz-form-control",5),e._UZ(10,"app-color-input",6),e.qZA()(),e.TgZ(11,"nz-form-item")(12,"nz-form-label",7),e._uU(13,"\u80cc\u666f\u56fe\u7247"),e.qZA(),e.TgZ(14,"nz-form-control",5),e._UZ(15,"input",8),e.qZA()()()),2&t&&(e.Q6J("formGroup",n.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24))},dependencies:[z._Y,z.Fj,z.JJ,z.JL,z.sg,z.u,wt.t3,wt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp,An]}),s})();const On=function(s){return{selected:s}};function Pn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.open(r))}),e._uU(1),e.TgZ(2,"div",2),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(3,"span",3),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleCopy(r))}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleEdit(r))}),e.qZA(),e.TgZ(5,"span",5),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleDel(r))}),e.qZA()()()}if(2&s){const t=i.$implicit,n=i.index,o=e.oxw();e.Q6J("ngClass",e.VKq(2,On,n==o.index)),e.xp6(1),e.hij(" ",t.name," ")}}let Dn=(()=>{class s{constructor(t,n,o){this.modal=t,this.ms=n,this.viewContainerRef=o,this.onPageChange=new e.vpe,this.index=0}handleEdit(t){const n=void 0===t,o=this.modal.create({nzTitle:n?"\u65b0\u589e\u9875\u9762":"\u7f16\u8f91\u9875\u9762",nzContent:Mn,nzComponentParams:{row:n?{name:"",content:{}}:this.project.pages[t]},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>o.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:r=>r?.submit().then(a=>{n?this.project.pages.push(a):this.project.pages[t]=a,this.onPageChange.emit(0),o.destroy()}).catch(a=>!1)}]})}handleDel(t){1!=this.project.pages.length?(this.project.pages.splice(t,1),this.index==t&&(t>=this.project.pages.length&&(this.index=t-1),this.onPageChange.emit(this.index))):this.ms.error("\u518d\u5220\u5c31\u6ca1\u6709\u4e86")}open(t){this.index=t,this.onPageChange.emit(t)}handleCopy(t){}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(zt.Sf),e.Y36(dt.dD),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-pages"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:1,vars:1,consts:[["class","page",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"page",3,"ngClass","click"],[1,"tools",3,"click"],["nz-icon","","nzType","copy","title","\u590d\u5236",3,"click"],["nz-icon","","nzType","edit","title","\u7f16\u8f91",3,"click"],["nz-icon","","nzType","delete","title","\u5220\u9664",3,"click"]],template:function(t,n){1&t&&e.YNc(0,Pn,6,4,"div",0),2&t&&e.Q6J("ngForOf",n.project.pages)},dependencies:[N.mk,N.sg,Z.Ls,rt.w],styles:[".page[_ngcontent-%COMP%]{position:relative;padding:3px 5px}.page[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{position:absolute;right:5px;top:3px;display:none}.page.selected[_ngcontent-%COMP%]{background-color:#e1e1e1}.page[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.page[_ngcontent-%COMP%]:hover > .tools[_ngcontent-%COMP%]{display:block}"]}),s})();var Ft=b(8e3);function Bn(s,i){if(1&s&&e._UZ(0,"nz-option",12),2&s){const t=e.oxw().$implicit;e.Q6J("nzValue",t.id)("nzLabel",t.name+"-"+t.id)}}function Rn(s,i){if(1&s&&(e.ynx(0),e.YNc(1,Bn,1,2,"nz-option",11),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function Fn(s,i){1&s&&(e.TgZ(0,"nz-option",13),e._UZ(1,"span",14),e._uU(2," Loading Data... "),e.qZA())}function Zn(s,i){if(1&s&&e._UZ(0,"nz-option",15),2&s){const t=i.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.name)}}let Jn=(()=>{class s{set content(t){const{product:n,device:o}=t;o?(this.onSearch(o),this.getVariableList(n)):this.onSearch(""),this.group.patchValue(t)}constructor(t,n){this.fb=t,this.rs=n,this.isLoading=!1,this.optionList=[],this.variableList=[],this.build()}build(t){this.group=this.fb.group({product:[(t=t||{}).product||"",[z.kI.required]],device:[t.device||"",[z.kI.required]],variable:[t.variable||"",[z.kI.required]]})}onSearch(t){this.isLoading=!0,this.rs.post("/api/device/search",{keyword:{name:t,id:t},limit:20,skip:0}).subscribe(n=>{this.optionList=n.data||[]}).add(()=>{this.isLoading=!1})}handleChange(t){this.variableList=[];const n=this.optionList.find(o=>o.id===t)||{product_id:""};this.group.patchValue({product:n.product_id,variable:""}),this.getVariableList(n.product_id)}getVariableList(t){t&&this.rs.get(`/api/product/${t}`).subscribe(n=>{this.variableList=n&&n.data&&n.data.properties||[]})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.qu),e.Y36(At.s))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-binding-setting"]],inputs:{content:"content"},decls:19,vars:16,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","device",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nzAllowClear","","nzShowSearch","","nzServerSearch","","formControlName","device","nzPlaceHolder","\u8f93\u5165\u8bbe\u5907\u540d\u79f0/id\u53ef\u641c\u7d22",3,"nzOnSearch","ngModelChange"],[4,"ngFor","ngForOf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],["nzRequired","","nzFor","product",3,"nzSm","nzXs"],["nz-input","","formControlName","product","readonly",""],["nzRequired","","nzFor","variable",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","variable"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel",4,"ngIf"],[3,"nzValue","nzLabel"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"],[3,"nzLabel","nzValue"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u8bbe\u5907ID"),e.qZA(),e.TgZ(4,"nz-form-control",2)(5,"nz-select",3),e.NdJ("nzOnSearch",function(r){return n.onSearch(r)})("ngModelChange",function(r){return n.handleChange(r)}),e.YNc(6,Rn,2,1,"ng-container",4),e.YNc(7,Fn,3,0,"nz-option",5),e.qZA()()(),e.TgZ(8,"nz-form-item")(9,"nz-form-label",6),e._uU(10,"\u4ea7\u54c1ID"),e.qZA(),e.TgZ(11,"nz-form-control",2),e._UZ(12,"input",7),e.qZA()(),e.TgZ(13,"nz-form-item")(14,"nz-form-label",8),e._uU(15,"\u53d8\u91cf"),e.qZA(),e.TgZ(16,"nz-form-control",2)(17,"nz-select",9),e.YNc(18,Zn,1,2,"nz-option",10),e.qZA()()()()),2&t&&(e.Q6J("formGroup",n.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",n.optionList),e.xp6(1),e.Q6J("ngIf",n.isLoading),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",n.variableList))},dependencies:[N.sg,N.O5,z._Y,z.Fj,z.JJ,z.JL,z.sg,z.u,Z.Ls,rt.w,wt.t3,wt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp,Ft.Ip,Ft.Vq]}),s})();function Ln(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.ALo(2,"json"),e.qZA()}if(2&s){const t=i.$implicit,n=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",e.lcZ(2,2,null==n.cell.data||null==n.cell.data.bindings?null:n.cell.data.bindings[t.name]),"\n")}}let Gn=(()=>{class s{constructor(t){this.ms=t}edit(t){this.cell.data.bindings||={},this.ms.create({nzTitle:`\u7f16\u8f91 ${t.label} \u6570\u636e\u7ed1\u5b9a`,nzContent:Jn,nzComponentParams:{content:this.cell.data.bindings[t.name]||{}},nzOnOk:({group:n})=>{this.cell.data.bindings[t.name]=n.value}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(zt.Sf))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-binding"]],inputs:{cell:"cell",component:"component"},decls:1,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,n){1&t&&e.YNc(0,Ln,3,4,"div",0),2&t&&e.Q6J("ngForOf",null==n.component?null:n.component.bindings)},dependencies:[N.sg,N.Ts]}),s})();var be=b(1103);let Un=(()=>{class s{constructor(){this.content="",this.codeMirrorOptions={theme:"material",mode:"javascript",lineWrapping:!0,foldGutter:!0,autoCloseBrackets:!0,autoFocus:!0,matchBrackets:!0,lint:!0}}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-listener-setting"]],inputs:{content:"content"},decls:1,vars:2,consts:[[3,"ngModel","options","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"ngx-codemirror",0),e.NdJ("ngModelChange",function(r){return n.content=r}),e.qZA()),2&t&&e.Q6J("ngModel",n.content)("options",n.codeMirrorOptions)},dependencies:[z.JJ,z.On,be.C],styles:[".CodeMirror-sizer{margin-left:0}  .CodeMirror-sizer .CodeMirror-gutters{visibility:hidden}"]}),s})();function Yn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",0),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.qZA()}if(2&s){const t=i.$implicit,n=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",null==n.cell.data||null==n.cell.data.listeners?null:n.cell.data.listeners[t.name],"\n")}}let Vn=(()=>{class s{constructor(t){this.ms=t,this.click={label:"\u70b9\u51fb",name:"click"}}edit(t){this.cell.data.listeners||={},this.ms.create({nzTitle:`\u7f16\u8f91${t.label}\u4e8b\u4ef6\u811a\u672c`,nzContent:Un,nzComponentParams:{content:this.cell.data.listeners[t.name]||""},nzOnOk:({content:n})=>{this.cell.data.listeners=Object.assign(this.cell.data.listeners||{},{[t.name]:n})}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(zt.Sf))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-listener"]],inputs:{cell:"cell",component:"component"},decls:3,vars:2,consts:[[3,"click"],[3,"click",4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.NdJ("click",function(){return n.edit(n.click)}),e._uU(1),e.qZA(),e.YNc(2,Yn,2,2,"div",1)),2&t&&(e.xp6(1),e.hij(" \u70b9\u51fb : ",null==n.cell.data||null==n.cell.data.listeners?null:n.cell.data.listeners.click,"\n"),e.xp6(1),e.Q6J("ngForOf",null==n.component?null:n.component.events))},dependencies:[N.sg]}),s})();function jn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onPositionChange(o))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"X"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",11),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"Y"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",12),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formPosition)}}function Hn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSizeChange(o))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",13),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",14),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formSize)}}function Qn(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onLinePositionChange(o))}),e.TgZ(1,"table")(2,"tr",15)(3,"td"),e._uU(4,"\u8d77\u70b9"),e.qZA(),e.TgZ(5,"td"),e._uU(6,"X:"),e._UZ(7,"input",16),e.qZA(),e.TgZ(8,"td"),e._uU(9,"Y:"),e._UZ(10,"input",17),e.qZA()(),e.TgZ(11,"tr",18)(12,"td"),e._uU(13,"\u7ec8\u70b9"),e.qZA(),e.TgZ(14,"td"),e._uU(15,"X:"),e._UZ(16,"input",16),e.qZA(),e.TgZ(17,"td"),e._uU(18,"Y:"),e._UZ(19,"input",17),e.qZA()()()()}if(2&s){const t=e.oxw(2);e.Q6J("formGroup",t.formLinePosition)}}function Wn(s,i){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"app-property-input",19),e.qZA()()),2&s){const t=i.$implicit,n=e.oxw(2);e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("property",t)("cell",n.cell)}}function $n(s,i){if(1&s&&(e.TgZ(0,"app-collapse",7),e.YNc(1,jn,12,1,"form",8),e.YNc(2,Hn,12,1,"form",8),e.YNc(3,Qn,20,1,"form",8),e.TgZ(4,"table"),e.YNc(5,Wn,5,3,"tr",9),e.qZA()()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isEdge()),e.xp6(2),e.Q6J("ngForOf",t.cmp.properties)}}function Xn(s,i){if(1&s&&(e.TgZ(0,"app-collapse",20),e._UZ(1,"app-binding",21),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}function qn(s,i){if(1&s&&(e.TgZ(0,"app-collapse",22),e._UZ(1,"app-listener",21),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}let Kn=(()=>{class s{get graph(){return this.g}set graph(t){this.g=t,t.on("cell:change:size",n=>{n.cell==this.cell&&this.formSize.patchValue(n.current)}),t.on("cell:change:position",n=>{n.cell==this.cell&&this.formPosition.patchValue(n.current)}),t.on("cell:unselected",({cell:n})=>{n==this.cell&&(this.cmp=void 0)}),t.on("selection:changed",({selected:n})=>{if(this.selected=n,1===t.getSelectedCellCount()){if(this.cell=t.getSelectedCells()[0],this.cell.isNode()){const o=this.cell.getPosition();this.formPosition.patchValue(o);const r=this.cell.getSize();this.formSize.patchValue(r)}else if(this.cell.isEdge()){const o=this.cell.getProp("source"),r=this.cell.getProp("target");this.formLinePosition.patchValue({source:o,target:r})}this.cmp=this.cs.Get(this.cell.shape)}})}constructor(t,n){this.fb=t,this.cs=n,this.onPageChange=new e.vpe,this.selected=[],this.formPosition=t.group({x:[0,[z.kI.required]],y:[0,[z.kI.required]]}),this.formSize=t.group({width:[0,[z.kI.required]],height:[0,[z.kI.required]]}),this.formLinePosition=t.group({source:t.group({x:[0,[z.kI.required]],y:[0,[z.kI.required]]}),target:t.group({x:[0,[z.kI.required]],y:[0,[z.kI.required]]})})}onPositionChange(t){this.cell.isNode()&&this.cell.setPosition(this.formPosition.value)}onSizeChange(t){this.cell.isNode()&&this.cell.setSize(this.formSize.value)}onLinePositionChange(t){this.cell.setProp(this.formLinePosition.value)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.qu),e.Y36(ut.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-property"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:7,vars:5,consts:[["title","\u9875\u9762\u7ba1\u7406"],["more","","nz-icon","","nzType","plus","nzTheme","outline","title","\u6dfb\u52a0\u9875\u9762",3,"click"],[3,"graph","project","onPageChange"],["pages",""],["title","\u63a7\u4ef6\u5c5e\u6027",4,"ngIf"],["title","\u6570\u636e\u7ed1\u5b9a",4,"ngIf"],["title","\u4e8b\u4ef6\u54cd\u5e94",4,"ngIf"],["title","\u63a7\u4ef6\u5c5e\u6027"],[3,"formGroup","change",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"formGroup","change"],["nz-input","","nzSize","small","type","number","formControlName","x"],["nz-input","","nzSize","small","type","number","formControlName","y"],["nz-input","","nzSize","small","type","number","formControlName","width"],["nz-input","","nzSize","small","type","number","formControlName","height"],["formGroupName","source"],["nz-input","","nzSize","small","type","number","formControlName","x",2,"width","60px"],["nz-input","","nzSize","small","type","number","formControlName","y",2,"width","60px"],["formGroupName","target"],[3,"property","cell"],["title","\u6570\u636e\u7ed1\u5b9a"],[3,"cell","component"],["title","\u4e8b\u4ef6\u54cd\u5e94"]],template:function(t,n){if(1&t){const o=e.EpF();e.TgZ(0,"app-collapse",0)(1,"span",1),e.NdJ("click",function(a){return e.CHM(o),e.MAs(3).handleEdit(),e.KtG(a.stopPropagation())}),e.qZA(),e.TgZ(2,"app-pages",2,3),e.NdJ("onPageChange",function(a){return n.onPageChange.emit(a)}),e.qZA()(),e.YNc(4,$n,6,4,"app-collapse",4),e.YNc(5,Xn,2,2,"app-collapse",5),e.YNc(6,qn,2,2,"app-collapse",6)}2&t&&(e.xp6(2),e.Q6J("graph",n.graph)("project",n.project),e.xp6(2),e.Q6J("ngIf",n.selected.length&&n.cmp),e.xp6(1),e.Q6J("ngIf",1==n.selected.length&&(null==n.cmp||null==n.cmp.bindings?null:n.cmp.bindings.length)),e.xp6(1),e.Q6J("ngIf",1==n.selected.length&&n.cmp))},dependencies:[N.sg,N.O5,z._Y,z.Fj,z.wV,z.JJ,z.JL,z.sg,z.u,z.x0,Z.Ls,rt.w,nt.Zp,kn,vt,Dn,Gn,Vn],styles:["[_nghost-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden;border-left:1px solid #a8a8a8;-webkit-user-select:none;user-select:none}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{min-width:80px}"]}),s})(),ti=(()=>{class s{set project(t){t&&this.group.patchValue(t)}constructor(t){this.fb=t,this.build()}build(t){this.group=this.fb.group({id:[(t=t||{}).id||"",[z.kI.required]],name:[t.name||"",[z.kI.required]],desc:[t.desc||"",[]],width:[t.width||400,[z.kI.required]],height:[t.height||400,[z.kI.required]]})}setData(t){const n=this.group.value;for(const o in n)n[o]=t[o];this.group.setValue(n)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.qu))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-project-setting"]],inputs:{project:"project"},decls:26,vars:11,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","id",3,"nzSpan"],["nzErrorTip","ID\u4e0d\u53ef\u4e3a\u7a7a!",3,"nzSpan"],["nz-input","","name","id","formControlName","id"],["nzRequired","","nzFor","name",3,"nzSpan"],["nzErrorTip","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a!",3,"nzSpan"],["nz-input","","name","name","formControlName","name"],["nzFor","width",3,"nzSpan"],[3,"nzSpan"],["formControlName","width"],["nzFor","height",3,"nzSpan"],["formControlName","height"],["nzFor","desc",3,"nzSpan"],["nz-input","","name","desc","formControlName","desc"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"ID"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.qZA()(),e.TgZ(6,"nz-form-item")(7,"nz-form-label",4),e._uU(8,"\u540d\u79f0"),e.qZA(),e.TgZ(9,"nz-form-control",5),e._UZ(10,"input",6),e.qZA()(),e.TgZ(11,"nz-form-item")(12,"nz-form-label",7),e._uU(13,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(14,"nz-form-control",8),e._UZ(15,"nz-input-number",9),e.qZA()(),e.TgZ(16,"nz-form-item")(17,"nz-form-label",10),e._uU(18,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(19,"nz-form-control",8),e._UZ(20,"nz-input-number",11),e.qZA()(),e.TgZ(21,"nz-form-item")(22,"nz-form-label",12),e._uU(23,"\u8bf4\u660e"),e.qZA(),e.TgZ(24,"nz-form-control",8),e._UZ(25,"input",13),e.qZA()()()),2&t&&(e.Q6J("formGroup",n.group),e.xp6(2),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16))},dependencies:[z._Y,z.Fj,z.JJ,z.JL,z.sg,z.u,wt.t3,wt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp,me]}),s})();function ei(s,i){if(1&s&&(e.TgZ(0,"p")(1,"a",1),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&s){const t=i.$implicit;e.xp6(1),e.Q6J("href",t.url,e.LSH),e.xp6(1),e.Oqu(t.name),e.xp6(1),e.hij(" ",t.email,"\n")}}let ni=(()=>{class s{constructor(){this.contributors=[{name:"\u6770\u795e",url:"https://github.com/zgwit",email:"jason@zgwit.com"},{name:"EnTrouble",url:"https://github.com/EnTrouble",email:"hutianqi@zgwit.cn"}]}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-about"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],["target","_blank",3,"href"]],template:function(t,n){1&t&&(e.TgZ(0,"p"),e._uU(1,"\u7269\u8054\u5927\u5e08 Web SCADA \u63d2\u4ef6\uff0c\u8d21\u732e\u8005\uff1a"),e.qZA(),e.YNc(2,ei,4,3,"p",0)),2&t&&(e.xp6(2),e.Q6J("ngForOf",n.contributors))},dependencies:[N.sg]}),s})();var ze=b(2577),Ht=b(3325),yt=b(9562);const ii=function(){return{standalone:!0}};let si=(()=>{class s{constructor(t,n,o,r){this.cs=t,this.modal=n,this.msg=o,this.viewContainerRef=r,this.onSave=new e.vpe,this.scale=1,this.scaleChange=new e.vpe,this.showGrid=JSON.parse(localStorage.getItem("show_grid")||"true")}handleSave(){this.onSave.emit()}handleExport(t){switch(console.log(this.graph),t){case"SVG":this.graph.exportSVG();break;case"PNG":this.graph.exportPNG();break;case"JPEG":this.graph.exportJPEG();break;case"file":this.savefiles(this.graph.toJSON(),Date.now()+"")}}handleUndo(){this.graph.undo()}handleRedo(){this.graph.redo()}handleCut(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.cut(this.graph.getSelectedCells(),{deep:!0})}handleCopy(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.copy(this.graph.getSelectedCells(),{deep:!0})}handlePaste(){this.graph.paste()}handleDelete(){this.graph.getSelectedCells().forEach(t=>t.remove())}handleAlignLeft(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position();void 0===t?t=r.x:(r.x=t,o.setPosition(r))})}handleAlignCenter(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position(),a=o.size();void 0===t?t=r.x+.5*a.width:(r.x=t-.5*a.width,o.setPosition(r))})}handleAlignRight(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position(),a=o.size();void 0===t?t=r.x+a.width:(r.x=t-a.width,o.setPosition(r))})}handleValignTop(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position();void 0===t?t=r.y:(r.y=t,o.setPosition(r))})}handleValignMiddle(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position(),a=o.size();void 0===t?t=r.y+.5*a.height:(r.y=t-.5*a.height,o.setPosition(r))})}handleValignBottom(){let t;this.graph.getSelectedCells().forEach(n=>{if(!n.isNode())return;let o=n,r=o.position(),a=o.size();void 0===t?t=r.y+a.height:(r.y=t-a.height,o.setPosition(r))})}handleMoveTop(){this.graph.getSelectedCells().forEach(t=>{t.toFront()})}handleMoveUp(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)+1)}handleMoveDown(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)-1)}handleMoveBottom(){this.graph.getSelectedCells().forEach(t=>{t.toBack()})}handleGroup(){let t=this.graph.getSelectedCells().map(r=>r.getBBox()),n={x:t.reduce((r,a)=>r.x<a.x?r:a).x-10,y:t.reduce((r,a)=>r.y<a.y?r:a).y-10,right:t.reduce((r,a)=>r.right>a.right?r:a).right+10,bottom:t.reduce((r,a)=>r.bottom>a.bottom?r:a).bottom+10};console.log("group",n),this.cs.Get("group");let o=this.graph.addNode({shape:"group",x:n.x,y:n.y,width:n.right-n.x,height:n.bottom-n.y});this.graph.getSelectedCells().forEach(r=>{r.setZIndex(o.zIndex+r.zIndex),o.addChild(r)})}handleUngroup(){this.graph.getSelectedCells().forEach(t=>{"group"==t.shape&&(t.getChildren()?.forEach(n=>{n.setParent(null)}),t.setChildren(null),t.remove())})}isGroup(){return 1===this.graph.getSelectedCellCount()&&this.graph.getSelectedCells()[0].getChildCount()>0}handleGrid(){this.showGrid?this.graph.hideGrid():this.graph.showGrid(),this.showGrid=!this.showGrid,localStorage.setItem("show_grid",JSON.stringify(this.showGrid))}settingProject(){const t=this.modal.create({nzTitle:"\u7f16\u8f91\u5de5\u7a0b\u4fe1\u606f",nzContent:ti,nzComponentParams:{project:this.project},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>t.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:n=>{const o=n.group.value;Object.assign(this.project,o),console.log("project setting",o),t.destroy()}}]})}savefiles(t,n){const o=window.URL||window.webkitURL||window,r=new Blob([JSON.stringify(t)]),a=document.createElement("a");a.href=o.createObjectURL(r),a.download=n,a.click()}handleScale(t){this.scaleChange.emit(t),this.graph.zoomTo(t)}about(){this.modal.create({nzTitle:"\u5173\u4e8e",nzContent:ni,nzFooter:null})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(ut.m),e.Y36(zt.Sf),e.Y36(dt.dD),e.Y36(e.s_b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-toolbar"]],inputs:{project:"project",graph:"graph",scale:"scale"},outputs:{onSave:"onSave",scaleChange:"scaleChange"},features:[e._Bn([dt.dD,zt.Sf])],decls:74,vars:30,consts:[["nz-button","",3,"click"],["nz-icon","","nzType","save","title","\u4fdd\u5b58"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["exportDropDownMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],["nzType","vertical"],["nz-button","","title","\u64a4\u9500(ctrl+z)",3,"disabled","click"],["nz-icon","","nzType","undo"],["nz-button","","title","\u91cd\u505a(ctrl+y)",3,"disabled","click"],["nz-icon","","nzType","redo"],["nz-button","","title","\u526a\u5207(ctrl+x)",3,"disabled","click"],["nz-icon","","nzType","scissor"],["nz-button","","title","\u590d\u5236(ctrl+c)",3,"disabled","click"],["nz-icon","","nzType","copy"],["nz-button","","title","\u7c98\u8d34(ctrl+v)",3,"disabled","click"],["nz-icon","","nzType","snippets"],["nz-button","","title","\u5220\u9664",3,"disabled","click"],["nz-icon","","nzType","delete"],["nz-button","",3,"disabled","click"],["nz-icon","","nzType","align-left","title","\u5de6\u5bf9\u9f50"],["nz-icon","","nzType","align-center","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","align-right","title","\u53f3\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-top","title","\u4e0a\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-middle","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-bottom","title","\u4e0b\u5bf9\u9f50"],["nz-icon","","nzType","vertical-right","title","\u7f6e\u9876",3,"nzRotate"],["nz-icon","","nzType","up","title","\u4e0a\u79fb\u4e00\u5c42"],["nz-icon","","nzType","down","title","\u4e0b\u79fb\u4e00\u5c42"],["nz-icon","","nzType","vertical-left","title","\u7f6e\u5e95",3,"nzRotate"],["nz-icon","","nzType","group","title","\u7ec4\u5408"],["nz-icon","","nzType","ungroup","title","\u89e3\u9664\u7ec4\u5408"],["nz-icon","","nzType","table","title","\u663e\u793a\u7f51\u683c"],["nz-icon","","nzType","setting","title","\u5de5\u7a0b\u8bbe\u7f6e"],[3,"ngModel","ngModelOptions","ngModelChange"],["nzLabel","25%",3,"nzValue"],["nzLabel","50%",3,"nzValue"],["nzLabel","75%",3,"nzValue"],["nzLabel","100%",3,"nzValue"],["nzLabel","200%",3,"nzValue"],["nzLabel","500%",3,"nzValue"],["nz-icon","","nzType","question-circle","title","\u5173\u4e8e"]],template:function(t,n){if(1&t&&(e.TgZ(0,"a",0),e.NdJ("click",function(){return n.handleSave()}),e._UZ(1,"i",1),e._uU(2," \u4fdd\u5b58\n"),e.qZA(),e.TgZ(3,"button",2),e._UZ(4,"i",3),e._uU(5,"\u4e0b\u8f7d"),e.qZA(),e.TgZ(6,"nz-dropdown-menu",null,4)(8,"ul",5)(9,"li",6),e.NdJ("click",function(){return n.handleExport("SVG")}),e._uU(10,"\u5bfc\u51faSVG"),e.qZA(),e.TgZ(11,"li",6),e.NdJ("click",function(){return n.handleExport("PNG")}),e._uU(12,"\u5bfc\u51faPNG"),e.qZA(),e.TgZ(13,"li",6),e.NdJ("click",function(){return n.handleExport("JPEG")}),e._uU(14,"\u5bfc\u51faJPEG"),e.qZA(),e.TgZ(15,"li",6),e.NdJ("click",function(){return n.handleExport("file")}),e._uU(16,"\u5bfc\u51fa\u6587\u4ef6"),e.qZA()()(),e._UZ(17,"nz-divider",7),e.TgZ(18,"a",8),e.NdJ("click",function(){return n.handleUndo()}),e._UZ(19,"i",9),e.qZA(),e.TgZ(20,"a",10),e.NdJ("click",function(){return n.handleRedo()}),e._UZ(21,"i",11),e.qZA(),e._UZ(22,"nz-divider",7),e.TgZ(23,"a",12),e.NdJ("click",function(){return n.handleCut()}),e._UZ(24,"i",13),e.qZA(),e.TgZ(25,"a",14),e.NdJ("click",function(){return n.handleCopy()}),e._UZ(26,"i",15),e.qZA(),e.TgZ(27,"a",16),e.NdJ("click",function(){return n.handlePaste()}),e._UZ(28,"i",17),e.qZA(),e.TgZ(29,"a",18),e.NdJ("click",function(){return n.handleDelete()}),e._UZ(30,"i",19),e.qZA(),e._UZ(31,"nz-divider",7),e.TgZ(32,"a",20),e.NdJ("click",function(){return n.handleAlignLeft()}),e._UZ(33,"i",21),e.qZA(),e.TgZ(34,"a",20),e.NdJ("click",function(){return n.handleAlignCenter()}),e._UZ(35,"i",22),e.qZA(),e.TgZ(36,"a",20),e.NdJ("click",function(){return n.handleAlignRight()}),e._UZ(37,"i",23),e.qZA(),e._UZ(38,"nz-divider",7),e.TgZ(39,"a",20),e.NdJ("click",function(){return n.handleValignTop()}),e._UZ(40,"i",24),e.qZA(),e.TgZ(41,"a",20),e.NdJ("click",function(){return n.handleValignMiddle()}),e._UZ(42,"i",25),e.qZA(),e.TgZ(43,"a",20),e.NdJ("click",function(){return n.handleValignBottom()}),e._UZ(44,"i",26),e.qZA(),e._UZ(45,"nz-divider",7),e.TgZ(46,"a",20),e.NdJ("click",function(){return n.handleMoveTop()}),e._UZ(47,"i",27),e.qZA(),e.TgZ(48,"a",20),e.NdJ("click",function(){return n.handleMoveUp()}),e._UZ(49,"i",28),e.qZA(),e.TgZ(50,"a",20),e.NdJ("click",function(){return n.handleMoveDown()}),e._UZ(51,"i",29),e.qZA(),e.TgZ(52,"a",20),e.NdJ("click",function(){return n.handleMoveBottom()}),e._UZ(53,"i",30),e.qZA(),e._UZ(54,"nz-divider",7),e.TgZ(55,"a",20),e.NdJ("click",function(){return n.handleGroup()}),e._UZ(56,"i",31),e.qZA(),e.TgZ(57,"a",20),e.NdJ("click",function(){return n.handleUngroup()}),e._UZ(58,"i",32),e.qZA(),e._UZ(59,"nz-divider",7),e.TgZ(60,"a",0),e.NdJ("click",function(){return n.handleGrid()}),e._UZ(61,"i",33),e.qZA(),e.TgZ(62,"a",0),e.NdJ("click",function(){return n.settingProject()}),e._UZ(63,"i",34),e.qZA(),e.TgZ(64,"nz-select",35),e.NdJ("ngModelChange",function(r){return n.handleScale(r)}),e._UZ(65,"nz-option",36)(66,"nz-option",37)(67,"nz-option",38)(68,"nz-option",39)(69,"nz-option",40)(70,"nz-option",41),e.qZA(),e._UZ(71,"nz-divider",7),e.TgZ(72,"a",0),e.NdJ("click",function(){return n.about()}),e._UZ(73,"i",42),e.qZA()),2&t){const o=e.MAs(7);e.xp6(3),e.Q6J("nzDropdownMenu",o),e.xp6(15),e.Q6J("disabled",!n.graph.canUndo()),e.xp6(2),e.Q6J("disabled",!n.graph.canRedo()),e.xp6(3),e.Q6J("disabled",!n.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!n.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!n.graph.getCellsInClipboard().length),e.xp6(2),e.Q6J("disabled",!n.graph.getSelectedCellCount()),e.xp6(3),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(3),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(3),e.Q6J("disabled",!n.graph.getSelectedCellCount()),e.xp6(1),e.Q6J("nzRotate",90),e.xp6(1),e.Q6J("disabled",1!=n.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",1!=n.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!n.graph.getSelectedCellCount()),e.xp6(1),e.Q6J("nzRotate",90),e.xp6(2),e.Q6J("disabled",n.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",!n.isGroup()),e.xp6(7),e.Q6J("ngModel",n.scale)("ngModelOptions",e.DdM(29,ii)),e.xp6(1),e.Q6J("nzValue",.25),e.xp6(1),e.Q6J("nzValue",.5),e.xp6(1),e.Q6J("nzValue",.75),e.xp6(1),e.Q6J("nzValue",1),e.xp6(1),e.Q6J("nzValue",2),e.xp6(1),e.Q6J("nzValue",5)}},dependencies:[z.JJ,z.On,Z.Ls,ze.g,tt.ix,rt.w,ft.dQ,Ft.Ip,Ft.Vq,Ht.wO,Ht.r9,yt.cm,yt.RR,yt.wA],styles:["[_nghost-%COMP%]{height:50px;display:flex;align-items:center;vertical-align:middle;padding:0 20px;font-size:20px;font-weight:700;overflow:hidden;border-bottom:1px solid #a8a8a8;background-color:#f0f0f0}a[_ngcontent-%COMP%]{padding:5px;margin:1px;cursor:pointer;text-decoration:none}a.disabled[_ngcontent-%COMP%]{color:gray;cursor:default}"]}),s})();const oi=["canvas"];let _e=(()=>{class s{constructor(t,n,o,r,a,c){this.title=t,this.rs=n,this.msg=o,this.router=r,this.route=a,this.cs=c,this.id="",this.project=function Et(){return{id:"",name:"\u7ec4\u6001\u5de5\u7a0b",desc:"",width:window.screen.width,height:window.screen.height,pages:[{name:"\u9996\u9875",content:{}}]}}(),this.index=0,this.scale=1,this.leftWidth=200,this.leftWidthMin=200,this.rightWidth=250,this.rightWidthMin=250,this.leftOn=!1,this.rightOn=!1,this.lastX=0,t.setTitle(this.project.name)}ngOnInit(){this.route.snapshot.paramMap.has("id")&&(this.id=this.route.snapshot.paramMap.get("id"),this.rs.get(`api/project/${this.id}`).subscribe(t=>{this.project=t.data,this.title.setTitle(this.project.name),this.canvas.Render(this.project.pages[0])}))}onDrag(t){this.canvas.Draw(t)}handleSave(){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.rs.post(this.id?`api/project/${this.id}`:"api/project/create",this.project).subscribe(n=>{this.router.navigateByUrl("/admin/project")})}handlePageChange(t){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.index=t,this.canvas.Render(this.project.pages[this.index])}onLeftDown(t){this.leftOn=!0,this.lastX=t.screenX}onRightDown(t){this.rightOn=!0,this.lastX=t.screenX}onMoseMove(t){let n=t.screenX-this.lastX;if(this.leftOn){if(n<0&&this.leftWidth<=this.leftWidthMin)return;this.leftWidth+=t.screenX-this.lastX}if(this.rightOn){if(n>0&&this.rightWidth<=this.rightWidthMin)return;this.rightWidth-=t.screenX-this.lastX}this.lastX=t.screenX}onMouseUp(t){this.leftOn=!1,this.rightOn=!1}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(ht.Dx),e.Y36(At.s),e.Y36(dt.dD),e.Y36(ct.F0),e.Y36(ct.gz),e.Y36(ut.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-editor"]],viewQuery:function(t,n){if(1&t&&e.Gf(oi,5),2&t){let o;e.iGM(o=e.CRH())&&(n.canvas=o.first)}},decls:9,vars:13,consts:[[3,"graph","project","scale","onSave","scaleChange"],[1,"body",3,"mousemove","mouseup"],[3,"onDrag"],[1,"splitter",3,"mousedown"],[1,"content"],["canvas",""],[3,"graph","project","onPageChange"]],template:function(t,n){if(1&t&&(e.TgZ(0,"app-toolbar",0),e.NdJ("onSave",function(){return n.handleSave()})("scaleChange",function(r){return n.scale=r}),e.qZA(),e.TgZ(1,"div",1),e.NdJ("mousemove",function(r){return n.onMoseMove(r)})("mouseup",function(r){return n.onMouseUp(r)}),e.TgZ(2,"app-library",2),e.NdJ("onDrag",function(r){return n.onDrag(r)}),e.qZA(),e.TgZ(3,"div",3),e.NdJ("mousedown",function(r){return n.onLeftDown(r)}),e.qZA(),e.TgZ(4,"div",4),e._UZ(5,"app-canvas",null,5),e.qZA(),e.TgZ(7,"div",3),e.NdJ("mousedown",function(r){return n.onRightDown(r)}),e.qZA(),e.TgZ(8,"app-property",6),e.NdJ("onPageChange",function(r){return n.handlePageChange(r)}),e.qZA()()),2&t){const o=e.MAs(6);e.Q6J("graph",o.graph)("project",n.project)("scale",n.scale),e.xp6(2),e.Udp("width",n.leftWidth+"px"),e.xp6(3),e.Udp("width",n.project.width*n.scale+"px")("height",n.project.height*n.scale+"px"),e.xp6(3),e.Udp("width",n.rightWidth+"px"),e.Q6J("graph",o.graph)("project",n.project)}},dependencies:[m,Ue,Kn,si],styles:["[_nghost-%COMP%]{height:100%;min-width:600px;overflow:hidden;display:flex;flex-direction:column;letter-spacing:.1em;font-size:12px}.body[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}.body[_ngcontent-%COMP%]   .splitter[_ngcontent-%COMP%]{width:8px;background-color:#c9c9c9;cursor:col-resize}.body[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;height:100%;position:relative;padding:10px;background-color:#f0f0f0;overflow:auto}"]}),s})();const ri=[{path:"",component:_e},{path:":id",component:_e}];let ai=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[ct.Bz.forChild(ri),ct.Bz]}),s})();var Y=b(1218),li=b(8284),ci=b(6903),Se=(b(5469),b(1281),b(727),b(6406),b(3101),b(9646),b(3601),b(8675),b(590),b(9300),b(1005),b(2540)),bi=(b(1519),b(9643)),zi=b(3353);b(8932),new e.OlP("NZ_TAB_SET");let Ki=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[_t.vT,N.ez,bi.Q8,Z.PV,mt.T,zi.ud,Rt.rt,Se.ZD,yt.b1]}),s})();var ts=b(8213),es=b(9166),ns=b(6672);let is=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[{provide:dt.dD},ut.m],imports:[N.ez,z.u5,z.UX,ai,Z.PV.forChild([Y.qgH,Y.n0m,Y.CnB,Y.ctN,Y.KrS,Y.x0x,Y.BXO,Y.vkb,Y.MjI,Y.NvA,Y.J1v,Y.TSL,Y.HIu,Y.lKn,Y.Xwh,Y.fhO,Y.FsU,Y.vEg,Y.zuz,Y.DxT]),ze.S,tt.sL,re.e4,it.U5,nt.o7,zt.Qp,li.wm,ci.zf,Ki,ts.Wr,es.Y,Ft.LV,cn,be.k,ns.X,zn,yt.b1]}),s})()},7521:(It,kt,b)=>{var N;!function(ct,Et,e){if(ct){for(var Z,ht={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},At={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},dt={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},ut={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},tt=1;tt<20;++tt)ht[111+tt]="f"+tt;for(tt=0;tt<=9;++tt)ht[tt+96]=tt.toString();j.prototype.bind=function(f,m,l){var B=this;return B._bindMultiple.call(B,f=f instanceof Array?f:[f],m,l),B},j.prototype.unbind=function(f,m){return this.bind.call(this,f,function(){},m)},j.prototype.trigger=function(f,m){var l=this;return l._directMap[f+":"+m]&&l._directMap[f+":"+m]({},f),l},j.prototype.reset=function(){var f=this;return f._callbacks={},f._directMap={},f},j.prototype.stopCallback=function(f,m){if((" "+m.className+" ").indexOf(" mousetrap ")>-1||Lt(m,this.target))return!1;if("composedPath"in f&&"function"==typeof f.composedPath){var B=f.composedPath()[0];B!==f.target&&(m=B)}return"INPUT"==m.tagName||"SELECT"==m.tagName||"TEXTAREA"==m.tagName||m.isContentEditable},j.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},j.addKeycodes=function(f){for(var m in f)f.hasOwnProperty(m)&&(ht[m]=f[m]);Z=null},j.init=function(){var f=j(Et);for(var m in f)"_"!==m.charAt(0)&&(j[m]=function(l){return function(){return f[l].apply(f,arguments)}}(m))},j.init(),ct.Mousetrap=j,It.exports&&(It.exports=j),void 0!==(N=function(){return j}.call(kt,b,kt,It))&&(It.exports=N)}function rt(f,m,l){f.addEventListener?f.addEventListener(m,l,!1):f.attachEvent("on"+m,l)}function ft(f){if("keypress"==f.type){var m=String.fromCharCode(f.which);return f.shiftKey||(m=m.toLowerCase()),m}return ht[f.which]?ht[f.which]:At[f.which]?At[f.which]:String.fromCharCode(f.which).toLowerCase()}function nt(f,m){return f.sort().join(",")===m.sort().join(",")}function vt(f){return"shift"==f||"ctrl"==f||"alt"==f||"meta"==f}function ne(f,m,l){return l||(l=function ee(){if(!Z)for(var f in Z={},ht)f>95&&f<112||ht.hasOwnProperty(f)&&(Z[ht[f]]=f);return Z}()[f]?"keydown":"keypress"),"keypress"==l&&m.length&&(l="keydown"),l}function Jt(f,m){var l,B,at,O=[];for(l=function ie(f){return"+"===f?["+"]:(f=f.replace(/\+{2}/g,"+plus")).split("+")}(f),at=0;at<l.length;++at)ut[B=l[at]]&&(B=ut[B]),m&&"keypress"!=m&&dt[B]&&(B=dt[B],O.push("shift")),vt(B)&&O.push(B);return{key:B,modifiers:O,action:m=ne(B,O,m)}}function Lt(f,m){return null!==f&&f!==Et&&(f===m||Lt(f.parentNode,m))}function j(f){var m=this;if(f=f||Et,!(m instanceof j))return new j(f);m.target=f,m._callbacks={},m._directMap={};var B,l={},at=!1,O=!1,Mt=!1;function Ot(S){S=S||{};var A,E=!1;for(A in l)S[A]?E=!0:l[A]=0;E||(Mt=!1)}function pt(S,E,A,k,D,st){var M,H,gt=[],K=A.type;if(!m._callbacks[S])return[];for("keyup"==K&&vt(S)&&(E=[S]),M=0;M<m._callbacks[S].length;++M)H=m._callbacks[S][M],!k&&H.seq&&l[H.seq]!=H.level||K!=H.action||("keypress"!=K||A.metaKey||A.ctrlKey)&&!nt(E,H.modifiers)||((!k&&H.combo==D||k&&H.seq==k&&H.level==st)&&m._callbacks[S].splice(M,1),gt.push(H));return gt}function Pt(S,E,A,k){m.stopCallback(E,E.target||E.srcElement,A,k)||!1===S(E,A)&&(function Kt(f){f.preventDefault?f.preventDefault():f.returnValue=!1}(E),function te(f){f.stopPropagation?f.stopPropagation():f.cancelBubble=!0}(E))}function Dt(S){"number"!=typeof S.which&&(S.which=S.keyCode);var E=ft(S);if(E){if("keyup"==S.type&&at===E)return void(at=!1);m.handleKey(E,function qt(f){var m=[];return f.shiftKey&&m.push("shift"),f.altKey&&m.push("alt"),f.ctrlKey&&m.push("ctrl"),f.metaKey&&m.push("meta"),m}(S),S)}}function Ut(S,E,A,k,D){m._directMap[S+":"+A]=E;var M,st=(S=S.replace(/\s+/g," ")).split(" ");st.length>1?function se(S,E,A,k){function D(K){return function(){Mt=K,++l[S],function Gt(){clearTimeout(B),B=setTimeout(Ot,1e3)}()}}function st(K){Pt(A,K,S),"keyup"!==k&&(at=ft(K)),setTimeout(Ot,10)}l[S]=0;for(var M=0;M<E.length;++M){var gt=M+1===E.length?st:D(k||Jt(E[M+1]).action);Ut(E[M],gt,k,S,M)}}(S,st,E,A):(M=Jt(S,A),m._callbacks[M.key]=m._callbacks[M.key]||[],pt(M.key,M.modifiers,{type:M.action},k,S,D),m._callbacks[M.key][k?"unshift":"push"]({callback:E,modifiers:M.modifiers,action:M.action,seq:k,level:D,combo:S}))}m._handleKey=function(S,E,A){var D,k=pt(S,E,A),st={},M=0,H=!1;for(D=0;D<k.length;++D)k[D].seq&&(M=Math.max(M,k[D].level));for(D=0;D<k.length;++D)if(k[D].seq){if(k[D].level!=M)continue;H=!0,st[k[D].seq]=1,Pt(k[D].callback,A,k[D].combo,k[D].seq)}else H||Pt(k[D].callback,A,k[D].combo);var gt="keypress"==A.type&&O;A.type==Mt&&!vt(S)&&!gt&&Ot(st),O=H&&"keydown"==A.type},m._bindMultiple=function(S,E,A){for(var k=0;k<S.length;++k)Ut(S[k],E,A)},rt(f,"keypress",Dt),rt(f,"keydown",Dt),rt(f,"keyup",Dt)}}(typeof window<"u"?window:null,typeof window<"u"?document:null)}}]);