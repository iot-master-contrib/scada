(self.webpackChunkscada=self.webpackChunkscada||[]).push([[153],{7153:(It,kt,b)=>{"use strict";b.r(kt),b.d(kt,{EditorModule:()=>ao});var w=b(6895),lt=b(4575),e=b(4650),ct=b(1481),_t=b(1445),ht=b(9651),ut=b(5582),Z=b(1102),et=b(6616),dt=b(7044),yt=b(1664),nt=b(5635);const $t=[[["","more",""]],"*"],Xt=function(o){return{close:o}},qt=["[more]","*"];let xt=(()=>{class o{constructor(){this.open=!0,this.title="\u6807\u9898"}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-collapse"]],inputs:{open:"open",title:"title"},ngContentSelectors:qt,decls:9,vars:5,consts:[[1,"header",3,"click"],["nz-icon","","nzType","caret-right","nzTheme","outline",3,"nzRotate"],[1,"title"],[1,"content",3,"ngClass"],[1,"inner"]],template:function(t,i){1&t&&(e.F$t($t),e.TgZ(0,"div",0),e.NdJ("click",function(){return i.open=!i.open}),e._UZ(1,"span",1),e.TgZ(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"span"),e.Hsn(5),e.qZA()(),e.TgZ(6,"div",3)(7,"div",4),e.Hsn(8,1),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("nzRotate",i.open?90:0),e.xp6(2),e.Oqu(i.title),e.xp6(3),e.Q6J("ngClass",e.VKq(3,Xt,!i.open)))},dependencies:[w.mk,Z.Ls,dt.w],styles:[".header[_ngcontent-%COMP%]{border-top:1px solid #a8a8a8;border-bottom:1px solid #a8a8a8;padding:4px;background-color:#f0f0f0;cursor:pointer;font-weight:700;font-size:1.1em;-webkit-user-select:none;user-select:none;align-items:center;display:flex}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1}.content[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{padding:4px}.content.close[_ngcontent-%COMP%]{height:0;max-height:0;overflow:hidden}"]}),o})();var Kt=b(6273);function te(o,n){1&o&&e._UZ(0,"span",7)}function ee(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.more())}),e._uU(1,"\u66f4\u591a"),e.qZA()}}function Zt(o,n){if(1&o&&e._UZ(0,"img",14),2&o){const t=e.oxw().$implicit;e.Q6J("src",t.icon,e.LSH)("alt",t.name)}}function Jt(o,n){if(1&o&&(e._UZ(0,"div",15),e.ALo(1,"html")),2&o){const t=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,t.svg),e.oJD)}}function V(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",11),e.NdJ("dragstart",function(s){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onDragStart(s,a))}),e.YNc(1,Zt,1,2,"img",12),e.YNc(2,Jt,2,3,"div",13),e.qZA()}if(2&o){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",t.svg)}}function f(o,n){if(1&o&&(e.TgZ(0,"app-collapse",9),e.YNc(1,V,3,3,"div",10),e.qZA()),2&o){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(1),e.Q6J("ngForOf",t.components)}}let m=(()=>{class o{constructor(t){this.cs=t,this.onDrag=new e.vpe}onDragStart(t,i){console.log("drag",i.id),this.onDrag.emit({event:t,component:i})}handleClick(){}more(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ut.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-library"]],outputs:{onDrag:"onDrag"},decls:9,vars:3,consts:[[1,"header"],["nzSearch","",3,"nzSuffix","nzAddOnAfter"],["type","text","nz-input","","placeholder","\u63a7\u4ef6\u540d\u79f0"],["suffixIconSearch",""],["suffixIconButton",""],[1,"collections"],[3,"title",4,"ngFor","ngForOf"],["nz-icon","","nzType","search"],["nz-button","",3,"click"],[3,"title"],["class","item","draggable","true",3,"title","dragstart",4,"ngFor","ngForOf"],["draggable","true",1,"item",3,"title","dragstart"],[3,"src","alt",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[3,"src","alt"],[3,"innerHTML"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"nz-input-group",1),e._UZ(2,"input",2),e.qZA(),e.YNc(3,te,1,0,"ng-template",null,3,e.W1O),e.YNc(5,ee,2,0,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(7,"div",5),e.YNc(8,f,2,2,"app-collapse",6),e.qZA()),2&t){const s=e.MAs(4),r=e.MAs(6);e.xp6(1),e.Q6J("nzSuffix",s)("nzAddOnAfter",r),e.xp6(7),e.Q6J("ngForOf",i.cs.collections)}},dependencies:[w.sg,w.O5,Z.Ls,et.ix,dt.w,yt.dQ,nt.Zp,nt.gB,nt.ke,xt,Kt.$],styles:["[_nghost-%COMP%]{height:100%;width:200px;overflow:hidden;-webkit-user-select:none;user-select:none;border-right:1px solid #a8a8a8;position:relative;display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:5px}.collections[_ngcontent-%COMP%]{flex:1;overflow:auto}.more-btn[_ngcontent-%COMP%]{width:100%;text-align:center;position:absolute;bottom:0}.item[_ngcontent-%COMP%]{display:inline-block;text-align:center;padding:4px;cursor:pointer}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:30px;height:30px}.item[_ngcontent-%COMP%]     svg{width:30px;height:30px}"]}),o})();var O,o,E,l=b(760);class rt extends l.G7{get model(){return this.graph.model}get view(){return this.graph.renderer.findViewByCell(this.node)}get containerClassName(){return this.prefixClassName("widget-transform")}get resizeClassName(){return`${this.containerClassName}-resize`}get rotateClassName(){return`${this.containerClassName}-rotate`}constructor(n,t,i){super(),this.node=t,this.graph=i,this.options=Object.assign(Object.assign({},O.defaultOptions),n),this.render(),this.startListening()}startListening(){this.delegateEvents({[`mousedown .${this.resizeClassName}`]:"startResizing",[`touchstart .${this.resizeClassName}`]:"startResizing",[`mousedown .${this.rotateClassName}`]:"startRotating",[`touchstart .${this.rotateClassName}`]:"startRotating"}),this.model.on("*",this.update,this),this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this),this.node.on("removed",this.remove,this),this.model.on("reseted",this.remove,this),this.view.on("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.on("cell:knob:mouseup",this.onKnobMouseUp,this)}stopListening(){this.undelegateEvents(),this.model.off("*",this.update,this),this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this),this.node.off("removed",this.remove,this),this.model.off("reseted",this.remove,this),this.view.off("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.off("cell:knob:mouseup",this.onKnobMouseUp,this)}renderHandles(){this.container=document.createElement("div");const n=document.createElement("div");l.is.attr(n,"draggable","false");const t=n.cloneNode(!0);l.is.addClass(t,this.rotateClassName);const i=O.POSITIONS.map(s=>{const r=n.cloneNode(!0);return l.is.addClass(r,this.resizeClassName),l.is.attr(r,"data-position",s),r});this.empty(),l.is.append(this.container,[...i,t])}render(){return this.renderHandles(),this.view&&this.view.addClass(O.NODE_CLS),l.is.addClass(this.container,this.containerClassName),l.is.toggleClass(this.container,"no-orth-resize",this.options.preserveAspectRatio||!this.options.orthogonalResizing),l.is.toggleClass(this.container,"no-resize",!this.options.resizable),l.is.toggleClass(this.container,"no-rotate",!this.options.rotatable),this.options.className&&l.is.addClass(this.container,this.options.className),this.graph.container.appendChild(this.container),this.update()}update(){const n=this.graph.matrix(),t=this.node.getBBox();t.x*=n.a,t.x+=n.e,t.y*=n.d,t.y+=n.f,t.width*=n.a,t.height*=n.d;const i=l.RZ.normalize(this.node.getAngle());return l.is.css(this.container,{transform:0!==i?`rotate(${i}deg)`:"",width:t.width,height:t.height,left:t.x,top:t.y}),this.updateResizerDirections(),this}remove(){return this.view&&this.view.removeClass(O.NODE_CLS),super.remove()}onKnobMouseDown(){this.startHandle()}onKnobMouseUp(){this.stopHandle()}updateResizerDirections(){const n=l.RZ.normalize(this.node.getAngle()),t=Math.floor(n*(O.DIRECTIONS.length/360));if(t!==this.prevShift){const i=O.DIRECTIONS.slice(t).concat(O.DIRECTIONS.slice(0,t)),s=a=>`${this.containerClassName}-cursor-${a}`;this.container.querySelectorAll(`.${this.resizeClassName}`).forEach((a,c)=>{l.is.removeClass(a,O.DIRECTIONS.map(d=>s(d)).join(" ")),l.is.addClass(a,s(i[c]))}),this.prevShift=t}}getTrueDirection(n){const t=l.RZ.normalize(this.node.getAngle());let i=O.POSITIONS.indexOf(n);return i+=Math.floor(t*(O.POSITIONS.length/360)),i%=O.POSITIONS.length,O.POSITIONS[i]}toValidResizeDirection(n){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[n]||n}startResizing(n){n.stopPropagation(),this.model.startBatch("resize",{cid:this.cid});const t=l.is.attr(n.target,"data-position");this.prepareResizing(n,t),this.startAction(n)}prepareResizing(n,t){const i=this.getTrueDirection(t);let s=0,r=0;t.split("-").forEach(h=>{s={left:-1,right:1}[h]||s,r={top:-1,bottom:1}[h]||r});const a=this.toValidResizeDirection(t),c={"top-right":"bottomLeft","top-left":"bottomRight","bottom-left":"topRight","bottom-right":"topLeft"}[a],d=l.RZ.normalize(this.node.getAngle());this.setEventData(n,{selector:c,direction:a,trueDirection:i,relativeDirection:t,angle:d,resizeX:s,resizeY:r,action:"resizing"})}startRotating(n){n.stopPropagation(),this.model.startBatch("rotate",{cid:this.cid});const t=this.node.getBBox().getCenter(),i=this.normalizeEvent(n),s=this.graph.snapToGrid(i.clientX,i.clientY);this.setEventData(n,{center:t,action:"rotating",angle:l.RZ.normalize(this.node.getAngle()),start:l.E9.create(s).theta(t)}),this.startAction(n)}onMouseMove(n){const t=this.graph.findViewByCell(this.node);let i=this.getEventData(n);if(i.action){const s=this.normalizeEvent(n);let r=s.clientX,a=s.clientY;const c=this.graph.getPlugin("scroller"),d=this.options.restrictedResizing;if(!0===d||"number"==typeof d){const z=!0===d?0:d,N=c?Math.max(z,8):z,_=this.graph.container.getBoundingClientRect();r=l.GH.clamp(r,_.left+N,_.right-N),a=l.GH.clamp(a,_.top+N,_.bottom-N)}else this.options.autoScrollOnResizing&&c&&c.autoScroll(r,a);const h=this.graph.snapToGrid(r,a),p=this.graph.getGridSize(),u=this.node,g=this.options;if("resizing"===i.action){i.resized||(t&&(t.addClass("node-resizing"),this.notify("node:resize",n,t)),i.resized=!0);const z=u.getBBox(),N=l.E9.create(h).rotate(i.angle,z.getCenter()).diff(z[i.selector]);let _=i.resizeX?N.x*i.resizeX:z.width,y=i.resizeY?N.y*i.resizeY:z.height;const I=_,x=y;if(_=l.Z4.snapToGrid(_,p),y=l.Z4.snapToGrid(y,p),_=Math.max(_,g.minWidth||p),y=Math.max(y,g.minHeight||p),_=Math.min(_,g.maxWidth||1/0),y=Math.min(y,g.maxHeight||1/0),g.preserveAspectRatio){const v=z.width*y/z.height;_<v?y=z.height*_/z.width:_=v}const T=i.relativeDirection;if(g.allowReverse&&(I<=-_||x<=-y)){let v;"left"===T?I<=-_&&(v="right"):"right"===T?I<=-_&&(v="left"):"top"===T?x<=-y&&(v="bottom"):"bottom"===T?x<=-y&&(v="top"):"top-left"===T?I<=-_&&x<=-y?v="bottom-right":I<=-_?v="top-right":x<=-y&&(v="bottom-left"):"top-right"===T?I<=-_&&x<=-y?v="bottom-left":I<=-_?v="top-left":x<=-y&&(v="bottom-right"):"bottom-left"===T?I<=-_&&x<=-y?v="top-right":I<=-_?v="bottom-right":x<=-y&&(v="top-left"):"bottom-right"===T&&(I<=-_&&x<=-y?v="top-left":I<=-_?v="bottom-left":x<=-y&&(v="top-right"));const P=v;this.stopHandle();const J=this.container.querySelector(`.${this.resizeClassName}[data-position="${P}"]`);this.startHandle(J),this.prepareResizing(n,P),this.onMouseMove(n)}z.width===_&&z.height===y||(u.resize(_,y,{ui:!0,direction:i.direction,relativeDirection:i.relativeDirection,trueDirection:i.trueDirection,minWidth:g.minWidth,minHeight:g.minHeight,maxWidth:g.maxWidth,maxHeight:g.maxHeight,preserveAspectRatio:!0===g.preserveAspectRatio}),this.notify("node:resizing",n,t))}else if("rotating"===i.action){i.rotated||(t&&(t.addClass("node-rotating"),this.notify("node:rotate",n,t)),i.rotated=!0);const z=u.getAngle(),N=i.start-l.E9.create(h).theta(i.center);let _=i.angle+N;g.rotateGrid&&(_=l.Z4.snapToGrid(_,g.rotateGrid)),_=l.RZ.normalize(_),z!==_&&(u.rotate(_,{absolute:!0}),this.notify("node:rotating",n,t))}}}onMouseUp(n){const t=this.getEventData(n);t.action&&(this.stopAction(n),this.model.stopBatch("resizing"===t.action?"resize":"rotate",{cid:this.cid}))}startHandle(n){if(this.handle=n||null,l.is.addClass(this.container,`${this.containerClassName}-active`),n){l.is.addClass(n,`${this.containerClassName}-active-handle`);const t=n.getAttribute("data-position");if(t){const i=O.DIRECTIONS[O.POSITIONS.indexOf(t)];l.is.addClass(this.container,`${this.containerClassName}-cursor-${i}`)}}}stopHandle(){if(l.is.removeClass(this.container,`${this.containerClassName}-active`),this.handle){l.is.removeClass(this.handle,`${this.containerClassName}-active-handle`);const n=this.handle.getAttribute("data-position");if(n){const t=O.DIRECTIONS[O.POSITIONS.indexOf(n)];l.is.removeClass(this.container,`${this.containerClassName}-cursor-${t}`)}this.handle=null}}startAction(n){this.startHandle(n.target),this.graph.view.undelegateEvents(),this.delegateDocumentEvents(O.documentEvents,n.data)}stopAction(n){this.stopHandle(),this.undelegateDocumentEvents(),this.graph.view.delegateEvents();const t=this.graph.findViewByCell(this.node),i=this.getEventData(n);t&&(t.removeClass(`node-${i.action}`),"resizing"===i.action&&i.resized?this.notify("node:resized",n,t):"rotating"===i.action&&i.rotated&&this.notify("node:rotated",n,t))}notify(n,t,i,s={}){if(i){const r=i.graph,a=r.view.normalizeEvent(t),c=r.snapToGrid(a.clientX,a.clientY);this.trigger(n,Object.assign({e:a,view:i,node:i.cell,cell:i.cell,x:c.x,y:c.y},s))}}dispose(){this.remove(),this.off()}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],rt.prototype,"dispose",null),(o=O||(O={})).NODE_CLS="has-widget-transform",o.DIRECTIONS=["nw","n","ne","e","se","s","sw","w"],o.POSITIONS=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],o.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp"},o.defaultOptions={minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,rotateGrid:15,rotatable:!0,preserveAspectRatio:!1,orthogonalResizing:!0,restrictedResizing:!1,autoScrollOnResizing:!0,allowReverse:!0},l.kJ.prototype.createTransformWidget=function(o){const n=this.getPlugin("transform");return n&&n.createWidget(o),this},l.kJ.prototype.clearTransformWidgets=function(){const o=this.getPlugin("transform");return o&&o.clearWidgets(),this};class pt extends l.ew{constructor(n={}){super(),this.name="transform",this.widgets=new Map,this.disabled=!1,this.options=n,l.mf.ensure(this.name,".x6-widget-transform {\n  position: absolute;\n  box-sizing: content-box !important;\n  margin: -5px 0 0 -5px;\n  padding: 4px;\n  border: 1px dashed #000;\n  border-radius: 5px;\n  user-select: none;\n  pointer-events: none;\n}\n.x6-widget-transform > div {\n  position: absolute;\n  box-sizing: border-box;\n  background-color: #fff;\n  border: 1px solid #000;\n  transition: background-color 0.2s;\n  pointer-events: auto;\n  -webkit-user-drag: none;\n  user-drag: none;\n  /* stylelint-disable-line */\n}\n.x6-widget-transform > div:hover {\n  background-color: #d3d3d3;\n}\n.x6-widget-transform-cursor-n {\n  cursor: n-resize;\n}\n.x6-widget-transform-cursor-s {\n  cursor: s-resize;\n}\n.x6-widget-transform-cursor-e {\n  cursor: e-resize;\n}\n.x6-widget-transform-cursor-w {\n  cursor: w-resize;\n}\n.x6-widget-transform-cursor-ne {\n  cursor: ne-resize;\n}\n.x6-widget-transform-cursor-nw {\n  cursor: nw-resize;\n}\n.x6-widget-transform-cursor-se {\n  cursor: se-resize;\n}\n.x6-widget-transform-cursor-sw {\n  cursor: sw-resize;\n}\n.x6-widget-transform-resize {\n  width: 10px;\n  height: 10px;\n  border-radius: 6px;\n}\n.x6-widget-transform-resize[data-position='top-left'] {\n  top: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='top-right'] {\n  top: -5px;\n  right: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-left'] {\n  bottom: -5px;\n  left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom-right'] {\n  right: -5px;\n  bottom: -5px;\n}\n.x6-widget-transform-resize[data-position='top'] {\n  top: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='bottom'] {\n  bottom: -5px;\n  left: 50%;\n  margin-left: -5px;\n}\n.x6-widget-transform-resize[data-position='left'] {\n  top: 50%;\n  left: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform-resize[data-position='right'] {\n  top: 50%;\n  right: -5px;\n  margin-top: -5px;\n}\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='top'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='right'] {\n  display: none;\n}\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='bottom'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='left'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='right'],\n.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='top'] {\n  display: none;\n}\n.x6-widget-transform.no-resize .x6-widget-transform-resize {\n  display: none;\n}\n.x6-widget-transform-rotate {\n  top: -20px;\n  left: -20px;\n  width: 12px;\n  height: 12px;\n  border-radius: 6px;\n  cursor: crosshair;\n}\n.x6-widget-transform.no-rotate .x6-widget-transform-rotate {\n  display: none;\n}\n.x6-widget-transform-active {\n  border-color: transparent;\n  pointer-events: all;\n}\n.x6-widget-transform-active > div {\n  display: none;\n}\n.x6-widget-transform-active > .x6-widget-transform-active-handle {\n  display: block;\n  background-color: #808080;\n}\n")}init(n){this.graph=n,!this.disabled&&this.startListening()}startListening(){this.graph.on("node:click",this.onNodeClick,this),this.graph.on("blank:mousedown",this.onBlankMouseDown,this)}stopListening(){this.graph.off("node:click",this.onNodeClick,this),this.graph.off("blank:mousedown",this.onBlankMouseDown,this)}enable(){this.disabled&&(this.disabled=!1,this.startListening())}disable(){this.disabled||(this.disabled=!0,this.stopListening())}isEnabled(){return!this.disabled}createWidget(n){this.clearWidgets();const t=this.createTransform(n);t&&(this.widgets.set(n,t),t.on("*",(i,s)=>{this.trigger(i,s),this.graph.trigger(i,s)}))}onNodeClick({node:n}){this.createWidget(n)}onBlankMouseDown(){this.clearWidgets()}createTransform(n){const t=this.getTransformOptions(n);return t.resizable||t.rotatable?new rt(t,n,this.graph):null}getTransformOptions(n){this.options.resizing||(this.options.resizing={enabled:!1}),this.options.rotating||(this.options.rotating={enabled:!1}),"boolean"==typeof this.options.resizing&&(this.options.resizing={enabled:this.options.resizing}),"boolean"==typeof this.options.rotating&&(this.options.rotating={enabled:this.options.rotating});const t=pt.parseOptionGroup(this.graph,n,this.options.resizing),i=pt.parseOptionGroup(this.graph,n,this.options.rotating);return{resizable:!!t.enabled,minWidth:t.minWidth||0,maxWidth:t.maxWidth||Number.MAX_SAFE_INTEGER,minHeight:t.minHeight||0,maxHeight:t.maxHeight||Number.MAX_SAFE_INTEGER,orthogonalResizing:"boolean"!=typeof t.orthogonal||t.orthogonal,restrictedResizing:!!t.restrict,autoScrollOnResizing:"boolean"!=typeof t.autoScroll||t.autoScroll,preserveAspectRatio:!!t.preserveAspectRatio,allowReverse:"boolean"!=typeof t.allowReverse||t.allowReverse,rotatable:!!i.enabled,rotateGrid:i.grid||15}}clearWidgets(){this.widgets.forEach((n,t)=>{this.graph.getCellById(t.id)&&n.dispose()}),this.widgets.clear()}dispose(){this.clearWidgets(),this.stopListening(),this.off(),l.mf.clean(this.name)}}(function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)})([l.ew.dispose()],pt.prototype,"dispose",null),function(o){o.parseOptionGroup=function n(t,i,s){const r={};return Object.keys(s||{}).forEach(a=>{const c=s[a];r[a]="function"==typeof c?c.call(t,i):c}),r}}(pt||(pt={}));class Lt extends l.G7{get model(){return this.graph.model}get containerClassName(){return this.prefixClassName("widget-snapline")}get verticalClassName(){return`${this.containerClassName}-vertical`}get horizontalClassName(){return`${this.containerClassName}-horizontal`}constructor(n){super();const{graph:t}=n,i=function(o,n){var t={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&n.indexOf(i)<0&&(t[i]=o[i]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(t[i[s]]=o[i[s]])}return t}(n,["graph"]);this.graph=t,this.options=Object.assign({},i),this.offset={x:0,y:0},this.render(),this.disabled||this.startListening()}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.startListening())}disable(){this.disabled||(this.options.enabled=!1,this.stopListening())}setFilter(n){this.options.filter=n}render(){const n=this.containerWrapper=new l.OW("svg"),t=this.horizontal=new l.OW("line"),i=this.vertical=new l.OW("line");n.addClass(this.containerClassName),t.addClass(this.horizontalClassName),i.addClass(this.verticalClassName),n.setAttribute("width","100%"),n.setAttribute("height","100%"),t.setAttribute("display","none"),i.setAttribute("display","none"),n.append([t,i]),this.options.className&&n.addClass(this.options.className),this.container=this.containerWrapper.node}startListening(){this.stopListening(),this.graph.on("node:mousedown",this.captureCursorOffset,this),this.graph.on("node:mousemove",this.snapOnMoving,this),this.model.on("batch:stop",this.onBatchStop,this),this.delegateDocumentEvents({mouseup:"hide",touchend:"hide"})}stopListening(){this.graph.off("node:mousedown",this.captureCursorOffset,this),this.graph.off("node:mousemove",this.snapOnMoving,this),this.model.off("batch:stop",this.onBatchStop,this),this.undelegateDocumentEvents()}onBatchStop({name:n,data:t}){"resize"===n&&this.snapOnResizing(t.cell,t)}captureCursorOffset({view:n,x:t,y:i}){const s=n.getDelegatedView();if(s&&this.isNodeMovable(s)){const r=n.cell.getPosition();this.offset={x:t-r.x,y:i-r.y}}}isNodeMovable(n){return n&&n.cell.isNode()&&n.can("nodeMovable")}getRestrictArea(n){const t=this.graph.options.translating.restrict,i="function"==typeof t?l.Iw.call(t,this.graph,n):t;return"number"==typeof i?this.graph.transform.getGraphArea().inflate(i):!0===i?this.graph.transform.getGraphArea():i||null}snapOnResizing(n,t){if(this.options.resizing&&!t.snapped&&t.ui&&t.direction&&t.trueDirection){const i=this.graph.renderer.findViewByCell(n);if(i&&i.cell.isNode()){const s=n.getBBox(),r=s.bbox(n.getAngle()),a=r.getTopLeft(),c=r.getBottomRight(),d=l.RZ.normalize(n.getAngle()),h=this.options.tolerance||0;let p,u,g,z,N,_;const y={vertical:0,horizontal:0},I=t.direction,x=t.trueDirection,T=t.relativeDirection;y.vertical=-1!==x.indexOf("right")?c.x:a.x,y.horizontal=-1!==x.indexOf("bottom")?c.y:a.y,this.model.getNodes().some(F=>{if(this.isIgnored(n,F))return!1;const $=F.getBBox().bbox(F.getAngle()),Ct=$.getTopLeft(),Wt=$.getBottomRight(),Re={vertical:[Ct.x,Wt.x],horizontal:[Ct.y,Wt.y]},Ft={};return Object.keys(Re).forEach(lo=>{const de=lo,co=Re[de].map(Nt=>({position:Nt,distance:Math.abs(Nt-y[de])})).filter(Nt=>Nt.distance<=h);Ft[de]=l.RO.sortBy(co,Nt=>Nt.distance)}),null==p&&Ft.vertical.length>0&&(p=Ft.vertical[0].position,u=Math.min(r.y,$.y),g=Math.max(c.y,Wt.y)-u),null==z&&Ft.horizontal.length>0&&(z=Ft.horizontal[0].position,N=Math.min(r.x,$.x),_=Math.max(c.x,Wt.x)-N),null!=p&&null!=z}),this.hide();let v=0,P=0;(null!=z||null!=p)&&(null!=p&&(v=-1!==x.indexOf("right")?p-c.x:a.x-p),null!=z&&(P=-1!==x.indexOf("bottom")?z-c.y:a.y-z));let J=0,Q=0;if(d%90==0)90===d||270===d?(J=P,Q=v):(J=v,Q=P);else{const F=d>=0&&d<90?1:d>=90&&d<180?4:d>=180&&d<270?3:2;null!=z&&null!=p&&(v<P?(P=0,z=void 0):(v=0,p=void 0));const $=l.RZ.toRad(d%90);v&&(J=3===F?v/Math.cos($):v/Math.sin($)),P&&(Q=3===F?P/Math.cos($):P/Math.sin($));const Ct=1===F||3===F;switch(T){case"top":case"bottom":Q=P?P/(Ct?Math.cos($):Math.sin($)):v/(Ct?Math.sin($):Math.cos($));break;case"left":case"right":J=v?v/(Ct?Math.cos($):Math.sin($)):P/(Ct?Math.sin($):Math.cos($))}}switch(T){case"top":case"bottom":J=0;break;case"left":case"right":Q=0}const at=this.graph.getGridSize();let W=Math.max(s.width+J,at),q=Math.max(s.height+Q,at);t.minWidth&&t.minWidth>at&&(W=Math.max(W,t.minWidth)),t.minHeight&&t.minHeight>at&&(q=Math.max(q,t.minHeight)),t.maxWidth&&(W=Math.min(W,t.maxWidth)),t.maxHeight&&(q=Math.min(q,t.maxHeight)),t.preserveAspectRatio&&(Q<J?q=W*(s.height/s.width):W=q*(s.width/s.height)),(W!==s.width||q!==s.height)&&(n.resize(W,q,{direction:I,relativeDirection:T,trueDirection:x,snapped:!0,snaplines:this.cid,restrict:this.getRestrictArea(i)}),g&&(g+=q-s.height),_&&(_+=W-s.width));const Y=n.getBBox().bbox(d);p&&Math.abs(Y.x-p)>1&&Math.abs(Y.width+Y.x-p)>1&&(p=void 0),z&&Math.abs(Y.y-z)>1&&Math.abs(Y.height+Y.y-z)>1&&(z=void 0),this.update({verticalLeft:p,verticalTop:u,verticalHeight:g,horizontalTop:z,horizontalLeft:N,horizontalWidth:_})}}}snapOnMoving({view:n,e:t,x:i,y:s}){const r=n.getEventData(t).delegatedView||n;if(!this.isNodeMovable(r))return;const a=r.cell,c=a.getSize(),d=a.getPosition(),h=new l.Ae(i-this.offset.x,s-this.offset.y,c.width,c.height),p=a.getAngle(),u=h.getCenter(),g=h.bbox(p),z=g.getTopLeft(),N=g.getBottomRight(),_=this.options.tolerance||0;let y,I,x,T,v,P,J=0,Q=0;if(this.model.getNodes().some(at=>{if(this.isIgnored(a,at))return!1;const W=at.getBBox().bbox(at.getAngle()),q=W.getCenter(),Y=W.getTopLeft(),F=W.getBottomRight();return null==y&&(Math.abs(q.x-u.x)<_?(y=q.x,J=.5):Math.abs(Y.x-z.x)<_?(y=Y.x,J=0):Math.abs(Y.x-N.x)<_?(y=Y.x,J=1):Math.abs(F.x-N.x)<_?(y=F.x,J=1):Math.abs(F.x-z.x)<_&&(y=F.x),null!=y&&(I=Math.min(g.y,W.y),x=Math.max(N.y,F.y)-I)),null==T&&(Math.abs(q.y-u.y)<_?(T=q.y,Q=.5):Math.abs(Y.y-z.y)<_?T=Y.y:Math.abs(Y.y-N.y)<_?(T=Y.y,Q=1):Math.abs(F.y-N.y)<_?(T=F.y,Q=1):Math.abs(F.y-z.y)<_&&(T=F.y),null!=T&&(v=Math.min(g.x,W.x),P=Math.max(N.x,F.x)-v)),null!=y&&null!=T}),this.hide(),null!=T||null!=y){null!=T&&(g.y=T-Q*g.height),null!=y&&(g.x=y-J*g.width);const at=g.getCenter(),Y=at.x-h.width/2-d.x,F=at.y-h.height/2-d.y;(0!==Y||0!==F)&&(a.translate(Y,F,{snapped:!0,restrict:this.getRestrictArea(r)}),P&&(P+=Y),x&&(x+=F)),this.update({verticalLeft:y,verticalTop:I,verticalHeight:x,horizontalTop:T,horizontalLeft:v,horizontalWidth:P})}}isIgnored(n,t){return t.id===n.id||t.isDescendantOf(n)||!this.filter(t)}filter(n){const t=this.options.filter;return Array.isArray(t)?t.some(i=>"string"==typeof i?n.shape===i:n.id===i.id):"function"!=typeof t||l.Iw.call(t,this.graph,n)}update(n){if(n.horizontalTop){const t=this.graph.localToGraph(new l.E9(n.horizontalLeft,n.horizontalTop)),i=this.graph.localToGraph(new l.E9(n.horizontalLeft+n.horizontalWidth,n.horizontalTop));this.horizontal.setAttributes({x1:this.options.sharp?`${t.x}`:"0",y1:`${t.y}`,x2:this.options.sharp?`${i.x}`:"100%",y2:`${i.y}`,display:"inherit"})}else this.horizontal.setAttribute("display","none");if(n.verticalLeft){const t=this.graph.localToGraph(new l.E9(n.verticalLeft,n.verticalTop)),i=this.graph.localToGraph(new l.E9(n.verticalLeft,n.verticalTop+n.verticalHeight));this.vertical.setAttributes({x1:`${t.x}`,y1:this.options.sharp?`${t.y}`:"0",x2:`${i.x}`,y2:this.options.sharp?`${i.y}`:"100%",display:"inherit"})}else this.vertical.setAttribute("display","none");this.show()}resetTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}show(){return this.resetTimer(),null==this.container.parentNode&&this.graph.container.appendChild(this.container),this}hide(){this.resetTimer(),this.vertical.setAttribute("display","none"),this.horizontal.setAttribute("display","none");const n=this.options.clean,t="number"==typeof n?n:!1!==n?3e3:0;return t>0&&(this.timer=window.setTimeout(()=>{null!==this.container.parentNode&&this.unmount()},t)),this}onRemove(){this.stopListening(),this.hide()}dispose(){this.remove()}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],Lt.prototype,"dispose",null),l.kJ.prototype.isSnaplineEnabled=function(){const o=this.getPlugin("snapline");return!!o&&o.isEnabled()},l.kJ.prototype.enableSnapline=function(){const o=this.getPlugin("snapline");return o&&o.enable(),this},l.kJ.prototype.disableSnapline=function(){const o=this.getPlugin("snapline");return o&&o.disable(),this},l.kJ.prototype.toggleSnapline=function(){const o=this.getPlugin("snapline");return o&&o.toggleEnabled(),this},l.kJ.prototype.hideSnapline=function(){const o=this.getPlugin("snapline");return o&&o.hide(),this},l.kJ.prototype.setSnaplineFilter=function(o){const n=this.getPlugin("snapline");return n&&n.setFilter(o),this},l.kJ.prototype.isSnaplineOnResizingEnabled=function(){const o=this.getPlugin("snapline");return!!o&&o.isOnResizingEnabled()},l.kJ.prototype.enableSnaplineOnResizing=function(){const o=this.getPlugin("snapline");return o&&o.enableOnResizing(),this},l.kJ.prototype.disableSnaplineOnResizing=function(){const o=this.getPlugin("snapline");return o&&o.disableOnResizing(),this},l.kJ.prototype.toggleSnaplineOnResizing=function(o){const n=this.getPlugin("snapline");return n&&n.toggleOnResizing(o),this},l.kJ.prototype.isSharpSnapline=function(){const o=this.getPlugin("snapline");return!!o&&o.isSharp()},l.kJ.prototype.enableSharpSnapline=function(){const o=this.getPlugin("snapline");return o&&o.enableSharp(),this},l.kJ.prototype.disableSharpSnapline=function(){const o=this.getPlugin("snapline");return o&&o.disableSharp(),this},l.kJ.prototype.toggleSharpSnapline=function(o){const n=this.getPlugin("snapline");return n&&n.toggleSharp(o),this},l.kJ.prototype.getSnaplineTolerance=function(){const o=this.getPlugin("snapline");if(o)return o.getTolerance()},l.kJ.prototype.setSnaplineTolerance=function(o){const n=this.getPlugin("snapline");return n&&n.setTolerance(o),this};class S extends l.JT{constructor(n={}){super(),this.name="snapline",this.options=Object.assign({enabled:!0,tolerance:10},n),l.mf.ensure(this.name,".x6-widget-snapline {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  pointer-events: none;\n}\n.x6-widget-snapline-vertical,\n.x6-widget-snapline-horizontal {\n  stroke: #2ecc71;\n  stroke-width: 1px;\n}\n")}init(n){this.snaplineImpl=new Lt(Object.assign(Object.assign({},this.options),{graph:n}))}isEnabled(){return!this.snaplineImpl.disabled}enable(){this.snaplineImpl.enable()}disable(){this.snaplineImpl.disable()}toggleEnabled(n){if(null==n)return this.isEnabled()?this.disable():this.enable(),this;n!==this.isEnabled()&&(n?this.enable():this.disable())}hide(){return this.snaplineImpl.hide(),this}setFilter(n){return this.snaplineImpl.setFilter(n),this}isOnResizingEnabled(){return!0===this.snaplineImpl.options.resizing}enableOnResizing(){return this.snaplineImpl.options.resizing=!0,this}disableOnResizing(){return this.snaplineImpl.options.resizing=!1,this}toggleOnResizing(n){return null!=n?n!==this.isOnResizingEnabled()&&(n?this.enableOnResizing():this.disableOnResizing()):this.isOnResizingEnabled()?this.disableOnResizing():this.enableOnResizing(),this}isSharp(){return!0===this.snaplineImpl.options.sharp}enableSharp(){return this.snaplineImpl.options.sharp=!0,this}disableSharp(){return this.snaplineImpl.options.sharp=!1,this}toggleSharp(n){return null!=n?n!==this.isSharp()&&(n?this.enableSharp():this.disableSharp()):this.isSharp()?this.disableSharp():this.enableSharp(),this}getTolerance(){return this.snaplineImpl.options.tolerance}setTolerance(n){return this.snaplineImpl.options.tolerance=n,this}captureCursorOffset(n){this.snaplineImpl.captureCursorOffset(n)}snapOnMoving(n){this.snaplineImpl.snapOnMoving(n)}dispose(){this.snaplineImpl.dispose(),l.mf.clean(this.name)}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.JT.dispose()],S.prototype,"dispose",null);class M{constructor(){this.cells=[]}copy(n,t,i={}){this.options=Object.assign({},i);const r=(l.Hn.isModel(t)?t:t.model).cloneSubGraph(n,i);this.cells=l.RO.sortBy(Object.keys(r).map(a=>r[a]),a=>a.isEdge()?2:1),this.serialize(i)}cut(n,t,i={}){this.copy(n,t,i),(l.kJ.isGraph(t)?t.model:t).batchUpdate("cut",()=>{n.forEach(r=>r.remove())})}paste(n,t={}){const i=Object.assign(Object.assign({},this.options),t),{offset:s,edgeProps:r,nodeProps:a}=i;let c=20,d=20;s&&(c="number"==typeof s?s:s.dx,d="number"==typeof s?s:s.dy),this.deserialize(i);const h=this.cells;h.forEach(u=>{u.model=null,u.removeProp("zIndex"),(c||d)&&u.translate(c,d),a&&u.isNode()&&u.prop(a),r&&u.isEdge()&&u.prop(r)});const p=l.kJ.isGraph(n)?n.model:n;return p.batchUpdate("paste",()=>{p.addCells(this.cells)}),this.copy(h,n,t),h}serialize(n){!1!==n.useLocalStorage&&E.save(this.cells)}deserialize(n){if(n.useLocalStorage){const t=E.fetch();t&&(this.cells=t)}}isEmpty(n={}){return n.useLocalStorage&&this.deserialize(n),this.cells.length<=0}clean(){this.options={},this.cells=[],E.clean()}}(function(o){const n=`${l.De.prefixCls}.clipboard.cells`;o.save=function t(r){if(window.localStorage){const a=r.map(c=>c.toJSON());localStorage.setItem(n,JSON.stringify(a))}},o.fetch=function i(){if(window.localStorage){const r=localStorage.getItem(n),a=r?JSON.parse(r):[];if(a)return l.Hn.fromJSON(a)}},o.clean=function s(){window.localStorage&&localStorage.removeItem(n)}})(E||(E={})),l.kJ.prototype.isClipboardEnabled=function(){const o=this.getPlugin("clipboard");return!!o&&o.isEnabled()},l.kJ.prototype.enableClipboard=function(){const o=this.getPlugin("clipboard");return o&&o.enable(),this},l.kJ.prototype.disableClipboard=function(){const o=this.getPlugin("clipboard");return o&&o.disable(),this},l.kJ.prototype.toggleClipboard=function(o){const n=this.getPlugin("clipboard");return n&&n.toggleEnabled(o),this},l.kJ.prototype.isClipboardEmpty=function(o){const n=this.getPlugin("clipboard");return!n||n.isEmpty(o)},l.kJ.prototype.getCellsInClipboard=function(){const o=this.getPlugin("clipboard");return o?o.getCellsInClipboard():[]},l.kJ.prototype.cleanClipboard=function(){const o=this.getPlugin("clipboard");return o&&o.clean(),this},l.kJ.prototype.copy=function(o,n){const t=this.getPlugin("clipboard");return t&&t.copy(o,n),this},l.kJ.prototype.cut=function(o,n){const t=this.getPlugin("clipboard");return t&&t.cut(o,n),this},l.kJ.prototype.paste=function(o,n){const t=this.getPlugin("clipboard");return t?t.paste(o,n):[]};class ot extends l.ew{get disabled(){return!0!==this.options.enabled}get cells(){return this.clipboardImpl.cells}constructor(n={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},n)}init(n){this.graph=n,this.clipboardImpl=new M,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(n={}){return this.clipboardImpl.isEmpty(n)}getCellsInClipboard(){return this.cells}clean(n){return(!this.disabled||n)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(n,t={}){return this.disabled||(this.clipboardImpl.copy(n,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:n})),this}cut(n,t={}){return this.disabled||(this.clipboardImpl.cut(n,this.graph,Object.assign(Object.assign({},this.commonOptions),t)),this.notify("clipboard:changed",{cells:n})),this}paste(n={},t=this.graph){return this.disabled?[]:this.clipboardImpl.paste(t,Object.assign(Object.assign({},this.commonOptions),n))}get commonOptions(){return function(o,n){var t={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&n.indexOf(i)<0&&(t[i]=o[i]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(o);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(o,i[s])&&(t[i[s]]=o[i[s]])}return t}(this.options,["enabled"])}notify(n,t){this.trigger(n,t),this.graph.trigger(n,t)}dispose(){this.clean(!0),this.off()}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.ew.dispose()],ot.prototype,"dispose",null);var A=b(7521),U=b.n(A);class K extends l.JT{get graph(){return this.options.graph}constructor(n){super(),this.options=n;const t=this.graph.getPlugin("scroller");this.container=t?t.container:this.graph.container,n.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=K.createMousetrap(this)}get disabled(){return!0!==this.options.enabled}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(n,t,i){this.mousetrap.bind(this.getKeys(n),t,i)}off(n,t){this.mousetrap.unbind(this.getKeys(n),t)}clear(){this.mousetrap.reset()}trigger(n,t){this.mousetrap.trigger(n,t)}focus(n){this.isInputEvent(n.e)||this.target.focus({preventScroll:!0})}getKeys(n){return(Array.isArray(n)?n:[n]).map(t=>this.formatkey(t))}formatkey(n){const t=n.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command"),i=this.options.format;return i?l.Iw.call(i,this.graph,t):t}isGraphEvent(n){const t=n.target;return!!t&&(t===this.target||n.currentTarget===this.target||t===document.body||l.is.contains(this.container,t))}isInputEvent(n){var t;const i=n.target,s=null===(t=i?.tagName)||void 0===t?void 0:t.toLowerCase();let r=["input","textarea"].includes(s);return"true"===l.is.attr(i,"contenteditable")&&(r=!0),r}isEnabledForEvent(n){const t=!this.disabled&&this.isGraphEvent(n),i=this.isInputEvent(n);if(t){if(i&&("Backspace"===n.key||"Delete"===n.key))return!1;if(this.options.guard)return l.Iw.call(this.options.guard,this.graph,n)}return t}dispose(){this.mousetrap.reset()}}(function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)})([l.JT.dispose()],K.prototype,"dispose",null),function(o){o.createMousetrap=function n(t){const i=new(U())(t.target),s=i.stopCallback;return i.stopCallback=(r,a,c)=>!t.isEnabledForEvent(r)||!!s&&s.call(i,r,a,c),i}}(K||(K={})),l.kJ.prototype.isKeyboardEnabled=function(){const o=this.getPlugin("keyboard");return!!o&&o.isEnabled()},l.kJ.prototype.enableKeyboard=function(){const o=this.getPlugin("keyboard");return o&&o.enable(),this},l.kJ.prototype.disableKeyboard=function(){const o=this.getPlugin("keyboard");return o&&o.disable(),this},l.kJ.prototype.toggleKeyboard=function(o){const n=this.getPlugin("keyboard");return n&&n.toggleEnabled(o),this},l.kJ.prototype.bindKey=function(o,n,t){const i=this.getPlugin("keyboard");return i&&i.bindKey(o,n,t),this},l.kJ.prototype.unbindKey=function(o,n){const t=this.getPlugin("keyboard");return t&&t.unbindKey(o,n),this},l.kJ.prototype.clearKeys=function(){const o=this.getPlugin("keyboard");return o&&o.clear(),this},l.kJ.prototype.triggerKey=function(o,n){const t=this.getPlugin("keyboard");return t&&t.trigger(o,n),this};class jt extends l.JT{constructor(n={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},n)}init(n){this.keyboardImpl=new K(Object.assign(Object.assign({},this.options),{graph:n}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(n,t,i){return this.keyboardImpl.on(n,t,i),this}trigger(n,t){return this.keyboardImpl.trigger(n,t),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(n,t){return this.keyboardImpl.off(n,t),this}dispose(){this.keyboardImpl.dispose()}}(function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)})([l.JT.dispose()],jt.prototype,"dispose",null),l.kJ.prototype.isHistoryEnabled=function(){const o=this.getPlugin("history");return!!o&&o.isEnabled()},l.kJ.prototype.enableHistory=function(){const o=this.getPlugin("history");return o&&o.enable(),this},l.kJ.prototype.disableHistory=function(){const o=this.getPlugin("history");return o&&o.disable(),this},l.kJ.prototype.toggleHistory=function(o){const n=this.getPlugin("history");return n&&n.toggleEnabled(o),this},l.kJ.prototype.undo=function(o){const n=this.getPlugin("history");return n&&n.undo(o),this},l.kJ.prototype.redo=function(o){const n=this.getPlugin("history");return n&&n.redo(o),this},l.kJ.prototype.undoAndCancel=function(o){const n=this.getPlugin("history");return n&&n.cancel(o),this},l.kJ.prototype.canUndo=function(){const o=this.getPlugin("history");return!!o&&o.canUndo()},l.kJ.prototype.canRedo=function(){const o=this.getPlugin("history");return!!o&&o.canRedo()},l.kJ.prototype.cleanHistory=function(o){const n=this.getPlugin("history");return n&&n.clean(o),this},l.kJ.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()},l.kJ.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()},l.kJ.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()},l.kJ.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var R,tt,pe=function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);return s>3&&r&&Object.defineProperty(n,t,r),r};class vt extends l.ew{constructor(n={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:t=0}=n;this.stackSize=t,this.options=R.getOptions(n),this.validator=new vt.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(n){this.graph=n,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(n={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,n),this.redoStack.push(t),this.notify("undo",t,n))}return this}redo(n={}){if(!this.disabled){const t=this.redoStack.pop();t&&(this.applyCommand(t,n),this.undoStackPush(t),this.notify("redo",t,n))}return this}cancel(n={}){if(!this.disabled){const t=this.undoStack.pop();t&&(this.revertCommand(t,n),this.redoStack=[],this.notify("cancel",t,n))}return this}getSize(){return this.stackSize}getUndoRemainSize(){return this.stackSize-this.undoStack.length}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(n={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,n),this}get disabled(){return!0!==this.options.enabled}validate(n,...t){return this.validator.validate(n,...t),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((n,t)=>{this.handlers[t]=this.addCommand.bind(this,n),this.model.on(n,this.handlers[t])}),this.validator.on("invalid",n=>this.trigger("invalid",n))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((n,t)=>{this.model.off(n,this.handlers[t])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(n){return{batch:!!n&&n.batch,data:{}}}revertCommand(n,t){this.freezed=!0;const i=Array.isArray(n)?R.sortBatchCommands(n):[n];for(let s=i.length-1;s>=0;s-=1){const r=i[s],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.revertOptionsList||[]));this.executeCommand(r,!0,a)}this.freezed=!1}applyCommand(n,t){this.freezed=!0;const i=Array.isArray(n)?R.sortBatchCommands(n):[n];for(let s=0;s<i.length;s+=1){const r=i[s],a=Object.assign(Object.assign({},t),l.QK.pick(r.options,this.options.applyOptionsList||[]));this.executeCommand(r,!1,a)}this.freezed=!1}executeCommand(n,t,i){const s=this.model,r=s.getCell(n.data.id),a=n.event;if(R.isAddEvent(a)&&t||R.isRemoveEvent(a)&&!t)r&&r.remove(i);else if(R.isAddEvent(a)&&!t||R.isRemoveEvent(a)&&t){const c=n.data;c.node?s.addNode(c.props,i):c.edge&&s.addEdge(c.props,i)}else if(R.isChangeEvent(a)){const c=n.data,d=c.key;if(d&&r){const h=t?c.prev[d]:c.next[d];"attrs"===c.key&&this.ensureUndefinedAttrs(h,t?c.next[d]:c.prev[d]),r.prop(d,h,i)}}else{const c=this.options.executeCommand;c&&l.Iw.call(c,this,n,t,i)}}addCommand(n,t){if(this.freezed||this.disabled)return;const i=t,s=i.options||{};if(s.dryrun||R.isAddEvent(n)&&this.options.ignoreAdd||R.isRemoveEvent(n)&&this.options.ignoreRemove||R.isChangeEvent(n)&&this.options.ignoreChange)return;const r=this.options.beforeAddCommand;if(null!=r&&!1===l.Iw.call(r,this,n,t))return;"cell:change:*"===n&&(n=`cell:change:${i.key}`);const a=i.cell,c=l.Hn.isModel(a);let d;if(this.batchCommands){if(d=this.batchCommands[Math.max(this.lastBatchIndex,0)],this.lastBatchIndex>=0&&(c&&!d.modelChange||d.data.id!==a.id||d.event!==n)){const g=this.batchCommands.findIndex(z=>(c&&z.modelChange||z.data.id===a.id)&&z.event===n);g<0||R.isAddEvent(n)||R.isRemoveEvent(n)?d=this.createCommand({batch:!0}):(d=this.batchCommands[g],this.batchCommands.splice(g,1)),this.batchCommands.push(d),this.lastBatchIndex=this.batchCommands.length-1}}else d=this.createCommand({batch:!1});if(R.isAddEvent(n)||R.isRemoveEvent(n)){const p=d.data;return d.event=n,d.options=s,p.id=a.id,p.props=l.QK.cloneDeep(a.toJSON()),a.isEdge()?p.edge=!0:a.isNode()&&(p.node=!0),this.push(d,s)}if(R.isChangeEvent(n)){const p=t.key,u=d.data;return(!d.batch||!d.event)&&(d.event=n,d.options=s,u.key=p,null==u.prev&&(u.prev={}),u.prev[p]=l.QK.cloneDeep(a.previous(p)),c?d.modelChange=!0:u.id=a.id),null==u.next&&(u.next={}),u.next[p]=l.QK.cloneDeep(a.prop(p)),this.push(d,s)}const h=this.options.afterAddCommand;h&&l.Iw.call(h,this,n,t,d),this.push(d,s)}initBatchCommand(n){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(n){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const t=this.filterBatchCommand(this.batchCommands);t.length>0&&(this.redoStack=[],this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,n)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(n){let t=n.slice();const i=[];for(;t.length>0;){const s=t.shift(),r=s.event,a=s.data.id;if(null!=r&&(null!=a||s.modelChange)){if(R.isAddEvent(r)){const c=t.findIndex(d=>R.isRemoveEvent(d.event)&&d.data.id===a);if(c>=0){t=t.filter((d,h)=>c<h||d.data.id!==a);continue}}else if(R.isRemoveEvent(r)){const c=t.findIndex(d=>R.isAddEvent(d.event)&&d.data.id===a);if(c>=0){t.splice(c,1);continue}}else if(R.isChangeEvent(r)){const c=s.data;if(l.QK.isEqual(c.prev,c.next))continue}i.push(s)}}return i}notify(n,t,i){const s=null==t?null:Array.isArray(t)?t:[t];this.emit(n,{cmds:s,options:i}),this.graph.trigger(`history:${n}`,{cmds:s,options:i}),this.emit("change",{cmds:s,options:i}),this.graph.trigger("history:change",{cmds:s,options:i})}push(n,t){this.redoStack=[],n.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:n,options:t})):(this.undoStackPush(n),this.consolidateCommands(),this.notify("add",n,t))}consolidateCommands(){var n;const t=this.undoStack[this.undoStack.length-1],i=this.undoStack[this.undoStack.length-2];if(!Array.isArray(t))return;const s=new Set(t.map(a=>a.event));if(!(2===s.size&&s.has("cell:change:parent")&&s.has("cell:change:children")&&t.every(a=>{var c;return a.batch&&(null===(c=a.options)||void 0===c?void 0:c.ui)})&&Array.isArray(i)&&1===i.length))return;const r=i[0];"cell:change:position"!==r.event||null===(n=r.options)||void 0===n||!n.ui||(i.push(...t),this.undoStack.pop())}undoStackPush(n){0!==this.stackSize?(this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(n)):this.undoStack.push(n)}ensureUndefinedAttrs(n,t){null!==n&&null!==t&&"object"==typeof n&&"object"==typeof t&&Object.keys(t).forEach(i=>{n.hasOwnProperty(i)?"object"==typeof n[i]&&"object"==typeof t[i]&&this.ensureUndefinedAttrs(n[i],t[i]):n[i]=void 0})}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}pe([l.ew.dispose()],vt.prototype,"dispose",null),function(o){class n extends l.ew{constructor(i){super(),this.map={},this.command=i.history,this.cancelInvalid=!1!==i.cancelInvalid,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:i}){return Array.isArray(i)?i.every(s=>this.isValidCommand(s)):this.isValidCommand(i)}isValidCommand(i){if(i.options&&!1===i.options.validation)return!0;let r=null;return(i.event&&this.map[i.event]||[]).forEach(a=>{let c=0;const d=h=>{const p=a[c];c+=1;try{if(!p)return void(r=h);p(h,i,d)}catch(u){d(u)}};d(r)}),!r||(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:r}),!1)}validate(i,...s){const r=Array.isArray(i)?i:i.split(/\s+/);return s.forEach(a=>{if("function"!=typeof a)throw new Error(`${r.join(" ")} requires callback functions.`)}),r.forEach(a=>{null==this.map[a]&&(this.map[a]=[]),this.map[a].push(s)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}pe([l.ew.dispose()],n.prototype,"dispose",null),o.Validator=n}(vt||(vt={})),function(o){o.isAddEvent=function n(a){return"cell:added"===a},o.isRemoveEvent=function t(a){return"cell:removed"===a},o.isChangeEvent=function i(a){return null!=a&&a.startsWith("cell:change:")},o.getOptions=function s(a){const c=["cell:added","cell:removed","cell:change:*"],d=["batch:start","batch:stop"],h=a.eventNames?a.eventNames.filter(p=>!(o.isChangeEvent(p)||c.includes(p)||d.includes(p))):c;return Object.assign(Object.assign({enabled:!0},a),{eventNames:h,applyOptionsList:a.applyOptionsList||["propertyPath"],revertOptionsList:a.revertOptionsList||["propertyPath"]})},o.sortBatchCommands=function r(a){const c=[];for(let d=0,h=a.length;d<h;d+=1){const p=a[d];let u=null;if(o.isAddEvent(p.event)){const g=p.data.id;for(let z=0;z<d;z+=1)if(a[z].data.id===g){u=z;break}}null!==u?c.splice(u,0,p):c.push(p)}return c}}(R||(R={}));class he extends l.G7{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(tt.classNames.box)}get $boxes(){return l.is.children(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(n){super(),this.options=n,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new l.FE([],{comparator:tt.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const n=this.graph,t=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),n.on("scale",this.onGraphTransformed,this),n.on("translate",this.onGraphTransformed,this),n.model.on("updated",this.onModelUpdated,this),t.on("added",this.onCellAdded,this),t.on("removed",this.onCellRemoved,this),t.on("reseted",this.onReseted,this),t.on("updated",this.onCollectionUpdated,this),t.on("node:change:position",this.onNodePositionChanged,this),t.on("cell:changed",this.onCellChanged,this)}stopListening(){const n=this.graph,t=this.collection;this.undelegateEvents(),n.off("scale",this.onGraphTransformed,this),n.off("translate",this.onGraphTransformed,this),n.model.off("updated",this.onModelUpdated,this),t.off("added",this.onCellAdded,this),t.off("removed",this.onCellRemoved,this),t.off("reseted",this.onReseted,this),t.off("updated",this.onCollectionUpdated,this),t.off("node:change:position",this.onNodePositionChanged,this),t.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:n,options:t}){const{showNodeSelectionBox:i,pointerEvents:s}=this.options,{ui:r,selection:a,translateBy:c,snapped:d}=t;if(!(!0===i&&"none"!==s||this.translating||a)&&(r&&c&&n.id===c||d)){this.translating=!0;const u=n.position(),g=n.previous("position"),z=u.x-g.x,N=u.y-g.y;(0!==z||0!==N)&&this.translateSelectedNodes(z,N,n,t),this.translating=!1}}onModelUpdated({removed:n}){n&&n.length&&this.unselect(n)}isEmpty(){return this.length<=0}isSelected(n){return this.collection.has(n)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(n,t={}){t.dryrun=!0;const i=this.filter(Array.isArray(n)?n:[n]);return this.collection.add(i,t),this}unselect(n,t={}){return t.dryrun=!0,this.collection.remove(Array.isArray(n)?n:[n],t),this}reset(n,t={}){if(n){if(t.batch){const h=this.filter(Array.isArray(n)?n:[n]);return this.collection.reset(h,Object.assign(Object.assign({},t),{ui:!0})),this}const i=this.cells,s=this.filter(Array.isArray(n)?n:[n]),r={},a={};i.forEach(h=>r[h.id]=h),s.forEach(h=>a[h.id]=h);const c=[],d=[];return s.forEach(h=>{r[h.id]||c.push(h)}),i.forEach(h=>{a[h.id]||d.push(h)}),d.length&&this.unselect(d,Object.assign(Object.assign({},t),{ui:!0})),c.length&&this.select(c,Object.assign(Object.assign({},t),{ui:!0})),0===d.length&&0===c.length&&this.updateContainer(),this}return this.clean(t)}clean(n={}){return this.length&&(!1===n.batch?this.unselect(this.cells,n):this.collection.reset([],Object.assign(Object.assign({},n),{ui:!0}))),this}setFilter(n){this.options.filter=n}setContent(n){this.options.content=n}startSelecting(n){let t,i;n=this.normalizeEvent(n),this.clean();const s=this.graph.container;if(null!=n.offsetX&&null!=n.offsetY&&s.contains(n.target))t=n.offsetX,i=n.offsetY;else{const r=l.is.offset(s);t=n.clientX-r.left+window.pageXOffset+s.scrollLeft,i=n.clientY-r.top+window.pageYOffset+s.scrollTop}l.is.css(this.container,{top:i,left:t,width:1,height:1}),this.setEventData(n,{action:"selecting",clientX:n.clientX,clientY:n.clientY,offsetX:t,offsetY:i,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(tt.documentEvents,n.data)}filter(n){const t=this.options.filter;return n.filter(i=>Array.isArray(t)?t.some(s=>"string"==typeof s?i.shape===s:i.id===s.id):"function"!=typeof t||l.Iw.call(t,this.graph,i))}stopSelecting(n){const t=this.graph,i=this.getEventData(n);switch(i.action){case"selecting":{let r=l.is.width(this.container),a=l.is.height(this.container);const c=l.is.offset(this.container),d=t.pageToLocal(c.left,c.top),h=t.transform.getScale();r/=h.sx,a/=h.sy;const p=new l.Ae(d.x,d.y,r,a),u=this.getCellViewsInArea(p).map(g=>g.cell);this.reset(u,{batch:!0}),this.hideRubberband();break}case"translating":{const r=t.snapToGrid(n.clientX,n.clientY);this.options.following||this.updateSelectedNodesPosition({dx:i.clientX-i.originX,dy:i.clientY-i.originY}),this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",n,r.x,r.y);break}default:this.clean()}}onMouseUp(n){this.getEventData(n).action&&(this.stopSelecting(n),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(n){this.options.following||n.stopPropagation();const t=this.normalizeEvent(n);this.options.movable&&this.startTranslating(t);const i=this.getCellViewFromElem(t.target);this.setEventData(t,{activeView:i});const s=this.graph.snapToGrid(t.clientX,t.clientY);this.notifyBoxEvent("box:mousedown",t,s.x,s.y),this.delegateDocumentEvents(tt.documentEvents,t.data)}startTranslating(n){this.graph.model.startBatch("move-selection");const t=this.graph.snapToGrid(n.clientX,n.clientY);this.setEventData(n,{action:"translating",clientX:t.x,clientY:t.y,originX:t.x,originY:t.y})}getRestrictArea(){const n=this.graph.options.translating.restrict,t="function"==typeof n?l.Iw.call(n,this.graph,null):n;return"number"==typeof t?this.graph.transform.getGraphArea().inflate(t):!0===t?this.graph.transform.getGraphArea():t||null}getSelectionOffset(n,t){let i=n.x-t.clientX,s=n.y-t.clientY;const r=this.getRestrictArea();if(r){const a=this.collection.toArray(),c=l.bL.getCellsBBox(a,{deep:!0})||l.Ae.create(),d=r.x-c.x,h=r.y-c.y,p=r.x+r.width-(c.x+c.width),u=r.y+r.height-(c.y+c.height);if(i<d&&(i=d),s<h&&(s=h),p<i&&(i=p),u<s&&(s=u),!this.options.following){const g=n.x-t.originX,z=n.y-t.originY;i=g<=d||g>=p?0:i,s=z<=h||z>=u?0:s}}return{dx:i,dy:s}}updateElementPosition(n,t,i){const s=l.is.css(n,"left"),r=l.is.css(n,"top"),a=s?parseFloat(s):0,c=r?parseFloat(r):0;l.is.css(n,"left",a+t),l.is.css(n,"top",c+i)}updateSelectedNodesPosition(n){const{dx:t,dy:i}=n;if(t||i)if(this.translateSelectedNodes(t,i),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const s=this.graph.transform.getScale();for(let r=0,a=this.$boxes.length;r<a;r+=1)this.updateElementPosition(this.$boxes[r],t*s.sx,i*s.sy);this.updateElementPosition(this.selectionContainer,t*s.sx,i*s.sy)}}autoScrollGraph(n,t){const i=this.graph.getPlugin("scroller");return i?i.autoScroll(n,t):{scrollerX:0,scrollerY:0}}adjustSelection(n){const t=this.normalizeEvent(n),i=this.getEventData(t);switch(i.action){case"selecting":{const r=i;!0!==r.moving&&(l.is.appendTo(this.container,this.graph.container),this.showRubberband(),r.moving=!0);const{scrollerX:a,scrollerY:c}=this.autoScrollGraph(t.clientX,t.clientY);r.scrollerX+=a,r.scrollerY+=c;const d=t.clientX-r.clientX+r.scrollerX,h=t.clientY-r.clientY+r.scrollerY,p=parseInt(l.is.css(this.container,"left")||"0",10),u=parseInt(l.is.css(this.container,"top")||"0",10);l.is.css(this.container,{left:d<0?r.offsetX+d:p,top:h<0?r.offsetY+h:u,width:Math.abs(d),height:Math.abs(h)});break}case"translating":{const r=this.graph.snapToGrid(t.clientX,t.clientY),a=i,c=this.getSelectionOffset(r,a);this.options.following?this.updateSelectedNodesPosition(c):this.updateContainerPosition(c),c.dx&&(a.clientX=r.x),c.dy&&(a.clientY=r.y),this.notifyBoxEvent("box:mousemove",n,r.x,r.y);break}}this.boxesUpdated=!1}translateSelectedNodes(n,t,i,s){const r={},a=[];if(i&&(r[i.id]=!0),this.collection.toArray().forEach(c=>{c.getDescendants({deep:!0}).forEach(d=>{r[d.id]=!0})}),s&&s.translateBy){const c=this.graph.getCellById(s.translateBy);c&&(r[c.id]=!0,c.getDescendants({deep:!0}).forEach(d=>{r[d.id]=!0}),a.push(c))}this.collection.toArray().forEach(c=>{if(!r[c.id]){const d=Object.assign(Object.assign({},s),{selection:this.cid,exclude:a});c.translate(n,t,d),this.graph.model.getConnectedEdges(c).forEach(h=>{r[h.id]||(h.translate(n,t,d),r[h.id]=!0)})}})}getCellViewsInArea(n){const t=this.graph,i={strict:this.options.strict};let s=[];return this.options.rubberNode&&(s=s.concat(t.model.getNodesInArea(n,i).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),this.options.rubberEdge&&(s=s.concat(t.model.getEdgesInArea(n,i).map(r=>t.renderer.findViewByCell(r)).filter(r=>null!=r))),s}notifyBoxEvent(n,t,i,s){const a=this.getEventData(t).activeView;this.trigger(n,{e:t,view:a,x:i,y:s,cell:a.cell})}getSelectedClassName(n){return this.prefixClassName((n.isNode()?"node":"edge")+"-selected")}addCellSelectedClassName(n){const t=this.graph.renderer.findViewByCell(n);t&&t.addClass(this.getSelectedClassName(n))}removeCellUnSelectedClassName(n){const t=this.graph.renderer.findViewByCell(n);t&&t.removeClass(this.getSelectedClassName(n))}destroySelectionBox(n){this.removeCellUnSelectedClassName(n),this.canShowSelectionBox(n)&&(l.is.remove(this.container.querySelector(`[data-cell-id="${n.id}"]`)),0===this.$boxes.length&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(n){n.forEach(t=>this.removeCellUnSelectedClassName(t)),this.hide(),l.is.remove(this.$boxes),this.boxCount=0}hide(){l.is.removeClass(this.container,this.prefixClassName(tt.classNames.rubberband)),l.is.removeClass(this.container,this.prefixClassName(tt.classNames.selected))}showRubberband(){l.is.addClass(this.container,this.prefixClassName(tt.classNames.rubberband))}hideRubberband(){l.is.removeClass(this.container,this.prefixClassName(tt.classNames.rubberband))}showSelected(){l.is.removeAttribute(this.container,"style"),l.is.addClass(this.container,this.prefixClassName(tt.classNames.selected))}createContainer(){this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName(tt.classNames.root)),this.options.className&&l.is.addClass(this.container,this.options.className),this.selectionContainer=document.createElement("div"),l.is.addClass(this.selectionContainer,this.prefixClassName(tt.classNames.inner)),this.selectionContent=document.createElement("div"),l.is.addClass(this.selectionContent,this.prefixClassName(tt.classNames.content)),l.is.append(this.selectionContainer,this.selectionContent),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length),l.is.prepend(this.container,this.selectionContainer)}updateContainerPosition(n){(n.dx||n.dy)&&this.updateElementPosition(this.selectionContainer,n.dx,n.dy)}updateContainer(){const n={x:1/0,y:1/0},t={x:0,y:0};this.collection.toArray().filter(r=>this.canShowSelectionBox(r)).forEach(r=>{const a=this.graph.renderer.findViewByCell(r);if(a){const c=a.getBBox({useCellGeometry:!0});n.x=Math.min(n.x,c.x),n.y=Math.min(n.y,c.y),t.x=Math.max(t.x,c.x+c.width),t.y=Math.max(t.y,c.y+c.height)}}),l.is.css(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:n.x,top:n.y,width:t.x-n.x,height:t.y-n.y}),l.is.attr(this.selectionContainer,"data-selection-length",this.collection.length);const s=this.options.content;if(s)if("function"==typeof s){const r=l.Iw.call(s,this.graph,this,this.selectionContent);r&&(this.selectionContent.innerHTML=r)}else this.selectionContent.innerHTML=s;this.collection.length>0&&!this.container.parentNode?l.is.appendTo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(n){return n.isNode()&&!0===this.options.showNodeSelectionBox||n.isEdge()&&!0===this.options.showEdgeSelectionBox}createSelectionBox(n){if(this.addCellSelectedClassName(n),this.canShowSelectionBox(n)){const t=this.graph.renderer.findViewByCell(n);if(t){const i=t.getBBox({useCellGeometry:!0}),s=this.boxClassName,r=document.createElement("div");l.is.addClass(r,s),l.is.addClass(r,`${s}-${n.isNode()?"node":"edge"}`),l.is.attr(r,"data-cell-id",n.id),l.is.css(r,{position:"absolute",left:i.x,top:i.y,width:i.width,height:i.height,pointerEvents:this.options.pointerEvents||"auto"}),l.is.appendTo(r,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let n=0,t=this.$boxes.length;n<t;n+=1){const i=this.$boxes[n],s=l.is.attr(i,"data-cell-id");l.is.remove(i);const r=this.collection.get(s);r&&this.createSelectionBox(r)}this.updateContainer()}return 0}getCellViewFromElem(n){const t=n.getAttribute("data-cell-id");if(t){const i=this.collection.get(t);if(i)return this.graph.renderer.findViewByCell(i)}return null}onCellRemoved({cell:n}){this.destroySelectionBox(n),this.updateContainer()}onReseted({previous:n,current:t}){this.destroyAllSelectionBoxes(n),t.forEach(i=>{this.listenCellRemoveEvent(i),this.createSelectionBox(i)}),this.updateContainer()}onCellAdded({cell:n}){this.listenCellRemoveEvent(n),this.createSelectionBox(n),this.updateContainer()}listenCellRemoveEvent(n){n.off("removed",this.onCellRemoved,this),n.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:n,removed:t,options:i}){n.forEach(r=>{this.trigger("cell:selected",{cell:r,options:i}),r.isNode()?this.trigger("node:selected",{cell:r,options:i,node:r}):r.isEdge()&&this.trigger("edge:selected",{cell:r,options:i,edge:r})}),t.forEach(r=>{this.trigger("cell:unselected",{cell:r,options:i}),r.isNode()?this.trigger("node:unselected",{cell:r,options:i,node:r}):r.isEdge()&&this.trigger("edge:unselected",{cell:r,options:i,edge:r})});const s={added:n,removed:t,options:i,selected:this.cells.filter(r=>!!this.graph.getCellById(r.id))};this.trigger("selection:changed",s)}dispose(){this.clean(),this.remove(),this.off()}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.G7.dispose()],he.prototype,"dispose",null),function(o){const n="widget-selection";o.classNames={root:n,inner:`${n}-inner`,box:`${n}-box`,content:`${n}-content`,rubberband:`${n}-rubberband`,selected:`${n}-selected`},o.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},o.depthComparator=function t(i){return i.getAncestors().length}}(tt||(tt={})),l.kJ.prototype.isSelectionEnabled=function(){const o=this.getPlugin("selection");return!!o&&o.isEnabled()},l.kJ.prototype.enableSelection=function(){const o=this.getPlugin("selection");return o&&o.enable(),this},l.kJ.prototype.disableSelection=function(){const o=this.getPlugin("selection");return o&&o.disable(),this},l.kJ.prototype.toggleSelection=function(o){const n=this.getPlugin("selection");return n&&n.toggleEnabled(o),this},l.kJ.prototype.isMultipleSelection=function(){const o=this.getPlugin("selection");return!!o&&o.isMultipleSelection()},l.kJ.prototype.enableMultipleSelection=function(){const o=this.getPlugin("selection");return o&&o.enableMultipleSelection(),this},l.kJ.prototype.disableMultipleSelection=function(){const o=this.getPlugin("selection");return o&&o.disableMultipleSelection(),this},l.kJ.prototype.toggleMultipleSelection=function(o){const n=this.getPlugin("selection");return n&&n.toggleMultipleSelection(o),this},l.kJ.prototype.isSelectionMovable=function(){const o=this.getPlugin("selection");return!!o&&o.isSelectionMovable()},l.kJ.prototype.enableSelectionMovable=function(){const o=this.getPlugin("selection");return o&&o.enableSelectionMovable(),this},l.kJ.prototype.disableSelectionMovable=function(){const o=this.getPlugin("selection");return o&&o.disableSelectionMovable(),this},l.kJ.prototype.toggleSelectionMovable=function(o){const n=this.getPlugin("selection");return n&&n.toggleSelectionMovable(o),this},l.kJ.prototype.isRubberbandEnabled=function(){const o=this.getPlugin("selection");return!!o&&o.isRubberbandEnabled()},l.kJ.prototype.enableRubberband=function(){const o=this.getPlugin("selection");return o&&o.enableRubberband(),this},l.kJ.prototype.disableRubberband=function(){const o=this.getPlugin("selection");return o&&o.disableRubberband(),this},l.kJ.prototype.toggleRubberband=function(o){const n=this.getPlugin("selection");return n&&n.toggleRubberband(o),this},l.kJ.prototype.isStrictRubberband=function(){const o=this.getPlugin("selection");return!!o&&o.isStrictRubberband()},l.kJ.prototype.enableStrictRubberband=function(){const o=this.getPlugin("selection");return o&&o.enableStrictRubberband(),this},l.kJ.prototype.disableStrictRubberband=function(){const o=this.getPlugin("selection");return o&&o.disableStrictRubberband(),this},l.kJ.prototype.toggleStrictRubberband=function(o){const n=this.getPlugin("selection");return n&&n.toggleStrictRubberband(o),this},l.kJ.prototype.setRubberbandModifiers=function(o){const n=this.getPlugin("selection");return n&&n.setRubberbandModifiers(o),this},l.kJ.prototype.setSelectionFilter=function(o){const n=this.getPlugin("selection");return n&&n.setSelectionFilter(o),this},l.kJ.prototype.setSelectionDisplayContent=function(o){const n=this.getPlugin("selection");return n&&n.setSelectionDisplayContent(o),this},l.kJ.prototype.isSelectionEmpty=function(){const o=this.getPlugin("selection");return!o||o.isEmpty()},l.kJ.prototype.cleanSelection=function(o){const n=this.getPlugin("selection");return n&&n.clean(o),this},l.kJ.prototype.resetSelection=function(o,n){const t=this.getPlugin("selection");return t&&t.reset(o,n),this},l.kJ.prototype.getSelectedCells=function(){const o=this.getPlugin("selection");return o?o.getSelectedCells():[]},l.kJ.prototype.getSelectedCellCount=function(){const o=this.getPlugin("selection");return o?o.getSelectedCellCount():0},l.kJ.prototype.isSelected=function(o){const n=this.getPlugin("selection");return!!n&&n.isSelected(o)},l.kJ.prototype.select=function(o,n){const t=this.getPlugin("selection");return t&&t.select(o,n),this},l.kJ.prototype.unselect=function(o,n){const t=this.getPlugin("selection");return t?t.unselect(o,n):this};class St extends l.ew{get rubberbandDisabled(){return!0!==this.options.enabled||!0!==this.options.rubberband}get disabled(){return!0!==this.options.enabled}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(n={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=l.QK.merge({enabled:!0},St.defaultOptions,n),l.mf.ensure(this.name,".x6-widget-selection {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: none;\n  width: 0;\n  height: 0;\n  touch-action: none;\n}\n.x6-widget-selection-rubberband {\n  display: block;\n  overflow: visible;\n  opacity: 0.3;\n}\n.x6-widget-selection-selected {\n  display: block;\n}\n.x6-widget-selection-box {\n  cursor: move;\n}\n.x6-widget-selection-inner[data-selection-length='0'],\n.x6-widget-selection-inner[data-selection-length='1'] {\n  display: none;\n}\n.x6-widget-selection-content {\n  position: absolute;\n  top: 100%;\n  right: -20px;\n  left: -20px;\n  margin-top: 30px;\n  padding: 6px;\n  line-height: 14px;\n  text-align: center;\n  border-radius: 6px;\n}\n.x6-widget-selection-content:empty {\n  display: none;\n}\n.x6-widget-selection-rubberband {\n  background-color: #3498db;\n  border: 2px solid #2980b9;\n}\n.x6-widget-selection-box {\n  box-sizing: content-box !important;\n  margin-top: -4px;\n  margin-left: -4px;\n  padding-right: 4px;\n  padding-bottom: 4px;\n  border: 2px dashed #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-inner {\n  box-sizing: content-box !important;\n  margin-top: -8px;\n  margin-left: -8px;\n  padding-right: 12px;\n  padding-bottom: 12px;\n  border: 2px solid #feb663;\n  box-shadow: 2px 2px 5px #d3d3d3;\n}\n.x6-widget-selection-content {\n  color: #fff;\n  font-size: 10px;\n  background-color: #6a6b8a;\n}\n")}init(n){this.graph=n,this.selectionImpl=new he(Object.assign(Object.assign({},this.options),{graph:n})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(n){return null!=n?n!==this.isEnabled()&&(n?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(n){return null!=n?n!==this.isMultipleSelection()&&(n?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return!1!==this.options.movable}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(n){return null!=n?n!==this.isSelectionMovable()&&(n?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(n){return null!=n?n!==this.isRubberbandEnabled()&&(n?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return!0===this.selectionImpl.options.strict}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(n){return null!=n?n!==this.isStrictRubberband()&&(n?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(n){this.setModifiers(n)}setSelectionFilter(n){return this.setFilter(n),this}setSelectionDisplayContent(n){return this.setContent(n),this}isEmpty(){return this.length<=0}clean(n={}){return this.selectionImpl.clean(n),this}reset(n,t={}){return this.selectionImpl.reset(n?this.getCells(n):[],t),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(n){return this.selectionImpl.isSelected(n)}select(n,t={}){const i=this.getCells(n);return i.length&&(this.isMultiple()?this.selectionImpl.select(i,t):this.reset(i.slice(0,1),t)),this}unselect(n,t={}){return this.selectionImpl.unselect(this.getCells(n),t),this}setup(){this.selectionImpl.on("*",(n,t)=>{this.trigger(n,t),this.graph.trigger(n,t)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:n}){const t=this.graph.panning.allowPanning(n,!0),i=this.graph.getPlugin("scroller"),s=i&&i.allowPanning(n,!0);(this.allowRubberband(n,!0)||this.allowRubberband(n)&&!s&&!t)&&this.startRubberband(n)}onBlankClick(){this.clean()}allowRubberband(n,t){return!this.rubberbandDisabled&&l.tx.isMatch(n,this.options.modifiers,t)}allowMultipleSelection(n){return this.isMultiple()&&l.tx.isMatch(n,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:n}){this.movedMap.set(n,!0)}onCellMouseUp({e:n,cell:t}){const i=this.options;let s=this.disabled;!s&&this.movedMap.has(t)&&(s=!1===i.selectCellOnMoved,s||(s=!1===i.selectNodeOnMoved&&t.isNode()),s||(s=!1===i.selectEdgeOnMoved&&t.isEdge())),s||(this.allowMultipleSelection(n)?this.unselectMap.has(t)?this.unselectMap.delete(t):this.isSelected(t)?this.unselect(t):this.select(t):this.reset(t)),this.movedMap.delete(t)}onBoxMouseDown({e:n,cell:t}){this.disabled||this.allowMultipleSelection(n)&&(this.unselect(t),this.unselectMap.set(t,!0))}getCells(n){return(Array.isArray(n)?n:[n]).map(t=>"string"==typeof t?this.graph.getCellById(t):t).filter(t=>null!=t)}startRubberband(n){return this.rubberbandDisabled||this.selectionImpl.startSelecting(n),this}isMultiple(){return!1!==this.options.multiple}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(n){return this.options.modifiers=n,this}setContent(n){return this.selectionImpl.setContent(n),this}setFilter(n){return this.selectionImpl.setFilter(n),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),l.mf.clean(this.name)}}(function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)})([l.ew.dispose()],St.prototype,"dispose",null),function(o){o.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null}}(St||(St={})),l.kJ.prototype.toSVG=function(o,n){const t=this.getPlugin("export");t&&t.toSVG(o,n)},l.kJ.prototype.toPNG=function(o,n){const t=this.getPlugin("export");t&&t.toPNG(o,n)},l.kJ.prototype.toJPEG=function(o,n){const t=this.getPlugin("export");t&&t.toJPEG(o,n)},l.kJ.prototype.exportPNG=function(o,n){const t=this.getPlugin("export");t&&t.exportPNG(o,n)},l.kJ.prototype.exportJPEG=function(o,n){const t=this.getPlugin("export");t&&t.exportJPEG(o,n)},l.kJ.prototype.exportSVG=function(o,n){const t=this.getPlugin("export");t&&t.exportSVG(o,n)};class ue extends l.ew{constructor(){super(),this.name="export"}get view(){return this.graph.view}init(n){this.graph=n}exportPNG(n="chart",t={}){this.toPNG(i=>{l.Vb.downloadDataUri(i,n)},t)}exportJPEG(n="chart",t={}){this.toPNG(i=>{l.Vb.downloadDataUri(i,n)},t)}exportSVG(n="chart",t={}){this.toSVG(i=>{l.Vb.downloadDataUri(l.Vb.svgToDataUrl(i),n)},t)}toSVG(n,t={}){this.notify("before:export",t);const i=this.view.svg,s=l.OW.create(i).clone();let r=s.node;const a=s.findOne(`.${this.view.prefixClassName("graph-svg-stage")}`),c=t.viewBox||this.graph.graphToLocal(this.graph.getContentBBox()),d=t.preserveDimensions;if(d){const u="boolean"==typeof d?c:d;s.attr({width:u.width,height:u.height})}if(s.removeAttribute("style").attr("viewBox",[c.x,c.y,c.width,c.height].join(" ")),a.removeAttribute("transform"),!1!==t.copyStyles){const u=i.ownerDocument,g=Array.from(i.querySelectorAll("*")),z=Array.from(r.querySelectorAll("*")),N=u.styleSheets.length,_=[];for(let x=N-1;x>=0;x-=1)_[x]=u.styleSheets[x],u.styleSheets[x].disabled=!0;const y={};g.forEach((x,T)=>{const v=window.getComputedStyle(x,null),P={};Object.keys(v).forEach(J=>{P[J]=v.getPropertyValue(J)}),y[T]=P}),N!==u.styleSheets.length&&_.forEach((x,T)=>{u.styleSheets[T]=x});for(let x=0;x<N;x+=1)u.styleSheets[x].disabled=!1;const I={};g.forEach((x,T)=>{const v=window.getComputedStyle(x,null),P=y[T],J={};Object.keys(v).forEach(Q=>{!l.GH.isNumber(Q)&&v.getPropertyValue(Q)!==P[Q]&&(J[Q]=v.getPropertyValue(Q))}),I[T]=J}),z.forEach((x,T)=>{l.is.css(x,I[T])})}const h=t.stylesheet;if("string"==typeof h){const u=i.ownerDocument.implementation.createDocument(null,"xml",null).createCDATASection(h);s.prepend(l.OW.create("style",{type:"text/css"},[u]))}const p=()=>{const u=t.beforeSerialize;if("function"==typeof u){const z=l.Iw.call(u,this.graph,r);z instanceof SVGSVGElement&&(r=z)}const g=(new XMLSerializer).serializeToString(r).replace(/&nbsp;/g,"\xa0");this.notify("after:export",t),n(g)};if(t.serializeImages){const u=s.find("image").map(g=>new Promise(z=>{const N=g.attr("xlink:href")||g.attr("href");l.Vb.imageToDataUri(N,(_,y)=>{!_&&y&&g.attr("xlink:href",y),z()})}));Promise.all(u).then(p)}else p()}toDataURL(n,t){let i=t.viewBox||this.graph.getContentBBox();const s=l.GH.normalizeSides(t.padding);t.width&&t.height&&(s.left+s.right>=t.width&&(s.left=s.right=0),s.top+s.bottom>=t.height&&(s.top=s.bottom=0));const r=new l.Ae(-s.left,-s.top,s.left+s.right,s.top+s.bottom);t.width&&t.height&&r.scale((i.width+s.left+s.right)/t.width,(i.height+s.top+s.bottom)/t.height),i=l.Ae.create(i).moveAndExpand(r);const a="number"==typeof t.width&&"number"==typeof t.height?{width:t.width,height:t.height}:i;let c=t.ratio?parseFloat(t.ratio):1;(!Number.isFinite(c)||0===c)&&(c=1);const d={width:Math.max(Math.round(a.width*c),1),height:Math.max(Math.round(a.height*c),1)};{const p=document.createElement("canvas"),u=p.getContext("2d");p.width=d.width,p.height=d.height;const g=d.width-1,z=d.height-1;u.fillStyle="rgb(1,1,1)",u.fillRect(g,z,1,1);const N=u.getImageData(g,z,1,1).data;if(1!==N[0]||1!==N[1]||1!==N[2])throw new Error("size exceeded")}const h=new Image;h.onload=()=>{const p=document.createElement("canvas");p.width=d.width,p.height=d.height;const u=p.getContext("2d");u.fillStyle=t.backgroundColor||"white",u.fillRect(0,0,d.width,d.height);try{u.drawImage(h,0,0,d.width,d.height);const g=p.toDataURL(t.type,t.quality);n(g)}catch{}},this.toSVG(p=>{h.src=`data:image/svg+xml,${encodeURIComponent(p)}`},Object.assign(Object.assign({},t),{viewBox:i,serializeImages:!0,preserveDimensions:Object.assign({},d)}))}toPNG(n,t={}){this.toDataURL(n,Object.assign(Object.assign({},t),{type:"image/png"}))}toJPEG(n,t={}){this.toDataURL(n,Object.assign(Object.assign({},t),{type:"image/jpeg"}))}notify(n,t){this.trigger(n,t),this.graph.trigger(n,t)}dispose(){this.off()}}!function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)}([l.ew.dispose()],ue.prototype,"dispose",null);class bt extends l.G7{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){return this.options.target.getPlugin("snapline")}constructor(n){super(),this.name="dnd",this.options=Object.assign(Object.assign({},bt.defaults),n),this.init()}init(){l.mf.ensure(this.name,".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n"),this.container=document.createElement("div"),l.is.addClass(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new l.kJ(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),l.is.append(this.container,this.draggingGraph.container)}start(n,t){const i=t;i.preventDefault(),this.targetModel.startBatch("dnd"),l.is.addClass(this.container,"dragging"),l.is.appendTo(this.container,this.options.draggingContainer||document.body),this.sourceNode=n,this.prepareDragging(n,i.clientX,i.clientY);const s=this.updateNodePosition(i.clientX,i.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:i,node:n,cell:n,view:this.draggingView,x:s.x,y:s.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(bt.documentEvents,i.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(n,t,i){const s=this.draggingGraph,r=s.model,a=this.options.getDragNode(n,{sourceNode:n,draggingGraph:s,targetGraph:this.targetGraph});a.position(0,0);let c=5;if(this.isSnaplineEnabled()&&(c+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const p=this.targetGraph.transform.getScale();s.scale(p.sx,p.sy),c*=Math.max(p.sx,p.sy)}else s.scale(1,1);this.clearDragging(),r.resetCells([a]);const d=s.findViewByCell(a);d.undelegateEvents(),d.cell.off("changed"),s.fitToContent({padding:c,allowNewOrigin:"any"});const h=d.getBBox();this.geometryBBox=d.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(h.getTopLeft()),this.draggingNode=a,this.draggingView=d,this.draggingBBox=a.getBBox(),this.padding=c,this.originOffset=this.updateGraphPosition(t,i)}updateGraphPosition(n,t){const i=document.body.scrollTop||document.documentElement.scrollTop,s=this.delta,r=this.geometryBBox,a=this.padding||5,c={left:n-s.x-r.width/2-a,top:t-s.y-r.height/2-a+i};return this.draggingGraph&&l.is.css(this.container,{left:`${c.left}px`,top:`${c.top}px`}),c}updateNodePosition(n,t){const i=this.targetGraph.clientToLocal(n,t),s=this.draggingBBox;return i.x-=s.width/2,i.y-=s.height/2,this.draggingNode.position(i.x,i.y),i}snap({cell:n,current:t,options:i}){const s=n;if(i.snapped){const r=this.draggingBBox;s.position(r.x+i.tx,r.y+i.ty,{silent:!0}),this.draggingView.translate(),s.position(t.x,t.y,{silent:!0}),this.snapOffset={x:i.tx,y:i.ty}}else this.snapOffset=null}onDragging(n){const t=this.draggingView;if(t){n.preventDefault();const i=this.normalizeEvent(n),s=i.clientX,r=i.clientY;this.updateGraphPosition(s,r);const a=this.updateNodePosition(s,r),c=this.targetGraph.options.embedding.enabled,d=(c||this.isSnaplineEnabled())&&this.isInsideValidArea({x:s,y:r});if(c){t.setEventData(i,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const h=t.getEventData(i);d?t.processEmbedding(i,h):t.clearEmbedding(h),this.candidateEmbedView=h.candidateEmbedView}this.isSnaplineEnabled()&&(d?this.snapline.snapOnMoving({e:i,view:t,x:a.x,y:a.y}):this.snapline.hide())}}onDragEnd(n){const t=this.draggingNode;if(t){const i=this.normalizeEvent(n),s=this.draggingView,r=this.draggingBBox,a=this.snapOffset;let c=r.x,d=r.y;a&&(c+=a.x,d+=a.y),t.position(c,d,{silent:!0});const h=this.drop(t,{x:i.clientX,y:i.clientY}),p=u=>{u?(this.onDropped(t),this.targetGraph.options.embedding.enabled&&s&&(s.setEventData(i,{cell:u,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),s.finalizeEmbedding(i,s.getEventData(i)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};l.Iw.isAsync(h)?(this.undelegateDocumentEvents(),h.then(p)):p(h)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(n){this.draggingNode===n&&(this.clearDragging(),l.is.removeClass(this.container,"dragging"),l.is.remove(this.container))}onDropInvalid(){const n=this.draggingNode;n&&this.onDropped(n)}isInsideValidArea(n){let t,i=null;const s=this.targetGraph,r=this.targetScroller;this.options.dndContainer&&(i=this.getDropArea(this.options.dndContainer));const a=i&&i.containsPoint(n);if(r)if(r.options.autoResize)t=this.getDropArea(r.container);else{const c=this.getDropArea(r.container);t=this.getDropArea(s.container).intersectsWithRect(c)}else t=this.getDropArea(s.container);return!a&&t&&t.containsPoint(n)}getDropArea(n){const t=l.is.offset(n),i=document.body.scrollTop||document.documentElement.scrollTop,s=document.body.scrollLeft||document.documentElement.scrollLeft;return l.Ae.create({x:t.left+parseInt(l.is.css(n,"border-left-width"),10)-s,y:t.top+parseInt(l.is.css(n,"border-top-width"),10)-i,width:n.clientWidth,height:n.clientHeight})}drop(n,t){if(this.isInsideValidArea(t)){const i=this.targetGraph,s=i.model,r=i.clientToLocal(t),a=this.sourceNode,c=this.options.getDropNode(n,{sourceNode:a,draggingNode:n,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),d=c.getBBox();r.x+=d.x-d.width/2,r.y+=d.y-d.height/2;const h=this.snapOffset?1:i.getGridSize();c.position(l.Z4.snapToGrid(r.x,h),l.Z4.snapToGrid(r.y,h)),c.removeZIndex();const p=this.options.validateNode,u=!p||p(c,{sourceNode:a,draggingNode:n,droppingNode:c,targetGraph:i,draggingGraph:this.draggingGraph});return"boolean"==typeof u?u?(s.addCell(c,{stencil:this.cid}),c):null:l.Iw.toDeferredBoolean(u).then(g=>g?(s.addCell(c,{stencil:this.cid}),c):null)}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),l.mf.clean(this.name)}}(function(o,n,t,i){var a,s=arguments.length,r=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(o,n,t,i);else for(var c=o.length-1;c>=0;c--)(a=o[c])&&(r=(s<3?a(r):s>3?a(n,t,r):a(n,t))||r);s>3&&r&&Object.defineProperty(n,t,r)})([l.G7.dispose()],bt.prototype,"dispose",null),function(o){o.defaults={getDragNode:n=>n.clone(),getDropNode:n=>n.clone()},o.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}}(bt||(bt={}));let He=(()=>{class o{constructor(t,i,s,r){this.cs=t,this.element=i,this.injector=s,this.viewContainerRef=r,this.graph=new l.kJ({container:i.nativeElement,background:{},grid:{size:10,visible:JSON.parse(localStorage.getItem("show_grid")||"true"),type:"mesh"},connecting:{snap:!1,connector:"normal",createEdge:()=>new l.bn.kS({shape:"line",attrs:{line:{stroke:"#333",strokeWidth:1,targetMarker:null,strokeDasharray:0,style:{animation:"ant-line 30s infinite linear"}}},label:{text:""},router:{name:"normal"}})},highlighting:{magnetAvailable:{name:"stroke",args:{padding:4,attrs:{strokeWidth:2,stroke:"rgba(223,234,255)"}}}}}),this.graph.use(new jt({enabled:!0})),this.graph.use(new pt({resizing:{enabled:!0},rotating:{enabled:!0}})),this.graph.use(new S({enabled:!0})),this.graph.use(new ot({enabled:!0})),this.graph.use(new vt({enabled:!0})),this.graph.use(new St({enabled:!0,multiple:!0,rubberband:!0,rubberEdge:!0,movable:!0,strict:!0,showNodeSelectionBox:!0})),this.graph.use(new ue),this.dnd=new bt({target:this.graph}),this.graph.bindKey("ctrl+s",a=>{this.graph.exportPNG(),a.preventDefault()}),this.graph.bindKey("ctrl+z",()=>this.graph.undo()),this.graph.bindKey("ctrl+y",()=>this.graph.redo()),this.graph.bindKey("ctrl+x",()=>this.graph.cut(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+c",()=>this.graph.copy(this.graph.getSelectedCells(),{deep:!0})),this.graph.bindKey("ctrl+v",()=>this.graph.resetSelection(this.graph.paste())),this.graph.bindKey("backspace",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.bindKey("delete",()=>this.graph.getSelectedCells().forEach(a=>a.remove())),this.graph.container.onmousemove=a=>{this.line&&(this.graph.addEdge({shape:this.line.id,source:[a.offsetX,a.offsetY],target:[a.offsetX-120,a.offsetY+80],...this.line.meta}),this.line=void 0)},this.graph.on("edge:selected",l.Iw.debounce(({edge:a})=>{a.addTools([{name:"source-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"target-arrowhead",args:{attrs:{cursor:"pointer",fill:"#3c9566"}}},{name:"vertices",args:{attrs:{fill:"#3c9566",cursor:"crosshair"},stopPropagation:!1}}])})),this.graph.on("edge:unselected",({cell:a})=>{a.removeTools()}),this.graph.on("node:mouseenter",l.Iw.debounce(({})=>{}),500),this.graph.on("node:mouseleave",({})=>{}),this.graph.on("blank:click",()=>{}),this.graph.on("node:click",({})=>{}),this.graph.on("cell:selected",()=>{}),this.graph.on("cell:click",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.click?.call(this,a,c)}),this.graph.on("cell:mouseenter",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseenter?.call(this,a,c)}),this.graph.on("cell:mouseleave",({cell:a,e:c})=>{this.cs.Get(a.shape)?.listeners?.mouseleave?.call(this,a,c)})}Render(t){t.content?.cells?.forEach(i=>{this.cs.Get(i.shape)}),this.graph.drawBackground({color:t.background_color,image:t.background_image}),this.graph.fromJSON(t.content)}Draw(t){let i,{component:s}=t;switch(this.cs.CheckRegister(s),s.type){case"line":return void(this.line=s);case"shape":case"svg":let r={};s.bindings?.forEach(a=>r[a.name]=a.default),i=this.graph.createNode({shape:s.id,...s.meta,data:r})}console.log(i),i&&t.event&&this.dnd.start(i,t.event)}showPorts(t,i){for(let s=0,r=t.length;s<r;s+=1)t[s].style.visibility=i?"visible":"hidden"}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ut.m),e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-canvas"]],decls:0,vars:0,template:function(t,i){},styles:["[_nghost-%COMP%]{display:block;position:relative;box-shadow:#a8a8a8 2px 2px 10px;background-color:#fff}"]}),o})();var C=b(433),oe=b(2851),L=b(7582),G=b(9521),Dt=b(7579),st=b(4968),Ht=b(6451),Ye=b(1884),X=b(2722),fe=b(3303),j=b(3187),Bt=b(2687),gt=b(445),Yt=b(9570),mt=b(6287);const Ve=["upHandler"],Ue=["downHandler"],Qe=["inputElement"];function We(o,n){if(1&o&&e._UZ(0,"nz-form-item-feedback-icon",11),2&o){const t=e.oxw();e.Q6J("status",t.status)}}let ge=(()=>{class o{constructor(t,i,s,r,a,c,d,h,p){this.ngZone=t,this.elementRef=i,this.cdr=s,this.focusMonitor=r,this.renderer=a,this.directionality=c,this.destroy$=d,this.nzFormStatusService=h,this.nzFormNoStatusService=p,this.isNzDisableFirstChange=!0,this.isFocused=!1,this.disabled$=new Dt.x,this.disabledUp=!1,this.disabledDown=!1,this.dir="ltr",this.prefixCls="ant-input-number",this.status="",this.statusCls={},this.hasFeedback=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzBlur=new e.vpe,this.nzFocus=new e.vpe,this.nzSize="default",this.nzMin=-1/0,this.nzMax=1/0,this.nzParser=u=>u.trim().replace(/\u3002/g,".").replace(/[^\w\.-]+/g,""),this.nzPrecisionMode="toFixed",this.nzPlaceHolder="",this.nzStatus="",this.nzStep=1,this.nzInputMode="decimal",this.nzId=null,this.nzDisabled=!1,this.nzReadOnly=!1,this.nzAutoFocus=!1,this.nzBorderless=!1,this.nzFormatter=u=>u}onModelChange(t){this.parsedValue=this.nzParser(t),this.inputElement.nativeElement.value=`${this.parsedValue}`;const i=this.getCurrentValidValue(this.parsedValue);this.setValue(i)}getCurrentValidValue(t){let i=t;return i=""===i?"":this.isNotCompleteNumber(i)?this.value:`${this.getValidValue(i)}`,this.toNumber(i)}isNotCompleteNumber(t){return isNaN(t)||""===t||null===t||!(!t||t.toString().indexOf(".")!==t.toString().length-1)}getValidValue(t){let i=parseFloat(t);return isNaN(i)?t:(i<this.nzMin&&(i=this.nzMin),i>this.nzMax&&(i=this.nzMax),i)}toNumber(t){if(this.isNotCompleteNumber(t))return t;const i=String(t);if(i.indexOf(".")>=0&&(0,j.DX)(this.nzPrecision)){if("function"==typeof this.nzPrecisionMode)return this.nzPrecisionMode(t,this.nzPrecision);if("cut"===this.nzPrecisionMode){const s=i.split(".");return s[1]=s[1].slice(0,this.nzPrecision),Number(s.join("."))}return Number(Number(t).toFixed(this.nzPrecision))}return Number(t)}getRatio(t){let i=1;return t.metaKey||t.ctrlKey?i=.1:t.shiftKey&&(i=10),i}down(t,i){this.isFocused||this.focus(),this.step("down",t,i)}up(t,i){this.isFocused||this.focus(),this.step("up",t,i)}getPrecision(t){const i=t.toString();if(i.indexOf("e-")>=0)return parseInt(i.slice(i.indexOf("e-")+2),10);let s=0;return i.indexOf(".")>=0&&(s=i.length-i.indexOf(".")-1),s}getMaxPrecision(t,i){if((0,j.DX)(this.nzPrecision))return this.nzPrecision;const s=this.getPrecision(i),r=this.getPrecision(this.nzStep),a=this.getPrecision(t);return t?Math.max(a,s+r):s+r}getPrecisionFactor(t,i){const s=this.getMaxPrecision(t,i);return Math.pow(10,s)}upStep(t,i){const s=this.getPrecisionFactor(t,i),r=Math.abs(this.getMaxPrecision(t,i));let a;return a="number"==typeof t?((s*t+s*this.nzStep*i)/s).toFixed(r):this.nzMin===-1/0?this.nzStep:this.nzMin,this.toNumber(a)}downStep(t,i){const s=this.getPrecisionFactor(t,i),r=Math.abs(this.getMaxPrecision(t,i));let a;return a="number"==typeof t?((s*t-s*this.nzStep*i)/s).toFixed(r):this.nzMin===-1/0?-this.nzStep:this.nzMin,this.toNumber(a)}step(t,i,s=1){if(this.stop(),i.preventDefault(),this.nzDisabled)return;const r=this.getCurrentValidValue(this.parsedValue)||0;let a=0;"up"===t?a=this.upStep(r,s):"down"===t&&(a=this.downStep(r,s));const c=a>this.nzMax||a<this.nzMin;a>this.nzMax?a=this.nzMax:a<this.nzMin&&(a=this.nzMin),this.setValue(a),this.updateDisplayValue(a),this.isFocused=!0,!c&&(this.autoStepTimer=setTimeout(()=>{this[t](i,s)},300))}stop(){this.autoStepTimer&&clearTimeout(this.autoStepTimer)}setValue(t){if(`${this.value}`!=`${t}`&&this.onChange(t),this.value=t,this.parsedValue=t,this.disabledUp=this.disabledDown=!1,t||0===t){const i=Number(t);i>=this.nzMax&&(this.disabledUp=!0),i<=this.nzMin&&(this.disabledDown=!0)}}updateDisplayValue(t){const i=(0,j.DX)(this.nzFormatter(t))?this.nzFormatter(t):"";this.displayValue=i,this.inputElement.nativeElement.value=`${i}`}writeValue(t){this.value=t,this.setValue(t),this.updateDisplayValue(t),this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.disabled$.next(this.nzDisabled),this.cdr.markForCheck()}focus(){this.focusMonitor.focusVia(this.inputElement,"keyboard")}blur(){this.inputElement.nativeElement.blur()}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe((0,Ye.x)((t,i)=>t.status===i.status&&t.hasFeedback===i.hasFeedback),(0,X.R)(this.destroy$)).subscribe(({status:t,hasFeedback:i})=>{this.setStatusStyles(t,i)}),this.focusMonitor.monitor(this.elementRef,!0).pipe((0,X.R)(this.destroy$)).subscribe(t=>{t?(this.isFocused=!0,this.nzFocus.emit()):(this.isFocused=!1,this.updateDisplayValue(this.value),this.nzBlur.emit(),Promise.resolve().then(()=>this.onTouched()))}),this.dir=this.directionality.value,this.directionality.change.pipe((0,X.R)(this.destroy$)).subscribe(t=>{this.dir=t}),this.setupHandlersListeners(),this.ngZone.runOutsideAngular(()=>{(0,st.R)(this.inputElement.nativeElement,"keyup").pipe((0,X.R)(this.destroy$)).subscribe(()=>this.stop()),(0,st.R)(this.inputElement.nativeElement,"keydown").pipe((0,X.R)(this.destroy$)).subscribe(t=>{const{keyCode:i}=t;i!==G.LH&&i!==G.JH&&i!==G.K5||this.ngZone.run(()=>{if(i===G.LH){const s=this.getRatio(t);this.up(t,s),this.stop()}else if(i===G.JH){const s=this.getRatio(t);this.down(t,s),this.stop()}else this.updateDisplayValue(this.value);this.cdr.markForCheck()})})})}ngOnChanges(t){const{nzStatus:i,nzDisabled:s}=t;if(t.nzFormatter&&!t.nzFormatter.isFirstChange()){const r=this.getCurrentValidValue(this.parsedValue);this.setValue(r),this.updateDisplayValue(r)}s&&this.disabled$.next(this.nzDisabled),i&&this.setStatusStyles(this.nzStatus,this.hasFeedback)}ngAfterViewInit(){this.nzAutoFocus&&this.focus()}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.elementRef)}setupHandlersListeners(){this.ngZone.runOutsideAngular(()=>{(0,Ht.T)((0,st.R)(this.upHandler.nativeElement,"mouseup"),(0,st.R)(this.upHandler.nativeElement,"mouseleave"),(0,st.R)(this.downHandler.nativeElement,"mouseup"),(0,st.R)(this.downHandler.nativeElement,"mouseleave")).pipe((0,X.R)(this.destroy$)).subscribe(()=>this.stop())})}setStatusStyles(t,i){this.status=t,this.hasFeedback=i,this.cdr.markForCheck(),this.statusCls=(0,j.Zu)(this.prefixCls,t,i),Object.keys(this.statusCls).forEach(s=>{this.statusCls[s]?this.renderer.addClass(this.elementRef.nativeElement,s):this.renderer.removeClass(this.elementRef.nativeElement,s)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.R0b),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(Bt.tE),e.Y36(e.Qsj),e.Y36(gt.Is,8),e.Y36(fe.kn),e.Y36(Yt.kH,8),e.Y36(Yt.yW,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["nz-input-number"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Ve,7),e.Gf(Ue,7),e.Gf(Qe,7)),2&t){let s;e.iGM(s=e.CRH())&&(i.upHandler=s.first),e.iGM(s=e.CRH())&&(i.downHandler=s.first),e.iGM(s=e.CRH())&&(i.inputElement=s.first)}},hostAttrs:[1,"ant-input-number"],hostVars:16,hostBindings:function(t,i){2&t&&e.ekj("ant-input-number-in-form-item",!!i.nzFormStatusService)("ant-input-number-focused",i.isFocused)("ant-input-number-lg","large"===i.nzSize)("ant-input-number-sm","small"===i.nzSize)("ant-input-number-disabled",i.nzDisabled)("ant-input-number-readonly",i.nzReadOnly)("ant-input-number-rtl","rtl"===i.dir)("ant-input-number-borderless",i.nzBorderless)},inputs:{nzSize:"nzSize",nzMin:"nzMin",nzMax:"nzMax",nzParser:"nzParser",nzPrecision:"nzPrecision",nzPrecisionMode:"nzPrecisionMode",nzPlaceHolder:"nzPlaceHolder",nzStatus:"nzStatus",nzStep:"nzStep",nzInputMode:"nzInputMode",nzId:"nzId",nzDisabled:"nzDisabled",nzReadOnly:"nzReadOnly",nzAutoFocus:"nzAutoFocus",nzBorderless:"nzBorderless",nzFormatter:"nzFormatter"},outputs:{nzBlur:"nzBlur",nzFocus:"nzFocus"},exportAs:["nzInputNumber"],features:[e._Bn([{provide:C.JU,useExisting:(0,e.Gpc)(()=>o),multi:!0},fe.kn]),e.TTD],decls:11,vars:15,consts:[[1,"ant-input-number-handler-wrap"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-up",3,"mousedown"],["upHandler",""],["nz-icon","","nzType","up",1,"ant-input-number-handler-up-inner"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-down",3,"mousedown"],["downHandler",""],["nz-icon","","nzType","down",1,"ant-input-number-handler-down-inner"],[1,"ant-input-number-input-wrap"],["autocomplete","off",1,"ant-input-number-input",3,"disabled","placeholder","readOnly","ngModel","ngModelChange"],["inputElement",""],["class","ant-input-number-suffix",3,"status",4,"ngIf"],[1,"ant-input-number-suffix",3,"status"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"span",1,2),e.NdJ("mousedown",function(r){return i.up(r)}),e._UZ(3,"span",3),e.qZA(),e.TgZ(4,"span",4,5),e.NdJ("mousedown",function(r){return i.down(r)}),e._UZ(6,"span",6),e.qZA()(),e.TgZ(7,"div",7)(8,"input",8,9),e.NdJ("ngModelChange",function(r){return i.onModelChange(r)}),e.qZA()(),e.YNc(10,We,1,1,"nz-form-item-feedback-icon",10)),2&t&&(e.xp6(1),e.ekj("ant-input-number-handler-up-disabled",i.disabledUp),e.xp6(3),e.ekj("ant-input-number-handler-down-disabled",i.disabledDown),e.xp6(4),e.Q6J("disabled",i.nzDisabled)("placeholder",i.nzPlaceHolder)("readOnly",i.nzReadOnly)("ngModel",i.displayValue),e.uIk("id",i.nzId)("autofocus",i.nzAutoFocus?"autofocus":null)("min",i.nzMin)("max",i.nzMax)("step",i.nzStep)("inputmode",i.nzInputMode),e.xp6(2),e.Q6J("ngIf",i.hasFeedback&&!!i.status&&!i.nzFormNoStatusService))},dependencies:[w.O5,C.Fj,C.JJ,C.On,Z.Ls,Yt.w_],encapsulation:2,changeDetection:0}),(0,L.gn)([(0,j.yF)()],o.prototype,"nzDisabled",void 0),(0,L.gn)([(0,j.yF)()],o.prototype,"nzReadOnly",void 0),(0,L.gn)([(0,j.yF)()],o.prototype,"nzAutoFocus",void 0),(0,L.gn)([(0,j.yF)()],o.prototype,"nzBorderless",void 0),o})(),cn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[gt.vT,w.ez,C.u5,mt.T,Z.PV,Yt.mJ]}),o})();var zt=b(2536);const dn=["switchElement"];function pn(o,n){1&o&&e._UZ(0,"span",8)}function hn(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzCheckedChildren)}}function un(o,n){if(1&o&&(e.ynx(0),e.YNc(1,hn,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("nzStringTemplateOutlet",t.nzCheckedChildren)}}function fn(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.nzUnCheckedChildren)}}function gn(o,n){if(1&o&&e.YNc(0,fn,2,1,"ng-container",9),2&o){const t=e.oxw();e.Q6J("nzStringTemplateOutlet",t.nzUnCheckedChildren)}}let bn=(()=>{class o{constructor(t,i,s,r,a,c){this.nzConfigService=t,this.host=i,this.ngZone=s,this.cdr=r,this.focusMonitor=a,this.directionality=c,this._nzModuleName="switch",this.isChecked=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzLoading=!1,this.nzDisabled=!1,this.nzControl=!1,this.nzCheckedChildren=null,this.nzUnCheckedChildren=null,this.nzSize="default",this.nzId=null,this.dir="ltr",this.destroy$=new Dt.x,this.isNzDisableFirstChange=!0}updateValue(t){this.isChecked!==t&&(this.isChecked=t,this.onChange(this.isChecked))}focus(){this.focusMonitor.focusVia(this.switchElement.nativeElement,"keyboard")}blur(){this.switchElement.nativeElement.blur()}ngOnInit(){this.directionality.change.pipe((0,X.R)(this.destroy$)).subscribe(t=>{this.dir=t,this.cdr.detectChanges()}),this.dir=this.directionality.value,this.ngZone.runOutsideAngular(()=>{(0,st.R)(this.host.nativeElement,"click").pipe((0,X.R)(this.destroy$)).subscribe(t=>{t.preventDefault(),!(this.nzControl||this.nzDisabled||this.nzLoading)&&this.ngZone.run(()=>{this.updateValue(!this.isChecked),this.cdr.markForCheck()})}),(0,st.R)(this.switchElement.nativeElement,"keydown").pipe((0,X.R)(this.destroy$)).subscribe(t=>{if(this.nzControl||this.nzDisabled||this.nzLoading)return;const{keyCode:i}=t;i!==G.oh&&i!==G.SV&&i!==G.L_&&i!==G.K5||(t.preventDefault(),this.ngZone.run(()=>{i===G.oh?this.updateValue(!1):i===G.SV?this.updateValue(!0):(i===G.L_||i===G.K5)&&this.updateValue(!this.isChecked),this.cdr.markForCheck()}))})})}ngAfterViewInit(){this.focusMonitor.monitor(this.switchElement.nativeElement,!0).pipe((0,X.R)(this.destroy$)).subscribe(t=>{t||Promise.resolve().then(()=>this.onTouched())})}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.switchElement.nativeElement),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.isChecked=t,this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.cdr.markForCheck()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(zt.jY),e.Y36(e.SBq),e.Y36(e.R0b),e.Y36(e.sBO),e.Y36(Bt.tE),e.Y36(gt.Is,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["nz-switch"]],viewQuery:function(t,i){if(1&t&&e.Gf(dn,7),2&t){let s;e.iGM(s=e.CRH())&&(i.switchElement=s.first)}},inputs:{nzLoading:"nzLoading",nzDisabled:"nzDisabled",nzControl:"nzControl",nzCheckedChildren:"nzCheckedChildren",nzUnCheckedChildren:"nzUnCheckedChildren",nzSize:"nzSize",nzId:"nzId"},exportAs:["nzSwitch"],features:[e._Bn([{provide:C.JU,useExisting:(0,e.Gpc)(()=>o),multi:!0}])],decls:9,vars:16,consts:[["nz-wave","","type","button",1,"ant-switch",3,"disabled","nzWaveExtraNode"],["switchElement",""],[1,"ant-switch-handle"],["nz-icon","","nzType","loading","class","ant-switch-loading-icon",4,"ngIf"],[1,"ant-switch-inner"],[4,"ngIf","ngIfElse"],["uncheckTemplate",""],[1,"ant-click-animating-node"],["nz-icon","","nzType","loading",1,"ant-switch-loading-icon"],[4,"nzStringTemplateOutlet"]],template:function(t,i){if(1&t&&(e.TgZ(0,"button",0,1)(2,"span",2),e.YNc(3,pn,1,0,"span",3),e.qZA(),e.TgZ(4,"span",4),e.YNc(5,un,2,1,"ng-container",5),e.YNc(6,gn,1,1,"ng-template",null,6,e.W1O),e.qZA(),e._UZ(8,"div",7),e.qZA()),2&t){const s=e.MAs(7);e.ekj("ant-switch-checked",i.isChecked)("ant-switch-loading",i.nzLoading)("ant-switch-disabled",i.nzDisabled)("ant-switch-small","small"===i.nzSize)("ant-switch-rtl","rtl"===i.dir),e.Q6J("disabled",i.nzDisabled)("nzWaveExtraNode",!0),e.uIk("id",i.nzId),e.xp6(3),e.Q6J("ngIf",i.nzLoading),e.xp6(2),e.Q6J("ngIf",i.isChecked)("ngIfElse",s)}},dependencies:[w.O5,yt.dQ,Z.Ls,mt.f],encapsulation:2,changeDetection:0}),(0,L.gn)([(0,j.yF)()],o.prototype,"nzLoading",void 0),(0,L.gn)([(0,j.yF)()],o.prototype,"nzDisabled",void 0),(0,L.gn)([(0,j.yF)()],o.prototype,"nzControl",void 0),(0,L.gn)([(0,zt.oS)()],o.prototype,"nzSize",void 0),o})(),zn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[gt.vT,w.ez,yt.vG,Z.PV,mt.T]}),o})();function Cn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input",6),e.NdJ("change",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(s))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)||"")}}function _n(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nz-input-number",7),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.change(s))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function yn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nz-input-number",7),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.change(s))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function xn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nz-switch",7),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.change(s))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModel",t.cell.getPropByPath(t.property.path))}}function vn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input",8),e.NdJ("colorPickerChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.change(s))})("cpPresetColorsChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.setPresentColors(s))}),e.qZA()}if(2&o){const t=e.oxw(),i=e.MAs(7);e.Udp("color",t.cell.getPropByPath(t.property.path)),e.Q6J("value",t.cell.getPropByPath(t.property.path)||"none")("colorPicker",t.cell.getPropByPath(t.property.path))("cpEyeDropper",!0)("cpUseRootViewContainer",!0)("cpPresetColors",t.getPresentColors())("cpExtraTemplate",i)}}function Sn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}function Tn(o,n){if(1&o&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.name)}}function wn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"select",10),e.NdJ("change",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.inputChange(s))}),e.YNc(1,Tn,2,2,"option",11),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("value",t.cell.getPropByPath(t.property.path)),e.xp6(1),e.Q6J("ngForOf",t.property.options)}}let Nn=(()=>{class o{inputChange(t){this.cell.setPropByPath(this.property.path,t.target.value)}change(t){this.cell.setPropByPath(this.property.path,t);let i=this.getPresentColors(),s=i.indexOf(t);s>-1&&i.splice(s,1),i.unshift(t),i.length>12&&(i.length=12),this.setPresentColors(i)}getPresentColors(){let t=localStorage.getItem("present-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("present-colors",JSON.stringify(t))}clearColor(){this.cell.setPropByPath(this.property.path,"none")}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-property-input"]],inputs:{property:"property",cell:"cell"},decls:9,vars:7,consts:[[3,"ngSwitch"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change",4,"ngSwitchCase"],["nzSize","small",3,"ngModel","ngModelChange",4,"ngSwitchCase"],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","color","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange",4,"ngSwitchCase"],["suffixIconClear",""],[3,"value","change",4,"ngSwitchCase"],["nz-input","","nzSize","small","placeholder","\u7a7a",3,"value","change"],["nzSize","small",3,"ngModel","ngModelChange"],["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange"],[3,"click"],[3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,i){1&t&&(e.ynx(0,0),e.YNc(1,Cn,1,1,"input",1),e.YNc(2,_n,1,1,"nz-input-number",2),e.YNc(3,yn,1,1,"nz-input-number",2),e.YNc(4,xn,1,1,"nz-switch",2),e.YNc(5,vn,1,8,"input",3),e.YNc(6,Sn,2,0,"ng-template",null,4,e.W1O),e.YNc(8,wn,2,2,"select",5),e.BQk()),2&t&&(e.Q6J("ngSwitch",i.property.type),e.xp6(1),e.Q6J("ngSwitchCase","text"),e.xp6(1),e.Q6J("ngSwitchCase","number"),e.xp6(1),e.Q6J("ngSwitchCase","stroke"),e.xp6(1),e.Q6J("ngSwitchCase","boolean"),e.xp6(1),e.Q6J("ngSwitchCase","color"),e.xp6(3),e.Q6J("ngSwitchCase","select"))},dependencies:[w.sg,w.RF,w.n9,C.YN,C.Kr,C.JJ,C.On,oe.Kk,nt.Zp,ge,bn]}),o})();var Tt=b(3679),it=b(6704);function In(o,n){1&o&&(e.ynx(0),e._uU(1,"\u8bf7\u8f93\u5165\u540d\u79f0!"),e.BQk())}function kn(o,n){1&o&&e.YNc(0,In,2,0,"ng-container",5),2&o&&e.Q6J("ngIf",n.$implicit.hasError("required"))}let Mn=(()=>{class o{set row(t){t&&this.group.setValue({name:t.name})}constructor(t,i,s){this.fb=t,this.rs=i,this.msg=s,this.build()}build(t){this.group=this.fb.group({name:[(t=t||{}).name||"",[C.kI.required]]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.qu),e.Y36(_t.s),e.Y36(ht.dD))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-page-setting"]],inputs:{row:"row"},decls:8,vars:6,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","name"],["nameErrorTpl",""],[4,"ngIf"]],template:function(t,i){if(1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u540d\u79f0"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.YNc(6,kn,1,1,"ng-template",null,4,e.W1O),e.qZA()()()),2&t){const s=e.MAs(7);e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",s)}},dependencies:[w.O5,C._Y,C.Fj,C.JJ,C.JL,C.sg,C.u,Tt.t3,Tt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp]}),o})();var wt=b(5156);const En=function(o){return{selected:o}};function An(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.open(r))}),e._uU(1),e.TgZ(2,"div",2),e.NdJ("click",function(s){return s.stopPropagation()}),e.TgZ(3,"span",3),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleCopy(r))}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleEdit(r))}),e.qZA(),e.TgZ(5,"span",5),e.NdJ("click",function(){const r=e.CHM(t).index,a=e.oxw();return e.KtG(a.handleDel(r))}),e.qZA()()()}if(2&o){const t=n.$implicit,i=n.index,s=e.oxw();e.Q6J("ngClass",e.VKq(2,En,i==s.index)),e.xp6(1),e.hij(" ",t.name," ")}}let On=(()=>{class o{constructor(t,i,s){this.modal=t,this.ms=i,this.viewContainerRef=s,this.onPageChange=new e.vpe,this.index=0}handleEdit(t){const i=void 0===t,s=this.modal.create({nzTitle:i?"\u65b0\u589e\u9875\u9762":"\u7f16\u8f91\u9875\u9762",nzContent:Mn,nzComponentParams:{row:i?{name:"",content:{}}:this.project.pages[t]},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>s.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:r=>{const a=r?.group.value;i?this.project.pages.push({name:a.name,content:{}}):this.project.pages[t].name=a.name,this.onPageChange.emit(0),s.destroy()}}]})}handleDel(t){1!=this.project.pages.length?(this.project.pages.splice(t,1),this.index==t&&(t>=this.project.pages.length&&(this.index=t-1),this.onPageChange.emit(this.index))):this.ms.error("\u518d\u5220\u5c31\u6ca1\u6709\u4e86")}open(t){this.index=t,this.onPageChange.emit(t)}handleCopy(t){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(wt.Sf),e.Y36(ht.dD),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-pages"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:1,vars:1,consts:[["class","page",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"page",3,"ngClass","click"],[1,"tools",3,"click"],["nz-icon","","nzType","copy","title","\u590d\u5236",3,"click"],["nz-icon","","nzType","edit","title","\u91cd\u547d\u540d",3,"click"],["nz-icon","","nzType","delete","title","\u5220\u9664",3,"click"]],template:function(t,i){1&t&&e.YNc(0,An,6,4,"div",0),2&t&&e.Q6J("ngForOf",i.project.pages)},dependencies:[w.mk,w.sg,Z.Ls,dt.w],styles:[".page[_ngcontent-%COMP%]{position:relative;padding:3px 5px}.page[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{position:absolute;right:5px;top:3px;display:none}.page.selected[_ngcontent-%COMP%]{background-color:#e1e1e1}.page[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.page[_ngcontent-%COMP%]:hover > .tools[_ngcontent-%COMP%]{display:block}"]}),o})();function Pn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",2),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.clearColor())}),e._uU(1,"\u6e05\u7a7a\u8f93\u5165\u6846"),e.qZA()}}let Dn=(()=>{class o{constructor(){this.color="",this.colorChange=new e.vpe}change(t){console.log("property change",t),this.colorChange.emit(t);let i=this.getPresentColors(),s=i.indexOf(t);s>-1&&i.splice(s,1),i.unshift(t),i.length>12&&(i.length=12),this.setPresentColors(i)}getPresentColors(){let t=localStorage.getItem("bgc-colors");if(t)try{return JSON.parse(t)}catch{}return[]}setPresentColors(t){localStorage.setItem("bgc-colors",JSON.stringify(t))}clearColor(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-color-input"]],inputs:{color:"color"},outputs:{colorChange:"colorChange"},decls:3,vars:8,consts:[["nz-input","","nzSize","small","cpPresetLabel","\u5386\u53f2\u8bb0\u5f55",3,"value","colorPicker","cpEyeDropper","cpUseRootViewContainer","cpPresetColors","cpExtraTemplate","colorPickerChange","cpPresetColorsChange"],["suffixIconClear",""],[3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"input",0),e.NdJ("colorPickerChange",function(r){return i.change(r)})("cpPresetColorsChange",function(r){return i.setPresentColors(r)}),e.qZA(),e.YNc(1,Pn,2,0,"ng-template",null,1,e.W1O)),2&t){const s=e.MAs(2);e.Udp("color",i.color),e.Q6J("value",i.color||"none")("colorPicker",i.color)("cpEyeDropper",!0)("cpUseRootViewContainer",!0)("cpPresetColors",i.getPresentColors())("cpExtraTemplate",s)}},dependencies:[oe.Kk,nt.Zp]}),o})();function Bn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"table")(1,"tr")(2,"td"),e._uU(3,"\u80cc\u666f\u989c\u8272"),e.qZA(),e.TgZ(4,"td")(5,"app-color-input",1),e.NdJ("colorChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.colorChange(s))}),e.qZA()()(),e.TgZ(6,"tr")(7,"td"),e._uU(8,"\u80cc\u666f\u56fe\u7247"),e.qZA(),e.TgZ(9,"td")(10,"input",2),e.NdJ("nzBlur",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSetImage())}),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("color",t.bgcOption.color)}}let Rn=(()=>{class o{constructor(){this.bgcOption={}}colorChange(t){this.bgcOption=Object.assign(this.bgcOption,{color:t}),this.graph.drawBackground(this.bgcOption)}handleSetImage(){console.log(222222222)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-background"]],inputs:{graph:"graph"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"color","colorChange"],["type","text","nzSize","small","nz-input","","placeholder","\u65e0","readonly","",3,"nzBlur"]],template:function(t,i){1&t&&e.YNc(0,Bn,11,1,"table",0),2&t&&e.Q6J("ngIf",i.bgcOption)},dependencies:[w.O5,nt.Zp,Dn],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{min-width:80px}"]}),o})();var Rt=b(8e3);function Fn(o,n){if(1&o&&e._UZ(0,"nz-option",12),2&o){const t=e.oxw().$implicit;e.Q6J("nzValue",t.id)("nzLabel",t.name+"-"+t.id)}}function Zn(o,n){if(1&o&&(e.ynx(0),e.YNc(1,Fn,1,2,"nz-option",11),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function Jn(o,n){1&o&&(e.TgZ(0,"nz-option",13),e._UZ(1,"span",14),e._uU(2," Loading Data... "),e.qZA())}function Ln(o,n){if(1&o&&e._UZ(0,"nz-option",15),2&o){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.name)}}let Gn=(()=>{class o{set content(t){const{product:i}=t;i&&this.getVariableList(i),this.group.patchValue(t)}constructor(t,i){this.fb=t,this.rs=i,this.isLoading=!1,this.optionList=[],this.variableList=[],this.build(),this.onSearch("")}build(t){this.group=this.fb.group({product:[(t=t||{}).product||"",[C.kI.required]],device:[t.device||"",[C.kI.required]],variable:[t.variable||"",[C.kI.required]]})}onSearch(t){this.isLoading=!0,this.rs.post("/api/device/search",{keyword:{name:t},limit:20,skip:0}).subscribe(i=>{this.optionList=i.data||[]}).add(()=>{this.isLoading=!1})}handleChange(t){const i=this.optionList.find(s=>s.id===t)||{product_id:""};this.group.patchValue({product:i.product_id}),this.getVariableList(i.product_id)}getVariableList(t){this.rs.get(`/api/product/${t}`).subscribe(i=>{this.variableList=i&&i.data&&i.data.properties||[]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.qu),e.Y36(_t.s))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-binding-setting"]],inputs:{content:"content"},decls:19,vars:16,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","device",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nzAllowClear","","nzShowSearch","","nzServerSearch","","formControlName","device",3,"nzOnSearch","ngModelChange"],[4,"ngFor","ngForOf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],["nzRequired","","nzFor","product",3,"nzSm","nzXs"],["nz-input","","formControlName","product"],["nzRequired","","nzFor","variable",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","variable"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel",4,"ngIf"],[3,"nzValue","nzLabel"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"],[3,"nzLabel","nzValue"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u8bbe\u5907ID"),e.qZA(),e.TgZ(4,"nz-form-control",2)(5,"nz-select",3),e.NdJ("nzOnSearch",function(r){return i.onSearch(r)})("ngModelChange",function(r){return i.handleChange(r)}),e.YNc(6,Zn,2,1,"ng-container",4),e.YNc(7,Jn,3,0,"nz-option",5),e.qZA()()(),e.TgZ(8,"nz-form-item")(9,"nz-form-label",6),e._uU(10,"\u4ea7\u54c1ID"),e.qZA(),e.TgZ(11,"nz-form-control",2),e._UZ(12,"input",7),e.qZA()(),e.TgZ(13,"nz-form-item")(14,"nz-form-label",8),e._uU(15,"\u53d8\u91cf"),e.qZA(),e.TgZ(16,"nz-form-control",2)(17,"nz-select",9),e.YNc(18,Ln,1,2,"nz-option",10),e.qZA()()()()),2&t&&(e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",i.optionList),e.xp6(1),e.Q6J("ngIf",i.isLoading),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",i.variableList))},dependencies:[w.sg,w.O5,C._Y,C.Fj,C.JJ,C.JL,C.sg,C.u,Z.Ls,dt.w,Tt.t3,Tt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp,Rt.Ip,Rt.Vq]}),o})();function jn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.ALo(2,"json"),e.qZA()}if(2&o){const t=n.$implicit,i=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",e.lcZ(2,2,null==i.cell.data||null==i.cell.data.bindings?null:i.cell.data.bindings[t.name]),"\n")}}let Hn=(()=>{class o{constructor(t){this.ms=t}edit(t){this.cell.data.bindings||={},this.ms.create({nzTitle:`\u7f16\u8f91 ${t.label} \u6570\u636e\u7ed1\u5b9a`,nzContent:Gn,nzComponentParams:{content:this.cell.data.bindings[t.name]||{}},nzOnOk:({group:i})=>{this.cell.data.bindings[t.name]=i.value}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(wt.Sf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-binding"]],inputs:{cell:"cell",component:"component"},decls:1,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,i){1&t&&e.YNc(0,jn,3,4,"div",0),2&t&&e.Q6J("ngForOf",null==i.component?null:i.component.bindings)},dependencies:[w.sg,w.Ts]}),o})();var me=b(1103);let Yn=(()=>{class o{constructor(){this.content="",this.codeMirrorOptions={theme:"material",mode:"javascript",lineWrapping:!0,foldGutter:!0,autoCloseBrackets:!0,autoFocus:!0,matchBrackets:!0,lint:!0}}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-listener-setting"]],inputs:{content:"content"},decls:1,vars:2,consts:[[3,"ngModel","options","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"ngx-codemirror",0),e.NdJ("ngModelChange",function(r){return i.content=r}),e.qZA()),2&t&&e.Q6J("ngModel",i.content)("options",i.codeMirrorOptions)},dependencies:[C.JJ,C.On,me.C],styles:[".CodeMirror-sizer{margin-left:0}  .CodeMirror-sizer .CodeMirror-gutters{visibility:hidden}"]}),o})();function Vn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",0),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.edit(r))}),e._uU(1),e.qZA()}if(2&o){const t=n.$implicit,i=e.oxw();e.xp6(1),e.AsE(" ",t.label," : ",null==i.cell.data||null==i.cell.data.listeners?null:i.cell.data.listeners[t.name],"\n")}}let Un=(()=>{class o{constructor(t){this.ms=t,this.click={label:"\u70b9\u51fb",name:"click"}}edit(t){this.cell.data.listeners||={},this.ms.create({nzTitle:`\u7f16\u8f91${t.label}\u4e8b\u4ef6\u811a\u672c`,nzContent:Yn,nzComponentParams:{content:this.cell.data.listeners[t.name]||""},nzOnOk:({content:i})=>{this.cell.data.listeners=Object.assign(this.cell.data.listeners||{},{[t.name]:i})}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(wt.Sf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-listener"]],inputs:{cell:"cell",component:"component"},decls:3,vars:2,consts:[[3,"click"],[3,"click",4,"ngFor","ngForOf"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.NdJ("click",function(){return i.edit(i.click)}),e._uU(1),e.qZA(),e.YNc(2,Vn,2,2,"div",1)),2&t&&(e.xp6(1),e.hij(" \u70b9\u51fb : ",null==i.cell.data||null==i.cell.data.listeners?null:i.cell.data.listeners.click,"\n"),e.xp6(1),e.Q6J("ngForOf",null==i.component?null:i.component.events))},dependencies:[w.sg]}),o})();function Qn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"form",12),e.NdJ("change",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onPositionChange(s))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"X"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",13),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"Y"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",14),e.qZA()()()()}if(2&o){const t=e.oxw(2);e.Q6J("formGroup",t.formPosition)}}function Wn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"form",12),e.NdJ("change",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSizeChange(s))}),e.TgZ(1,"table")(2,"tr")(3,"td"),e._uU(4,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",15),e.qZA()(),e.TgZ(7,"tr")(8,"td"),e._uU(9,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",16),e.qZA()()()()}if(2&o){const t=e.oxw(2);e.Q6J("formGroup",t.formSize)}}function $n(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"form",12),e.NdJ("change",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onLinePositionChange(s))}),e.TgZ(1,"table")(2,"tr",17)(3,"td"),e._uU(4,"\u8d77\u70b9"),e.qZA(),e.TgZ(5,"td"),e._uU(6,"X:"),e._UZ(7,"input",18),e.qZA(),e.TgZ(8,"td"),e._uU(9,"Y:"),e._UZ(10,"input",19),e.qZA()(),e.TgZ(11,"tr",20)(12,"td"),e._uU(13,"\u7ec8\u70b9"),e.qZA(),e.TgZ(14,"td"),e._uU(15,"X:"),e._UZ(16,"input",18),e.qZA(),e.TgZ(17,"td"),e._uU(18,"Y:"),e._UZ(19,"input",19),e.qZA()()()()}if(2&o){const t=e.oxw(2);e.Q6J("formGroup",t.formLinePosition)}}function Xn(o,n){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"app-property-input",21),e.qZA()()),2&o){const t=n.$implicit,i=e.oxw(2);e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("property",t)("cell",i.cell)}}function qn(o,n){if(1&o&&(e.TgZ(0,"app-collapse",9),e.YNc(1,Qn,12,1,"form",10),e.YNc(2,Wn,12,1,"form",10),e.YNc(3,$n,20,1,"form",10),e.TgZ(4,"table"),e.YNc(5,Xn,5,3,"tr",11),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isNode()),e.xp6(1),e.Q6J("ngIf",t.cell.isEdge()),e.xp6(2),e.Q6J("ngForOf",t.cmp.properties)}}function Kn(o,n){if(1&o&&(e.TgZ(0,"app-collapse",22),e._UZ(1,"app-binding",23),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}function ti(o,n){if(1&o&&(e.TgZ(0,"app-collapse",24),e._UZ(1,"app-listener",23),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("cell",t.cell)("component",t.cmp)}}let ei=(()=>{class o{get graph(){return this.g}set graph(t){this.g=t,t.on("cell:change:size",i=>{i.cell==this.cell&&this.formSize.patchValue(i.current)}),t.on("cell:change:position",i=>{i.cell==this.cell&&this.formPosition.patchValue(i.current)}),t.on("cell:unselected",({cell:i})=>{i==this.cell&&(this.cmp=void 0)}),t.on("selection:changed",({selected:i})=>{if(this.selected=i,1===t.getSelectedCellCount()){if(this.cell=t.getSelectedCells()[0],this.cell.isNode()){const s=this.cell.getPosition();this.formPosition.patchValue(s);const r=this.cell.getSize();this.formSize.patchValue(r)}else if(this.cell.isEdge()){const s=this.cell.getProp("source"),r=this.cell.getProp("target");this.formLinePosition.patchValue({source:s,target:r})}this.cmp=this.cs.Get(this.cell.shape)}})}constructor(t,i){this.fb=t,this.cs=i,this.onPageChange=new e.vpe,this.selected=[],this.formPosition=t.group({x:[0,[C.kI.required]],y:[0,[C.kI.required]]}),this.formSize=t.group({width:[0,[C.kI.required]],height:[0,[C.kI.required]]}),this.formLinePosition=t.group({source:t.group({x:[0,[C.kI.required]],y:[0,[C.kI.required]]}),target:t.group({x:[0,[C.kI.required]],y:[0,[C.kI.required]]})})}onPositionChange(t){this.cell.isNode()&&this.cell.setPosition(this.formPosition.value)}onSizeChange(t){this.cell.isNode()&&this.cell.setSize(this.formSize.value)}onLinePositionChange(t){this.cell.setProp(this.formLinePosition.value)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.qu),e.Y36(ut.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-property"]],inputs:{project:"project",graph:"graph"},outputs:{onPageChange:"onPageChange"},decls:9,vars:6,consts:[["title","\u9875\u9762\u7ba1\u7406"],["more","","nz-icon","","nzType","plus","nzTheme","outline","title","\u6dfb\u52a0\u9875\u9762",3,"click"],[3,"graph","project","onPageChange"],["pages",""],["title","\u9875\u9762\u80cc\u666f"],[3,"graph"],["title","\u63a7\u4ef6\u5c5e\u6027",4,"ngIf"],["title","\u6570\u636e\u7ed1\u5b9a",4,"ngIf"],["title","\u4e8b\u4ef6\u54cd\u5e94",4,"ngIf"],["title","\u63a7\u4ef6\u5c5e\u6027"],[3,"formGroup","change",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"formGroup","change"],["nz-input","","nzSize","small","type","number","formControlName","x"],["nz-input","","nzSize","small","type","number","formControlName","y"],["nz-input","","nzSize","small","type","number","formControlName","width"],["nz-input","","nzSize","small","type","number","formControlName","height"],["formGroupName","source"],["nz-input","","nzSize","small","type","number","formControlName","x",2,"width","60px"],["nz-input","","nzSize","small","type","number","formControlName","y",2,"width","60px"],["formGroupName","target"],[3,"property","cell"],["title","\u6570\u636e\u7ed1\u5b9a"],[3,"cell","component"],["title","\u4e8b\u4ef6\u54cd\u5e94"]],template:function(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"app-collapse",0)(1,"span",1),e.NdJ("click",function(a){return e.CHM(s),e.MAs(3).handleEdit(),e.KtG(a.stopPropagation())}),e.qZA(),e.TgZ(2,"app-pages",2,3),e.NdJ("onPageChange",function(a){return i.onPageChange.emit(a)}),e.qZA()(),e.TgZ(4,"app-collapse",4),e._UZ(5,"app-background",5),e.qZA(),e.YNc(6,qn,6,4,"app-collapse",6),e.YNc(7,Kn,2,2,"app-collapse",7),e.YNc(8,ti,2,2,"app-collapse",8)}2&t&&(e.xp6(2),e.Q6J("graph",i.graph)("project",i.project),e.xp6(3),e.Q6J("graph",i.graph),e.xp6(1),e.Q6J("ngIf",i.selected.length&&i.cmp),e.xp6(1),e.Q6J("ngIf",1==i.selected.length&&(null==i.cmp||null==i.cmp.bindings?null:i.cmp.bindings.length)),e.xp6(1),e.Q6J("ngIf",1==i.selected.length&&i.cmp))},dependencies:[w.sg,w.O5,C._Y,C.Fj,C.wV,C.JJ,C.JL,C.sg,C.u,C.x0,Z.Ls,dt.w,nt.Zp,Nn,xt,On,Rn,Hn,Un],styles:["[_nghost-%COMP%]{width:241px;height:100%;overflow-y:auto;overflow-x:hidden;border-left:1px solid #a8a8a8}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{min-width:80px}"]}),o})(),ni=(()=>{class o{set project(t){t&&this.group.patchValue(t)}constructor(t){this.fb=t,this.build()}build(t){this.group=this.fb.group({name:[(t=t||{}).name||"",[C.kI.required]],desc:[t.desc||"",[]],width:[t.width||400,[C.kI.required]],height:[t.height||400,[C.kI.required]]})}setData(t){const i=this.group.value;for(const s in i)i[s]=t[s];this.group.setValue(i)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-project-setting"]],inputs:{project:"project"},decls:21,vars:9,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","name",3,"nzSpan"],["nzErrorTip","\u540d\u79f0\u4e0d\u53ef\u4e3a\u7a7a!",3,"nzSpan"],["nz-input","","name","name","formControlName","name"],["nzFor","width",3,"nzSpan"],[3,"nzSpan"],["formControlName","width"],["nzFor","height",3,"nzSpan"],["formControlName","height"],["nzFor","desc",3,"nzSpan"],["nz-input","","name","desc","formControlName","desc"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),e._uU(3,"\u540d\u79f0"),e.qZA(),e.TgZ(4,"nz-form-control",2),e._UZ(5,"input",3),e.qZA()(),e.TgZ(6,"nz-form-item")(7,"nz-form-label",4),e._uU(8,"\u5bbd\u5ea6"),e.qZA(),e.TgZ(9,"nz-form-control",5),e._UZ(10,"nz-input-number",6),e.qZA()(),e.TgZ(11,"nz-form-item")(12,"nz-form-label",7),e._uU(13,"\u9ad8\u5ea6"),e.qZA(),e.TgZ(14,"nz-form-control",5),e._UZ(15,"nz-input-number",8),e.qZA()(),e.TgZ(16,"nz-form-item")(17,"nz-form-label",9),e._uU(18,"\u8bf4\u660e"),e.qZA(),e.TgZ(19,"nz-form-control",5),e._UZ(20,"input",10),e.qZA()()()),2&t&&(e.Q6J("formGroup",i.group),e.xp6(2),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",16))},dependencies:[C._Y,C.Fj,C.JJ,C.JL,C.sg,C.u,Tt.t3,Tt.SK,it.Lr,it.Nx,it.iK,it.Fd,nt.Zp,ge]}),o})();var be=b(2577);const ii=function(){return{standalone:!0}};let oi=(()=>{class o{constructor(t,i,s,r){this.cs=t,this.modal=i,this.msg=s,this.viewContainerRef=r,this.onSave=new e.vpe,this.scale=1,this.scaleChange=new e.vpe,this.showGrid=JSON.parse(localStorage.getItem("show_grid")||"true")}handleSave(){this.onSave.emit()}handleExport(){this.savefiles(this.graph.toJSON(),Date.now()+"")}handleUndo(){this.graph.undo()}handleRedo(){this.graph.redo()}handleCut(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.cut(this.graph.getSelectedCells(),{deep:!0})}handleCopy(){this.graph.getSelectedCells().forEach(t=>t.removeTools()),this.graph.copy(this.graph.getSelectedCells(),{deep:!0})}handlePaste(){this.graph.paste()}handleDelete(){this.graph.getSelectedCells().forEach(t=>t.remove())}handleAlignLeft(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position();void 0===t?t=r.x:(r.x=t,s.setPosition(r))})}handleAlignCenter(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position(),a=s.size();void 0===t?t=r.x+.5*a.width:(r.x=t-.5*a.width,s.setPosition(r))})}handleAlignRight(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position(),a=s.size();void 0===t?t=r.x+a.width:(r.x=t-a.width,s.setPosition(r))})}handleValignTop(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position();void 0===t?t=r.y:(r.y=t,s.setPosition(r))})}handleValignMiddle(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position(),a=s.size();void 0===t?t=r.y+.5*a.height:(r.y=t-.5*a.height,s.setPosition(r))})}handleValignBottom(){let t;this.graph.getSelectedCells().forEach(i=>{if(!i.isNode())return;let s=i,r=s.position(),a=s.size();void 0===t?t=r.y+a.height:(r.y=t-a.height,s.setPosition(r))})}handleMoveTop(){this.graph.getSelectedCells().forEach(t=>{t.toFront()})}handleMoveUp(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)+1)}handleMoveDown(){const t=this.graph.getSelectedCells()[0];t.setZIndex(Number(t.getZIndex()||0)-1)}handleMoveBottom(){this.graph.getSelectedCells().forEach(t=>{t.toBack()})}handleGroup(){let t=this.graph.getSelectedCells().map(r=>r.getBBox()),i={x:t.reduce((r,a)=>r.x<a.x?r:a).x-10,y:t.reduce((r,a)=>r.y<a.y?r:a).y-10,right:t.reduce((r,a)=>r.right>a.right?r:a).right+10,bottom:t.reduce((r,a)=>r.bottom>a.bottom?r:a).bottom+10};console.log("group",i),this.cs.Get("group");let s=this.graph.addNode({shape:"group",x:i.x,y:i.y,width:i.right-i.x,height:i.bottom-i.y});this.graph.getSelectedCells().forEach(r=>{r.setZIndex(s.zIndex+r.zIndex),s.addChild(r)})}handleUngroup(){this.graph.getSelectedCells().forEach(t=>{"group"==t.shape&&(t.getChildren()?.forEach(i=>{i.setParent(null)}),t.setChildren(null),t.remove())})}isGroup(){return 1===this.graph.getSelectedCellCount()&&this.graph.getSelectedCells()[0].getChildCount()>0}handleGrid(){this.showGrid?this.graph.hideGrid():this.graph.showGrid(),this.showGrid=!this.showGrid,localStorage.setItem("show_grid",JSON.stringify(this.showGrid))}settingProject(){const t=this.modal.create({nzTitle:"\u7f16\u8f91\u5de5\u7a0b\u4fe1\u606f",nzContent:ni,nzComponentParams:{project:this.project},nzViewContainerRef:this.viewContainerRef,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>t.destroy()},{label:"\u4fdd\u5b58",type:"primary",onClick:i=>{const s=i.group.value;Object.assign(this.project,s),console.log("project setting",s),t.destroy()}}]})}savefiles(t,i){const s=window.URL||window.webkitURL||window,r=new Blob([JSON.stringify(t)]),a=document.createElement("a");a.href=s.createObjectURL(r),a.download=i,a.click()}handleScale(t){this.scaleChange.emit(t),this.graph.zoomTo(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ut.m),e.Y36(wt.Sf),e.Y36(ht.dD),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-toolbar"]],inputs:{project:"project",graph:"graph",scale:"scale"},outputs:{onSave:"onSave",scaleChange:"scaleChange"},features:[e._Bn([ht.dD,wt.Sf])],decls:60,vars:27,consts:[["nz-button","",3,"click"],["nz-icon","","nzType","save","title","\u4fdd\u5b58"],["nz-icon","","nzType","export","title","\u5bfc\u51fa"],["nzType","vertical"],["nz-button","","title","\u64a4\u9500(ctrl+z)",3,"disabled","click"],["nz-icon","","nzType","undo"],["nz-button","","title","\u91cd\u505a(ctrl+y)",3,"disabled","click"],["nz-icon","","nzType","redo"],["nz-button","","title","\u526a\u5207(ctrl+x)",3,"disabled","click"],["nz-icon","","nzType","scissor"],["nz-button","","title","\u590d\u5236(ctrl+c)",3,"disabled","click"],["nz-icon","","nzType","copy"],["nz-button","","title","\u7c98\u8d34(ctrl+v)",3,"disabled","click"],["nz-icon","","nzType","snippets"],["nz-button","","title","\u5220\u9664",3,"disabled","click"],["nz-icon","","nzType","delete"],["nz-button","",3,"disabled","click"],["nz-icon","","nzType","align-left","title","\u5de6\u5bf9\u9f50"],["nz-icon","","nzType","align-center","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","align-right","title","\u53f3\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-top","title","\u4e0a\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-middle","title","\u5c45\u4e2d\u5bf9\u9f50"],["nz-icon","","nzType","vertical-align-bottom","title","\u4e0b\u5bf9\u9f50"],["nz-icon","","nzType","vertical-right","title","\u7f6e\u9876",3,"nzRotate"],["nz-icon","","nzType","up","title","\u4e0a\u79fb\u4e00\u5c42"],["nz-icon","","nzType","down","title","\u4e0b\u79fb\u4e00\u5c42"],["nz-icon","","nzType","vertical-left","title","\u7f6e\u5e95",3,"nzRotate"],["nz-icon","","nzType","group","title","\u7ec4\u5408"],["nz-icon","","nzType","ungroup","title","\u89e3\u9664\u7ec4\u5408"],["nz-icon","","nzType","table","title","\u663e\u793a\u7f51\u683c"],["nz-icon","","nzType","setting","title","\u5de5\u7a0b\u8bbe\u7f6e"],[3,"ngModel","ngModelOptions","ngModelChange"],["nzLabel","25%",3,"nzValue"],["nzLabel","50%",3,"nzValue"],["nzLabel","75%",3,"nzValue"],["nzLabel","100%",3,"nzValue"],["nzLabel","200%",3,"nzValue"],["nzLabel","500%",3,"nzValue"]],template:function(t,i){1&t&&(e.TgZ(0,"a",0),e.NdJ("click",function(){return i.handleSave()}),e._UZ(1,"i",1),e._uU(2," \u4fdd\u5b58\n"),e.qZA(),e.TgZ(3,"a",0),e.NdJ("click",function(){return i.handleExport()}),e._UZ(4,"i",2),e._uU(5," \u5bfc\u51fa\n"),e.qZA(),e._UZ(6,"nz-divider",3),e.TgZ(7,"a",4),e.NdJ("click",function(){return i.handleUndo()}),e._UZ(8,"i",5),e.qZA(),e.TgZ(9,"a",6),e.NdJ("click",function(){return i.handleRedo()}),e._UZ(10,"i",7),e.qZA(),e._UZ(11,"nz-divider",3),e.TgZ(12,"a",8),e.NdJ("click",function(){return i.handleCut()}),e._UZ(13,"i",9),e.qZA(),e.TgZ(14,"a",10),e.NdJ("click",function(){return i.handleCopy()}),e._UZ(15,"i",11),e.qZA(),e.TgZ(16,"a",12),e.NdJ("click",function(){return i.handlePaste()}),e._UZ(17,"i",13),e.qZA(),e.TgZ(18,"a",14),e.NdJ("click",function(){return i.handleDelete()}),e._UZ(19,"i",15),e.qZA(),e._UZ(20,"nz-divider",3),e.TgZ(21,"a",16),e.NdJ("click",function(){return i.handleAlignLeft()}),e._UZ(22,"i",17),e.qZA(),e.TgZ(23,"a",16),e.NdJ("click",function(){return i.handleAlignCenter()}),e._UZ(24,"i",18),e.qZA(),e.TgZ(25,"a",16),e.NdJ("click",function(){return i.handleAlignRight()}),e._UZ(26,"i",19),e.qZA(),e._UZ(27,"nz-divider",3),e.TgZ(28,"a",16),e.NdJ("click",function(){return i.handleValignTop()}),e._UZ(29,"i",20),e.qZA(),e.TgZ(30,"a",16),e.NdJ("click",function(){return i.handleValignMiddle()}),e._UZ(31,"i",21),e.qZA(),e.TgZ(32,"a",16),e.NdJ("click",function(){return i.handleValignBottom()}),e._UZ(33,"i",22),e.qZA(),e._UZ(34,"nz-divider",3),e.TgZ(35,"a",0),e.NdJ("click",function(){return i.handleMoveTop()}),e._UZ(36,"i",23),e.qZA(),e.TgZ(37,"a",16),e.NdJ("click",function(){return i.handleMoveUp()}),e._UZ(38,"i",24),e.qZA(),e.TgZ(39,"a",16),e.NdJ("click",function(){return i.handleMoveDown()}),e._UZ(40,"i",25),e.qZA(),e.TgZ(41,"a",0),e.NdJ("click",function(){return i.handleMoveBottom()}),e._UZ(42,"i",26),e.qZA(),e._UZ(43,"nz-divider",3),e.TgZ(44,"a",16),e.NdJ("click",function(){return i.handleGroup()}),e._UZ(45,"i",27),e.qZA(),e.TgZ(46,"a",16),e.NdJ("click",function(){return i.handleUngroup()}),e._UZ(47,"i",28),e.qZA(),e._UZ(48,"nz-divider",3),e.TgZ(49,"a",0),e.NdJ("click",function(){return i.handleGrid()}),e._UZ(50,"i",29),e.qZA(),e.TgZ(51,"a",0),e.NdJ("click",function(){return i.settingProject()}),e._UZ(52,"i",30),e.qZA(),e.TgZ(53,"nz-select",31),e.NdJ("ngModelChange",function(r){return i.handleScale(r)}),e._UZ(54,"nz-option",32)(55,"nz-option",33)(56,"nz-option",34)(57,"nz-option",35)(58,"nz-option",36)(59,"nz-option",37),e.qZA()),2&t&&(e.xp6(7),e.Q6J("disabled",!i.graph.canUndo()),e.xp6(2),e.Q6J("disabled",!i.graph.canRedo()),e.xp6(3),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",!i.graph.getCellsInClipboard().length),e.xp6(2),e.Q6J("disabled",!i.graph.getSelectedCellCount()),e.xp6(3),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(3),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(4),e.Q6J("nzRotate",90),e.xp6(1),e.Q6J("disabled",1!=i.graph.getSelectedCellCount()),e.xp6(2),e.Q6J("disabled",1!=i.graph.getSelectedCellCount()),e.xp6(3),e.Q6J("nzRotate",90),e.xp6(2),e.Q6J("disabled",i.graph.getSelectedCellCount()<2),e.xp6(2),e.Q6J("disabled",!i.isGroup()),e.xp6(7),e.Q6J("ngModel",i.scale)("ngModelOptions",e.DdM(26,ii)),e.xp6(1),e.Q6J("nzValue",.25),e.xp6(1),e.Q6J("nzValue",.5),e.xp6(1),e.Q6J("nzValue",.75),e.xp6(1),e.Q6J("nzValue",1),e.xp6(1),e.Q6J("nzValue",2),e.xp6(1),e.Q6J("nzValue",5))},dependencies:[C.JJ,C.On,Z.Ls,be.g,et.ix,dt.w,Rt.Ip,Rt.Vq],styles:["[_nghost-%COMP%]{height:50px;display:flex;align-items:center;vertical-align:middle;padding:0 20px;font-size:20px;font-weight:700;overflow:hidden;border-bottom:1px solid #a8a8a8;background-color:#f0f0f0}a[_ngcontent-%COMP%]{padding:5px;margin:1px;cursor:pointer;text-decoration:none}a.disabled[_ngcontent-%COMP%]{color:gray;cursor:default}"]}),o})();const si=["canvas"];let ze=(()=>{class o{constructor(t,i,s,r,a,c){this.title=t,this.rs=i,this.msg=s,this.router=r,this.route=a,this.cs=c,this.id="",this.project=function Mt(){return{id:"",name:"\u7ec4\u6001\u5de5\u7a0b",desc:"",width:window.screen.width,height:window.screen.height,pages:[{name:"\u9996\u9875",content:{}}]}}(),this.index=0,this.scale=1,t.setTitle(this.project.name)}ngOnInit(){this.route.snapshot.paramMap.has("id")&&(this.id=this.route.snapshot.paramMap.get("id"),this.rs.get(`api/project/${this.id}`).subscribe(t=>{this.project=t.data,this.title.setTitle(this.project.name),this.canvas.Render(this.project.pages[0])}))}onDrag(t){this.canvas.Draw(t)}handleSave(){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.rs.post(this.id?`api/project/${this.id}`:"api/project/create",this.project).subscribe(i=>{this.router.navigateByUrl("/admin/project")})}handlePageChange(t){this.project.pages[this.index].content=this.canvas.graph.toJSON(),this.index=t,this.canvas.Render(this.project.pages[this.index])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ct.Dx),e.Y36(_t.s),e.Y36(ht.dD),e.Y36(lt.F0),e.Y36(lt.gz),e.Y36(ut.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-editor"]],viewQuery:function(t,i){if(1&t&&e.Gf(si,5),2&t){let s;e.iGM(s=e.CRH())&&(i.canvas=s.first)}},decls:7,vars:9,consts:[[3,"graph","project","scale","onSave","scaleChange"],[1,"body"],[3,"onDrag"],[1,"content"],["canvas",""],[3,"graph","project","onPageChange"]],template:function(t,i){if(1&t&&(e.TgZ(0,"app-toolbar",0),e.NdJ("onSave",function(){return i.handleSave()})("scaleChange",function(r){return i.scale=r}),e.qZA(),e.TgZ(1,"div",1)(2,"app-library",2),e.NdJ("onDrag",function(r){return i.onDrag(r)}),e.qZA(),e.TgZ(3,"div",3),e._UZ(4,"app-canvas",null,4),e.qZA(),e.TgZ(6,"app-property",5),e.NdJ("onPageChange",function(r){return i.handlePageChange(r)}),e.qZA()()),2&t){const s=e.MAs(5);e.Q6J("graph",s.graph)("project",i.project)("scale",i.scale),e.xp6(4),e.Udp("width",i.project.width*i.scale+"px")("height",i.project.height*i.scale+"px"),e.xp6(2),e.Q6J("graph",s.graph)("project",i.project)}},dependencies:[m,He,ei,oi],styles:["[_nghost-%COMP%]{height:100%;min-width:600px;overflow:hidden;display:flex;flex-direction:column;letter-spacing:.1em;font-size:12px}.body[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}.body[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;height:100%;position:relative;padding:10px;background-color:#f0f0f0;overflow:auto}"]}),o})();const ri=[{path:"",component:ze},{path:":id",component:ze}];let ai=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[lt.Bz.forChild(ri),lt.Bz]}),o})();var H=b(1218),Ce=b(3353),li=b(2289);let ui=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[gt.vT,w.ez,Z.PV,li.xu,Ce.ud]}),o})();var fi=b(6903),se=(b(5469),b(1281),b(727),b(6406),b(3101),b(9646),b(3601),b(8675),b(590),b(9300),b(1005),b(3325),b(9562)),Te=b(2540),xi=(b(1519),b(9643));b(8932),new e.OlP("NZ_TAB_SET");let io=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[gt.vT,w.ez,xi.Q8,Z.PV,mt.T,Ce.ud,Bt.rt,Te.ZD,se.b1]}),o})();var oo=b(8213),so=b(9166),ro=b(6672);let ao=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[{provide:ht.dD},ut.m],imports:[w.ez,C.u5,C.UX,ai,Z.PV.forChild([H.qgH,H.n0m,H.CnB,H.ctN,H.KrS,H.x0x,H.BXO,H.vkb,H.MjI,H.NvA,H.J1v,H.TSL,H.HIu,H.lKn,H.Xwh,H.fhO,H.FsU,H.vEg,H.zuz,H.DxT]),be.S,et.sL,oe.e4,it.U5,nt.o7,wt.Qp,ui,fi.zf,io,oo.Wr,so.Y,Rt.LV,cn,me.k,ro.X,zn]}),o})()},7521:(It,kt,b)=>{var w;!function(lt,Mt,e){if(lt){for(var Z,ct={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ht={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},ut={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},et=1;et<20;++et)ct[111+et]="f"+et;for(et=0;et<=9;++et)ct[et+96]=et.toString();V.prototype.bind=function(f,m,l){var B=this;return B._bindMultiple.call(B,f=f instanceof Array?f:[f],m,l),B},V.prototype.unbind=function(f,m){return this.bind.call(this,f,function(){},m)},V.prototype.trigger=function(f,m){var l=this;return l._directMap[f+":"+m]&&l._directMap[f+":"+m]({},f),l},V.prototype.reset=function(){var f=this;return f._callbacks={},f._directMap={},f},V.prototype.stopCallback=function(f,m){if((" "+m.className+" ").indexOf(" mousetrap ")>-1||Jt(m,this.target))return!1;if("composedPath"in f&&"function"==typeof f.composedPath){var B=f.composedPath()[0];B!==f.target&&(m=B)}return"INPUT"==m.tagName||"SELECT"==m.tagName||"TEXTAREA"==m.tagName||m.isContentEditable},V.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},V.addKeycodes=function(f){for(var m in f)f.hasOwnProperty(m)&&(ct[m]=f[m]);Z=null},V.init=function(){var f=V(Mt);for(var m in f)"_"!==m.charAt(0)&&(V[m]=function(l){return function(){return f[l].apply(f,arguments)}}(m))},V.init(),lt.Mousetrap=V,It.exports&&(It.exports=V),void 0!==(w=function(){return V}.call(kt,b,kt,It))&&(It.exports=w)}function dt(f,m,l){f.addEventListener?f.addEventListener(m,l,!1):f.attachEvent("on"+m,l)}function yt(f){if("keypress"==f.type){var m=String.fromCharCode(f.which);return f.shiftKey||(m=m.toLowerCase()),m}return ct[f.which]?ct[f.which]:_t[f.which]?_t[f.which]:String.fromCharCode(f.which).toLowerCase()}function nt(f,m){return f.sort().join(",")===m.sort().join(",")}function xt(f){return"shift"==f||"ctrl"==f||"alt"==f||"meta"==f}function te(f,m,l){return l||(l=function Kt(){if(!Z)for(var f in Z={},ct)f>95&&f<112||ct.hasOwnProperty(f)&&(Z[ct[f]]=f);return Z}()[f]?"keydown":"keypress"),"keypress"==l&&m.length&&(l="keydown"),l}function Zt(f,m){var l,B,rt,O=[];for(l=function ee(f){return"+"===f?["+"]:(f=f.replace(/\+{2}/g,"+plus")).split("+")}(f),rt=0;rt<l.length;++rt)ut[B=l[rt]]&&(B=ut[B]),m&&"keypress"!=m&&ht[B]&&(B=ht[B],O.push("shift")),xt(B)&&O.push(B);return{key:B,modifiers:O,action:m=te(B,O,m)}}function Jt(f,m){return null!==f&&f!==Mt&&(f===m||Jt(f.parentNode,m))}function V(f){var m=this;if(f=f||Mt,!(m instanceof V))return new V(f);m.target=f,m._callbacks={},m._directMap={};var B,l={},rt=!1,O=!1,Et=!1;function At(S){S=S||{};var E,M=!1;for(E in l)S[E]?M=!0:l[E]=0;M||(Et=!1)}function pt(S,M,E,k,D,ot){var A,U,ft=[],K=E.type;if(!m._callbacks[S])return[];for("keyup"==K&&xt(S)&&(M=[S]),A=0;A<m._callbacks[S].length;++A)U=m._callbacks[S][A],!k&&U.seq&&l[U.seq]!=U.level||K!=U.action||("keypress"!=K||E.metaKey||E.ctrlKey)&&!nt(M,U.modifiers)||((!k&&U.combo==D||k&&U.seq==k&&U.level==ot)&&m._callbacks[S].splice(A,1),ft.push(U));return ft}function Ot(S,M,E,k){m.stopCallback(M,M.target||M.srcElement,E,k)||!1===S(M,E)&&(function Xt(f){f.preventDefault?f.preventDefault():f.returnValue=!1}(M),function qt(f){f.stopPropagation?f.stopPropagation():f.cancelBubble=!0}(M))}function Pt(S){"number"!=typeof S.which&&(S.which=S.keyCode);var M=yt(S);if(M){if("keyup"==S.type&&rt===M)return void(rt=!1);m.handleKey(M,function $t(f){var m=[];return f.shiftKey&&m.push("shift"),f.altKey&&m.push("alt"),f.ctrlKey&&m.push("ctrl"),f.metaKey&&m.push("meta"),m}(S),S)}}function Gt(S,M,E,k,D){m._directMap[S+":"+E]=M;var A,ot=(S=S.replace(/\s+/g," ")).split(" ");ot.length>1?function ne(S,M,E,k){function D(K){return function(){Et=K,++l[S],function Lt(){clearTimeout(B),B=setTimeout(At,1e3)}()}}function ot(K){Ot(E,K,S),"keyup"!==k&&(rt=yt(K)),setTimeout(At,10)}l[S]=0;for(var A=0;A<M.length;++A){var ft=A+1===M.length?ot:D(k||Zt(M[A+1]).action);Gt(M[A],ft,k,S,A)}}(S,ot,M,E):(A=Zt(S,E),m._callbacks[A.key]=m._callbacks[A.key]||[],pt(A.key,A.modifiers,{type:A.action},k,S,D),m._callbacks[A.key][k?"unshift":"push"]({callback:M,modifiers:A.modifiers,action:A.action,seq:k,level:D,combo:S}))}m._handleKey=function(S,M,E){var D,k=pt(S,M,E),ot={},A=0,U=!1;for(D=0;D<k.length;++D)k[D].seq&&(A=Math.max(A,k[D].level));for(D=0;D<k.length;++D)if(k[D].seq){if(k[D].level!=A)continue;U=!0,ot[k[D].seq]=1,Ot(k[D].callback,E,k[D].combo,k[D].seq)}else U||Ot(k[D].callback,E,k[D].combo);var ft="keypress"==E.type&&O;E.type==Et&&!xt(S)&&!ft&&At(ot),O=U&&"keydown"==E.type},m._bindMultiple=function(S,M,E){for(var k=0;k<S.length;++k)Gt(S[k],M,E)},dt(f,"keypress",Pt),dt(f,"keydown",Pt),dt(f,"keyup",Pt)}}(typeof window<"u"?window:null,typeof window<"u"?document:null)}}]);